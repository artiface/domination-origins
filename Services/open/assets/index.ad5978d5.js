const Zu=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerpolicy&&(s.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?s.credentials="include":r.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}};Zu();/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const vl="141",Yu=0,Ul=1,Ju=2,Yf=1,Ku=2,ds=3,Ms=0,Pn=1,Ur=2,Qu=1,Oi=0,Dr=1,zl=2,Gl=3,Vl=4,$u=5,Er=100,td=101,ed=102,Hl=103,Wl=104,nd=200,id=201,rd=202,sd=203,Jf=204,Kf=205,od=206,ad=207,ld=208,cd=209,fd=210,hd=0,ud=1,dd=2,Xa=3,pd=4,md=5,gd=6,vd=7,Oo=0,xd=1,_d=2,xi=0,yd=1,bd=2,wd=3,Md=4,Sd=5,Qf=300,zr=301,Gr=302,Za=303,Ya=304,Uo=306,Ja=1e3,Tn=1001,Ka=1002,Ye=1003,ql=1004,jl=1005,un=1006,Ad=1007,zo=1008,nr=1009,Ed=1010,Td=1011,$f=1012,Cd=1013,Ji=1014,Ki=1015,Ss=1016,Rd=1017,Pd=1018,Nr=1020,Id=1021,Ld=1022,Cn=1023,Dd=1024,Nd=1025,$i=1026,Vr=1027,Fd=1028,Bd=1029,kd=1030,Od=1031,Ud=1033,Qo=33776,$o=33777,ta=33778,ea=33779,Xl=35840,Zl=35841,Yl=35842,Jl=35843,zd=36196,Kl=37492,Ql=37496,$l=37808,tc=37809,ec=37810,nc=37811,ic=37812,rc=37813,sc=37814,oc=37815,ac=37816,lc=37817,cc=37818,fc=37819,hc=37820,uc=37821,dc=36492,ir=3e3,pe=3001,Gd=3200,Vd=3201,Yr=0,Hd=1,di="srgb",Qi="srgb-linear",na=7680,Wd=519,pc=35044,mc="300 es",Qa=1035;class Jr{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const r=this._listeners[t];if(r!==void 0){const s=r.indexOf(e);s!==-1&&r.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const r=n.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,t);t.target=null}}}const Ce=[];for(let i=0;i<256;i++)Ce[i]=(i<16?"0":"")+i.toString(16);const ia=Math.PI/180,gc=180/Math.PI;function Ns(){const i=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Ce[i&255]+Ce[i>>8&255]+Ce[i>>16&255]+Ce[i>>24&255]+"-"+Ce[t&255]+Ce[t>>8&255]+"-"+Ce[t>>16&15|64]+Ce[t>>24&255]+"-"+Ce[e&63|128]+Ce[e>>8&255]+"-"+Ce[e>>16&255]+Ce[e>>24&255]+Ce[n&255]+Ce[n>>8&255]+Ce[n>>16&255]+Ce[n>>24&255]).toLowerCase()}function Je(i,t,e){return Math.max(t,Math.min(e,i))}function qd(i,t){return(i%t+t)%t}function ra(i,t,e){return(1-e)*i+e*t}function vc(i){return(i&i-1)===0&&i!==0}function $a(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}class ne{constructor(t=0,e=0){this.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),r=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*r+t.x,this.y=s*r+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Wn{constructor(){this.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,s,o,a,l,c){const h=this.elements;return h[0]=t,h[1]=r,h[2]=a,h[3]=e,h[4]=s,h[5]=l,h[6]=n,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,s=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],h=n[4],u=n[7],p=n[2],x=n[5],b=n[8],g=r[0],v=r[3],M=r[6],D=r[1],z=r[4],B=r[7],O=r[2],G=r[5],Z=r[8];return s[0]=o*g+a*D+l*O,s[3]=o*v+a*z+l*G,s[6]=o*M+a*B+l*Z,s[1]=c*g+h*D+u*O,s[4]=c*v+h*z+u*G,s[7]=c*M+h*B+u*Z,s[2]=p*g+x*D+b*O,s[5]=p*v+x*z+b*G,s[8]=p*M+x*B+b*Z,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e*o*h-e*a*c-n*s*h+n*a*l+r*s*c-r*o*l}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=h*o-a*c,p=a*l-h*s,x=c*s-o*l,b=e*u+n*p+r*x;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/b;return t[0]=u*g,t[1]=(r*c-h*n)*g,t[2]=(a*n-r*o)*g,t[3]=p*g,t[4]=(h*e-r*l)*g,t[5]=(r*s-a*e)*g,t[6]=x*g,t[7]=(n*l-c*e)*g,t[8]=(o*e-n*s)*g,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(n*l,n*c,-n*(l*o+c*a)+o+t,-r*c,r*l,-r*(-c*o+l*a)+a+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.elements,s=r[0],o=r[3],a=r[6],l=r[1],c=r[4],h=r[7];return r[0]=e*s+n*l,r[3]=e*o+n*c,r[6]=e*a+n*h,r[1]=-n*s+e*l,r[4]=-n*o+e*c,r[7]=-n*a+e*h,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}function th(i){for(let t=i.length-1;t>=0;--t)if(i[t]>65535)return!0;return!1}function As(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function tr(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function vo(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const sa={[di]:{[Qi]:tr},[Qi]:{[di]:vo}},_n={legacyMode:!0,get workingColorSpace(){return Qi},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,t,e){if(this.legacyMode||t===e||!t||!e)return i;if(sa[t]&&sa[t][e]!==void 0){const n=sa[t][e];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,t){return this.convert(i,this.workingColorSpace,t)},toWorkingColorSpace:function(i,t){return this.convert(i,t,this.workingColorSpace)}},eh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},we={r:0,g:0,b:0},yn={h:0,s:0,l:0},Ws={h:0,s:0,l:0};function oa(i,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?i+(t-i)*6*e:e<1/2?t:e<2/3?i+(t-i)*6*(2/3-e):i}function qs(i,t){return t.r=i.r,t.g=i.g,t.b=i.b,t}class Vt{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&n===void 0?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=di){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,_n.toWorkingColorSpace(this,e),this}setRGB(t,e,n,r=Qi){return this.r=t,this.g=e,this.b=n,_n.toWorkingColorSpace(this,r),this}setHSL(t,e,n,r=Qi){if(t=qd(t,1),e=Je(e,0,1),n=Je(n,0,1),e===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+e):n+e-n*e,o=2*n-s;this.r=oa(o,s,t+1/3),this.g=oa(o,s,t),this.b=oa(o,s,t-1/3)}return _n.toWorkingColorSpace(this,r),this}setStyle(t,e=di){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,_n.toWorkingColorSpace(this,e),n(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,_n.toWorkingColorSpace(this,e),n(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){const l=parseFloat(s[1])/360,c=parseInt(s[2],10)/100,h=parseInt(s[3],10)/100;return n(s[4]),this.setHSL(l,c,h,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=r[1],o=s.length;if(o===3)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,_n.toWorkingColorSpace(this,e),this;if(o===6)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,_n.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=di){const n=eh[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=tr(t.r),this.g=tr(t.g),this.b=tr(t.b),this}copyLinearToSRGB(t){return this.r=vo(t.r),this.g=vo(t.g),this.b=vo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=di){return _n.fromWorkingColorSpace(qs(this,we),t),Je(we.r*255,0,255)<<16^Je(we.g*255,0,255)<<8^Je(we.b*255,0,255)<<0}getHexString(t=di){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Qi){_n.fromWorkingColorSpace(qs(this,we),e);const n=we.r,r=we.g,s=we.b,o=Math.max(n,r,s),a=Math.min(n,r,s);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const u=o-a;switch(c=h<=.5?u/(o+a):u/(2-o-a),o){case n:l=(r-s)/u+(r<s?6:0);break;case r:l=(s-n)/u+2;break;case s:l=(n-r)/u+4;break}l/=6}return t.h=l,t.s=c,t.l=h,t}getRGB(t,e=Qi){return _n.fromWorkingColorSpace(qs(this,we),e),t.r=we.r,t.g=we.g,t.b=we.b,t}getStyle(t=di){return _n.fromWorkingColorSpace(qs(this,we),t),t!==di?`color(${t} ${we.r} ${we.g} ${we.b})`:`rgb(${we.r*255|0},${we.g*255|0},${we.b*255|0})`}offsetHSL(t,e,n){return this.getHSL(yn),yn.h+=t,yn.s+=e,yn.l+=n,this.setHSL(yn.h,yn.s,yn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(yn),t.getHSL(Ws);const n=ra(yn.h,Ws.h,e),r=ra(yn.s,Ws.s,e),s=ra(yn.l,Ws.l,e);return this.setHSL(n,r,s),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),t.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Vt.NAMES=eh;let hr;class nh{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{hr===void 0&&(hr=As("canvas")),hr.width=t.width,hr.height=t.height;const n=hr.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=hr}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=As("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=tr(s[o]/255)*255;return n.putImageData(r,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(tr(e[n]/255)*255):e[n]=tr(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class ih{constructor(t=null){this.isSource=!0,this.uuid=Ns(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(aa(r[o].image)):s.push(aa(r[o]))}else s=aa(r);n.url=s}return e||(t.images[this.uuid]=n),n}}function aa(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?nh.getDataURL(i):i.data?{data:Array.prototype.slice.call(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let jd=0;class pn extends Jr{constructor(t=pn.DEFAULT_IMAGE,e=pn.DEFAULT_MAPPING,n=Tn,r=Tn,s=un,o=zo,a=Cn,l=nr,c=1,h=ir){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:jd++}),this.uuid=Ns(),this.name="",this.source=new ih(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ne(0,0),this.repeat=new ne(1,1),this.center=new ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Wn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Qf)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ja:t.x=t.x-Math.floor(t.x);break;case Tn:t.x=t.x<0?0:1;break;case Ka:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ja:t.y=t.y-Math.floor(t.y);break;case Tn:t.y=t.y<0?0:1;break;case Ka:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}}pn.DEFAULT_IMAGE=null;pn.DEFAULT_MAPPING=Qf;class Oe{constructor(t=0,e=0,n=0,r=1){this.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*s,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*s,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*s,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,r,s;const l=t.elements,c=l[0],h=l[4],u=l[8],p=l[1],x=l[5],b=l[9],g=l[2],v=l[6],M=l[10];if(Math.abs(h-p)<.01&&Math.abs(u-g)<.01&&Math.abs(b-v)<.01){if(Math.abs(h+p)<.1&&Math.abs(u+g)<.1&&Math.abs(b+v)<.1&&Math.abs(c+x+M-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const z=(c+1)/2,B=(x+1)/2,O=(M+1)/2,G=(h+p)/4,Z=(u+g)/4,L=(b+v)/4;return z>B&&z>O?z<.01?(n=0,r=.707106781,s=.707106781):(n=Math.sqrt(z),r=G/n,s=Z/n):B>O?B<.01?(n=.707106781,r=0,s=.707106781):(r=Math.sqrt(B),n=G/r,s=L/r):O<.01?(n=.707106781,r=.707106781,s=0):(s=Math.sqrt(O),n=Z/s,r=L/s),this.set(n,r,s,e),this}let D=Math.sqrt((v-b)*(v-b)+(u-g)*(u-g)+(p-h)*(p-h));return Math.abs(D)<.001&&(D=1),this.x=(v-b)/D,this.y=(u-g)/D,this.z=(p-h)/D,this.w=Math.acos((c+x+M-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ui extends Jr{constructor(t,e,n={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Oe(0,0,t,e),this.scissorTest=!1,this.viewport=new Oe(0,0,t,e);const r={width:t,height:e,depth:1};this.texture=new pn(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:un,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(t,e,n=1){(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new ih(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class rh extends pn{constructor(t=null,e=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=Ye,this.minFilter=Ye,this.wrapR=Tn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Xd extends pn{constructor(t=null,e=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:r},this.magFilter=Ye,this.minFilter=Ye,this.wrapR=Tn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Fs{constructor(t=0,e=0,n=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=r}static slerp(t,e,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,r)}static slerpFlat(t,e,n,r,s,o,a){let l=n[r+0],c=n[r+1],h=n[r+2],u=n[r+3];const p=s[o+0],x=s[o+1],b=s[o+2],g=s[o+3];if(a===0){t[e+0]=l,t[e+1]=c,t[e+2]=h,t[e+3]=u;return}if(a===1){t[e+0]=p,t[e+1]=x,t[e+2]=b,t[e+3]=g;return}if(u!==g||l!==p||c!==x||h!==b){let v=1-a;const M=l*p+c*x+h*b+u*g,D=M>=0?1:-1,z=1-M*M;if(z>Number.EPSILON){const O=Math.sqrt(z),G=Math.atan2(O,M*D);v=Math.sin(v*G)/O,a=Math.sin(a*G)/O}const B=a*D;if(l=l*v+p*B,c=c*v+x*B,h=h*v+b*B,u=u*v+g*B,v===1-a){const O=1/Math.sqrt(l*l+c*c+h*h+u*u);l*=O,c*=O,h*=O,u*=O}}t[e]=l,t[e+1]=c,t[e+2]=h,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,r,s,o){const a=n[r],l=n[r+1],c=n[r+2],h=n[r+3],u=s[o],p=s[o+1],x=s[o+2],b=s[o+3];return t[e]=a*b+h*u+l*x-c*p,t[e+1]=l*b+h*p+c*u-a*x,t[e+2]=c*b+h*x+a*p-l*u,t[e+3]=h*b-a*u-l*p-c*x,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,s=t._z,o=t._order,a=Math.cos,l=Math.sin,c=a(n/2),h=a(r/2),u=a(s/2),p=l(n/2),x=l(r/2),b=l(s/2);switch(o){case"XYZ":this._x=p*h*u+c*x*b,this._y=c*x*u-p*h*b,this._z=c*h*b+p*x*u,this._w=c*h*u-p*x*b;break;case"YXZ":this._x=p*h*u+c*x*b,this._y=c*x*u-p*h*b,this._z=c*h*b-p*x*u,this._w=c*h*u+p*x*b;break;case"ZXY":this._x=p*h*u-c*x*b,this._y=c*x*u+p*h*b,this._z=c*h*b+p*x*u,this._w=c*h*u-p*x*b;break;case"ZYX":this._x=p*h*u-c*x*b,this._y=c*x*u+p*h*b,this._z=c*h*b-p*x*u,this._w=c*h*u+p*x*b;break;case"YZX":this._x=p*h*u+c*x*b,this._y=c*x*u+p*h*b,this._z=c*h*b-p*x*u,this._w=c*h*u-p*x*b;break;case"XZY":this._x=p*h*u-c*x*b,this._y=c*x*u-p*h*b,this._z=c*h*b+p*x*u,this._w=c*h*u+p*x*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],r=e[4],s=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],u=e[10],p=n+a+u;if(p>0){const x=.5/Math.sqrt(p+1);this._w=.25/x,this._x=(h-l)*x,this._y=(s-c)*x,this._z=(o-r)*x}else if(n>a&&n>u){const x=2*Math.sqrt(1+n-a-u);this._w=(h-l)/x,this._x=.25*x,this._y=(r+o)/x,this._z=(s+c)/x}else if(a>u){const x=2*Math.sqrt(1+a-n-u);this._w=(s-c)/x,this._x=(r+o)/x,this._y=.25*x,this._z=(l+h)/x}else{const x=2*Math.sqrt(1+u-n-a);this._w=(o-r)/x,this._x=(s+c)/x,this._y=(l+h)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Je(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const r=Math.min(1,e/n);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return e!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,r=t._y,s=t._z,o=t._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=n*h+o*a+r*c-s*l,this._y=r*h+o*l+s*a-n*c,this._z=s*h+o*c+n*l-r*a,this._w=o*h-n*a-r*l-s*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,r=this._y,s=this._z,o=this._w;let a=o*t._w+n*t._x+r*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const x=1-e;return this._w=x*o+e*this._w,this._x=x*n+e*this._x,this._y=x*r+e*this._y,this._z=x*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),u=Math.sin((1-e)*h)/c,p=Math.sin(e*h)/c;return this._w=o*u+this._w*p,this._x=n*u+this._x*p,this._y=r*u+this._y*p,this._z=s*u+this._z*p,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(r),n*Math.sin(s),n*Math.cos(s),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class J{constructor(t=0,e=0,n=0){this.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return e!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return e!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(xc.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(xc.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*r,this.y=s[1]*e+s[4]*n+s[7]*r,this.z=s[2]*e+s[5]*n+s[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,r=this.z,s=t.elements,o=1/(s[3]*e+s[7]*n+s[11]*r+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*r+s[12])*o,this.y=(s[1]*e+s[5]*n+s[9]*r+s[13])*o,this.z=(s[2]*e+s[6]*n+s[10]*r+s[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,r=this.z,s=t.x,o=t.y,a=t.z,l=t.w,c=l*e+o*r-a*n,h=l*n+a*e-s*r,u=l*r+s*n-o*e,p=-s*e-o*n-a*r;return this.x=c*l+p*-s+h*-a-u*-o,this.y=h*l+p*-o+u*-s-c*-a,this.z=u*l+p*-a+c*-o-h*-s,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,r=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*r,this.y=s[1]*e+s[5]*n+s[9]*r,this.z=s[2]*e+s[6]*n+s[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return e!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,r=t.y,s=t.z,o=e.x,a=e.y,l=e.z;return this.x=r*l-s*a,this.y=s*o-n*l,this.z=n*a-r*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return la.copy(this).projectOnVector(t),this.sub(la)}reflect(t){return this.sub(la.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Je(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const la=new J,xc=new Fs;class Bs{constructor(t=new J(1/0,1/0,1/0),e=new J(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=t.length;l<c;l+=3){const h=t[l],u=t[l+1],p=t[l+2];h<e&&(e=h),u<n&&(n=u),p<r&&(r=p),h>s&&(s=h),u>o&&(o=u),p>a&&(a=p)}return this.min.set(e,n,r),this.max.set(s,o,a),this}setFromBufferAttribute(t){let e=1/0,n=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=t.count;l<c;l++){const h=t.getX(l),u=t.getY(l),p=t.getZ(l);h<e&&(e=h),u<n&&(n=u),p<r&&(r=p),h>s&&(s=h),u>o&&(o=u),p>a&&(a=p)}return this.min.set(e,n,r),this.max.set(s,o,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Wi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0)if(e&&n.attributes!=null&&n.attributes.position!==void 0){const s=n.attributes.position;for(let o=0,a=s.count;o<a;o++)Wi.fromBufferAttribute(s,o).applyMatrix4(t.matrixWorld),this.expandByPoint(Wi)}else n.boundingBox===null&&n.computeBoundingBox(),ca.copy(n.boundingBox),ca.applyMatrix4(t.matrixWorld),this.union(ca);const r=t.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Wi),Wi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ss),js.subVectors(this.max,ss),ur.subVectors(t.a,ss),dr.subVectors(t.b,ss),pr.subVectors(t.c,ss),Ei.subVectors(dr,ur),Ti.subVectors(pr,dr),qi.subVectors(ur,pr);let e=[0,-Ei.z,Ei.y,0,-Ti.z,Ti.y,0,-qi.z,qi.y,Ei.z,0,-Ei.x,Ti.z,0,-Ti.x,qi.z,0,-qi.x,-Ei.y,Ei.x,0,-Ti.y,Ti.x,0,-qi.y,qi.x,0];return!fa(e,ur,dr,pr,js)||(e=[1,0,0,0,1,0,0,0,1],!fa(e,ur,dr,pr,js))?!1:(Xs.crossVectors(Ei,Ti),e=[Xs.x,Xs.y,Xs.z],fa(e,ur,dr,pr,js))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Wi.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Wi).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ai[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ai[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ai[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ai[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ai[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ai[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ai[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ai[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ai),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ai=[new J,new J,new J,new J,new J,new J,new J,new J],Wi=new J,ca=new Bs,ur=new J,dr=new J,pr=new J,Ei=new J,Ti=new J,qi=new J,ss=new J,js=new J,Xs=new J,ji=new J;function fa(i,t,e,n,r){for(let s=0,o=i.length-3;s<=o;s+=3){ji.fromArray(i,s);const a=r.x*Math.abs(ji.x)+r.y*Math.abs(ji.y)+r.z*Math.abs(ji.z),l=t.dot(ji),c=e.dot(ji),h=n.dot(ji);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const Zd=new Bs,_c=new J,Zs=new J,ha=new J;class xl{constructor(t=new J,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):Zd.setFromPoints(t).getCenter(n);let r=0;for(let s=0,o=t.length;s<o;s++)r=Math.max(r,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){ha.subVectors(t,this.center);const e=ha.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),r=(n-this.radius)*.5;this.center.add(ha.multiplyScalar(r/n)),this.radius+=r}return this}union(t){return this.center.equals(t.center)===!0?Zs.set(0,0,1).multiplyScalar(t.radius):Zs.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(_c.copy(t.center).add(Zs)),this.expandByPoint(_c.copy(t.center).sub(Zs)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const li=new J,ua=new J,Ys=new J,Ci=new J,da=new J,Js=new J,pa=new J;class sh{constructor(t=new J,e=new J(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,li)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=li.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(li.copy(this.direction).multiplyScalar(e).add(this.origin),li.distanceToSquared(t))}distanceSqToSegment(t,e,n,r){ua.copy(t).add(e).multiplyScalar(.5),Ys.copy(e).sub(t).normalize(),Ci.copy(this.origin).sub(ua);const s=t.distanceTo(e)*.5,o=-this.direction.dot(Ys),a=Ci.dot(this.direction),l=-Ci.dot(Ys),c=Ci.lengthSq(),h=Math.abs(1-o*o);let u,p,x,b;if(h>0)if(u=o*l-a,p=o*a-l,b=s*h,u>=0)if(p>=-b)if(p<=b){const g=1/h;u*=g,p*=g,x=u*(u+o*p+2*a)+p*(o*u+p+2*l)+c}else p=s,u=Math.max(0,-(o*p+a)),x=-u*u+p*(p+2*l)+c;else p=-s,u=Math.max(0,-(o*p+a)),x=-u*u+p*(p+2*l)+c;else p<=-b?(u=Math.max(0,-(-o*s+a)),p=u>0?-s:Math.min(Math.max(-s,-l),s),x=-u*u+p*(p+2*l)+c):p<=b?(u=0,p=Math.min(Math.max(-s,-l),s),x=p*(p+2*l)+c):(u=Math.max(0,-(o*s+a)),p=u>0?s:Math.min(Math.max(-s,-l),s),x=-u*u+p*(p+2*l)+c);else p=o>0?-s:s,u=Math.max(0,-(o*p+a)),x=-u*u+p*(p+2*l)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(Ys).multiplyScalar(p).add(ua),x}intersectSphere(t,e){li.subVectors(t.center,this.origin);const n=li.dot(this.direction),r=li.dot(li)-n*n,s=t.radius*t.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=n-o,l=n+o;return a<0&&l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,r,s,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,p=this.origin;return c>=0?(n=(t.min.x-p.x)*c,r=(t.max.x-p.x)*c):(n=(t.max.x-p.x)*c,r=(t.min.x-p.x)*c),h>=0?(s=(t.min.y-p.y)*h,o=(t.max.y-p.y)*h):(s=(t.max.y-p.y)*h,o=(t.min.y-p.y)*h),n>o||s>r||((s>n||n!==n)&&(n=s),(o<r||r!==r)&&(r=o),u>=0?(a=(t.min.z-p.z)*u,l=(t.max.z-p.z)*u):(a=(t.max.z-p.z)*u,l=(t.min.z-p.z)*u),n>l||a>r)||((a>n||n!==n)&&(n=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(n>=0?n:r,e)}intersectsBox(t){return this.intersectBox(t,li)!==null}intersectTriangle(t,e,n,r,s){da.subVectors(e,t),Js.subVectors(n,t),pa.crossVectors(da,Js);let o=this.direction.dot(pa),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Ci.subVectors(this.origin,t);const l=a*this.direction.dot(Js.crossVectors(Ci,Js));if(l<0)return null;const c=a*this.direction.dot(da.cross(Ci));if(c<0||l+c>o)return null;const h=-a*Ci.dot(pa);return h<0?null:this.at(h/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ue{constructor(){this.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,r,s,o,a,l,c,h,u,p,x,b,g,v){const M=this.elements;return M[0]=t,M[4]=e,M[8]=n,M[12]=r,M[1]=s,M[5]=o,M[9]=a,M[13]=l,M[2]=c,M[6]=h,M[10]=u,M[14]=p,M[3]=x,M[7]=b,M[11]=g,M[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ue().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,r=1/mr.setFromMatrixColumn(t,0).length(),s=1/mr.setFromMatrixColumn(t,1).length(),o=1/mr.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,s=t.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(r),c=Math.sin(r),h=Math.cos(s),u=Math.sin(s);if(t.order==="XYZ"){const p=o*h,x=o*u,b=a*h,g=a*u;e[0]=l*h,e[4]=-l*u,e[8]=c,e[1]=x+b*c,e[5]=p-g*c,e[9]=-a*l,e[2]=g-p*c,e[6]=b+x*c,e[10]=o*l}else if(t.order==="YXZ"){const p=l*h,x=l*u,b=c*h,g=c*u;e[0]=p+g*a,e[4]=b*a-x,e[8]=o*c,e[1]=o*u,e[5]=o*h,e[9]=-a,e[2]=x*a-b,e[6]=g+p*a,e[10]=o*l}else if(t.order==="ZXY"){const p=l*h,x=l*u,b=c*h,g=c*u;e[0]=p-g*a,e[4]=-o*u,e[8]=b+x*a,e[1]=x+b*a,e[5]=o*h,e[9]=g-p*a,e[2]=-o*c,e[6]=a,e[10]=o*l}else if(t.order==="ZYX"){const p=o*h,x=o*u,b=a*h,g=a*u;e[0]=l*h,e[4]=b*c-x,e[8]=p*c+g,e[1]=l*u,e[5]=g*c+p,e[9]=x*c-b,e[2]=-c,e[6]=a*l,e[10]=o*l}else if(t.order==="YZX"){const p=o*l,x=o*c,b=a*l,g=a*c;e[0]=l*h,e[4]=g-p*u,e[8]=b*u+x,e[1]=u,e[5]=o*h,e[9]=-a*h,e[2]=-c*h,e[6]=x*u+b,e[10]=p-g*u}else if(t.order==="XZY"){const p=o*l,x=o*c,b=a*l,g=a*c;e[0]=l*h,e[4]=-u,e[8]=c*h,e[1]=p*u+g,e[5]=o*h,e[9]=x*u-b,e[2]=b*u-x,e[6]=a*h,e[10]=g*u+p}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Yd,t,Jd)}lookAt(t,e,n){const r=this.elements;return $e.subVectors(t,e),$e.lengthSq()===0&&($e.z=1),$e.normalize(),Ri.crossVectors(n,$e),Ri.lengthSq()===0&&(Math.abs(n.z)===1?$e.x+=1e-4:$e.z+=1e-4,$e.normalize(),Ri.crossVectors(n,$e)),Ri.normalize(),Ks.crossVectors($e,Ri),r[0]=Ri.x,r[4]=Ks.x,r[8]=$e.x,r[1]=Ri.y,r[5]=Ks.y,r[9]=$e.y,r[2]=Ri.z,r[6]=Ks.z,r[10]=$e.z,this}multiply(t,e){return e!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,r=e.elements,s=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],h=n[1],u=n[5],p=n[9],x=n[13],b=n[2],g=n[6],v=n[10],M=n[14],D=n[3],z=n[7],B=n[11],O=n[15],G=r[0],Z=r[4],L=r[8],U=r[12],$=r[1],j=r[5],ht=r[9],R=r[13],f=r[2],m=r[6],y=r[10],w=r[14],S=r[3],C=r[7],I=r[11],A=r[15];return s[0]=o*G+a*$+l*f+c*S,s[4]=o*Z+a*j+l*m+c*C,s[8]=o*L+a*ht+l*y+c*I,s[12]=o*U+a*R+l*w+c*A,s[1]=h*G+u*$+p*f+x*S,s[5]=h*Z+u*j+p*m+x*C,s[9]=h*L+u*ht+p*y+x*I,s[13]=h*U+u*R+p*w+x*A,s[2]=b*G+g*$+v*f+M*S,s[6]=b*Z+g*j+v*m+M*C,s[10]=b*L+g*ht+v*y+M*I,s[14]=b*U+g*R+v*w+M*A,s[3]=D*G+z*$+B*f+O*S,s[7]=D*Z+z*j+B*m+O*C,s[11]=D*L+z*ht+B*y+O*I,s[15]=D*U+z*R+B*w+O*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],r=t[8],s=t[12],o=t[1],a=t[5],l=t[9],c=t[13],h=t[2],u=t[6],p=t[10],x=t[14],b=t[3],g=t[7],v=t[11],M=t[15];return b*(+s*l*u-r*c*u-s*a*p+n*c*p+r*a*x-n*l*x)+g*(+e*l*x-e*c*p+s*o*p-r*o*x+r*c*h-s*l*h)+v*(+e*c*u-e*a*x-s*o*u+n*o*x+s*a*h-n*c*h)+M*(-r*a*h-e*l*u+e*a*p+r*o*u-n*o*p+n*l*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],r=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=t[9],p=t[10],x=t[11],b=t[12],g=t[13],v=t[14],M=t[15],D=u*v*c-g*p*c+g*l*x-a*v*x-u*l*M+a*p*M,z=b*p*c-h*v*c-b*l*x+o*v*x+h*l*M-o*p*M,B=h*g*c-b*u*c+b*a*x-o*g*x-h*a*M+o*u*M,O=b*u*l-h*g*l-b*a*p+o*g*p+h*a*v-o*u*v,G=e*D+n*z+r*B+s*O;if(G===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Z=1/G;return t[0]=D*Z,t[1]=(g*p*s-u*v*s-g*r*x+n*v*x+u*r*M-n*p*M)*Z,t[2]=(a*v*s-g*l*s+g*r*c-n*v*c-a*r*M+n*l*M)*Z,t[3]=(u*l*s-a*p*s-u*r*c+n*p*c+a*r*x-n*l*x)*Z,t[4]=z*Z,t[5]=(h*v*s-b*p*s+b*r*x-e*v*x-h*r*M+e*p*M)*Z,t[6]=(b*l*s-o*v*s-b*r*c+e*v*c+o*r*M-e*l*M)*Z,t[7]=(o*p*s-h*l*s+h*r*c-e*p*c-o*r*x+e*l*x)*Z,t[8]=B*Z,t[9]=(b*u*s-h*g*s-b*n*x+e*g*x+h*n*M-e*u*M)*Z,t[10]=(o*g*s-b*a*s+b*n*c-e*g*c-o*n*M+e*a*M)*Z,t[11]=(h*a*s-o*u*s-h*n*c+e*u*c+o*n*x-e*a*x)*Z,t[12]=O*Z,t[13]=(h*g*r-b*u*r+b*n*p-e*g*p-h*n*v+e*u*v)*Z,t[14]=(b*a*r-o*g*r-b*n*l+e*g*l+o*n*v-e*a*v)*Z,t[15]=(o*u*r-h*a*r+h*n*l-e*u*l-o*n*p+e*a*p)*Z,this}scale(t){const e=this.elements,n=t.x,r=t.y,s=t.z;return e[0]*=n,e[4]*=r,e[8]*=s,e[1]*=n,e[5]*=r,e[9]*=s,e[2]*=n,e[6]*=r,e[10]*=s,e[3]*=n,e[7]*=r,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),r=Math.sin(e),s=1-n,o=t.x,a=t.y,l=t.z,c=s*o,h=s*a;return this.set(c*o+n,c*a-r*l,c*l+r*a,0,c*a+r*l,h*a+n,h*l-r*o,0,c*l-r*a,h*l+r*o,s*l*l+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,r,s,o){return this.set(1,n,s,0,t,1,o,0,e,r,1,0,0,0,0,1),this}compose(t,e,n){const r=this.elements,s=e._x,o=e._y,a=e._z,l=e._w,c=s+s,h=o+o,u=a+a,p=s*c,x=s*h,b=s*u,g=o*h,v=o*u,M=a*u,D=l*c,z=l*h,B=l*u,O=n.x,G=n.y,Z=n.z;return r[0]=(1-(g+M))*O,r[1]=(x+B)*O,r[2]=(b-z)*O,r[3]=0,r[4]=(x-B)*G,r[5]=(1-(p+M))*G,r[6]=(v+D)*G,r[7]=0,r[8]=(b+z)*Z,r[9]=(v-D)*Z,r[10]=(1-(p+g))*Z,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,n){const r=this.elements;let s=mr.set(r[0],r[1],r[2]).length();const o=mr.set(r[4],r[5],r[6]).length(),a=mr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),t.x=r[12],t.y=r[13],t.z=r[14],bn.copy(this);const c=1/s,h=1/o,u=1/a;return bn.elements[0]*=c,bn.elements[1]*=c,bn.elements[2]*=c,bn.elements[4]*=h,bn.elements[5]*=h,bn.elements[6]*=h,bn.elements[8]*=u,bn.elements[9]*=u,bn.elements[10]*=u,e.setFromRotationMatrix(bn),n.x=s,n.y=o,n.z=a,this}makePerspective(t,e,n,r,s,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,l=2*s/(e-t),c=2*s/(n-r),h=(e+t)/(e-t),u=(n+r)/(n-r),p=-(o+s)/(o-s),x=-2*o*s/(o-s);return a[0]=l,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=c,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=p,a[14]=x,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,n,r,s,o){const a=this.elements,l=1/(e-t),c=1/(n-r),h=1/(o-s),u=(e+t)*l,p=(n+r)*c,x=(o+s)*h;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-p,a[2]=0,a[6]=0,a[10]=-2*h,a[14]=-x,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const mr=new J,bn=new Ue,Yd=new J(0,0,0),Jd=new J(1,1,1),Ri=new J,Ks=new J,$e=new J,yc=new Ue,bc=new Fs;class ks{constructor(t=0,e=0,n=0,r=ks.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,r=this._order){return this._x=t,this._y=e,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const r=t.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],h=r[9],u=r[2],p=r[6],x=r[10];switch(e){case"XYZ":this._y=Math.asin(Je(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,x),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Je(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,x),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Je(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,x),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Je(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,x),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Je(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,x));break;case"XZY":this._z=Math.asin(-Je(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-h,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return yc.makeRotationFromQuaternion(t),this.setFromRotationMatrix(yc,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return bc.setFromEuler(this),this.setFromQuaternion(bc,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}ks.DefaultOrder="XYZ";ks.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class _l{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Kd=0;const wc=new J,gr=new Fs,ci=new Ue,Qs=new J,os=new J,Qd=new J,$d=new Fs,Mc=new J(1,0,0),Sc=new J(0,1,0),Ac=new J(0,0,1),tp={type:"added"},Ec={type:"removed"};class In extends Jr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Kd++}),this.uuid=Ns(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=In.DefaultUp.clone();const t=new J,e=new ks,n=new Fs,r=new J(1,1,1);function s(){n.setFromEuler(e,!1)}function o(){e.setFromQuaternion(n,void 0,!1)}e._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ue},normalMatrix:{value:new Wn}}),this.matrix=new Ue,this.matrixWorld=new Ue,this.matrixAutoUpdate=In.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new _l,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return gr.setFromAxisAngle(t,e),this.quaternion.multiply(gr),this}rotateOnWorldAxis(t,e){return gr.setFromAxisAngle(t,e),this.quaternion.premultiply(gr),this}rotateX(t){return this.rotateOnAxis(Mc,t)}rotateY(t){return this.rotateOnAxis(Sc,t)}rotateZ(t){return this.rotateOnAxis(Ac,t)}translateOnAxis(t,e){return wc.copy(t).applyQuaternion(this.quaternion),this.position.add(wc.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Mc,t)}translateY(t){return this.translateOnAxis(Sc,t)}translateZ(t){return this.translateOnAxis(Ac,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ci.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Qs.copy(t):Qs.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),os.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ci.lookAt(os,Qs,this.up):ci.lookAt(Qs,os,this.up),this.quaternion.setFromRotationMatrix(ci),r&&(ci.extractRotation(r.matrixWorld),gr.setFromRotationMatrix(ci),this.quaternion.premultiply(gr.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(tp)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ec)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(Ec)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ci.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ci.multiply(t.parent.matrixWorld)),t.applyMatrix4(ci),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,r=this.children.length;n<r;n++){const o=this.children[n].getObjectByProperty(t,e);if(o!==void 0)return o}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(os,t,Qd),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(os,$d,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,r=e.length;n<r;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const u=l[c];s(t.shapes,u)}else s(t.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(t.materials,this.material[l]));r.material=a}else r.material=s(t.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(t.animations,l))}}if(e){const a=o(t.geometries),l=o(t.materials),c=o(t.textures),h=o(t.images),u=o(t.shapes),p=o(t.skeletons),x=o(t.animations),b=o(t.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),h.length>0&&(n.images=h),u.length>0&&(n.shapes=u),p.length>0&&(n.skeletons=p),x.length>0&&(n.animations=x),b.length>0&&(n.nodes=b)}return n.object=r,n;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const r=t.children[n];this.add(r.clone())}return this}}In.DefaultUp=new J(0,1,0);In.DefaultMatrixAutoUpdate=!0;const wn=new J,fi=new J,ma=new J,hi=new J,vr=new J,xr=new J,Tc=new J,ga=new J,va=new J,xa=new J;class Gn{constructor(t=new J,e=new J,n=new J){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,r){r.subVectors(n,e),wn.subVectors(t,e),r.cross(wn);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(t,e,n,r,s){wn.subVectors(r,e),fi.subVectors(n,e),ma.subVectors(t,e);const o=wn.dot(wn),a=wn.dot(fi),l=wn.dot(ma),c=fi.dot(fi),h=fi.dot(ma),u=o*c-a*a;if(u===0)return s.set(-2,-1,-1);const p=1/u,x=(c*l-a*h)*p,b=(o*h-a*l)*p;return s.set(1-x-b,b,x)}static containsPoint(t,e,n,r){return this.getBarycoord(t,e,n,r,hi),hi.x>=0&&hi.y>=0&&hi.x+hi.y<=1}static getUV(t,e,n,r,s,o,a,l){return this.getBarycoord(t,e,n,r,hi),l.set(0,0),l.addScaledVector(s,hi.x),l.addScaledVector(o,hi.y),l.addScaledVector(a,hi.z),l}static isFrontFacing(t,e,n,r){return wn.subVectors(n,e),fi.subVectors(t,e),wn.cross(fi).dot(r)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,n,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return wn.subVectors(this.c,this.b),fi.subVectors(this.a,this.b),wn.cross(fi).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Gn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Gn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,r,s){return Gn.getUV(t,this.a,this.b,this.c,e,n,r,s)}containsPoint(t){return Gn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Gn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,r=this.b,s=this.c;let o,a;vr.subVectors(r,n),xr.subVectors(s,n),ga.subVectors(t,n);const l=vr.dot(ga),c=xr.dot(ga);if(l<=0&&c<=0)return e.copy(n);va.subVectors(t,r);const h=vr.dot(va),u=xr.dot(va);if(h>=0&&u<=h)return e.copy(r);const p=l*u-h*c;if(p<=0&&l>=0&&h<=0)return o=l/(l-h),e.copy(n).addScaledVector(vr,o);xa.subVectors(t,s);const x=vr.dot(xa),b=xr.dot(xa);if(b>=0&&x<=b)return e.copy(s);const g=x*c-l*b;if(g<=0&&c>=0&&b<=0)return a=c/(c-b),e.copy(n).addScaledVector(xr,a);const v=h*b-x*u;if(v<=0&&u-h>=0&&x-b>=0)return Tc.subVectors(s,r),a=(u-h)/(u-h+(x-b)),e.copy(r).addScaledVector(Tc,a);const M=1/(v+g+p);return o=g*M,a=p*M,e.copy(n).addScaledVector(vr,o).addScaledVector(xr,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let ep=0;class Ie extends Jr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:ep++}),this.uuid=Ns(),this.name="",this.type="Material",this.blending=Dr,this.side=Ms,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Jf,this.blendDst=Kf,this.blendEquation=Er,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Xa,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Wd,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=na,this.stencilZFail=na,this.stencilZPass=na,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if(e==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===Qu;continue}const r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Dr&&(n.blending=this.blending),this.side!==Ms&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(e){const s=r(t.textures),o=r(t.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const r=e.length;n=new Array(r);for(let s=0;s!==r;++s)n[s]=e[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}get vertexTangents(){return console.warn("THREE."+this.type+": .vertexTangents has been removed."),!1}set vertexTangents(t){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}Ie.fromType=function(){return null};class Es extends Ie{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _e=new J,$s=new ne;class Xn{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n===!0,this.usage=pc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[t+r]=e.array[n+r];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let r=0,s=t.length;r<s;r++){let o=t[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new Vt),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let r=0,s=t.length;r<s;r++){let o=t[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new ne),e[n++]=o.x,e[n++]=o.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let r=0,s=t.length;r<s;r++){let o=t[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new J),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let r=0,s=t.length;r<s;r++){let o=t[r];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new Oe),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)$s.fromBufferAttribute(this,e),$s.applyMatrix3(t),this.setXY(e,$s.x,$s.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)_e.fromBufferAttribute(this,e),_e.applyMatrix3(t),this.setXYZ(e,_e.x,_e.y,_e.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)_e.fromBufferAttribute(this,e),_e.applyMatrix4(t),this.setXYZ(e,_e.x,_e.y,_e.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)_e.fromBufferAttribute(this,e),_e.applyNormalMatrix(t),this.setXYZ(e,_e.x,_e.y,_e.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)_e.fromBufferAttribute(this,e),_e.transformDirection(t),this.setXYZ(e,_e.x,_e.y,_e.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this}setXYZW(t,e,n,r,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==pc&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}class oh extends Xn{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class ah extends Xn{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class er extends Xn{constructor(t,e,n){super(new Float32Array(t),e,n)}}let np=0;const cn=new Ue,_a=new In,_r=new J,tn=new Bs,as=new Bs,Se=new J;class cr extends Jr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:np++}),this.uuid=Ns(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(th(t)?ah:oh)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Wn().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return cn.makeRotationFromQuaternion(t),this.applyMatrix4(cn),this}rotateX(t){return cn.makeRotationX(t),this.applyMatrix4(cn),this}rotateY(t){return cn.makeRotationY(t),this.applyMatrix4(cn),this}rotateZ(t){return cn.makeRotationZ(t),this.applyMatrix4(cn),this}translate(t,e,n){return cn.makeTranslation(t,e,n),this.applyMatrix4(cn),this}scale(t,e,n){return cn.makeScale(t,e,n),this.applyMatrix4(cn),this}lookAt(t){return _a.lookAt(t),_a.updateMatrix(),this.applyMatrix4(_a.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_r).negate(),this.translate(_r.x,_r.y,_r.z),this}setFromPoints(t){const e=[];for(let n=0,r=t.length;n<r;n++){const s=t[n];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new er(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Bs);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new J(-1/0,-1/0,-1/0),new J(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){const s=e[n];tn.setFromBufferAttribute(s),this.morphTargetsRelative?(Se.addVectors(this.boundingBox.min,tn.min),this.boundingBox.expandByPoint(Se),Se.addVectors(this.boundingBox.max,tn.max),this.boundingBox.expandByPoint(Se)):(this.boundingBox.expandByPoint(tn.min),this.boundingBox.expandByPoint(tn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new xl);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new J,1/0);return}if(t){const n=this.boundingSphere.center;if(tn.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){const a=e[s];as.setFromBufferAttribute(a),this.morphTargetsRelative?(Se.addVectors(tn.min,as.min),tn.expandByPoint(Se),Se.addVectors(tn.max,as.max),tn.expandByPoint(Se)):(tn.expandByPoint(as.min),tn.expandByPoint(as.max))}tn.getCenter(n);let r=0;for(let s=0,o=t.count;s<o;s++)Se.fromBufferAttribute(t,s),r=Math.max(r,n.distanceToSquared(Se));if(e)for(let s=0,o=e.length;s<o;s++){const a=e[s],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Se.fromBufferAttribute(a,c),l&&(_r.fromBufferAttribute(t,c),Se.add(_r)),r=Math.max(r,n.distanceToSquared(Se))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.array,r=e.position.array,s=e.normal.array,o=e.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Xn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let $=0;$<a;$++)c[$]=new J,h[$]=new J;const u=new J,p=new J,x=new J,b=new ne,g=new ne,v=new ne,M=new J,D=new J;function z($,j,ht){u.fromArray(r,$*3),p.fromArray(r,j*3),x.fromArray(r,ht*3),b.fromArray(o,$*2),g.fromArray(o,j*2),v.fromArray(o,ht*2),p.sub(u),x.sub(u),g.sub(b),v.sub(b);const R=1/(g.x*v.y-v.x*g.y);!isFinite(R)||(M.copy(p).multiplyScalar(v.y).addScaledVector(x,-g.y).multiplyScalar(R),D.copy(x).multiplyScalar(g.x).addScaledVector(p,-v.x).multiplyScalar(R),c[$].add(M),c[j].add(M),c[ht].add(M),h[$].add(D),h[j].add(D),h[ht].add(D))}let B=this.groups;B.length===0&&(B=[{start:0,count:n.length}]);for(let $=0,j=B.length;$<j;++$){const ht=B[$],R=ht.start,f=ht.count;for(let m=R,y=R+f;m<y;m+=3)z(n[m+0],n[m+1],n[m+2])}const O=new J,G=new J,Z=new J,L=new J;function U($){Z.fromArray(s,$*3),L.copy(Z);const j=c[$];O.copy(j),O.sub(Z.multiplyScalar(Z.dot(j))).normalize(),G.crossVectors(L,j);const R=G.dot(h[$])<0?-1:1;l[$*4]=O.x,l[$*4+1]=O.y,l[$*4+2]=O.z,l[$*4+3]=R}for(let $=0,j=B.length;$<j;++$){const ht=B[$],R=ht.start,f=ht.count;for(let m=R,y=R+f;m<y;m+=3)U(n[m+0]),U(n[m+1]),U(n[m+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Xn(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let p=0,x=n.count;p<x;p++)n.setXYZ(p,0,0,0);const r=new J,s=new J,o=new J,a=new J,l=new J,c=new J,h=new J,u=new J;if(t)for(let p=0,x=t.count;p<x;p+=3){const b=t.getX(p+0),g=t.getX(p+1),v=t.getX(p+2);r.fromBufferAttribute(e,b),s.fromBufferAttribute(e,g),o.fromBufferAttribute(e,v),h.subVectors(o,s),u.subVectors(r,s),h.cross(u),a.fromBufferAttribute(n,b),l.fromBufferAttribute(n,g),c.fromBufferAttribute(n,v),a.add(h),l.add(h),c.add(h),n.setXYZ(b,a.x,a.y,a.z),n.setXYZ(g,l.x,l.y,l.z),n.setXYZ(v,c.x,c.y,c.z)}else for(let p=0,x=e.count;p<x;p+=3)r.fromBufferAttribute(e,p+0),s.fromBufferAttribute(e,p+1),o.fromBufferAttribute(e,p+2),h.subVectors(o,s),u.subVectors(r,s),h.cross(u),n.setXYZ(p+0,h.x,h.y,h.z),n.setXYZ(p+1,h.x,h.y,h.z),n.setXYZ(p+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!(t&&t.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);return}e===void 0&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(t.attributes[r]===void 0)continue;const o=n[r].array,a=t.attributes[r],l=a.array,c=a.itemSize*e,h=Math.min(l.length,o.length-c);for(let u=0,p=c;u<h;u++,p++)o[p]=l[u]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Se.fromBufferAttribute(t,e),Se.normalize(),t.setXYZ(e,Se.x,Se.y,Se.z)}toNonIndexed(){function t(a,l){const c=a.array,h=a.itemSize,u=a.normalized,p=new c.constructor(l.length*h);let x=0,b=0;for(let g=0,v=l.length;g<v;g++){a.isInterleavedBufferAttribute?x=l[g]*a.data.stride+a.offset:x=l[g]*h;for(let M=0;M<h;M++)p[b++]=c[x++]}return new Xn(p,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new cr,n=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=t(l,n);e.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let h=0,u=c.length;h<u;h++){const p=c[h],x=t(p,n);l.push(x)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const l in n){const c=n[l];t.data.attributes[l]=c.toJSON(t.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let u=0,p=c.length;u<p;u++){const x=c[u];h.push(x.toJSON(t.data))}h.length>0&&(r[l]=h,s=!0)}s&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(e));const r=t.attributes;for(const c in r){const h=r[c];this.setAttribute(c,h.clone(e))}const s=t.morphAttributes;for(const c in s){const h=[],u=s[c];for(let p=0,x=u.length;p<x;p++)h.push(u[p].clone(e));this.morphAttributes[c]=h}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let c=0,h=o.length;c<h;c++){const u=o[c];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Cc=new Ue,yr=new sh,ya=new xl,Pi=new J,Ii=new J,Li=new J,ba=new J,wa=new J,Ma=new J,to=new J,eo=new J,no=new J,io=new ne,ro=new ne,so=new ne,Sa=new J,oo=new J;class qn extends In{constructor(t=new cr,e=new Es){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const r=e[n[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}raycast(t,e){const n=this.geometry,r=this.material,s=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),ya.copy(n.boundingSphere),ya.applyMatrix4(s),t.ray.intersectsSphere(ya)===!1)||(Cc.copy(s).invert(),yr.copy(t.ray).applyMatrix4(Cc),n.boundingBox!==null&&yr.intersectsBox(n.boundingBox)===!1))return;let o;const a=n.index,l=n.attributes.position,c=n.morphAttributes.position,h=n.morphTargetsRelative,u=n.attributes.uv,p=n.attributes.uv2,x=n.groups,b=n.drawRange;if(a!==null)if(Array.isArray(r))for(let g=0,v=x.length;g<v;g++){const M=x[g],D=r[M.materialIndex],z=Math.max(M.start,b.start),B=Math.min(a.count,Math.min(M.start+M.count,b.start+b.count));for(let O=z,G=B;O<G;O+=3){const Z=a.getX(O),L=a.getX(O+1),U=a.getX(O+2);o=ao(this,D,t,yr,l,c,h,u,p,Z,L,U),o&&(o.faceIndex=Math.floor(O/3),o.face.materialIndex=M.materialIndex,e.push(o))}}else{const g=Math.max(0,b.start),v=Math.min(a.count,b.start+b.count);for(let M=g,D=v;M<D;M+=3){const z=a.getX(M),B=a.getX(M+1),O=a.getX(M+2);o=ao(this,r,t,yr,l,c,h,u,p,z,B,O),o&&(o.faceIndex=Math.floor(M/3),e.push(o))}}else if(l!==void 0)if(Array.isArray(r))for(let g=0,v=x.length;g<v;g++){const M=x[g],D=r[M.materialIndex],z=Math.max(M.start,b.start),B=Math.min(l.count,Math.min(M.start+M.count,b.start+b.count));for(let O=z,G=B;O<G;O+=3){const Z=O,L=O+1,U=O+2;o=ao(this,D,t,yr,l,c,h,u,p,Z,L,U),o&&(o.faceIndex=Math.floor(O/3),o.face.materialIndex=M.materialIndex,e.push(o))}}else{const g=Math.max(0,b.start),v=Math.min(l.count,b.start+b.count);for(let M=g,D=v;M<D;M+=3){const z=M,B=M+1,O=M+2;o=ao(this,r,t,yr,l,c,h,u,p,z,B,O),o&&(o.faceIndex=Math.floor(M/3),e.push(o))}}}}function ip(i,t,e,n,r,s,o,a){let l;if(t.side===Pn?l=n.intersectTriangle(o,s,r,!0,a):l=n.intersectTriangle(r,s,o,t.side!==Ur,a),l===null)return null;oo.copy(a),oo.applyMatrix4(i.matrixWorld);const c=e.ray.origin.distanceTo(oo);return c<e.near||c>e.far?null:{distance:c,point:oo.clone(),object:i}}function ao(i,t,e,n,r,s,o,a,l,c,h,u){Pi.fromBufferAttribute(r,c),Ii.fromBufferAttribute(r,h),Li.fromBufferAttribute(r,u);const p=i.morphTargetInfluences;if(s&&p){to.set(0,0,0),eo.set(0,0,0),no.set(0,0,0);for(let b=0,g=s.length;b<g;b++){const v=p[b],M=s[b];v!==0&&(ba.fromBufferAttribute(M,c),wa.fromBufferAttribute(M,h),Ma.fromBufferAttribute(M,u),o?(to.addScaledVector(ba,v),eo.addScaledVector(wa,v),no.addScaledVector(Ma,v)):(to.addScaledVector(ba.sub(Pi),v),eo.addScaledVector(wa.sub(Ii),v),no.addScaledVector(Ma.sub(Li),v)))}Pi.add(to),Ii.add(eo),Li.add(no)}i.isSkinnedMesh&&(i.boneTransform(c,Pi),i.boneTransform(h,Ii),i.boneTransform(u,Li));const x=ip(i,t,e,n,Pi,Ii,Li,Sa);if(x){a&&(io.fromBufferAttribute(a,c),ro.fromBufferAttribute(a,h),so.fromBufferAttribute(a,u),x.uv=Gn.getUV(Sa,Pi,Ii,Li,io,ro,so,new ne)),l&&(io.fromBufferAttribute(l,c),ro.fromBufferAttribute(l,h),so.fromBufferAttribute(l,u),x.uv2=Gn.getUV(Sa,Pi,Ii,Li,io,ro,so,new ne));const b={a:c,b:h,c:u,normal:new J,materialIndex:0};Gn.getNormal(Pi,Ii,Li,b.normal),x.face=b}return x}class Kr extends cr{constructor(t=1,e=1,n=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],h=[],u=[];let p=0,x=0;b("z","y","x",-1,-1,n,e,t,o,s,0),b("z","y","x",1,-1,n,e,-t,o,s,1),b("x","z","y",1,1,t,n,e,r,o,2),b("x","z","y",1,-1,t,n,-e,r,o,3),b("x","y","z",1,-1,t,e,n,r,s,4),b("x","y","z",-1,-1,t,e,-n,r,s,5),this.setIndex(l),this.setAttribute("position",new er(c,3)),this.setAttribute("normal",new er(h,3)),this.setAttribute("uv",new er(u,2));function b(g,v,M,D,z,B,O,G,Z,L,U){const $=B/Z,j=O/L,ht=B/2,R=O/2,f=G/2,m=Z+1,y=L+1;let w=0,S=0;const C=new J;for(let I=0;I<y;I++){const A=I*j-R;for(let d=0;d<m;d++){const E=d*$-ht;C[g]=E*D,C[v]=A*z,C[M]=f,c.push(C.x,C.y,C.z),C[g]=0,C[v]=0,C[M]=G>0?1:-1,h.push(C.x,C.y,C.z),u.push(d/Z),u.push(1-I/L),w+=1}}for(let I=0;I<L;I++)for(let A=0;A<Z;A++){const d=p+A+m*I,E=p+A+m*(I+1),it=p+(A+1)+m*(I+1),_=p+(A+1)+m*I;l.push(d,E,_),l.push(E,it,_),S+=6}a.addGroup(x,S,U),x+=S,p+=w}}static fromJSON(t){return new Kr(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function Hr(i){const t={};for(const e in i){t[e]={};for(const n in i[e]){const r=i[e][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[e][n]=r.clone():Array.isArray(r)?t[e][n]=r.slice():t[e][n]=r}}return t}function Ne(i){const t={};for(let e=0;e<i.length;e++){const n=Hr(i[e]);for(const r in n)t[r]=n[r]}return t}const rp={clone:Hr,merge:Ne};var sp=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,op=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class _i extends Ie{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=sp,this.fragmentShader=op,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&(t.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Hr(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?e.uniforms[r]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[r]={type:"m4",value:o.toArray()}:e.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const r in this.extensions)this.extensions[r]===!0&&(n[r]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class lh extends In{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ue,this.projectionMatrix=new Ue,this.projectionMatrixInverse=new Ue}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class dn extends lh{constructor(t=50,e=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=gc*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(ia*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return gc*2*Math.atan(Math.tan(ia*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,r,s,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(ia*.5*this.fov)/this.zoom,n=2*e,r=this.aspect*n,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,e-=o.offsetY*n/c,r*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(s+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const br=90,wr=1;class ap extends In{constructor(t,e,n){if(super(),this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;const r=new dn(br,wr,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new J(1,0,0)),this.add(r);const s=new dn(br,wr,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new J(-1,0,0)),this.add(s);const o=new dn(br,wr,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new J(0,1,0)),this.add(o);const a=new dn(br,wr,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new J(0,-1,0)),this.add(a);const l=new dn(br,wr,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new J(0,0,1)),this.add(l);const c=new dn(br,wr,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new J(0,0,-1)),this.add(c)}update(t,e){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[r,s,o,a,l,c]=this.children,h=t.getRenderTarget(),u=t.toneMapping,p=t.xr.enabled;t.toneMapping=xi,t.xr.enabled=!1;const x=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,s),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,l),n.texture.generateMipmaps=x,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(h),t.toneMapping=u,t.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class ch extends pn{constructor(t,e,n,r,s,o,a,l,c,h){t=t!==void 0?t:[],e=e!==void 0?e:zr,super(t,e,n,r,s,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class lp extends Ui{constructor(t,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},r=[n,n,n,n,n,n];this.texture=new ch(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:un}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Kr(5,5,5),s=new _i({name:"CubemapFromEquirect",uniforms:Hr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Pn,blending:Oi});s.uniforms.tEquirect.value=e;const o=new qn(r,s),a=e.minFilter;return e.minFilter===zo&&(e.minFilter=un),new ap(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,n,r){const s=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,r);t.setRenderTarget(s)}}const Aa=new J,cp=new J,fp=new Wn;class Xi{constructor(t=new J(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const r=Aa.subVectors(n,e).cross(cp.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(Aa),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:e.copy(n).multiplyScalar(s).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||fp.getNormalMatrix(t),r=this.coplanarPoint(Aa).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Mr=new xl,lo=new J;class fh{constructor(t=new Xi,e=new Xi,n=new Xi,r=new Xi,s=new Xi,o=new Xi){this.planes=[t,e,n,r,s,o]}set(t,e,n,r,s,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,r=n[0],s=n[1],o=n[2],a=n[3],l=n[4],c=n[5],h=n[6],u=n[7],p=n[8],x=n[9],b=n[10],g=n[11],v=n[12],M=n[13],D=n[14],z=n[15];return e[0].setComponents(a-r,u-l,g-p,z-v).normalize(),e[1].setComponents(a+r,u+l,g+p,z+v).normalize(),e[2].setComponents(a+s,u+c,g+x,z+M).normalize(),e[3].setComponents(a-s,u-c,g-x,z-M).normalize(),e[4].setComponents(a-o,u-h,g-b,z-D).normalize(),e[5].setComponents(a+o,u+h,g+b,z+D).normalize(),this}intersectsObject(t){const e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Mr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Mr)}intersectsSprite(t){return Mr.center.set(0,0,0),Mr.radius=.7071067811865476,Mr.applyMatrix4(t.matrixWorld),this.intersectsSphere(Mr)}intersectsSphere(t){const e=this.planes,n=t.center,r=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(n)<r)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const r=e[n];if(lo.x=r.normal.x>0?t.max.x:t.min.x,lo.y=r.normal.y>0?t.max.y:t.min.y,lo.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(lo)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function hh(){let i=null,t=!1,e=null,n=null;function r(s,o){e(s,o),n=i.requestAnimationFrame(r)}return{start:function(){t!==!0&&e!==null&&(n=i.requestAnimationFrame(r),t=!0)},stop:function(){i.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){i=s}}}function hp(i,t){const e=t.isWebGL2,n=new WeakMap;function r(c,h){const u=c.array,p=c.usage,x=i.createBuffer();i.bindBuffer(h,x),i.bufferData(h,u,p),c.onUploadCallback();let b;if(u instanceof Float32Array)b=5126;else if(u instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(e)b=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else b=5123;else if(u instanceof Int16Array)b=5122;else if(u instanceof Uint32Array)b=5125;else if(u instanceof Int32Array)b=5124;else if(u instanceof Int8Array)b=5120;else if(u instanceof Uint8Array)b=5121;else if(u instanceof Uint8ClampedArray)b=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:x,type:b,bytesPerElement:u.BYTES_PER_ELEMENT,version:c.version}}function s(c,h,u){const p=h.array,x=h.updateRange;i.bindBuffer(u,c),x.count===-1?i.bufferSubData(u,0,p):(e?i.bufferSubData(u,x.offset*p.BYTES_PER_ELEMENT,p,x.offset,x.count):i.bufferSubData(u,x.offset*p.BYTES_PER_ELEMENT,p.subarray(x.offset,x.offset+x.count)),x.count=-1)}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);h&&(i.deleteBuffer(h.buffer),n.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const p=n.get(c);(!p||p.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const u=n.get(c);u===void 0?n.set(c,r(c,h)):u.version<c.version&&(s(u.buffer,c,h),u.version=c.version)}return{get:o,remove:a,update:l}}class yl extends cr{constructor(t=1,e=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const s=t/2,o=e/2,a=Math.floor(n),l=Math.floor(r),c=a+1,h=l+1,u=t/a,p=e/l,x=[],b=[],g=[],v=[];for(let M=0;M<h;M++){const D=M*p-o;for(let z=0;z<c;z++){const B=z*u-s;b.push(B,-D,0),g.push(0,0,1),v.push(z/a),v.push(1-M/l)}}for(let M=0;M<l;M++)for(let D=0;D<a;D++){const z=D+c*M,B=D+c*(M+1),O=D+1+c*(M+1),G=D+1+c*M;x.push(z,B,G),x.push(B,O,G)}this.setIndex(x),this.setAttribute("position",new er(b,3)),this.setAttribute("normal",new er(g,3)),this.setAttribute("uv",new er(v,2))}static fromJSON(t){return new yl(t.width,t.height,t.widthSegments,t.heightSegments)}}var up=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,dp=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pp=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,mp=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,gp=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,vp=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,xp="vec3 transformed = vec3( position );",_p=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,yp=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,bp=`#ifdef USE_IRIDESCENCE
const mat3 XYZ_TO_REC709 = mat3(
    3.2404542, -0.9692660,  0.0556434,
   -1.5371385,  1.8760108, -0.2040259,
   -0.4985314,  0.0415560,  1.0572252
);
vec3 Fresnel0ToIor( vec3 fresnel0 ) {
   vec3 sqrtF0 = sqrt( fresnel0 );
   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
}
vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
}
float IorToFresnel0( float transmittedIor, float incidentIor ) {
   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
}
vec3 evalSensitivity( float OPD, vec3 shift ) {
   float phase = 2.0 * PI * OPD * 1.0e-9;
   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );
   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );
   xyz /= 1.0685e-7;
   vec3 srgb = XYZ_TO_REC709 * xyz;
   return srgb;
}
vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
   vec3 I;
   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
   float cosTheta2Sq = 1.0 - sinTheta2Sq;
   if ( cosTheta2Sq < 0.0 ) {
       return vec3( 1.0 );
   }
   float cosTheta2 = sqrt( cosTheta2Sq );
   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
   float R12 = F_Schlick( R0, 1.0, cosTheta1 );
   float R21 = R12;
   float T121 = 1.0 - R12;
   float phi12 = 0.0;
   if ( iridescenceIOR < outsideIOR ) phi12 = PI;
   float phi21 = PI - phi12;
   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
   vec3 phi23 = vec3( 0.0 );
   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;
   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;
   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;
   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
   vec3 phi = vec3( phi21 ) + phi23;
   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
   vec3 r123 = sqrt( R123 );
   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
   vec3 C0 = R12 + Rs;
   I = C0;
   vec3 Cm = Rs - T121;
   for ( int m = 1; m <= 2; ++m ) {
       Cm *= r123;
       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
       I += Cm * Sm;
   }
   return max( I, vec3( 0.0 ) );
}
#endif`,wp=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Mp=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,Sp=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ap=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Ep=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Tp=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Cp=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Rp=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Pp=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Ip=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Lp=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,Dp=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,Np=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Fp=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,Bp=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,kp=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Op="gl_FragColor = linearToOutputTexel( gl_FragColor );",Up=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,zp=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Gp=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Vp=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Hp=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Wp=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,qp=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,jp=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Xp=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Zp=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Yp=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,Jp=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Kp=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Qp=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,$p=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,t0=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,e0=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,n0=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,i0=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,r0=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,s0=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,o0=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,a0=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
float dotNVi = saturate( dot( normal, geometry.viewDir ) );
if ( material.iridescenceThickness == 0.0 ) {
	material.iridescence = 0.0;
} else {
	material.iridescence = saturate( material.iridescence );
}
if ( material.iridescence > 0.0 ) {
	material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
	material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,l0=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,c0=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,f0=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,h0=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,u0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,d0=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,p0=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,m0=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,g0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,v0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,x0=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,_0=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,y0=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,b0=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,w0=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,M0=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,S0=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,A0=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,E0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,T0=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,C0=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,R0=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,P0=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,I0=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,L0=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,D0=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,N0=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,F0=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,B0=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,k0=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,O0=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,U0=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,z0=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,G0=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,V0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,H0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,W0=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,q0=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,j0=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,X0=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,Z0=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Y0=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,J0=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,K0=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Q0=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,$0=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,tm=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,em=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,nm=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,im=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,rm=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,sm=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,om=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,am=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,lm=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cm=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fm=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,hm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,um=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,dm=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,pm=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,mm=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,gm=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vm=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xm=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,_m=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ym=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bm=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,wm=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mm=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Sm=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Am=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Em=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tm=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Cm=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Rm=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pm=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Im=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Lm=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Dm=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Nm=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Fm=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Bm=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,km=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Om=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Um=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zm=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,Wt={alphamap_fragment:up,alphamap_pars_fragment:dp,alphatest_fragment:pp,alphatest_pars_fragment:mp,aomap_fragment:gp,aomap_pars_fragment:vp,begin_vertex:xp,beginnormal_vertex:_p,bsdfs:yp,iridescence_fragment:bp,bumpmap_pars_fragment:wp,clipping_planes_fragment:Mp,clipping_planes_pars_fragment:Sp,clipping_planes_pars_vertex:Ap,clipping_planes_vertex:Ep,color_fragment:Tp,color_pars_fragment:Cp,color_pars_vertex:Rp,color_vertex:Pp,common:Ip,cube_uv_reflection_fragment:Lp,defaultnormal_vertex:Dp,displacementmap_pars_vertex:Np,displacementmap_vertex:Fp,emissivemap_fragment:Bp,emissivemap_pars_fragment:kp,encodings_fragment:Op,encodings_pars_fragment:Up,envmap_fragment:zp,envmap_common_pars_fragment:Gp,envmap_pars_fragment:Vp,envmap_pars_vertex:Hp,envmap_physical_pars_fragment:t0,envmap_vertex:Wp,fog_vertex:qp,fog_pars_vertex:jp,fog_fragment:Xp,fog_pars_fragment:Zp,gradientmap_pars_fragment:Yp,lightmap_fragment:Jp,lightmap_pars_fragment:Kp,lights_lambert_vertex:Qp,lights_pars_begin:$p,lights_toon_fragment:e0,lights_toon_pars_fragment:n0,lights_phong_fragment:i0,lights_phong_pars_fragment:r0,lights_physical_fragment:s0,lights_physical_pars_fragment:o0,lights_fragment_begin:a0,lights_fragment_maps:l0,lights_fragment_end:c0,logdepthbuf_fragment:f0,logdepthbuf_pars_fragment:h0,logdepthbuf_pars_vertex:u0,logdepthbuf_vertex:d0,map_fragment:p0,map_pars_fragment:m0,map_particle_fragment:g0,map_particle_pars_fragment:v0,metalnessmap_fragment:x0,metalnessmap_pars_fragment:_0,morphcolor_vertex:y0,morphnormal_vertex:b0,morphtarget_pars_vertex:w0,morphtarget_vertex:M0,normal_fragment_begin:S0,normal_fragment_maps:A0,normal_pars_fragment:E0,normal_pars_vertex:T0,normal_vertex:C0,normalmap_pars_fragment:R0,clearcoat_normal_fragment_begin:P0,clearcoat_normal_fragment_maps:I0,clearcoat_pars_fragment:L0,iridescence_pars_fragment:D0,output_fragment:N0,packing:F0,premultiplied_alpha_fragment:B0,project_vertex:k0,dithering_fragment:O0,dithering_pars_fragment:U0,roughnessmap_fragment:z0,roughnessmap_pars_fragment:G0,shadowmap_pars_fragment:V0,shadowmap_pars_vertex:H0,shadowmap_vertex:W0,shadowmask_pars_fragment:q0,skinbase_vertex:j0,skinning_pars_vertex:X0,skinning_vertex:Z0,skinnormal_vertex:Y0,specularmap_fragment:J0,specularmap_pars_fragment:K0,tonemapping_fragment:Q0,tonemapping_pars_fragment:$0,transmission_fragment:tm,transmission_pars_fragment:em,uv_pars_fragment:nm,uv_pars_vertex:im,uv_vertex:rm,uv2_pars_fragment:sm,uv2_pars_vertex:om,uv2_vertex:am,worldpos_vertex:lm,background_vert:cm,background_frag:fm,cube_vert:hm,cube_frag:um,depth_vert:dm,depth_frag:pm,distanceRGBA_vert:mm,distanceRGBA_frag:gm,equirect_vert:vm,equirect_frag:xm,linedashed_vert:_m,linedashed_frag:ym,meshbasic_vert:bm,meshbasic_frag:wm,meshlambert_vert:Mm,meshlambert_frag:Sm,meshmatcap_vert:Am,meshmatcap_frag:Em,meshnormal_vert:Tm,meshnormal_frag:Cm,meshphong_vert:Rm,meshphong_frag:Pm,meshphysical_vert:Im,meshphysical_frag:Lm,meshtoon_vert:Dm,meshtoon_frag:Nm,points_vert:Fm,points_frag:Bm,shadow_vert:km,shadow_frag:Om,sprite_vert:Um,sprite_frag:zm},xt={common:{diffuse:{value:new Vt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Wn},uv2Transform:{value:new Wn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}},sprite:{diffuse:{value:new Vt(16777215)},opacity:{value:1},center:{value:new ne(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Wn}}},Un={basic:{uniforms:Ne([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.fog]),vertexShader:Wt.meshbasic_vert,fragmentShader:Wt.meshbasic_frag},lambert:{uniforms:Ne([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.fog,xt.lights,{emissive:{value:new Vt(0)}}]),vertexShader:Wt.meshlambert_vert,fragmentShader:Wt.meshlambert_frag},phong:{uniforms:Ne([xt.common,xt.specularmap,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,xt.lights,{emissive:{value:new Vt(0)},specular:{value:new Vt(1118481)},shininess:{value:30}}]),vertexShader:Wt.meshphong_vert,fragmentShader:Wt.meshphong_frag},standard:{uniforms:Ne([xt.common,xt.envmap,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.roughnessmap,xt.metalnessmap,xt.fog,xt.lights,{emissive:{value:new Vt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag},toon:{uniforms:Ne([xt.common,xt.aomap,xt.lightmap,xt.emissivemap,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.gradientmap,xt.fog,xt.lights,{emissive:{value:new Vt(0)}}]),vertexShader:Wt.meshtoon_vert,fragmentShader:Wt.meshtoon_frag},matcap:{uniforms:Ne([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,xt.fog,{matcap:{value:null}}]),vertexShader:Wt.meshmatcap_vert,fragmentShader:Wt.meshmatcap_frag},points:{uniforms:Ne([xt.points,xt.fog]),vertexShader:Wt.points_vert,fragmentShader:Wt.points_frag},dashed:{uniforms:Ne([xt.common,xt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Wt.linedashed_vert,fragmentShader:Wt.linedashed_frag},depth:{uniforms:Ne([xt.common,xt.displacementmap]),vertexShader:Wt.depth_vert,fragmentShader:Wt.depth_frag},normal:{uniforms:Ne([xt.common,xt.bumpmap,xt.normalmap,xt.displacementmap,{opacity:{value:1}}]),vertexShader:Wt.meshnormal_vert,fragmentShader:Wt.meshnormal_frag},sprite:{uniforms:Ne([xt.sprite,xt.fog]),vertexShader:Wt.sprite_vert,fragmentShader:Wt.sprite_frag},background:{uniforms:{uvTransform:{value:new Wn},t2D:{value:null}},vertexShader:Wt.background_vert,fragmentShader:Wt.background_frag},cube:{uniforms:Ne([xt.envmap,{opacity:{value:1}}]),vertexShader:Wt.cube_vert,fragmentShader:Wt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Wt.equirect_vert,fragmentShader:Wt.equirect_frag},distanceRGBA:{uniforms:Ne([xt.common,xt.displacementmap,{referencePosition:{value:new J},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Wt.distanceRGBA_vert,fragmentShader:Wt.distanceRGBA_frag},shadow:{uniforms:Ne([xt.lights,xt.fog,{color:{value:new Vt(0)},opacity:{value:1}}]),vertexShader:Wt.shadow_vert,fragmentShader:Wt.shadow_frag}};Un.physical={uniforms:Ne([Un.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ne(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Vt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Vt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Vt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Wt.meshphysical_vert,fragmentShader:Wt.meshphysical_frag};function Gm(i,t,e,n,r,s){const o=new Vt(0);let a=r===!0?0:1,l,c,h=null,u=0,p=null;function x(g,v){let M=!1,D=v.isScene===!0?v.background:null;D&&D.isTexture&&(D=t.get(D));const z=i.xr,B=z.getSession&&z.getSession();B&&B.environmentBlendMode==="additive"&&(D=null),D===null?b(o,a):D&&D.isColor&&(b(D,1),M=!0),(i.autoClear||M)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),D&&(D.isCubeTexture||D.mapping===Uo)?(c===void 0&&(c=new qn(new Kr(1,1,1),new _i({name:"BackgroundCubeMaterial",uniforms:Hr(Un.cube.uniforms),vertexShader:Un.cube.vertexShader,fragmentShader:Un.cube.fragmentShader,side:Pn,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(O,G,Z){this.matrixWorld.copyPosition(Z.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=D,c.material.uniforms.flipEnvMap.value=D.isCubeTexture&&D.isRenderTargetTexture===!1?-1:1,(h!==D||u!==D.version||p!==i.toneMapping)&&(c.material.needsUpdate=!0,h=D,u=D.version,p=i.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null)):D&&D.isTexture&&(l===void 0&&(l=new qn(new yl(2,2),new _i({name:"BackgroundMaterial",uniforms:Hr(Un.background.uniforms),vertexShader:Un.background.vertexShader,fragmentShader:Un.background.fragmentShader,side:Ms,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=D,D.matrixAutoUpdate===!0&&D.updateMatrix(),l.material.uniforms.uvTransform.value.copy(D.matrix),(h!==D||u!==D.version||p!==i.toneMapping)&&(l.material.needsUpdate=!0,h=D,u=D.version,p=i.toneMapping),l.layers.enableAll(),g.unshift(l,l.geometry,l.material,0,0,null))}function b(g,v){e.buffers.color.setClear(g.r,g.g,g.b,v,s)}return{getClearColor:function(){return o},setClearColor:function(g,v=1){o.set(g),a=v,b(o,a)},getClearAlpha:function(){return a},setClearAlpha:function(g){a=g,b(o,a)},render:x}}function Vm(i,t,e,n){const r=i.getParameter(34921),s=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=v(null);let c=l,h=!1;function u(f,m,y,w,S){let C=!1;if(o){const I=g(w,y,m);c!==I&&(c=I,x(c.object)),C=M(f,w,y,S),C&&D(f,w,y,S)}else{const I=m.wireframe===!0;(c.geometry!==w.id||c.program!==y.id||c.wireframe!==I)&&(c.geometry=w.id,c.program=y.id,c.wireframe=I,C=!0)}S!==null&&e.update(S,34963),(C||h)&&(h=!1,L(f,m,y,w),S!==null&&i.bindBuffer(34963,e.get(S).buffer))}function p(){return n.isWebGL2?i.createVertexArray():s.createVertexArrayOES()}function x(f){return n.isWebGL2?i.bindVertexArray(f):s.bindVertexArrayOES(f)}function b(f){return n.isWebGL2?i.deleteVertexArray(f):s.deleteVertexArrayOES(f)}function g(f,m,y){const w=y.wireframe===!0;let S=a[f.id];S===void 0&&(S={},a[f.id]=S);let C=S[m.id];C===void 0&&(C={},S[m.id]=C);let I=C[w];return I===void 0&&(I=v(p()),C[w]=I),I}function v(f){const m=[],y=[],w=[];for(let S=0;S<r;S++)m[S]=0,y[S]=0,w[S]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:m,enabledAttributes:y,attributeDivisors:w,object:f,attributes:{},index:null}}function M(f,m,y,w){const S=c.attributes,C=m.attributes;let I=0;const A=y.getAttributes();for(const d in A)if(A[d].location>=0){const it=S[d];let _=C[d];if(_===void 0&&(d==="instanceMatrix"&&f.instanceMatrix&&(_=f.instanceMatrix),d==="instanceColor"&&f.instanceColor&&(_=f.instanceColor)),it===void 0||it.attribute!==_||_&&it.data!==_.data)return!0;I++}return c.attributesNum!==I||c.index!==w}function D(f,m,y,w){const S={},C=m.attributes;let I=0;const A=y.getAttributes();for(const d in A)if(A[d].location>=0){let it=C[d];it===void 0&&(d==="instanceMatrix"&&f.instanceMatrix&&(it=f.instanceMatrix),d==="instanceColor"&&f.instanceColor&&(it=f.instanceColor));const _={};_.attribute=it,it&&it.data&&(_.data=it.data),S[d]=_,I++}c.attributes=S,c.attributesNum=I,c.index=w}function z(){const f=c.newAttributes;for(let m=0,y=f.length;m<y;m++)f[m]=0}function B(f){O(f,0)}function O(f,m){const y=c.newAttributes,w=c.enabledAttributes,S=c.attributeDivisors;y[f]=1,w[f]===0&&(i.enableVertexAttribArray(f),w[f]=1),S[f]!==m&&((n.isWebGL2?i:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](f,m),S[f]=m)}function G(){const f=c.newAttributes,m=c.enabledAttributes;for(let y=0,w=m.length;y<w;y++)m[y]!==f[y]&&(i.disableVertexAttribArray(y),m[y]=0)}function Z(f,m,y,w,S,C){n.isWebGL2===!0&&(y===5124||y===5125)?i.vertexAttribIPointer(f,m,y,S,C):i.vertexAttribPointer(f,m,y,w,S,C)}function L(f,m,y,w){if(n.isWebGL2===!1&&(f.isInstancedMesh||w.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;z();const S=w.attributes,C=y.getAttributes(),I=m.defaultAttributeValues;for(const A in C){const d=C[A];if(d.location>=0){let E=S[A];if(E===void 0&&(A==="instanceMatrix"&&f.instanceMatrix&&(E=f.instanceMatrix),A==="instanceColor"&&f.instanceColor&&(E=f.instanceColor)),E!==void 0){const it=E.normalized,_=E.itemSize,N=e.get(E);if(N===void 0)continue;const Q=N.buffer,Y=N.type,tt=N.bytesPerElement;if(E.isInterleavedBufferAttribute){const et=E.data,lt=et.stride,rt=E.offset;if(et.isInstancedInterleavedBuffer){for(let At=0;At<d.locationSize;At++)O(d.location+At,et.meshPerAttribute);f.isInstancedMesh!==!0&&w._maxInstanceCount===void 0&&(w._maxInstanceCount=et.meshPerAttribute*et.count)}else for(let At=0;At<d.locationSize;At++)B(d.location+At);i.bindBuffer(34962,Q);for(let At=0;At<d.locationSize;At++)Z(d.location+At,_/d.locationSize,Y,it,lt*tt,(rt+_/d.locationSize*At)*tt)}else{if(E.isInstancedBufferAttribute){for(let et=0;et<d.locationSize;et++)O(d.location+et,E.meshPerAttribute);f.isInstancedMesh!==!0&&w._maxInstanceCount===void 0&&(w._maxInstanceCount=E.meshPerAttribute*E.count)}else for(let et=0;et<d.locationSize;et++)B(d.location+et);i.bindBuffer(34962,Q);for(let et=0;et<d.locationSize;et++)Z(d.location+et,_/d.locationSize,Y,it,_*tt,_/d.locationSize*et*tt)}}else if(I!==void 0){const it=I[A];if(it!==void 0)switch(it.length){case 2:i.vertexAttrib2fv(d.location,it);break;case 3:i.vertexAttrib3fv(d.location,it);break;case 4:i.vertexAttrib4fv(d.location,it);break;default:i.vertexAttrib1fv(d.location,it)}}}}G()}function U(){ht();for(const f in a){const m=a[f];for(const y in m){const w=m[y];for(const S in w)b(w[S].object),delete w[S];delete m[y]}delete a[f]}}function $(f){if(a[f.id]===void 0)return;const m=a[f.id];for(const y in m){const w=m[y];for(const S in w)b(w[S].object),delete w[S];delete m[y]}delete a[f.id]}function j(f){for(const m in a){const y=a[m];if(y[f.id]===void 0)continue;const w=y[f.id];for(const S in w)b(w[S].object),delete w[S];delete y[f.id]}}function ht(){R(),h=!0,c!==l&&(c=l,x(c.object))}function R(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:u,reset:ht,resetDefaultState:R,dispose:U,releaseStatesOfGeometry:$,releaseStatesOfProgram:j,initAttributes:z,enableAttribute:B,disableUnusedAttributes:G}}function Hm(i,t,e,n){const r=n.isWebGL2;let s;function o(c){s=c}function a(c,h){i.drawArrays(s,c,h),e.update(h,s,1)}function l(c,h,u){if(u===0)return;let p,x;if(r)p=i,x="drawArraysInstanced";else if(p=t.get("ANGLE_instanced_arrays"),x="drawArraysInstancedANGLE",p===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}p[x](s,c,h,u),e.update(h,s,u)}this.setMode=o,this.render=a,this.renderInstances=l}function Wm(i,t,e){let n;function r(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const Z=t.get("EXT_texture_filter_anisotropic");n=i.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(Z){if(Z==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Z="mediump"}return Z==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let a=e.precision!==void 0?e.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||t.has("WEBGL_draw_buffers"),h=e.logarithmicDepthBuffer===!0,u=i.getParameter(34930),p=i.getParameter(35660),x=i.getParameter(3379),b=i.getParameter(34076),g=i.getParameter(34921),v=i.getParameter(36347),M=i.getParameter(36348),D=i.getParameter(36349),z=p>0,B=o||t.has("OES_texture_float"),O=z&&B,G=o?i.getParameter(36183):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:r,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:p,maxTextureSize:x,maxCubemapSize:b,maxAttributes:g,maxVertexUniforms:v,maxVaryings:M,maxFragmentUniforms:D,vertexTextures:z,floatFragmentTextures:B,floatVertexTextures:O,maxSamples:G}}function qm(i){const t=this;let e=null,n=0,r=!1,s=!1;const o=new Xi,a=new Wn,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,p,x){const b=u.length!==0||p||n!==0||r;return r=p,e=h(u,x,0),n=u.length,b},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(u,p,x){const b=u.clippingPlanes,g=u.clipIntersection,v=u.clipShadows,M=i.get(u);if(!r||b===null||b.length===0||s&&!v)s?h(null):c();else{const D=s?0:n,z=D*4;let B=M.clippingState||null;l.value=B,B=h(b,p,z,x);for(let O=0;O!==z;++O)B[O]=e[O];M.clippingState=B,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=D}};function c(){l.value!==e&&(l.value=e,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(u,p,x,b){const g=u!==null?u.length:0;let v=null;if(g!==0){if(v=l.value,b!==!0||v===null){const M=x+g*4,D=p.matrixWorldInverse;a.getNormalMatrix(D),(v===null||v.length<M)&&(v=new Float32Array(M));for(let z=0,B=x;z!==g;++z,B+=4)o.copy(u[z]).applyMatrix4(D,a),o.normal.toArray(v,B),v[B+3]=o.constant}l.value=v,l.needsUpdate=!0}return t.numPlanes=g,t.numIntersection=0,v}}function jm(i){let t=new WeakMap;function e(o,a){return a===Za?o.mapping=zr:a===Ya&&(o.mapping=Gr),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Za||a===Ya)if(t.has(o)){const l=t.get(o).texture;return e(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new lp(l.height/2);return c.fromEquirectangularTexture(i,o),t.set(o,c),o.addEventListener("dispose",r),e(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=t.get(a);l!==void 0&&(t.delete(a),l.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}class Xm extends lh{constructor(t=-1,e=1,n=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=n-t,o=n+t,a=r+e,l=r-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Rr=4,Rc=[.125,.215,.35,.446,.526,.582],Yi=20,Ea=new Xm,Pc=new Vt;let Ta=null;const Zi=(1+Math.sqrt(5))/2,Sr=1/Zi,Ic=[new J(1,1,1),new J(-1,1,1),new J(1,1,-1),new J(-1,1,-1),new J(0,Zi,Sr),new J(0,Zi,-Sr),new J(Sr,0,Zi),new J(-Sr,0,Zi),new J(Zi,Sr,0),new J(-Zi,Sr,0)];class Lc{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,r=100){Ta=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,r,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Fc(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Nc(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ta),t.scissorTest=!1,co(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===zr||t.mapping===Gr?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ta=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:un,minFilter:un,generateMipmaps:!1,type:Ss,format:Cn,encoding:ir,depthBuffer:!1},r=Dc(t,e,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Dc(t,e,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Zm(s)),this._blurMaterial=Ym(s,t,e)}return r}_compileMaterial(t){const e=new qn(this._lodPlanes[0],t);this._renderer.compile(e,Ea)}_sceneToCubeUV(t,e,n,r){const a=new dn(90,1,e,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,p=h.toneMapping;h.getClearColor(Pc),h.toneMapping=xi,h.autoClear=!1;const x=new Es({name:"PMREM.Background",side:Pn,depthWrite:!1,depthTest:!1}),b=new qn(new Kr,x);let g=!1;const v=t.background;v?v.isColor&&(x.color.copy(v),t.background=null,g=!0):(x.color.copy(Pc),g=!0);for(let M=0;M<6;M++){const D=M%3;D===0?(a.up.set(0,l[M],0),a.lookAt(c[M],0,0)):D===1?(a.up.set(0,0,l[M]),a.lookAt(0,c[M],0)):(a.up.set(0,l[M],0),a.lookAt(0,0,c[M]));const z=this._cubeSize;co(r,D*z,M>2?z:0,z,z),h.setRenderTarget(r),g&&h.render(b,a),h.render(t,a)}b.geometry.dispose(),b.material.dispose(),h.toneMapping=p,h.autoClear=u,t.background=v}_textureToCubeUV(t,e){const n=this._renderer,r=t.mapping===zr||t.mapping===Gr;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=Fc()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Nc());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new qn(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=t;const l=this._cubeSize;co(e,0,0,3*l,2*l),n.setRenderTarget(e),n.render(o,Ea)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),o=Ic[(r-1)%Ic.length];this._blur(t,r-1,r,s,o)}e.autoClear=n}_blur(t,e,n,r,s){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,r,"latitudinal",s),this._halfBlur(o,t,n,n,r,"longitudinal",s)}_halfBlur(t,e,n,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new qn(this._lodPlanes[r],c),p=c.uniforms,x=this._sizeLods[n]-1,b=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Yi-1),g=s/b,v=isFinite(s)?1+Math.floor(h*g):Yi;v>Yi&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Yi}`);const M=[];let D=0;for(let Z=0;Z<Yi;++Z){const L=Z/g,U=Math.exp(-L*L/2);M.push(U),Z===0?D+=U:Z<v&&(D+=2*U)}for(let Z=0;Z<M.length;Z++)M[Z]=M[Z]/D;p.envMap.value=t.texture,p.samples.value=v,p.weights.value=M,p.latitudinal.value=o==="latitudinal",a&&(p.poleAxis.value=a);const{_lodMax:z}=this;p.dTheta.value=b,p.mipInt.value=z-n;const B=this._sizeLods[r],O=3*B*(r>z-Rr?r-z+Rr:0),G=4*(this._cubeSize-B);co(e,O,G,3*B,2*B),l.setRenderTarget(e),l.render(u,Ea)}}function Zm(i){const t=[],e=[],n=[];let r=i;const s=i-Rr+1+Rc.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);e.push(a);let l=1/a;o>i-Rr?l=Rc[o-i+Rr-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),h=-c,u=1+c,p=[h,h,u,h,u,u,h,h,u,u,h,u],x=6,b=6,g=3,v=2,M=1,D=new Float32Array(g*b*x),z=new Float32Array(v*b*x),B=new Float32Array(M*b*x);for(let G=0;G<x;G++){const Z=G%3*2/3-1,L=G>2?0:-1,U=[Z,L,0,Z+2/3,L,0,Z+2/3,L+1,0,Z,L,0,Z+2/3,L+1,0,Z,L+1,0];D.set(U,g*b*G),z.set(p,v*b*G);const $=[G,G,G,G,G,G];B.set($,M*b*G)}const O=new cr;O.setAttribute("position",new Xn(D,g)),O.setAttribute("uv",new Xn(z,v)),O.setAttribute("faceIndex",new Xn(B,M)),t.push(O),r>Rr&&r--}return{lodPlanes:t,sizeLods:e,sigmas:n}}function Dc(i,t,e){const n=new Ui(i,t,e);return n.texture.mapping=Uo,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function co(i,t,e,n,r){i.viewport.set(t,e,n,r),i.scissor.set(t,e,n,r)}function Ym(i,t,e){const n=new Float32Array(Yi),r=new J(0,1,0);return new _i({name:"SphericalGaussianBlur",defines:{n:Yi,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:bl(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Oi,depthTest:!1,depthWrite:!1})}function Nc(){return new _i({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:bl(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Oi,depthTest:!1,depthWrite:!1})}function Fc(){return new _i({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:bl(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Oi,depthTest:!1,depthWrite:!1})}function bl(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Jm(i){let t=new WeakMap,e=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===Za||l===Ya,h=l===zr||l===Gr;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let u=t.get(a);return e===null&&(e=new Lc(i)),u=c?e.fromEquirectangular(a,u):e.fromCubemap(a,u),t.set(a,u),u.texture}else{if(t.has(a))return t.get(a).texture;{const u=a.image;if(c&&u&&u.height>0||h&&u&&r(u)){e===null&&(e=new Lc(i));const p=c?e.fromEquirectangular(a):e.fromCubemap(a);return t.set(a,p),a.addEventListener("dispose",s),p.texture}else return null}}}return a}function r(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:o}}function Km(i){const t={};function e(n){if(t[n]!==void 0)return t[n];let r;switch(n){case"WEBGL_depth_texture":r=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=i.getExtension(n)}return t[n]=r,r}return{has:function(n){return e(n)!==null},init:function(n){n.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(n){const r=e(n);return r===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),r}}}function Qm(i,t,e,n){const r={},s=new WeakMap;function o(u){const p=u.target;p.index!==null&&t.remove(p.index);for(const b in p.attributes)t.remove(p.attributes[b]);p.removeEventListener("dispose",o),delete r[p.id];const x=s.get(p);x&&(t.remove(x),s.delete(p)),n.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,e.memory.geometries--}function a(u,p){return r[p.id]===!0||(p.addEventListener("dispose",o),r[p.id]=!0,e.memory.geometries++),p}function l(u){const p=u.attributes;for(const b in p)t.update(p[b],34962);const x=u.morphAttributes;for(const b in x){const g=x[b];for(let v=0,M=g.length;v<M;v++)t.update(g[v],34962)}}function c(u){const p=[],x=u.index,b=u.attributes.position;let g=0;if(x!==null){const D=x.array;g=x.version;for(let z=0,B=D.length;z<B;z+=3){const O=D[z+0],G=D[z+1],Z=D[z+2];p.push(O,G,G,Z,Z,O)}}else{const D=b.array;g=b.version;for(let z=0,B=D.length/3-1;z<B;z+=3){const O=z+0,G=z+1,Z=z+2;p.push(O,G,G,Z,Z,O)}}const v=new(th(p)?ah:oh)(p,1);v.version=g;const M=s.get(u);M&&t.remove(M),s.set(u,v)}function h(u){const p=s.get(u);if(p){const x=u.index;x!==null&&p.version<x.version&&c(u)}else c(u);return s.get(u)}return{get:a,update:l,getWireframeAttribute:h}}function $m(i,t,e,n){const r=n.isWebGL2;let s;function o(p){s=p}let a,l;function c(p){a=p.type,l=p.bytesPerElement}function h(p,x){i.drawElements(s,x,a,p*l),e.update(x,s,1)}function u(p,x,b){if(b===0)return;let g,v;if(r)g=i,v="drawElementsInstanced";else if(g=t.get("ANGLE_instanced_arrays"),v="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[v](s,x,a,p*l,b),e.update(x,s,b)}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=u}function tg(i){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(e.calls++,o){case 4:e.triangles+=a*(s/3);break;case 1:e.lines+=a*(s/2);break;case 3:e.lines+=a*(s-1);break;case 2:e.lines+=a*s;break;case 0:e.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function r(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:r,update:n}}function eg(i,t){return i[0]-t[0]}function ng(i,t){return Math.abs(t[1])-Math.abs(i[1])}function Ca(i,t){let e=1;const n=t.isInterleavedBufferAttribute?t.data.array:t.array;n instanceof Int8Array?e=127:n instanceof Int16Array?e=32767:n instanceof Int32Array?e=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),i.divideScalar(e)}function ig(i,t,e){const n={},r=new Float32Array(8),s=new WeakMap,o=new Oe,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,u,p){const x=c.morphTargetInfluences;if(t.isWebGL2===!0){const b=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,g=b!==void 0?b.length:0;let v=s.get(h);if(v===void 0||v.count!==g){let m=function(){R.dispose(),s.delete(h),h.removeEventListener("dispose",m)};v!==void 0&&v.texture.dispose();const z=h.morphAttributes.position!==void 0,B=h.morphAttributes.normal!==void 0,O=h.morphAttributes.color!==void 0,G=h.morphAttributes.position||[],Z=h.morphAttributes.normal||[],L=h.morphAttributes.color||[];let U=0;z===!0&&(U=1),B===!0&&(U=2),O===!0&&(U=3);let $=h.attributes.position.count*U,j=1;$>t.maxTextureSize&&(j=Math.ceil($/t.maxTextureSize),$=t.maxTextureSize);const ht=new Float32Array($*j*4*g),R=new rh(ht,$,j,g);R.type=Ki,R.needsUpdate=!0;const f=U*4;for(let y=0;y<g;y++){const w=G[y],S=Z[y],C=L[y],I=$*j*4*y;for(let A=0;A<w.count;A++){const d=A*f;z===!0&&(o.fromBufferAttribute(w,A),w.normalized===!0&&Ca(o,w),ht[I+d+0]=o.x,ht[I+d+1]=o.y,ht[I+d+2]=o.z,ht[I+d+3]=0),B===!0&&(o.fromBufferAttribute(S,A),S.normalized===!0&&Ca(o,S),ht[I+d+4]=o.x,ht[I+d+5]=o.y,ht[I+d+6]=o.z,ht[I+d+7]=0),O===!0&&(o.fromBufferAttribute(C,A),C.normalized===!0&&Ca(o,C),ht[I+d+8]=o.x,ht[I+d+9]=o.y,ht[I+d+10]=o.z,ht[I+d+11]=C.itemSize===4?o.w:1)}}v={count:g,texture:R,size:new ne($,j)},s.set(h,v),h.addEventListener("dispose",m)}let M=0;for(let z=0;z<x.length;z++)M+=x[z];const D=h.morphTargetsRelative?1:1-M;p.getUniforms().setValue(i,"morphTargetBaseInfluence",D),p.getUniforms().setValue(i,"morphTargetInfluences",x),p.getUniforms().setValue(i,"morphTargetsTexture",v.texture,e),p.getUniforms().setValue(i,"morphTargetsTextureSize",v.size)}else{const b=x===void 0?0:x.length;let g=n[h.id];if(g===void 0||g.length!==b){g=[];for(let B=0;B<b;B++)g[B]=[B,0];n[h.id]=g}for(let B=0;B<b;B++){const O=g[B];O[0]=B,O[1]=x[B]}g.sort(ng);for(let B=0;B<8;B++)B<b&&g[B][1]?(a[B][0]=g[B][0],a[B][1]=g[B][1]):(a[B][0]=Number.MAX_SAFE_INTEGER,a[B][1]=0);a.sort(eg);const v=h.morphAttributes.position,M=h.morphAttributes.normal;let D=0;for(let B=0;B<8;B++){const O=a[B],G=O[0],Z=O[1];G!==Number.MAX_SAFE_INTEGER&&Z?(v&&h.getAttribute("morphTarget"+B)!==v[G]&&h.setAttribute("morphTarget"+B,v[G]),M&&h.getAttribute("morphNormal"+B)!==M[G]&&h.setAttribute("morphNormal"+B,M[G]),r[B]=Z,D+=Z):(v&&h.hasAttribute("morphTarget"+B)===!0&&h.deleteAttribute("morphTarget"+B),M&&h.hasAttribute("morphNormal"+B)===!0&&h.deleteAttribute("morphNormal"+B),r[B]=0)}const z=h.morphTargetsRelative?1:1-D;p.getUniforms().setValue(i,"morphTargetBaseInfluence",z),p.getUniforms().setValue(i,"morphTargetInfluences",r)}}return{update:l}}function rg(i,t,e,n){let r=new WeakMap;function s(l){const c=n.render.frame,h=l.geometry,u=t.get(l,h);return r.get(u)!==c&&(t.update(u),r.set(u,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),e.update(l.instanceMatrix,34962),l.instanceColor!==null&&e.update(l.instanceColor,34962)),u}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),e.remove(c.instanceMatrix),c.instanceColor!==null&&e.remove(c.instanceColor)}return{update:s,dispose:o}}const uh=new pn,dh=new rh,ph=new Xd,mh=new ch,Bc=[],kc=[],Oc=new Float32Array(16),Uc=new Float32Array(9),zc=new Float32Array(4);function Qr(i,t,e){const n=i[0];if(n<=0||n>0)return i;const r=t*e;let s=Bc[r];if(s===void 0&&(s=new Float32Array(r),Bc[r]=s),t!==0){n.toArray(s,0);for(let o=1,a=0;o!==t;++o)a+=e,i[o].toArray(s,a)}return s}function He(i,t){if(i.length!==t.length)return!1;for(let e=0,n=i.length;e<n;e++)if(i[e]!==t[e])return!1;return!0}function We(i,t){for(let e=0,n=t.length;e<n;e++)i[e]=t[e]}function Go(i,t){let e=kc[t];e===void 0&&(e=new Int32Array(t),kc[t]=e);for(let n=0;n!==t;++n)e[n]=i.allocateTextureUnit();return e}function sg(i,t){const e=this.cache;e[0]!==t&&(i.uniform1f(this.addr,t),e[0]=t)}function og(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(i.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(He(e,t))return;i.uniform2fv(this.addr,t),We(e,t)}}function ag(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(i.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(i.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(He(e,t))return;i.uniform3fv(this.addr,t),We(e,t)}}function lg(i,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(i.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(He(e,t))return;i.uniform4fv(this.addr,t),We(e,t)}}function cg(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(He(e,t))return;i.uniformMatrix2fv(this.addr,!1,t),We(e,t)}else{if(He(e,n))return;zc.set(n),i.uniformMatrix2fv(this.addr,!1,zc),We(e,n)}}function fg(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(He(e,t))return;i.uniformMatrix3fv(this.addr,!1,t),We(e,t)}else{if(He(e,n))return;Uc.set(n),i.uniformMatrix3fv(this.addr,!1,Uc),We(e,n)}}function hg(i,t){const e=this.cache,n=t.elements;if(n===void 0){if(He(e,t))return;i.uniformMatrix4fv(this.addr,!1,t),We(e,t)}else{if(He(e,n))return;Oc.set(n),i.uniformMatrix4fv(this.addr,!1,Oc),We(e,n)}}function ug(i,t){const e=this.cache;e[0]!==t&&(i.uniform1i(this.addr,t),e[0]=t)}function dg(i,t){const e=this.cache;He(e,t)||(i.uniform2iv(this.addr,t),We(e,t))}function pg(i,t){const e=this.cache;He(e,t)||(i.uniform3iv(this.addr,t),We(e,t))}function mg(i,t){const e=this.cache;He(e,t)||(i.uniform4iv(this.addr,t),We(e,t))}function gg(i,t){const e=this.cache;e[0]!==t&&(i.uniform1ui(this.addr,t),e[0]=t)}function vg(i,t){const e=this.cache;He(e,t)||(i.uniform2uiv(this.addr,t),We(e,t))}function xg(i,t){const e=this.cache;He(e,t)||(i.uniform3uiv(this.addr,t),We(e,t))}function _g(i,t){const e=this.cache;He(e,t)||(i.uniform4uiv(this.addr,t),We(e,t))}function yg(i,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),e.setTexture2D(t||uh,r)}function bg(i,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),e.setTexture3D(t||ph,r)}function wg(i,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),e.setTextureCube(t||mh,r)}function Mg(i,t,e){const n=this.cache,r=e.allocateTextureUnit();n[0]!==r&&(i.uniform1i(this.addr,r),n[0]=r),e.setTexture2DArray(t||dh,r)}function Sg(i){switch(i){case 5126:return sg;case 35664:return og;case 35665:return ag;case 35666:return lg;case 35674:return cg;case 35675:return fg;case 35676:return hg;case 5124:case 35670:return ug;case 35667:case 35671:return dg;case 35668:case 35672:return pg;case 35669:case 35673:return mg;case 5125:return gg;case 36294:return vg;case 36295:return xg;case 36296:return _g;case 35678:case 36198:case 36298:case 36306:case 35682:return yg;case 35679:case 36299:case 36307:return bg;case 35680:case 36300:case 36308:case 36293:return wg;case 36289:case 36303:case 36311:case 36292:return Mg}}function Ag(i,t){i.uniform1fv(this.addr,t)}function Eg(i,t){const e=Qr(t,this.size,2);i.uniform2fv(this.addr,e)}function Tg(i,t){const e=Qr(t,this.size,3);i.uniform3fv(this.addr,e)}function Cg(i,t){const e=Qr(t,this.size,4);i.uniform4fv(this.addr,e)}function Rg(i,t){const e=Qr(t,this.size,4);i.uniformMatrix2fv(this.addr,!1,e)}function Pg(i,t){const e=Qr(t,this.size,9);i.uniformMatrix3fv(this.addr,!1,e)}function Ig(i,t){const e=Qr(t,this.size,16);i.uniformMatrix4fv(this.addr,!1,e)}function Lg(i,t){i.uniform1iv(this.addr,t)}function Dg(i,t){i.uniform2iv(this.addr,t)}function Ng(i,t){i.uniform3iv(this.addr,t)}function Fg(i,t){i.uniform4iv(this.addr,t)}function Bg(i,t){i.uniform1uiv(this.addr,t)}function kg(i,t){i.uniform2uiv(this.addr,t)}function Og(i,t){i.uniform3uiv(this.addr,t)}function Ug(i,t){i.uniform4uiv(this.addr,t)}function zg(i,t,e){const n=t.length,r=Go(e,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)e.setTexture2D(t[s]||uh,r[s])}function Gg(i,t,e){const n=t.length,r=Go(e,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)e.setTexture3D(t[s]||ph,r[s])}function Vg(i,t,e){const n=t.length,r=Go(e,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)e.setTextureCube(t[s]||mh,r[s])}function Hg(i,t,e){const n=t.length,r=Go(e,n);i.uniform1iv(this.addr,r);for(let s=0;s!==n;++s)e.setTexture2DArray(t[s]||dh,r[s])}function Wg(i){switch(i){case 5126:return Ag;case 35664:return Eg;case 35665:return Tg;case 35666:return Cg;case 35674:return Rg;case 35675:return Pg;case 35676:return Ig;case 5124:case 35670:return Lg;case 35667:case 35671:return Dg;case 35668:case 35672:return Ng;case 35669:case 35673:return Fg;case 5125:return Bg;case 36294:return kg;case 36295:return Og;case 36296:return Ug;case 35678:case 36198:case 36298:case 36306:case 35682:return zg;case 35679:case 36299:case 36307:return Gg;case 35680:case 36300:case 36308:case 36293:return Vg;case 36289:case 36303:case 36311:case 36292:return Hg}}class qg{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=Sg(e.type)}}class jg{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=Wg(e.type)}}class Xg{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(t,e[a.id],n)}}}const Ra=/(\w+)(\])?(\[|\.)?/g;function Gc(i,t){i.seq.push(t),i.map[t.id]=t}function Zg(i,t,e){const n=i.name,r=n.length;for(Ra.lastIndex=0;;){const s=Ra.exec(n),o=Ra.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){Gc(e,c===void 0?new qg(a,i,t):new jg(a,i,t));break}else{let u=e.map[a];u===void 0&&(u=new Xg(a),Gc(e,u)),e=u}}}class xo{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let r=0;r<n;++r){const s=t.getActiveUniform(e,r),o=t.getUniformLocation(e,s.name);Zg(s,o,this)}}setValue(t,e,n,r){const s=this.map[e];s!==void 0&&s.setValue(t,n,r)}setOptional(t,e,n){const r=e[n];r!==void 0&&this.setValue(t,n,r)}static upload(t,e,n,r){for(let s=0,o=e.length;s!==o;++s){const a=e[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,r)}}static seqWithValue(t,e){const n=[];for(let r=0,s=t.length;r!==s;++r){const o=t[r];o.id in e&&n.push(o)}return n}}function Vc(i,t,e){const n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),n}let Yg=0;function Jg(i,t){const e=i.split(`
`),n=[],r=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let o=r;o<s;o++){const a=o+1;n.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return n.join(`
`)}function Kg(i){switch(i){case ir:return["Linear","( value )"];case pe:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function Hc(i,t,e){const n=i.getShaderParameter(t,35713),r=i.getShaderInfoLog(t).trim();if(n&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return e.toUpperCase()+`

`+r+`

`+Jg(i.getShaderSource(t),o)}else return r}function Qg(i,t){const e=Kg(t);return"vec4 "+i+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function $g(i,t){let e;switch(t){case yd:e="Linear";break;case bd:e="Reinhard";break;case wd:e="OptimizedCineon";break;case Md:e="ACESFilmic";break;case Sd:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+i+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function tv(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ps).join(`
`)}function ev(i){const t=[];for(const e in i){const n=i[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function nv(i,t){const e={},n=i.getProgramParameter(t,35721);for(let r=0;r<n;r++){const s=i.getActiveAttrib(t,r),o=s.name;let a=1;s.type===35674&&(a=2),s.type===35675&&(a=3),s.type===35676&&(a=4),e[o]={type:s.type,location:i.getAttribLocation(t,o),locationSize:a}}return e}function ps(i){return i!==""}function Wc(i,t){return i.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function qc(i,t){return i.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const iv=/^[ \t]*#include +<([\w\d./]+)>/gm;function tl(i){return i.replace(iv,rv)}function rv(i,t){const e=Wt[t];if(e===void 0)throw new Error("Can not resolve #include <"+t+">");return tl(e)}const sv=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ov=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function jc(i){return i.replace(ov,gh).replace(sv,av)}function av(i,t,e,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),gh(i,t,e,n)}function gh(i,t,e,n){let r="";for(let s=parseInt(t);s<parseInt(e);s++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function Xc(i){let t="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?t+=`
#define HIGH_PRECISION`:i.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function lv(i){let t="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===Yf?t="SHADOWMAP_TYPE_PCF":i.shadowMapType===Ku?t="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===ds&&(t="SHADOWMAP_TYPE_VSM"),t}function cv(i){let t="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case zr:case Gr:t="ENVMAP_TYPE_CUBE";break;case Uo:t="ENVMAP_TYPE_CUBE_UV";break}return t}function fv(i){let t="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case Gr:t="ENVMAP_MODE_REFRACTION";break}return t}function hv(i){let t="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case Oo:t="ENVMAP_BLENDING_MULTIPLY";break;case xd:t="ENVMAP_BLENDING_MIX";break;case _d:t="ENVMAP_BLENDING_ADD";break}return t}function uv(i){const t=i.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:n,maxMip:e}}function dv(i,t,e,n){const r=i.getContext(),s=e.defines;let o=e.vertexShader,a=e.fragmentShader;const l=lv(e),c=cv(e),h=fv(e),u=hv(e),p=uv(e),x=e.isWebGL2?"":tv(e),b=ev(s),g=r.createProgram();let v,M,D=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(v=[b].filter(ps).join(`
`),v.length>0&&(v+=`
`),M=[x,b].filter(ps).join(`
`),M.length>0&&(M+=`
`)):(v=[Xc(e),"#define SHADER_NAME "+e.shaderName,b,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.supportsVertexTextures?"#define VERTEX_TEXTURES":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.displacementMap&&e.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ps).join(`
`),M=[x,Xc(e),"#define SHADER_NAME "+e.shaderName,b,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.envMap?"#define "+h:"",e.envMap?"#define "+u:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMap&&e.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",e.normalMap&&e.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",e.specularColorMap?"#define USE_SPECULARCOLORMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEENCOLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.vertexTangents?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUvs?"#define USE_UV":"",e.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==xi?"#define TONE_MAPPING":"",e.toneMapping!==xi?Wt.tonemapping_pars_fragment:"",e.toneMapping!==xi?$g("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",Wt.encodings_pars_fragment,Qg("linearToOutputTexel",e.outputEncoding),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(ps).join(`
`)),o=tl(o),o=Wc(o,e),o=qc(o,e),a=tl(a),a=Wc(a,e),a=qc(a,e),o=jc(o),a=jc(a),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(D=`#version 300 es
`,v=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,M=["#define varying in",e.glslVersion===mc?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===mc?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const z=D+v+o,B=D+M+a,O=Vc(r,35633,z),G=Vc(r,35632,B);if(r.attachShader(g,O),r.attachShader(g,G),e.index0AttributeName!==void 0?r.bindAttribLocation(g,0,e.index0AttributeName):e.morphTargets===!0&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g),i.debug.checkShaderErrors){const U=r.getProgramInfoLog(g).trim(),$=r.getShaderInfoLog(O).trim(),j=r.getShaderInfoLog(G).trim();let ht=!0,R=!0;if(r.getProgramParameter(g,35714)===!1){ht=!1;const f=Hc(r,O,"vertex"),m=Hc(r,G,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,35715)+`

Program Info Log: `+U+`
`+f+`
`+m)}else U!==""?console.warn("THREE.WebGLProgram: Program Info Log:",U):($===""||j==="")&&(R=!1);R&&(this.diagnostics={runnable:ht,programLog:U,vertexShader:{log:$,prefix:v},fragmentShader:{log:j,prefix:M}})}r.deleteShader(O),r.deleteShader(G);let Z;this.getUniforms=function(){return Z===void 0&&(Z=new xo(r,g)),Z};let L;return this.getAttributes=function(){return L===void 0&&(L=nv(r,g)),L},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.name=e.shaderName,this.id=Yg++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=O,this.fragmentShader=G,this}let pv=0;class mv{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,r=this._getShaderStage(e),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return e.has(t)===!1&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(e.has(t)===!1){const n=new gv(t);e.set(t,n)}return e.get(t)}}class gv{constructor(t){this.id=pv++,this.code=t,this.usedTimes=0}}function vv(i,t,e,n,r,s,o){const a=new _l,l=new mv,c=[],h=r.isWebGL2,u=r.logarithmicDepthBuffer,p=r.vertexTextures;let x=r.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(L,U,$,j,ht){const R=j.fog,f=ht.geometry,m=L.isMeshStandardMaterial?j.environment:null,y=(L.isMeshStandardMaterial?e:t).get(L.envMap||m),w=!!y&&y.mapping===Uo?y.image.height:null,S=b[L.type];L.precision!==null&&(x=r.getMaxPrecision(L.precision),x!==L.precision&&console.warn("THREE.WebGLProgram.getParameters:",L.precision,"not supported, using",x,"instead."));const C=f.morphAttributes.position||f.morphAttributes.normal||f.morphAttributes.color,I=C!==void 0?C.length:0;let A=0;f.morphAttributes.position!==void 0&&(A=1),f.morphAttributes.normal!==void 0&&(A=2),f.morphAttributes.color!==void 0&&(A=3);let d,E,it,_;if(S){const lt=Un[S];d=lt.vertexShader,E=lt.fragmentShader}else d=L.vertexShader,E=L.fragmentShader,l.update(L),it=l.getVertexShaderID(L),_=l.getFragmentShaderID(L);const N=i.getRenderTarget(),Q=L.alphaTest>0,Y=L.clearcoat>0,tt=L.iridescence>0;return{isWebGL2:h,shaderID:S,shaderName:L.type,vertexShader:d,fragmentShader:E,defines:L.defines,customVertexShaderID:it,customFragmentShaderID:_,isRawShaderMaterial:L.isRawShaderMaterial===!0,glslVersion:L.glslVersion,precision:x,instancing:ht.isInstancedMesh===!0,instancingColor:ht.isInstancedMesh===!0&&ht.instanceColor!==null,supportsVertexTextures:p,outputEncoding:N===null?i.outputEncoding:N.isXRRenderTarget===!0?N.texture.encoding:ir,map:!!L.map,matcap:!!L.matcap,envMap:!!y,envMapMode:y&&y.mapping,envMapCubeUVHeight:w,lightMap:!!L.lightMap,aoMap:!!L.aoMap,emissiveMap:!!L.emissiveMap,bumpMap:!!L.bumpMap,normalMap:!!L.normalMap,objectSpaceNormalMap:L.normalMapType===Hd,tangentSpaceNormalMap:L.normalMapType===Yr,decodeVideoTexture:!!L.map&&L.map.isVideoTexture===!0&&L.map.encoding===pe,clearcoat:Y,clearcoatMap:Y&&!!L.clearcoatMap,clearcoatRoughnessMap:Y&&!!L.clearcoatRoughnessMap,clearcoatNormalMap:Y&&!!L.clearcoatNormalMap,iridescence:tt,iridescenceMap:tt&&!!L.iridescenceMap,iridescenceThicknessMap:tt&&!!L.iridescenceThicknessMap,displacementMap:!!L.displacementMap,roughnessMap:!!L.roughnessMap,metalnessMap:!!L.metalnessMap,specularMap:!!L.specularMap,specularIntensityMap:!!L.specularIntensityMap,specularColorMap:!!L.specularColorMap,opaque:L.transparent===!1&&L.blending===Dr,alphaMap:!!L.alphaMap,alphaTest:Q,gradientMap:!!L.gradientMap,sheen:L.sheen>0,sheenColorMap:!!L.sheenColorMap,sheenRoughnessMap:!!L.sheenRoughnessMap,transmission:L.transmission>0,transmissionMap:!!L.transmissionMap,thicknessMap:!!L.thicknessMap,combine:L.combine,vertexTangents:!!L.normalMap&&!!f.attributes.tangent,vertexColors:L.vertexColors,vertexAlphas:L.vertexColors===!0&&!!f.attributes.color&&f.attributes.color.itemSize===4,vertexUvs:!!L.map||!!L.bumpMap||!!L.normalMap||!!L.specularMap||!!L.alphaMap||!!L.emissiveMap||!!L.roughnessMap||!!L.metalnessMap||!!L.clearcoatMap||!!L.clearcoatRoughnessMap||!!L.clearcoatNormalMap||!!L.iridescenceMap||!!L.iridescenceThicknessMap||!!L.displacementMap||!!L.transmissionMap||!!L.thicknessMap||!!L.specularIntensityMap||!!L.specularColorMap||!!L.sheenColorMap||!!L.sheenRoughnessMap,uvsVertexOnly:!(!!L.map||!!L.bumpMap||!!L.normalMap||!!L.specularMap||!!L.alphaMap||!!L.emissiveMap||!!L.roughnessMap||!!L.metalnessMap||!!L.clearcoatNormalMap||!!L.iridescenceMap||!!L.iridescenceThicknessMap||L.transmission>0||!!L.transmissionMap||!!L.thicknessMap||!!L.specularIntensityMap||!!L.specularColorMap||L.sheen>0||!!L.sheenColorMap||!!L.sheenRoughnessMap)&&!!L.displacementMap,fog:!!R,useFog:L.fog===!0,fogExp2:R&&R.isFogExp2,flatShading:!!L.flatShading,sizeAttenuation:L.sizeAttenuation,logarithmicDepthBuffer:u,skinning:ht.isSkinnedMesh===!0,morphTargets:f.morphAttributes.position!==void 0,morphNormals:f.morphAttributes.normal!==void 0,morphColors:f.morphAttributes.color!==void 0,morphTargetsCount:I,morphTextureStride:A,numDirLights:U.directional.length,numPointLights:U.point.length,numSpotLights:U.spot.length,numRectAreaLights:U.rectArea.length,numHemiLights:U.hemi.length,numDirLightShadows:U.directionalShadowMap.length,numPointLightShadows:U.pointShadowMap.length,numSpotLightShadows:U.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:L.dithering,shadowMapEnabled:i.shadowMap.enabled&&$.length>0,shadowMapType:i.shadowMap.type,toneMapping:L.toneMapped?i.toneMapping:xi,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:L.premultipliedAlpha,doubleSided:L.side===Ur,flipSided:L.side===Pn,useDepthPacking:!!L.depthPacking,depthPacking:L.depthPacking||0,index0AttributeName:L.index0AttributeName,extensionDerivatives:L.extensions&&L.extensions.derivatives,extensionFragDepth:L.extensions&&L.extensions.fragDepth,extensionDrawBuffers:L.extensions&&L.extensions.drawBuffers,extensionShaderTextureLOD:L.extensions&&L.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:L.customProgramCacheKey()}}function v(L){const U=[];if(L.shaderID?U.push(L.shaderID):(U.push(L.customVertexShaderID),U.push(L.customFragmentShaderID)),L.defines!==void 0)for(const $ in L.defines)U.push($),U.push(L.defines[$]);return L.isRawShaderMaterial===!1&&(M(U,L),D(U,L),U.push(i.outputEncoding)),U.push(L.customProgramCacheKey),U.join()}function M(L,U){L.push(U.precision),L.push(U.outputEncoding),L.push(U.envMapMode),L.push(U.envMapCubeUVHeight),L.push(U.combine),L.push(U.vertexUvs),L.push(U.fogExp2),L.push(U.sizeAttenuation),L.push(U.morphTargetsCount),L.push(U.morphAttributeCount),L.push(U.numDirLights),L.push(U.numPointLights),L.push(U.numSpotLights),L.push(U.numHemiLights),L.push(U.numRectAreaLights),L.push(U.numDirLightShadows),L.push(U.numPointLightShadows),L.push(U.numSpotLightShadows),L.push(U.shadowMapType),L.push(U.toneMapping),L.push(U.numClippingPlanes),L.push(U.numClipIntersection),L.push(U.depthPacking)}function D(L,U){a.disableAll(),U.isWebGL2&&a.enable(0),U.supportsVertexTextures&&a.enable(1),U.instancing&&a.enable(2),U.instancingColor&&a.enable(3),U.map&&a.enable(4),U.matcap&&a.enable(5),U.envMap&&a.enable(6),U.lightMap&&a.enable(7),U.aoMap&&a.enable(8),U.emissiveMap&&a.enable(9),U.bumpMap&&a.enable(10),U.normalMap&&a.enable(11),U.objectSpaceNormalMap&&a.enable(12),U.tangentSpaceNormalMap&&a.enable(13),U.clearcoat&&a.enable(14),U.clearcoatMap&&a.enable(15),U.clearcoatRoughnessMap&&a.enable(16),U.clearcoatNormalMap&&a.enable(17),U.iridescence&&a.enable(18),U.iridescenceMap&&a.enable(19),U.iridescenceThicknessMap&&a.enable(20),U.displacementMap&&a.enable(21),U.specularMap&&a.enable(22),U.roughnessMap&&a.enable(23),U.metalnessMap&&a.enable(24),U.gradientMap&&a.enable(25),U.alphaMap&&a.enable(26),U.alphaTest&&a.enable(27),U.vertexColors&&a.enable(28),U.vertexAlphas&&a.enable(29),U.vertexUvs&&a.enable(30),U.vertexTangents&&a.enable(31),U.uvsVertexOnly&&a.enable(32),U.fog&&a.enable(33),L.push(a.mask),a.disableAll(),U.useFog&&a.enable(0),U.flatShading&&a.enable(1),U.logarithmicDepthBuffer&&a.enable(2),U.skinning&&a.enable(3),U.morphTargets&&a.enable(4),U.morphNormals&&a.enable(5),U.morphColors&&a.enable(6),U.premultipliedAlpha&&a.enable(7),U.shadowMapEnabled&&a.enable(8),U.physicallyCorrectLights&&a.enable(9),U.doubleSided&&a.enable(10),U.flipSided&&a.enable(11),U.useDepthPacking&&a.enable(12),U.dithering&&a.enable(13),U.specularIntensityMap&&a.enable(14),U.specularColorMap&&a.enable(15),U.transmission&&a.enable(16),U.transmissionMap&&a.enable(17),U.thicknessMap&&a.enable(18),U.sheen&&a.enable(19),U.sheenColorMap&&a.enable(20),U.sheenRoughnessMap&&a.enable(21),U.decodeVideoTexture&&a.enable(22),U.opaque&&a.enable(23),L.push(a.mask)}function z(L){const U=b[L.type];let $;if(U){const j=Un[U];$=rp.clone(j.uniforms)}else $=L.uniforms;return $}function B(L,U){let $;for(let j=0,ht=c.length;j<ht;j++){const R=c[j];if(R.cacheKey===U){$=R,++$.usedTimes;break}}return $===void 0&&($=new dv(i,U,L,s),c.push($)),$}function O(L){if(--L.usedTimes===0){const U=c.indexOf(L);c[U]=c[c.length-1],c.pop(),L.destroy()}}function G(L){l.remove(L)}function Z(){l.dispose()}return{getParameters:g,getProgramCacheKey:v,getUniforms:z,acquireProgram:B,releaseProgram:O,releaseShaderCache:G,programs:c,dispose:Z}}function xv(){let i=new WeakMap;function t(s){let o=i.get(s);return o===void 0&&(o={},i.set(s,o)),o}function e(s){i.delete(s)}function n(s,o,a){i.get(s)[o]=a}function r(){i=new WeakMap}return{get:t,remove:e,update:n,dispose:r}}function _v(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.material.id!==t.material.id?i.material.id-t.material.id:i.z!==t.z?i.z-t.z:i.id-t.id}function Zc(i,t){return i.groupOrder!==t.groupOrder?i.groupOrder-t.groupOrder:i.renderOrder!==t.renderOrder?i.renderOrder-t.renderOrder:i.z!==t.z?t.z-i.z:i.id-t.id}function Yc(){const i=[];let t=0;const e=[],n=[],r=[];function s(){t=0,e.length=0,n.length=0,r.length=0}function o(u,p,x,b,g,v){let M=i[t];return M===void 0?(M={id:u.id,object:u,geometry:p,material:x,groupOrder:b,renderOrder:u.renderOrder,z:g,group:v},i[t]=M):(M.id=u.id,M.object=u,M.geometry=p,M.material=x,M.groupOrder=b,M.renderOrder=u.renderOrder,M.z=g,M.group=v),t++,M}function a(u,p,x,b,g,v){const M=o(u,p,x,b,g,v);x.transmission>0?n.push(M):x.transparent===!0?r.push(M):e.push(M)}function l(u,p,x,b,g,v){const M=o(u,p,x,b,g,v);x.transmission>0?n.unshift(M):x.transparent===!0?r.unshift(M):e.unshift(M)}function c(u,p){e.length>1&&e.sort(u||_v),n.length>1&&n.sort(p||Zc),r.length>1&&r.sort(p||Zc)}function h(){for(let u=t,p=i.length;u<p;u++){const x=i[u];if(x.id===null)break;x.id=null,x.object=null,x.geometry=null,x.material=null,x.group=null}}return{opaque:e,transmissive:n,transparent:r,init:s,push:a,unshift:l,finish:h,sort:c}}function yv(){let i=new WeakMap;function t(n,r){let s;return i.has(n)===!1?(s=new Yc,i.set(n,[s])):r>=i.get(n).length?(s=new Yc,i.get(n).push(s)):s=i.get(n)[r],s}function e(){i=new WeakMap}return{get:t,dispose:e}}function bv(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new J,color:new Vt};break;case"SpotLight":e={position:new J,direction:new J,color:new Vt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new J,color:new Vt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new J,skyColor:new Vt,groundColor:new Vt};break;case"RectAreaLight":e={color:new Vt,position:new J,halfWidth:new J,halfHeight:new J};break}return i[t.id]=e,e}}}function wv(){const i={};return{get:function(t){if(i[t.id]!==void 0)return i[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[t.id]=e,e}}}let Mv=0;function Sv(i,t){return(t.castShadow?1:0)-(i.castShadow?1:0)}function Av(i,t){const e=new bv,n=wv(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let h=0;h<9;h++)r.probe.push(new J);const s=new J,o=new Ue,a=new Ue;function l(h,u){let p=0,x=0,b=0;for(let U=0;U<9;U++)r.probe[U].set(0,0,0);let g=0,v=0,M=0,D=0,z=0,B=0,O=0,G=0;h.sort(Sv);const Z=u!==!0?Math.PI:1;for(let U=0,$=h.length;U<$;U++){const j=h[U],ht=j.color,R=j.intensity,f=j.distance,m=j.shadow&&j.shadow.map?j.shadow.map.texture:null;if(j.isAmbientLight)p+=ht.r*R*Z,x+=ht.g*R*Z,b+=ht.b*R*Z;else if(j.isLightProbe)for(let y=0;y<9;y++)r.probe[y].addScaledVector(j.sh.coefficients[y],R);else if(j.isDirectionalLight){const y=e.get(j);if(y.color.copy(j.color).multiplyScalar(j.intensity*Z),j.castShadow){const w=j.shadow,S=n.get(j);S.shadowBias=w.bias,S.shadowNormalBias=w.normalBias,S.shadowRadius=w.radius,S.shadowMapSize=w.mapSize,r.directionalShadow[g]=S,r.directionalShadowMap[g]=m,r.directionalShadowMatrix[g]=j.shadow.matrix,B++}r.directional[g]=y,g++}else if(j.isSpotLight){const y=e.get(j);if(y.position.setFromMatrixPosition(j.matrixWorld),y.color.copy(ht).multiplyScalar(R*Z),y.distance=f,y.coneCos=Math.cos(j.angle),y.penumbraCos=Math.cos(j.angle*(1-j.penumbra)),y.decay=j.decay,j.castShadow){const w=j.shadow,S=n.get(j);S.shadowBias=w.bias,S.shadowNormalBias=w.normalBias,S.shadowRadius=w.radius,S.shadowMapSize=w.mapSize,r.spotShadow[M]=S,r.spotShadowMap[M]=m,r.spotShadowMatrix[M]=j.shadow.matrix,G++}r.spot[M]=y,M++}else if(j.isRectAreaLight){const y=e.get(j);y.color.copy(ht).multiplyScalar(R),y.halfWidth.set(j.width*.5,0,0),y.halfHeight.set(0,j.height*.5,0),r.rectArea[D]=y,D++}else if(j.isPointLight){const y=e.get(j);if(y.color.copy(j.color).multiplyScalar(j.intensity*Z),y.distance=j.distance,y.decay=j.decay,j.castShadow){const w=j.shadow,S=n.get(j);S.shadowBias=w.bias,S.shadowNormalBias=w.normalBias,S.shadowRadius=w.radius,S.shadowMapSize=w.mapSize,S.shadowCameraNear=w.camera.near,S.shadowCameraFar=w.camera.far,r.pointShadow[v]=S,r.pointShadowMap[v]=m,r.pointShadowMatrix[v]=j.shadow.matrix,O++}r.point[v]=y,v++}else if(j.isHemisphereLight){const y=e.get(j);y.skyColor.copy(j.color).multiplyScalar(R*Z),y.groundColor.copy(j.groundColor).multiplyScalar(R*Z),r.hemi[z]=y,z++}}D>0&&(t.isWebGL2||i.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=xt.LTC_FLOAT_1,r.rectAreaLTC2=xt.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=xt.LTC_HALF_1,r.rectAreaLTC2=xt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=p,r.ambient[1]=x,r.ambient[2]=b;const L=r.hash;(L.directionalLength!==g||L.pointLength!==v||L.spotLength!==M||L.rectAreaLength!==D||L.hemiLength!==z||L.numDirectionalShadows!==B||L.numPointShadows!==O||L.numSpotShadows!==G)&&(r.directional.length=g,r.spot.length=M,r.rectArea.length=D,r.point.length=v,r.hemi.length=z,r.directionalShadow.length=B,r.directionalShadowMap.length=B,r.pointShadow.length=O,r.pointShadowMap.length=O,r.spotShadow.length=G,r.spotShadowMap.length=G,r.directionalShadowMatrix.length=B,r.pointShadowMatrix.length=O,r.spotShadowMatrix.length=G,L.directionalLength=g,L.pointLength=v,L.spotLength=M,L.rectAreaLength=D,L.hemiLength=z,L.numDirectionalShadows=B,L.numPointShadows=O,L.numSpotShadows=G,r.version=Mv++)}function c(h,u){let p=0,x=0,b=0,g=0,v=0;const M=u.matrixWorldInverse;for(let D=0,z=h.length;D<z;D++){const B=h[D];if(B.isDirectionalLight){const O=r.directional[p];O.direction.setFromMatrixPosition(B.matrixWorld),s.setFromMatrixPosition(B.target.matrixWorld),O.direction.sub(s),O.direction.transformDirection(M),p++}else if(B.isSpotLight){const O=r.spot[b];O.position.setFromMatrixPosition(B.matrixWorld),O.position.applyMatrix4(M),O.direction.setFromMatrixPosition(B.matrixWorld),s.setFromMatrixPosition(B.target.matrixWorld),O.direction.sub(s),O.direction.transformDirection(M),b++}else if(B.isRectAreaLight){const O=r.rectArea[g];O.position.setFromMatrixPosition(B.matrixWorld),O.position.applyMatrix4(M),a.identity(),o.copy(B.matrixWorld),o.premultiply(M),a.extractRotation(o),O.halfWidth.set(B.width*.5,0,0),O.halfHeight.set(0,B.height*.5,0),O.halfWidth.applyMatrix4(a),O.halfHeight.applyMatrix4(a),g++}else if(B.isPointLight){const O=r.point[x];O.position.setFromMatrixPosition(B.matrixWorld),O.position.applyMatrix4(M),x++}else if(B.isHemisphereLight){const O=r.hemi[v];O.direction.setFromMatrixPosition(B.matrixWorld),O.direction.transformDirection(M),v++}}}return{setup:l,setupView:c,state:r}}function Jc(i,t){const e=new Av(i,t),n=[],r=[];function s(){n.length=0,r.length=0}function o(u){n.push(u)}function a(u){r.push(u)}function l(u){e.setup(n,u)}function c(u){e.setupView(n,u)}return{init:s,state:{lightsArray:n,shadowsArray:r,lights:e},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function Ev(i,t){let e=new WeakMap;function n(s,o){let a;return e.has(s)===!1?(a=new Jc(i,t),e.set(s,[a])):o>=e.get(s).length?(a=new Jc(i,t),e.get(s).push(a)):a=e.get(s)[o],a}function r(){e=new WeakMap}return{get:n,dispose:r}}class vh extends Ie{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Gd,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class xh extends Ie{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new J,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const Tv=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Cv=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Rv(i,t,e){let n=new fh;const r=new ne,s=new ne,o=new Oe,a=new vh({depthPacking:Vd}),l=new xh,c={},h=e.maxTextureSize,u={0:Pn,1:Ms,2:Ur},p=new _i({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne},radius:{value:4}},vertexShader:Tv,fragmentShader:Cv}),x=p.clone();x.defines.HORIZONTAL_PASS=1;const b=new cr;b.setAttribute("position",new Xn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new qn(b,p),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Yf,this.render=function(B,O,G){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||B.length===0)return;const Z=i.getRenderTarget(),L=i.getActiveCubeFace(),U=i.getActiveMipmapLevel(),$=i.state;$.setBlending(Oi),$.buffers.color.setClear(1,1,1,1),$.buffers.depth.setTest(!0),$.setScissorTest(!1);for(let j=0,ht=B.length;j<ht;j++){const R=B[j],f=R.shadow;if(f===void 0){console.warn("THREE.WebGLShadowMap:",R,"has no shadow.");continue}if(f.autoUpdate===!1&&f.needsUpdate===!1)continue;r.copy(f.mapSize);const m=f.getFrameExtents();if(r.multiply(m),s.copy(f.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/m.x),r.x=s.x*m.x,f.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/m.y),r.y=s.y*m.y,f.mapSize.y=s.y)),f.map===null&&!f.isPointLightShadow&&this.type===ds&&(f.map=new Ui(r.x,r.y),f.map.texture.name=R.name+".shadowMap",f.mapPass=new Ui(r.x,r.y),f.camera.updateProjectionMatrix()),f.map===null){const w={minFilter:Ye,magFilter:Ye,format:Cn};f.map=new Ui(r.x,r.y,w),f.map.texture.name=R.name+".shadowMap",f.camera.updateProjectionMatrix()}i.setRenderTarget(f.map),i.clear();const y=f.getViewportCount();for(let w=0;w<y;w++){const S=f.getViewport(w);o.set(s.x*S.x,s.y*S.y,s.x*S.z,s.y*S.w),$.viewport(o),f.updateMatrices(R,w),n=f.getFrustum(),z(O,G,f.camera,R,this.type)}!f.isPointLightShadow&&this.type===ds&&M(f,G),f.needsUpdate=!1}v.needsUpdate=!1,i.setRenderTarget(Z,L,U)};function M(B,O){const G=t.update(g);p.defines.VSM_SAMPLES!==B.blurSamples&&(p.defines.VSM_SAMPLES=B.blurSamples,x.defines.VSM_SAMPLES=B.blurSamples,p.needsUpdate=!0,x.needsUpdate=!0),p.uniforms.shadow_pass.value=B.map.texture,p.uniforms.resolution.value=B.mapSize,p.uniforms.radius.value=B.radius,i.setRenderTarget(B.mapPass),i.clear(),i.renderBufferDirect(O,null,G,p,g,null),x.uniforms.shadow_pass.value=B.mapPass.texture,x.uniforms.resolution.value=B.mapSize,x.uniforms.radius.value=B.radius,i.setRenderTarget(B.map),i.clear(),i.renderBufferDirect(O,null,G,x,g,null)}function D(B,O,G,Z,L,U){let $=null;const j=G.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(j!==void 0?$=j:$=G.isPointLight===!0?l:a,i.localClippingEnabled&&O.clipShadows===!0&&O.clippingPlanes.length!==0||O.displacementMap&&O.displacementScale!==0||O.alphaMap&&O.alphaTest>0){const ht=$.uuid,R=O.uuid;let f=c[ht];f===void 0&&(f={},c[ht]=f);let m=f[R];m===void 0&&(m=$.clone(),f[R]=m),$=m}return $.visible=O.visible,$.wireframe=O.wireframe,U===ds?$.side=O.shadowSide!==null?O.shadowSide:O.side:$.side=O.shadowSide!==null?O.shadowSide:u[O.side],$.alphaMap=O.alphaMap,$.alphaTest=O.alphaTest,$.clipShadows=O.clipShadows,$.clippingPlanes=O.clippingPlanes,$.clipIntersection=O.clipIntersection,$.displacementMap=O.displacementMap,$.displacementScale=O.displacementScale,$.displacementBias=O.displacementBias,$.wireframeLinewidth=O.wireframeLinewidth,$.linewidth=O.linewidth,G.isPointLight===!0&&$.isMeshDistanceMaterial===!0&&($.referencePosition.setFromMatrixPosition(G.matrixWorld),$.nearDistance=Z,$.farDistance=L),$}function z(B,O,G,Z,L){if(B.visible===!1)return;if(B.layers.test(O.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&L===ds)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(G.matrixWorldInverse,B.matrixWorld);const j=t.update(B),ht=B.material;if(Array.isArray(ht)){const R=j.groups;for(let f=0,m=R.length;f<m;f++){const y=R[f],w=ht[y.materialIndex];if(w&&w.visible){const S=D(B,w,Z,G.near,G.far,L);i.renderBufferDirect(G,null,j,S,B,y)}}}else if(ht.visible){const R=D(B,ht,Z,G.near,G.far,L);i.renderBufferDirect(G,null,j,R,B,null)}}const $=B.children;for(let j=0,ht=$.length;j<ht;j++)z($[j],O,G,Z,L)}}function Pv(i,t,e){const n=e.isWebGL2;function r(){let k=!1;const mt=new Oe;let at=null;const _t=new Oe(0,0,0,0);return{setMask:function(bt){at!==bt&&!k&&(i.colorMask(bt,bt,bt,bt),at=bt)},setLocked:function(bt){k=bt},setClear:function(bt,wt,st,Dt,Pt){Pt===!0&&(bt*=Dt,wt*=Dt,st*=Dt),mt.set(bt,wt,st,Dt),_t.equals(mt)===!1&&(i.clearColor(bt,wt,st,Dt),_t.copy(mt))},reset:function(){k=!1,at=null,_t.set(-1,0,0,0)}}}function s(){let k=!1,mt=null,at=null,_t=null;return{setTest:function(bt){bt?_(2929):N(2929)},setMask:function(bt){mt!==bt&&!k&&(i.depthMask(bt),mt=bt)},setFunc:function(bt){if(at!==bt){if(bt)switch(bt){case hd:i.depthFunc(512);break;case ud:i.depthFunc(519);break;case dd:i.depthFunc(513);break;case Xa:i.depthFunc(515);break;case pd:i.depthFunc(514);break;case md:i.depthFunc(518);break;case gd:i.depthFunc(516);break;case vd:i.depthFunc(517);break;default:i.depthFunc(515)}else i.depthFunc(515);at=bt}},setLocked:function(bt){k=bt},setClear:function(bt){_t!==bt&&(i.clearDepth(bt),_t=bt)},reset:function(){k=!1,mt=null,at=null,_t=null}}}function o(){let k=!1,mt=null,at=null,_t=null,bt=null,wt=null,st=null,Dt=null,Pt=null;return{setTest:function(It){k||(It?_(2960):N(2960))},setMask:function(It){mt!==It&&!k&&(i.stencilMask(It),mt=It)},setFunc:function(It,ue,jt){(at!==It||_t!==ue||bt!==jt)&&(i.stencilFunc(It,ue,jt),at=It,_t=ue,bt=jt)},setOp:function(It,ue,jt){(wt!==It||st!==ue||Dt!==jt)&&(i.stencilOp(It,ue,jt),wt=It,st=ue,Dt=jt)},setLocked:function(It){k=It},setClear:function(It){Pt!==It&&(i.clearStencil(It),Pt=It)},reset:function(){k=!1,mt=null,at=null,_t=null,bt=null,wt=null,st=null,Dt=null,Pt=null}}}const a=new r,l=new s,c=new o;let h={},u={},p=new WeakMap,x=[],b=null,g=!1,v=null,M=null,D=null,z=null,B=null,O=null,G=null,Z=!1,L=null,U=null,$=null,j=null,ht=null;const R=i.getParameter(35661);let f=!1,m=0;const y=i.getParameter(7938);y.indexOf("WebGL")!==-1?(m=parseFloat(/^WebGL (\d)/.exec(y)[1]),f=m>=1):y.indexOf("OpenGL ES")!==-1&&(m=parseFloat(/^OpenGL ES (\d)/.exec(y)[1]),f=m>=2);let w=null,S={};const C=i.getParameter(3088),I=i.getParameter(2978),A=new Oe().fromArray(C),d=new Oe().fromArray(I);function E(k,mt,at){const _t=new Uint8Array(4),bt=i.createTexture();i.bindTexture(k,bt),i.texParameteri(k,10241,9728),i.texParameteri(k,10240,9728);for(let wt=0;wt<at;wt++)i.texImage2D(mt+wt,0,6408,1,1,0,6408,5121,_t);return bt}const it={};it[3553]=E(3553,3553,1),it[34067]=E(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),_(2929),l.setFunc(Xa),gt(!1),Ct(Ul),_(2884),rt(Oi);function _(k){h[k]!==!0&&(i.enable(k),h[k]=!0)}function N(k){h[k]!==!1&&(i.disable(k),h[k]=!1)}function Q(k,mt){return u[k]!==mt?(i.bindFramebuffer(k,mt),u[k]=mt,n&&(k===36009&&(u[36160]=mt),k===36160&&(u[36009]=mt)),!0):!1}function Y(k,mt){let at=x,_t=!1;if(k)if(at=p.get(mt),at===void 0&&(at=[],p.set(mt,at)),k.isWebGLMultipleRenderTargets){const bt=k.texture;if(at.length!==bt.length||at[0]!==36064){for(let wt=0,st=bt.length;wt<st;wt++)at[wt]=36064+wt;at.length=bt.length,_t=!0}}else at[0]!==36064&&(at[0]=36064,_t=!0);else at[0]!==1029&&(at[0]=1029,_t=!0);_t&&(e.isWebGL2?i.drawBuffers(at):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(at))}function tt(k){return b!==k?(i.useProgram(k),b=k,!0):!1}const et={[Er]:32774,[td]:32778,[ed]:32779};if(n)et[Hl]=32775,et[Wl]=32776;else{const k=t.get("EXT_blend_minmax");k!==null&&(et[Hl]=k.MIN_EXT,et[Wl]=k.MAX_EXT)}const lt={[nd]:0,[id]:1,[rd]:768,[Jf]:770,[fd]:776,[ld]:774,[od]:772,[sd]:769,[Kf]:771,[cd]:775,[ad]:773};function rt(k,mt,at,_t,bt,wt,st,Dt){if(k===Oi){g===!0&&(N(3042),g=!1);return}if(g===!1&&(_(3042),g=!0),k!==$u){if(k!==v||Dt!==Z){if((M!==Er||B!==Er)&&(i.blendEquation(32774),M=Er,B=Er),Dt)switch(k){case Dr:i.blendFuncSeparate(1,771,1,771);break;case zl:i.blendFunc(1,1);break;case Gl:i.blendFuncSeparate(0,769,0,1);break;case Vl:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}else switch(k){case Dr:i.blendFuncSeparate(770,771,1,771);break;case zl:i.blendFunc(770,1);break;case Gl:i.blendFuncSeparate(0,769,0,1);break;case Vl:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}D=null,z=null,O=null,G=null,v=k,Z=Dt}return}bt=bt||mt,wt=wt||at,st=st||_t,(mt!==M||bt!==B)&&(i.blendEquationSeparate(et[mt],et[bt]),M=mt,B=bt),(at!==D||_t!==z||wt!==O||st!==G)&&(i.blendFuncSeparate(lt[at],lt[_t],lt[wt],lt[st]),D=at,z=_t,O=wt,G=st),v=k,Z=null}function At(k,mt){k.side===Ur?N(2884):_(2884);let at=k.side===Pn;mt&&(at=!at),gt(at),k.blending===Dr&&k.transparent===!1?rt(Oi):rt(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.premultipliedAlpha),l.setFunc(k.depthFunc),l.setTest(k.depthTest),l.setMask(k.depthWrite),a.setMask(k.colorWrite);const _t=k.stencilWrite;c.setTest(_t),_t&&(c.setMask(k.stencilWriteMask),c.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),c.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),qt(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?_(32926):N(32926)}function gt(k){L!==k&&(k?i.frontFace(2304):i.frontFace(2305),L=k)}function Ct(k){k!==Yu?(_(2884),k!==U&&(k===Ul?i.cullFace(1029):k===Ju?i.cullFace(1028):i.cullFace(1032))):N(2884),U=k}function ve(k){k!==$&&(f&&i.lineWidth(k),$=k)}function qt(k,mt,at){k?(_(32823),(j!==mt||ht!==at)&&(i.polygonOffset(mt,at),j=mt,ht=at)):N(32823)}function Ot(k){k?_(3089):N(3089)}function Yt(k){k===void 0&&(k=33984+R-1),w!==k&&(i.activeTexture(k),w=k)}function Jt(k,mt){w===null&&Yt();let at=S[w];at===void 0&&(at={type:void 0,texture:void 0},S[w]=at),(at.type!==k||at.texture!==mt)&&(i.bindTexture(k,mt||it[k]),at.type=k,at.texture=mt)}function Kt(){const k=S[w];k!==void 0&&k.type!==void 0&&(i.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)}function F(){try{i.compressedTexImage2D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function T(){try{i.texSubImage2D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function K(){try{i.texSubImage3D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ct(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ot(){try{i.texStorage2D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ft(){try{i.texStorage3D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Ft(){try{i.texImage2D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function X(){try{i.texImage3D.apply(i,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function vt(k){A.equals(k)===!1&&(i.scissor(k.x,k.y,k.z,k.w),A.copy(k))}function Mt(k){d.equals(k)===!1&&(i.viewport(k.x,k.y,k.z,k.w),d.copy(k))}function ut(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),h={},w=null,S={},u={},p=new WeakMap,x=[],b=null,g=!1,v=null,M=null,D=null,z=null,B=null,O=null,G=null,Z=!1,L=null,U=null,$=null,j=null,ht=null,A.set(0,0,i.canvas.width,i.canvas.height),d.set(0,0,i.canvas.width,i.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:_,disable:N,bindFramebuffer:Q,drawBuffers:Y,useProgram:tt,setBlending:rt,setMaterial:At,setFlipSided:gt,setCullFace:Ct,setLineWidth:ve,setPolygonOffset:qt,setScissorTest:Ot,activeTexture:Yt,bindTexture:Jt,unbindTexture:Kt,compressedTexImage2D:F,texImage2D:Ft,texImage3D:X,texStorage2D:ot,texStorage3D:ft,texSubImage2D:T,texSubImage3D:K,compressedTexSubImage2D:ct,scissor:vt,viewport:Mt,reset:ut}}function Iv(i,t,e,n,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,h=r.maxTextureSize,u=r.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,x=/OculusBrowser/g.test(navigator.userAgent),b=new WeakMap;let g;const v=new WeakMap;let M=!1;try{M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function D(F,T){return M?new OffscreenCanvas(F,T):As("canvas")}function z(F,T,K,ct){let ot=1;if((F.width>ct||F.height>ct)&&(ot=ct/Math.max(F.width,F.height)),ot<1||T===!0)if(typeof HTMLImageElement<"u"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&F instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&F instanceof ImageBitmap){const ft=T?$a:Math.floor,Ft=ft(ot*F.width),X=ft(ot*F.height);g===void 0&&(g=D(Ft,X));const vt=K?D(Ft,X):g;return vt.width=Ft,vt.height=X,vt.getContext("2d").drawImage(F,0,0,Ft,X),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+Ft+"x"+X+")."),vt}else return"data"in F&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F;return F}function B(F){return vc(F.width)&&vc(F.height)}function O(F){return a?!1:F.wrapS!==Tn||F.wrapT!==Tn||F.minFilter!==Ye&&F.minFilter!==un}function G(F,T){return F.generateMipmaps&&T&&F.minFilter!==Ye&&F.minFilter!==un}function Z(F){i.generateMipmap(F)}function L(F,T,K,ct,ot=!1){if(a===!1)return T;if(F!==null){if(i[F]!==void 0)return i[F];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}let ft=T;return T===6403&&(K===5126&&(ft=33326),K===5131&&(ft=33325),K===5121&&(ft=33321)),T===33319&&(K===5126&&(ft=33328),K===5131&&(ft=33327),K===5121&&(ft=33323)),T===6408&&(K===5126&&(ft=34836),K===5131&&(ft=34842),K===5121&&(ft=ct===pe&&ot===!1?35907:32856),K===32819&&(ft=32854),K===32820&&(ft=32855)),(ft===33325||ft===33326||ft===33327||ft===33328||ft===34842||ft===34836)&&t.get("EXT_color_buffer_float"),ft}function U(F,T,K){return G(F,K)===!0||F.isFramebufferTexture&&F.minFilter!==Ye&&F.minFilter!==un?Math.log2(Math.max(T.width,T.height))+1:F.mipmaps!==void 0&&F.mipmaps.length>0?F.mipmaps.length:F.isCompressedTexture&&Array.isArray(F.image)?T.mipmaps.length:1}function $(F){return F===Ye||F===ql||F===jl?9728:9729}function j(F){const T=F.target;T.removeEventListener("dispose",j),R(T),T.isVideoTexture&&b.delete(T)}function ht(F){const T=F.target;T.removeEventListener("dispose",ht),m(T)}function R(F){const T=n.get(F);if(T.__webglInit===void 0)return;const K=F.source,ct=v.get(K);if(ct){const ot=ct[T.__cacheKey];ot.usedTimes--,ot.usedTimes===0&&f(F),Object.keys(ct).length===0&&v.delete(K)}n.remove(F)}function f(F){const T=n.get(F);i.deleteTexture(T.__webglTexture);const K=F.source,ct=v.get(K);delete ct[T.__cacheKey],o.memory.textures--}function m(F){const T=F.texture,K=n.get(F),ct=n.get(T);if(ct.__webglTexture!==void 0&&(i.deleteTexture(ct.__webglTexture),o.memory.textures--),F.depthTexture&&F.depthTexture.dispose(),F.isWebGLCubeRenderTarget)for(let ot=0;ot<6;ot++)i.deleteFramebuffer(K.__webglFramebuffer[ot]),K.__webglDepthbuffer&&i.deleteRenderbuffer(K.__webglDepthbuffer[ot]);else{if(i.deleteFramebuffer(K.__webglFramebuffer),K.__webglDepthbuffer&&i.deleteRenderbuffer(K.__webglDepthbuffer),K.__webglMultisampledFramebuffer&&i.deleteFramebuffer(K.__webglMultisampledFramebuffer),K.__webglColorRenderbuffer)for(let ot=0;ot<K.__webglColorRenderbuffer.length;ot++)K.__webglColorRenderbuffer[ot]&&i.deleteRenderbuffer(K.__webglColorRenderbuffer[ot]);K.__webglDepthRenderbuffer&&i.deleteRenderbuffer(K.__webglDepthRenderbuffer)}if(F.isWebGLMultipleRenderTargets)for(let ot=0,ft=T.length;ot<ft;ot++){const Ft=n.get(T[ot]);Ft.__webglTexture&&(i.deleteTexture(Ft.__webglTexture),o.memory.textures--),n.remove(T[ot])}n.remove(T),n.remove(F)}let y=0;function w(){y=0}function S(){const F=y;return F>=l&&console.warn("THREE.WebGLTextures: Trying to use "+F+" texture units while this GPU supports only "+l),y+=1,F}function C(F){const T=[];return T.push(F.wrapS),T.push(F.wrapT),T.push(F.magFilter),T.push(F.minFilter),T.push(F.anisotropy),T.push(F.internalFormat),T.push(F.format),T.push(F.type),T.push(F.generateMipmaps),T.push(F.premultiplyAlpha),T.push(F.flipY),T.push(F.unpackAlignment),T.push(F.encoding),T.join()}function I(F,T){const K=n.get(F);if(F.isVideoTexture&&Jt(F),F.isRenderTargetTexture===!1&&F.version>0&&K.__version!==F.version){const ct=F.image;if(ct===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ct.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Y(K,F,T);return}}e.activeTexture(33984+T),e.bindTexture(3553,K.__webglTexture)}function A(F,T){const K=n.get(F);if(F.version>0&&K.__version!==F.version){Y(K,F,T);return}e.activeTexture(33984+T),e.bindTexture(35866,K.__webglTexture)}function d(F,T){const K=n.get(F);if(F.version>0&&K.__version!==F.version){Y(K,F,T);return}e.activeTexture(33984+T),e.bindTexture(32879,K.__webglTexture)}function E(F,T){const K=n.get(F);if(F.version>0&&K.__version!==F.version){tt(K,F,T);return}e.activeTexture(33984+T),e.bindTexture(34067,K.__webglTexture)}const it={[Ja]:10497,[Tn]:33071,[Ka]:33648},_={[Ye]:9728,[ql]:9984,[jl]:9986,[un]:9729,[Ad]:9985,[zo]:9987};function N(F,T,K){if(K?(i.texParameteri(F,10242,it[T.wrapS]),i.texParameteri(F,10243,it[T.wrapT]),(F===32879||F===35866)&&i.texParameteri(F,32882,it[T.wrapR]),i.texParameteri(F,10240,_[T.magFilter]),i.texParameteri(F,10241,_[T.minFilter])):(i.texParameteri(F,10242,33071),i.texParameteri(F,10243,33071),(F===32879||F===35866)&&i.texParameteri(F,32882,33071),(T.wrapS!==Tn||T.wrapT!==Tn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(F,10240,$(T.magFilter)),i.texParameteri(F,10241,$(T.minFilter)),T.minFilter!==Ye&&T.minFilter!==un&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),t.has("EXT_texture_filter_anisotropic")===!0){const ct=t.get("EXT_texture_filter_anisotropic");if(T.type===Ki&&t.has("OES_texture_float_linear")===!1||a===!1&&T.type===Ss&&t.has("OES_texture_half_float_linear")===!1)return;(T.anisotropy>1||n.get(T).__currentAnisotropy)&&(i.texParameterf(F,ct.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T.anisotropy,r.getMaxAnisotropy())),n.get(T).__currentAnisotropy=T.anisotropy)}}function Q(F,T){let K=!1;F.__webglInit===void 0&&(F.__webglInit=!0,T.addEventListener("dispose",j));const ct=T.source;let ot=v.get(ct);ot===void 0&&(ot={},v.set(ct,ot));const ft=C(T);if(ft!==F.__cacheKey){ot[ft]===void 0&&(ot[ft]={texture:i.createTexture(),usedTimes:0},o.memory.textures++,K=!0),ot[ft].usedTimes++;const Ft=ot[F.__cacheKey];Ft!==void 0&&(ot[F.__cacheKey].usedTimes--,Ft.usedTimes===0&&f(T)),F.__cacheKey=ft,F.__webglTexture=ot[ft].texture}return K}function Y(F,T,K){let ct=3553;T.isDataArrayTexture&&(ct=35866),T.isData3DTexture&&(ct=32879);const ot=Q(F,T),ft=T.source;if(e.activeTexture(33984+K),e.bindTexture(ct,F.__webglTexture),ft.version!==ft.__currentVersion||ot===!0){i.pixelStorei(37440,T.flipY),i.pixelStorei(37441,T.premultiplyAlpha),i.pixelStorei(3317,T.unpackAlignment),i.pixelStorei(37443,0);const Ft=O(T)&&B(T.image)===!1;let X=z(T.image,Ft,!1,h);X=Kt(T,X);const vt=B(X)||a,Mt=s.convert(T.format,T.encoding);let ut=s.convert(T.type),k=L(T.internalFormat,Mt,ut,T.encoding,T.isVideoTexture);N(ct,T,vt);let mt;const at=T.mipmaps,_t=a&&T.isVideoTexture!==!0,bt=ft.__currentVersion===void 0||ot===!0,wt=U(T,X,vt);if(T.isDepthTexture)k=6402,a?T.type===Ki?k=36012:T.type===Ji?k=33190:T.type===Nr?k=35056:k=33189:T.type===Ki&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),T.format===$i&&k===6402&&T.type!==$f&&T.type!==Ji&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),T.type=Ji,ut=s.convert(T.type)),T.format===Vr&&k===6402&&(k=34041,T.type!==Nr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),T.type=Nr,ut=s.convert(T.type))),bt&&(_t?e.texStorage2D(3553,1,k,X.width,X.height):e.texImage2D(3553,0,k,X.width,X.height,0,Mt,ut,null));else if(T.isDataTexture)if(at.length>0&&vt){_t&&bt&&e.texStorage2D(3553,wt,k,at[0].width,at[0].height);for(let st=0,Dt=at.length;st<Dt;st++)mt=at[st],_t?e.texSubImage2D(3553,st,0,0,mt.width,mt.height,Mt,ut,mt.data):e.texImage2D(3553,st,k,mt.width,mt.height,0,Mt,ut,mt.data);T.generateMipmaps=!1}else _t?(bt&&e.texStorage2D(3553,wt,k,X.width,X.height),e.texSubImage2D(3553,0,0,0,X.width,X.height,Mt,ut,X.data)):e.texImage2D(3553,0,k,X.width,X.height,0,Mt,ut,X.data);else if(T.isCompressedTexture){_t&&bt&&e.texStorage2D(3553,wt,k,at[0].width,at[0].height);for(let st=0,Dt=at.length;st<Dt;st++)mt=at[st],T.format!==Cn?Mt!==null?_t?e.compressedTexSubImage2D(3553,st,0,0,mt.width,mt.height,Mt,mt.data):e.compressedTexImage2D(3553,st,k,mt.width,mt.height,0,mt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_t?e.texSubImage2D(3553,st,0,0,mt.width,mt.height,Mt,ut,mt.data):e.texImage2D(3553,st,k,mt.width,mt.height,0,Mt,ut,mt.data)}else if(T.isDataArrayTexture)_t?(bt&&e.texStorage3D(35866,wt,k,X.width,X.height,X.depth),e.texSubImage3D(35866,0,0,0,0,X.width,X.height,X.depth,Mt,ut,X.data)):e.texImage3D(35866,0,k,X.width,X.height,X.depth,0,Mt,ut,X.data);else if(T.isData3DTexture)_t?(bt&&e.texStorage3D(32879,wt,k,X.width,X.height,X.depth),e.texSubImage3D(32879,0,0,0,0,X.width,X.height,X.depth,Mt,ut,X.data)):e.texImage3D(32879,0,k,X.width,X.height,X.depth,0,Mt,ut,X.data);else if(T.isFramebufferTexture){if(bt)if(_t)e.texStorage2D(3553,wt,k,X.width,X.height);else{let st=X.width,Dt=X.height;for(let Pt=0;Pt<wt;Pt++)e.texImage2D(3553,Pt,k,st,Dt,0,Mt,ut,null),st>>=1,Dt>>=1}}else if(at.length>0&&vt){_t&&bt&&e.texStorage2D(3553,wt,k,at[0].width,at[0].height);for(let st=0,Dt=at.length;st<Dt;st++)mt=at[st],_t?e.texSubImage2D(3553,st,0,0,Mt,ut,mt):e.texImage2D(3553,st,k,Mt,ut,mt);T.generateMipmaps=!1}else _t?(bt&&e.texStorage2D(3553,wt,k,X.width,X.height),e.texSubImage2D(3553,0,0,0,Mt,ut,X)):e.texImage2D(3553,0,k,Mt,ut,X);G(T,vt)&&Z(ct),ft.__currentVersion=ft.version,T.onUpdate&&T.onUpdate(T)}F.__version=T.version}function tt(F,T,K){if(T.image.length!==6)return;const ct=Q(F,T),ot=T.source;if(e.activeTexture(33984+K),e.bindTexture(34067,F.__webglTexture),ot.version!==ot.__currentVersion||ct===!0){i.pixelStorei(37440,T.flipY),i.pixelStorei(37441,T.premultiplyAlpha),i.pixelStorei(3317,T.unpackAlignment),i.pixelStorei(37443,0);const ft=T.isCompressedTexture||T.image[0].isCompressedTexture,Ft=T.image[0]&&T.image[0].isDataTexture,X=[];for(let st=0;st<6;st++)!ft&&!Ft?X[st]=z(T.image[st],!1,!0,c):X[st]=Ft?T.image[st].image:T.image[st],X[st]=Kt(T,X[st]);const vt=X[0],Mt=B(vt)||a,ut=s.convert(T.format,T.encoding),k=s.convert(T.type),mt=L(T.internalFormat,ut,k,T.encoding),at=a&&T.isVideoTexture!==!0,_t=ot.__currentVersion===void 0||ct===!0;let bt=U(T,vt,Mt);N(34067,T,Mt);let wt;if(ft){at&&_t&&e.texStorage2D(34067,bt,mt,vt.width,vt.height);for(let st=0;st<6;st++){wt=X[st].mipmaps;for(let Dt=0;Dt<wt.length;Dt++){const Pt=wt[Dt];T.format!==Cn?ut!==null?at?e.compressedTexSubImage2D(34069+st,Dt,0,0,Pt.width,Pt.height,ut,Pt.data):e.compressedTexImage2D(34069+st,Dt,mt,Pt.width,Pt.height,0,Pt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):at?e.texSubImage2D(34069+st,Dt,0,0,Pt.width,Pt.height,ut,k,Pt.data):e.texImage2D(34069+st,Dt,mt,Pt.width,Pt.height,0,ut,k,Pt.data)}}}else{wt=T.mipmaps,at&&_t&&(wt.length>0&&bt++,e.texStorage2D(34067,bt,mt,X[0].width,X[0].height));for(let st=0;st<6;st++)if(Ft){at?e.texSubImage2D(34069+st,0,0,0,X[st].width,X[st].height,ut,k,X[st].data):e.texImage2D(34069+st,0,mt,X[st].width,X[st].height,0,ut,k,X[st].data);for(let Dt=0;Dt<wt.length;Dt++){const It=wt[Dt].image[st].image;at?e.texSubImage2D(34069+st,Dt+1,0,0,It.width,It.height,ut,k,It.data):e.texImage2D(34069+st,Dt+1,mt,It.width,It.height,0,ut,k,It.data)}}else{at?e.texSubImage2D(34069+st,0,0,0,ut,k,X[st]):e.texImage2D(34069+st,0,mt,ut,k,X[st]);for(let Dt=0;Dt<wt.length;Dt++){const Pt=wt[Dt];at?e.texSubImage2D(34069+st,Dt+1,0,0,ut,k,Pt.image[st]):e.texImage2D(34069+st,Dt+1,mt,ut,k,Pt.image[st])}}}G(T,Mt)&&Z(34067),ot.__currentVersion=ot.version,T.onUpdate&&T.onUpdate(T)}F.__version=T.version}function et(F,T,K,ct,ot){const ft=s.convert(K.format,K.encoding),Ft=s.convert(K.type),X=L(K.internalFormat,ft,Ft,K.encoding);n.get(T).__hasExternalTextures||(ot===32879||ot===35866?e.texImage3D(ot,0,X,T.width,T.height,T.depth,0,ft,Ft,null):e.texImage2D(ot,0,X,T.width,T.height,0,ft,Ft,null)),e.bindFramebuffer(36160,F),Yt(T)?p.framebufferTexture2DMultisampleEXT(36160,ct,ot,n.get(K).__webglTexture,0,Ot(T)):i.framebufferTexture2D(36160,ct,ot,n.get(K).__webglTexture,0),e.bindFramebuffer(36160,null)}function lt(F,T,K){if(i.bindRenderbuffer(36161,F),T.depthBuffer&&!T.stencilBuffer){let ct=33189;if(K||Yt(T)){const ot=T.depthTexture;ot&&ot.isDepthTexture&&(ot.type===Ki?ct=36012:ot.type===Ji&&(ct=33190));const ft=Ot(T);Yt(T)?p.renderbufferStorageMultisampleEXT(36161,ft,ct,T.width,T.height):i.renderbufferStorageMultisample(36161,ft,ct,T.width,T.height)}else i.renderbufferStorage(36161,ct,T.width,T.height);i.framebufferRenderbuffer(36160,36096,36161,F)}else if(T.depthBuffer&&T.stencilBuffer){const ct=Ot(T);K&&Yt(T)===!1?i.renderbufferStorageMultisample(36161,ct,35056,T.width,T.height):Yt(T)?p.renderbufferStorageMultisampleEXT(36161,ct,35056,T.width,T.height):i.renderbufferStorage(36161,34041,T.width,T.height),i.framebufferRenderbuffer(36160,33306,36161,F)}else{const ct=T.isWebGLMultipleRenderTargets===!0?T.texture:[T.texture];for(let ot=0;ot<ct.length;ot++){const ft=ct[ot],Ft=s.convert(ft.format,ft.encoding),X=s.convert(ft.type),vt=L(ft.internalFormat,Ft,X,ft.encoding),Mt=Ot(T);K&&Yt(T)===!1?i.renderbufferStorageMultisample(36161,Mt,vt,T.width,T.height):Yt(T)?p.renderbufferStorageMultisampleEXT(36161,Mt,vt,T.width,T.height):i.renderbufferStorage(36161,vt,T.width,T.height)}}i.bindRenderbuffer(36161,null)}function rt(F,T){if(T&&T.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,F),!(T.depthTexture&&T.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(T.depthTexture).__webglTexture||T.depthTexture.image.width!==T.width||T.depthTexture.image.height!==T.height)&&(T.depthTexture.image.width=T.width,T.depthTexture.image.height=T.height,T.depthTexture.needsUpdate=!0),I(T.depthTexture,0);const ct=n.get(T.depthTexture).__webglTexture,ot=Ot(T);if(T.depthTexture.format===$i)Yt(T)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,ct,0,ot):i.framebufferTexture2D(36160,36096,3553,ct,0);else if(T.depthTexture.format===Vr)Yt(T)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,ct,0,ot):i.framebufferTexture2D(36160,33306,3553,ct,0);else throw new Error("Unknown depthTexture format")}function At(F){const T=n.get(F),K=F.isWebGLCubeRenderTarget===!0;if(F.depthTexture&&!T.__autoAllocateDepthBuffer){if(K)throw new Error("target.depthTexture not supported in Cube render targets");rt(T.__webglFramebuffer,F)}else if(K){T.__webglDepthbuffer=[];for(let ct=0;ct<6;ct++)e.bindFramebuffer(36160,T.__webglFramebuffer[ct]),T.__webglDepthbuffer[ct]=i.createRenderbuffer(),lt(T.__webglDepthbuffer[ct],F,!1)}else e.bindFramebuffer(36160,T.__webglFramebuffer),T.__webglDepthbuffer=i.createRenderbuffer(),lt(T.__webglDepthbuffer,F,!1);e.bindFramebuffer(36160,null)}function gt(F,T,K){const ct=n.get(F);T!==void 0&&et(ct.__webglFramebuffer,F,F.texture,36064,3553),K!==void 0&&At(F)}function Ct(F){const T=F.texture,K=n.get(F),ct=n.get(T);F.addEventListener("dispose",ht),F.isWebGLMultipleRenderTargets!==!0&&(ct.__webglTexture===void 0&&(ct.__webglTexture=i.createTexture()),ct.__version=T.version,o.memory.textures++);const ot=F.isWebGLCubeRenderTarget===!0,ft=F.isWebGLMultipleRenderTargets===!0,Ft=B(F)||a;if(ot){K.__webglFramebuffer=[];for(let X=0;X<6;X++)K.__webglFramebuffer[X]=i.createFramebuffer()}else{if(K.__webglFramebuffer=i.createFramebuffer(),ft)if(r.drawBuffers){const X=F.texture;for(let vt=0,Mt=X.length;vt<Mt;vt++){const ut=n.get(X[vt]);ut.__webglTexture===void 0&&(ut.__webglTexture=i.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&F.samples>0&&Yt(F)===!1){const X=ft?T:[T];K.__webglMultisampledFramebuffer=i.createFramebuffer(),K.__webglColorRenderbuffer=[],e.bindFramebuffer(36160,K.__webglMultisampledFramebuffer);for(let vt=0;vt<X.length;vt++){const Mt=X[vt];K.__webglColorRenderbuffer[vt]=i.createRenderbuffer(),i.bindRenderbuffer(36161,K.__webglColorRenderbuffer[vt]);const ut=s.convert(Mt.format,Mt.encoding),k=s.convert(Mt.type),mt=L(Mt.internalFormat,ut,k,Mt.encoding),at=Ot(F);i.renderbufferStorageMultisample(36161,at,mt,F.width,F.height),i.framebufferRenderbuffer(36160,36064+vt,36161,K.__webglColorRenderbuffer[vt])}i.bindRenderbuffer(36161,null),F.depthBuffer&&(K.__webglDepthRenderbuffer=i.createRenderbuffer(),lt(K.__webglDepthRenderbuffer,F,!0)),e.bindFramebuffer(36160,null)}}if(ot){e.bindTexture(34067,ct.__webglTexture),N(34067,T,Ft);for(let X=0;X<6;X++)et(K.__webglFramebuffer[X],F,T,36064,34069+X);G(T,Ft)&&Z(34067),e.unbindTexture()}else if(ft){const X=F.texture;for(let vt=0,Mt=X.length;vt<Mt;vt++){const ut=X[vt],k=n.get(ut);e.bindTexture(3553,k.__webglTexture),N(3553,ut,Ft),et(K.__webglFramebuffer,F,ut,36064+vt,3553),G(ut,Ft)&&Z(3553)}e.unbindTexture()}else{let X=3553;(F.isWebGL3DRenderTarget||F.isWebGLArrayRenderTarget)&&(a?X=F.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(X,ct.__webglTexture),N(X,T,Ft),et(K.__webglFramebuffer,F,T,36064,X),G(T,Ft)&&Z(X),e.unbindTexture()}F.depthBuffer&&At(F)}function ve(F){const T=B(F)||a,K=F.isWebGLMultipleRenderTargets===!0?F.texture:[F.texture];for(let ct=0,ot=K.length;ct<ot;ct++){const ft=K[ct];if(G(ft,T)){const Ft=F.isWebGLCubeRenderTarget?34067:3553,X=n.get(ft).__webglTexture;e.bindTexture(Ft,X),Z(Ft),e.unbindTexture()}}}function qt(F){if(a&&F.samples>0&&Yt(F)===!1){const T=F.isWebGLMultipleRenderTargets?F.texture:[F.texture],K=F.width,ct=F.height;let ot=16384;const ft=[],Ft=F.stencilBuffer?33306:36096,X=n.get(F),vt=F.isWebGLMultipleRenderTargets===!0;if(vt)for(let Mt=0;Mt<T.length;Mt++)e.bindFramebuffer(36160,X.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Mt,36161,null),e.bindFramebuffer(36160,X.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Mt,3553,null,0);e.bindFramebuffer(36008,X.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,X.__webglFramebuffer);for(let Mt=0;Mt<T.length;Mt++){ft.push(36064+Mt),F.depthBuffer&&ft.push(Ft);const ut=X.__ignoreDepthValues!==void 0?X.__ignoreDepthValues:!1;if(ut===!1&&(F.depthBuffer&&(ot|=256),F.stencilBuffer&&(ot|=1024)),vt&&i.framebufferRenderbuffer(36008,36064,36161,X.__webglColorRenderbuffer[Mt]),ut===!0&&(i.invalidateFramebuffer(36008,[Ft]),i.invalidateFramebuffer(36009,[Ft])),vt){const k=n.get(T[Mt]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,k,0)}i.blitFramebuffer(0,0,K,ct,0,0,K,ct,ot,9728),x&&i.invalidateFramebuffer(36008,ft)}if(e.bindFramebuffer(36008,null),e.bindFramebuffer(36009,null),vt)for(let Mt=0;Mt<T.length;Mt++){e.bindFramebuffer(36160,X.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+Mt,36161,X.__webglColorRenderbuffer[Mt]);const ut=n.get(T[Mt]).__webglTexture;e.bindFramebuffer(36160,X.__webglFramebuffer),i.framebufferTexture2D(36009,36064+Mt,3553,ut,0)}e.bindFramebuffer(36009,X.__webglMultisampledFramebuffer)}}function Ot(F){return Math.min(u,F.samples)}function Yt(F){const T=n.get(F);return a&&F.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&T.__useRenderToTexture!==!1}function Jt(F){const T=o.render.frame;b.get(F)!==T&&(b.set(F,T),F.update())}function Kt(F,T){const K=F.encoding,ct=F.format,ot=F.type;return F.isCompressedTexture===!0||F.isVideoTexture===!0||F.format===Qa||K!==ir&&(K===pe?a===!1?t.has("EXT_sRGB")===!0&&ct===Cn?(F.format=Qa,F.minFilter=un,F.generateMipmaps=!1):T=nh.sRGBToLinear(T):(ct!==Cn||ot!==nr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",K)),T}this.allocateTextureUnit=S,this.resetTextureUnits=w,this.setTexture2D=I,this.setTexture2DArray=A,this.setTexture3D=d,this.setTextureCube=E,this.rebindTextures=gt,this.setupRenderTarget=Ct,this.updateRenderTargetMipmap=ve,this.updateMultisampleRenderTarget=qt,this.setupDepthRenderbuffer=At,this.setupFrameBufferTexture=et,this.useMultisampledRTT=Yt}function Lv(i,t,e){const n=e.isWebGL2;function r(s,o){let a;if(s===nr)return 5121;if(s===Rd)return 32819;if(s===Pd)return 32820;if(s===Ed)return 5120;if(s===Td)return 5122;if(s===$f)return 5123;if(s===Cd)return 5124;if(s===Ji)return 5125;if(s===Ki)return 5126;if(s===Ss)return n?5131:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===Id)return 6406;if(s===Cn)return 6408;if(s===Dd)return 6409;if(s===Nd)return 6410;if(s===$i)return 6402;if(s===Vr)return 34041;if(s===Fd)return 6403;if(s===Ld)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(s===Qa)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===Bd)return 36244;if(s===kd)return 33319;if(s===Od)return 33320;if(s===Ud)return 36249;if(s===Qo||s===$o||s===ta||s===ea)if(o===pe)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===Qo)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===$o)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===ta)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===ea)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===Qo)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===$o)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===ta)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===ea)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===Xl||s===Zl||s===Yl||s===Jl)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===Xl)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===Zl)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===Yl)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===Jl)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===zd)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===Kl||s===Ql)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(s===Kl)return o===pe?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===Ql)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===$l||s===tc||s===ec||s===nc||s===ic||s===rc||s===sc||s===oc||s===ac||s===lc||s===cc||s===fc||s===hc||s===uc)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(s===$l)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===tc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===ec)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===nc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===ic)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===rc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===sc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===oc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===ac)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===lc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===cc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===fc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===hc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===uc)return o===pe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===dc)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(s===dc)return o===pe?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return s===Nr?n?34042:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):i[s]!==void 0?i[s]:null}return{convert:r}}class Dv extends dn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class ms extends In{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Nv={type:"move"};class Pa{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ms,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ms,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new J,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new J),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ms,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new J,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new J),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(t&&e.session.visibilityState!=="visible-blurred")if(a!==null&&(r=e.getPose(t.targetRaySpace,n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Nv))),c&&t.hand){o=!0;for(const g of t.hand.values()){const v=e.getJointPose(g,n);if(c.joints[g.jointName]===void 0){const D=new ms;D.matrixAutoUpdate=!1,D.visible=!1,c.joints[g.jointName]=D,c.add(D)}const M=c.joints[g.jointName];v!==null&&(M.matrix.fromArray(v.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.jointRadius=v.radius),M.visible=v!==null}const h=c.joints["index-finger-tip"],u=c.joints["thumb-tip"],p=h.position.distanceTo(u.position),x=.02,b=.005;c.inputState.pinching&&p>x+b?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&p<=x-b&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}}class Fv extends pn{constructor(t,e,n,r,s,o,a,l,c,h){if(h=h!==void 0?h:$i,h!==$i&&h!==Vr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===$i&&(n=Ji),n===void 0&&h===Vr&&(n=Nr),super(null,r,s,o,a,l,h,n,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Ye,this.minFilter=l!==void 0?l:Ye,this.flipY=!1,this.generateMipmaps=!1}}class Bv extends Jr{constructor(t,e){super();const n=this;let r=null,s=1,o=null,a="local-floor",l=null,c=null,h=null,u=null,p=null,x=null;const b=e.getContextAttributes();let g=null,v=null;const M=[],D=new Map,z=new dn;z.layers.enable(1),z.viewport=new Oe;const B=new dn;B.layers.enable(2),B.viewport=new Oe;const O=[z,B],G=new Dv;G.layers.enable(1),G.layers.enable(2);let Z=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(C){let I=M[C];return I===void 0&&(I=new Pa,M[C]=I),I.getTargetRaySpace()},this.getControllerGrip=function(C){let I=M[C];return I===void 0&&(I=new Pa,M[C]=I),I.getGripSpace()},this.getHand=function(C){let I=M[C];return I===void 0&&(I=new Pa,M[C]=I),I.getHandSpace()};function U(C){const I=D.get(C.inputSource);I!==void 0&&I.dispatchEvent({type:C.type,data:C.inputSource})}function $(){r.removeEventListener("select",U),r.removeEventListener("selectstart",U),r.removeEventListener("selectend",U),r.removeEventListener("squeeze",U),r.removeEventListener("squeezestart",U),r.removeEventListener("squeezeend",U),r.removeEventListener("end",$),r.removeEventListener("inputsourceschange",j),D.forEach(function(C,I){C!==void 0&&C.disconnect(I)}),D.clear(),Z=null,L=null,t.setRenderTarget(g),p=null,u=null,h=null,r=null,v=null,S.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(C){s=C,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(C){a=C,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(C){l=C},this.getBaseLayer=function(){return u!==null?u:p},this.getBinding=function(){return h},this.getFrame=function(){return x},this.getSession=function(){return r},this.setSession=async function(C){if(r=C,r!==null){if(g=t.getRenderTarget(),r.addEventListener("select",U),r.addEventListener("selectstart",U),r.addEventListener("selectend",U),r.addEventListener("squeeze",U),r.addEventListener("squeezestart",U),r.addEventListener("squeezeend",U),r.addEventListener("end",$),r.addEventListener("inputsourceschange",j),b.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const I={antialias:r.renderState.layers===void 0?b.antialias:!0,alpha:b.alpha,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(r,e,I),r.updateRenderState({baseLayer:p}),v=new Ui(p.framebufferWidth,p.framebufferHeight,{format:Cn,type:nr,encoding:t.outputEncoding})}else{let I=null,A=null,d=null;b.depth&&(d=b.stencil?35056:33190,I=b.stencil?Vr:$i,A=b.stencil?Nr:Ji);const E={colorFormat:t.outputEncoding===pe?35907:32856,depthFormat:d,scaleFactor:s};h=new XRWebGLBinding(r,e),u=h.createProjectionLayer(E),r.updateRenderState({layers:[u]}),v=new Ui(u.textureWidth,u.textureHeight,{format:Cn,type:nr,depthTexture:new Fv(u.textureWidth,u.textureHeight,A,void 0,void 0,void 0,void 0,void 0,void 0,I),stencilBuffer:b.stencil,encoding:t.outputEncoding,samples:b.antialias?4:0});const it=t.properties.get(v);it.__ignoreDepthValues=u.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=await r.requestReferenceSpace(a),S.setContext(r),S.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function j(C){const I=r.inputSources;for(let A=0;A<I.length;A++){const d=I[A].handedness==="right"?1:0;D.set(I[A],M[d])}for(let A=0;A<C.removed.length;A++){const d=C.removed[A],E=D.get(d);E&&(E.dispatchEvent({type:"disconnected",data:d}),D.delete(d))}for(let A=0;A<C.added.length;A++){const d=C.added[A],E=D.get(d);E&&E.dispatchEvent({type:"connected",data:d})}}const ht=new J,R=new J;function f(C,I,A){ht.setFromMatrixPosition(I.matrixWorld),R.setFromMatrixPosition(A.matrixWorld);const d=ht.distanceTo(R),E=I.projectionMatrix.elements,it=A.projectionMatrix.elements,_=E[14]/(E[10]-1),N=E[14]/(E[10]+1),Q=(E[9]+1)/E[5],Y=(E[9]-1)/E[5],tt=(E[8]-1)/E[0],et=(it[8]+1)/it[0],lt=_*tt,rt=_*et,At=d/(-tt+et),gt=At*-tt;I.matrixWorld.decompose(C.position,C.quaternion,C.scale),C.translateX(gt),C.translateZ(At),C.matrixWorld.compose(C.position,C.quaternion,C.scale),C.matrixWorldInverse.copy(C.matrixWorld).invert();const Ct=_+At,ve=N+At,qt=lt-gt,Ot=rt+(d-gt),Yt=Q*N/ve*Ct,Jt=Y*N/ve*Ct;C.projectionMatrix.makePerspective(qt,Ot,Yt,Jt,Ct,ve)}function m(C,I){I===null?C.matrixWorld.copy(C.matrix):C.matrixWorld.multiplyMatrices(I.matrixWorld,C.matrix),C.matrixWorldInverse.copy(C.matrixWorld).invert()}this.updateCamera=function(C){if(r===null)return;G.near=B.near=z.near=C.near,G.far=B.far=z.far=C.far,(Z!==G.near||L!==G.far)&&(r.updateRenderState({depthNear:G.near,depthFar:G.far}),Z=G.near,L=G.far);const I=C.parent,A=G.cameras;m(G,I);for(let E=0;E<A.length;E++)m(A[E],I);G.matrixWorld.decompose(G.position,G.quaternion,G.scale),C.position.copy(G.position),C.quaternion.copy(G.quaternion),C.scale.copy(G.scale),C.matrix.copy(G.matrix),C.matrixWorld.copy(G.matrixWorld);const d=C.children;for(let E=0,it=d.length;E<it;E++)d[E].updateMatrixWorld(!0);A.length===2?f(G,z,B):G.projectionMatrix.copy(z.projectionMatrix)},this.getCamera=function(){return G},this.getFoveation=function(){if(u!==null)return u.fixedFoveation;if(p!==null)return p.fixedFoveation},this.setFoveation=function(C){u!==null&&(u.fixedFoveation=C),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=C)};let y=null;function w(C,I){if(c=I.getViewerPose(l||o),x=I,c!==null){const d=c.views;p!==null&&(t.setRenderTargetFramebuffer(v,p.framebuffer),t.setRenderTarget(v));let E=!1;d.length!==G.cameras.length&&(G.cameras.length=0,E=!0);for(let it=0;it<d.length;it++){const _=d[it];let N=null;if(p!==null)N=p.getViewport(_);else{const Y=h.getViewSubImage(u,_);N=Y.viewport,it===0&&(t.setRenderTargetTextures(v,Y.colorTexture,u.ignoreDepthValues?void 0:Y.depthStencilTexture),t.setRenderTarget(v))}let Q=O[it];Q===void 0&&(Q=new dn,Q.layers.enable(it),Q.viewport=new Oe,O[it]=Q),Q.matrix.fromArray(_.transform.matrix),Q.projectionMatrix.fromArray(_.projectionMatrix),Q.viewport.set(N.x,N.y,N.width,N.height),it===0&&G.matrix.copy(Q.matrix),E===!0&&G.cameras.push(Q)}}const A=r.inputSources;for(let d=0;d<M.length;d++){const E=A[d],it=D.get(E);it!==void 0&&it.update(E,I,l||o)}y&&y(C,I),x=null}const S=new hh;S.setAnimationLoop(w),this.setAnimationLoop=function(C){y=C},this.dispose=function(){}}}function kv(i,t){function e(g,v){g.fogColor.value.copy(v.color),v.isFog?(g.fogNear.value=v.near,g.fogFar.value=v.far):v.isFogExp2&&(g.fogDensity.value=v.density)}function n(g,v,M,D,z){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(g,v):v.isMeshToonMaterial?(r(g,v),h(g,v)):v.isMeshPhongMaterial?(r(g,v),c(g,v)):v.isMeshStandardMaterial?(r(g,v),u(g,v),v.isMeshPhysicalMaterial&&p(g,v,z)):v.isMeshMatcapMaterial?(r(g,v),x(g,v)):v.isMeshDepthMaterial?r(g,v):v.isMeshDistanceMaterial?(r(g,v),b(g,v)):v.isMeshNormalMaterial?r(g,v):v.isLineBasicMaterial?(s(g,v),v.isLineDashedMaterial&&o(g,v)):v.isPointsMaterial?a(g,v,M,D):v.isSpriteMaterial?l(g,v):v.isShadowMaterial?(g.color.value.copy(v.color),g.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(g,v){g.opacity.value=v.opacity,v.color&&g.diffuse.value.copy(v.color),v.emissive&&g.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(g.map.value=v.map),v.alphaMap&&(g.alphaMap.value=v.alphaMap),v.bumpMap&&(g.bumpMap.value=v.bumpMap,g.bumpScale.value=v.bumpScale,v.side===Pn&&(g.bumpScale.value*=-1)),v.displacementMap&&(g.displacementMap.value=v.displacementMap,g.displacementScale.value=v.displacementScale,g.displacementBias.value=v.displacementBias),v.emissiveMap&&(g.emissiveMap.value=v.emissiveMap),v.normalMap&&(g.normalMap.value=v.normalMap,g.normalScale.value.copy(v.normalScale),v.side===Pn&&g.normalScale.value.negate()),v.specularMap&&(g.specularMap.value=v.specularMap),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest);const M=t.get(v).envMap;if(M&&(g.envMap.value=M,g.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=v.reflectivity,g.ior.value=v.ior,g.refractionRatio.value=v.refractionRatio),v.lightMap){g.lightMap.value=v.lightMap;const B=i.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=v.lightMapIntensity*B}v.aoMap&&(g.aoMap.value=v.aoMap,g.aoMapIntensity.value=v.aoMapIntensity);let D;v.map?D=v.map:v.specularMap?D=v.specularMap:v.displacementMap?D=v.displacementMap:v.normalMap?D=v.normalMap:v.bumpMap?D=v.bumpMap:v.roughnessMap?D=v.roughnessMap:v.metalnessMap?D=v.metalnessMap:v.alphaMap?D=v.alphaMap:v.emissiveMap?D=v.emissiveMap:v.clearcoatMap?D=v.clearcoatMap:v.clearcoatNormalMap?D=v.clearcoatNormalMap:v.clearcoatRoughnessMap?D=v.clearcoatRoughnessMap:v.iridescenceMap?D=v.iridescenceMap:v.iridescenceThicknessMap?D=v.iridescenceThicknessMap:v.specularIntensityMap?D=v.specularIntensityMap:v.specularColorMap?D=v.specularColorMap:v.transmissionMap?D=v.transmissionMap:v.thicknessMap?D=v.thicknessMap:v.sheenColorMap?D=v.sheenColorMap:v.sheenRoughnessMap&&(D=v.sheenRoughnessMap),D!==void 0&&(D.isWebGLRenderTarget&&(D=D.texture),D.matrixAutoUpdate===!0&&D.updateMatrix(),g.uvTransform.value.copy(D.matrix));let z;v.aoMap?z=v.aoMap:v.lightMap&&(z=v.lightMap),z!==void 0&&(z.isWebGLRenderTarget&&(z=z.texture),z.matrixAutoUpdate===!0&&z.updateMatrix(),g.uv2Transform.value.copy(z.matrix))}function s(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity}function o(g,v){g.dashSize.value=v.dashSize,g.totalSize.value=v.dashSize+v.gapSize,g.scale.value=v.scale}function a(g,v,M,D){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.size.value=v.size*M,g.scale.value=D*.5,v.map&&(g.map.value=v.map),v.alphaMap&&(g.alphaMap.value=v.alphaMap),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest);let z;v.map?z=v.map:v.alphaMap&&(z=v.alphaMap),z!==void 0&&(z.matrixAutoUpdate===!0&&z.updateMatrix(),g.uvTransform.value.copy(z.matrix))}function l(g,v){g.diffuse.value.copy(v.color),g.opacity.value=v.opacity,g.rotation.value=v.rotation,v.map&&(g.map.value=v.map),v.alphaMap&&(g.alphaMap.value=v.alphaMap),v.alphaTest>0&&(g.alphaTest.value=v.alphaTest);let M;v.map?M=v.map:v.alphaMap&&(M=v.alphaMap),M!==void 0&&(M.matrixAutoUpdate===!0&&M.updateMatrix(),g.uvTransform.value.copy(M.matrix))}function c(g,v){g.specular.value.copy(v.specular),g.shininess.value=Math.max(v.shininess,1e-4)}function h(g,v){v.gradientMap&&(g.gradientMap.value=v.gradientMap)}function u(g,v){g.roughness.value=v.roughness,g.metalness.value=v.metalness,v.roughnessMap&&(g.roughnessMap.value=v.roughnessMap),v.metalnessMap&&(g.metalnessMap.value=v.metalnessMap),t.get(v).envMap&&(g.envMapIntensity.value=v.envMapIntensity)}function p(g,v,M){g.ior.value=v.ior,v.sheen>0&&(g.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),g.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(g.sheenColorMap.value=v.sheenColorMap),v.sheenRoughnessMap&&(g.sheenRoughnessMap.value=v.sheenRoughnessMap)),v.clearcoat>0&&(g.clearcoat.value=v.clearcoat,g.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(g.clearcoatMap.value=v.clearcoatMap),v.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap),v.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),g.clearcoatNormalMap.value=v.clearcoatNormalMap,v.side===Pn&&g.clearcoatNormalScale.value.negate())),v.iridescence>0&&(g.iridescence.value=v.iridescence,g.iridescenceIOR.value=v.iridescenceIOR,g.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(g.iridescenceMap.value=v.iridescenceMap),v.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=v.iridescenceThicknessMap)),v.transmission>0&&(g.transmission.value=v.transmission,g.transmissionSamplerMap.value=M.texture,g.transmissionSamplerSize.value.set(M.width,M.height),v.transmissionMap&&(g.transmissionMap.value=v.transmissionMap),g.thickness.value=v.thickness,v.thicknessMap&&(g.thicknessMap.value=v.thicknessMap),g.attenuationDistance.value=v.attenuationDistance,g.attenuationColor.value.copy(v.attenuationColor)),g.specularIntensity.value=v.specularIntensity,g.specularColor.value.copy(v.specularColor),v.specularIntensityMap&&(g.specularIntensityMap.value=v.specularIntensityMap),v.specularColorMap&&(g.specularColorMap.value=v.specularColorMap)}function x(g,v){v.matcap&&(g.matcap.value=v.matcap)}function b(g,v){g.referencePosition.value.copy(v.referencePosition),g.nearDistance.value=v.nearDistance,g.farDistance.value=v.farDistance}return{refreshFogUniforms:e,refreshMaterialUniforms:n}}function Ov(){const i=As("canvas");return i.style.display="block",i}function _h(i){this.isWebGLRenderer=!0;const t=i.canvas!==void 0?i.canvas:Ov(),e=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,r=i.stencil!==void 0?i.stencil:!0,s=i.antialias!==void 0?i.antialias:!1,o=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,a=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,l=i.powerPreference!==void 0?i.powerPreference:"default",c=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let h;e!==null?h=e.getContextAttributes().alpha:h=i.alpha!==void 0?i.alpha:!1;let u=null,p=null;const x=[],b=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ir,this.physicallyCorrectLights=!1,this.toneMapping=xi,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const g=this;let v=!1,M=0,D=0,z=null,B=-1,O=null;const G=new Oe,Z=new Oe;let L=null,U=t.width,$=t.height,j=1,ht=null,R=null;const f=new Oe(0,0,U,$),m=new Oe(0,0,U,$);let y=!1;const w=new fh;let S=!1,C=!1,I=null;const A=new Ue,d=new ne,E=new J,it={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function _(){return z===null?j:1}let N=e;function Q(P,W){for(let q=0;q<P.length;q++){const V=P[q],nt=t.getContext(V,W);if(nt!==null)return nt}return null}try{const P={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${vl}`),t.addEventListener("webglcontextlost",k,!1),t.addEventListener("webglcontextrestored",mt,!1),t.addEventListener("webglcontextcreationerror",at,!1),N===null){const W=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&W.shift(),N=Q(W,P),N===null)throw Q(W)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}N.getShaderPrecisionFormat===void 0&&(N.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(P){throw console.error("THREE.WebGLRenderer: "+P.message),P}let Y,tt,et,lt,rt,At,gt,Ct,ve,qt,Ot,Yt,Jt,Kt,F,T,K,ct,ot,ft,Ft,X,vt;function Mt(){Y=new Km(N),tt=new Wm(N,Y,i),Y.init(tt),X=new Lv(N,Y,tt),et=new Pv(N,Y,tt),lt=new tg(N),rt=new xv,At=new Iv(N,Y,et,rt,tt,X,lt),gt=new jm(g),Ct=new Jm(g),ve=new hp(N,tt),vt=new Vm(N,Y,ve,tt),qt=new Qm(N,ve,lt,vt),Ot=new rg(N,qt,ve,lt),ot=new ig(N,tt,At),T=new qm(rt),Yt=new vv(g,gt,Ct,Y,tt,vt,T),Jt=new kv(g,rt),Kt=new yv,F=new Ev(Y,tt),ct=new Gm(g,gt,et,Ot,h,o),K=new Rv(g,Ot,tt),ft=new Hm(N,Y,lt,tt),Ft=new $m(N,Y,lt,tt),lt.programs=Yt.programs,g.capabilities=tt,g.extensions=Y,g.properties=rt,g.renderLists=Kt,g.shadowMap=K,g.state=et,g.info=lt}Mt();const ut=new Bv(g,N);this.xr=ut,this.getContext=function(){return N},this.getContextAttributes=function(){return N.getContextAttributes()},this.forceContextLoss=function(){const P=Y.get("WEBGL_lose_context");P&&P.loseContext()},this.forceContextRestore=function(){const P=Y.get("WEBGL_lose_context");P&&P.restoreContext()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(P){P!==void 0&&(j=P,this.setSize(U,$,!1))},this.getSize=function(P){return P.set(U,$)},this.setSize=function(P,W,q){if(ut.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}U=P,$=W,t.width=Math.floor(P*j),t.height=Math.floor(W*j),q!==!1&&(t.style.width=P+"px",t.style.height=W+"px"),this.setViewport(0,0,P,W)},this.getDrawingBufferSize=function(P){return P.set(U*j,$*j).floor()},this.setDrawingBufferSize=function(P,W,q){U=P,$=W,j=q,t.width=Math.floor(P*q),t.height=Math.floor(W*q),this.setViewport(0,0,P,W)},this.getCurrentViewport=function(P){return P.copy(G)},this.getViewport=function(P){return P.copy(f)},this.setViewport=function(P,W,q,V){P.isVector4?f.set(P.x,P.y,P.z,P.w):f.set(P,W,q,V),et.viewport(G.copy(f).multiplyScalar(j).floor())},this.getScissor=function(P){return P.copy(m)},this.setScissor=function(P,W,q,V){P.isVector4?m.set(P.x,P.y,P.z,P.w):m.set(P,W,q,V),et.scissor(Z.copy(m).multiplyScalar(j).floor())},this.getScissorTest=function(){return y},this.setScissorTest=function(P){et.setScissorTest(y=P)},this.setOpaqueSort=function(P){ht=P},this.setTransparentSort=function(P){R=P},this.getClearColor=function(P){return P.copy(ct.getClearColor())},this.setClearColor=function(){ct.setClearColor.apply(ct,arguments)},this.getClearAlpha=function(){return ct.getClearAlpha()},this.setClearAlpha=function(){ct.setClearAlpha.apply(ct,arguments)},this.clear=function(P=!0,W=!0,q=!0){let V=0;P&&(V|=16384),W&&(V|=256),q&&(V|=1024),N.clear(V)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",k,!1),t.removeEventListener("webglcontextrestored",mt,!1),t.removeEventListener("webglcontextcreationerror",at,!1),Kt.dispose(),F.dispose(),rt.dispose(),gt.dispose(),Ct.dispose(),Ot.dispose(),vt.dispose(),Yt.dispose(),ut.dispose(),ut.removeEventListener("sessionstart",Pt),ut.removeEventListener("sessionend",It),I&&(I.dispose(),I=null),ue.stop()};function k(P){P.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),v=!0}function mt(){console.log("THREE.WebGLRenderer: Context Restored."),v=!1;const P=lt.autoReset,W=K.enabled,q=K.autoUpdate,V=K.needsUpdate,nt=K.type;Mt(),lt.autoReset=P,K.enabled=W,K.autoUpdate=q,K.needsUpdate=V,K.type=nt}function at(P){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",P.statusMessage)}function _t(P){const W=P.target;W.removeEventListener("dispose",_t),bt(W)}function bt(P){wt(P),rt.remove(P)}function wt(P){const W=rt.get(P).programs;W!==void 0&&(W.forEach(function(q){Yt.releaseProgram(q)}),P.isShaderMaterial&&Yt.releaseShaderCache(P))}this.renderBufferDirect=function(P,W,q,V,nt,yt){W===null&&(W=it);const St=nt.isMesh&&nt.matrixWorld.determinant()<0,Bt=le(P,W,q,V,nt);et.setMaterial(V,St);let Et=q.index;const Lt=q.attributes.position;if(Et===null){if(Lt===void 0||Lt.count===0)return}else if(Et.count===0)return;let zt=1;V.wireframe===!0&&(Et=qt.getWireframeAttribute(q),zt=2),vt.setup(nt,V,Bt,q,Et);let Gt,ie=ft;Et!==null&&(Gt=ve.get(Et),ie=Ft,ie.setIndex(Gt));const De=Et!==null?Et.count:Lt.count,Ge=q.drawRange.start*zt,Dn=q.drawRange.count*zt,qe=yt!==null?yt.start*zt:0,$t=yt!==null?yt.count*zt:1/0,Nn=Math.max(Ge,qe),fe=Math.min(De,Ge+Dn,qe+$t)-1,je=Math.max(0,fe-Nn+1);if(je!==0){if(nt.isMesh)V.wireframe===!0?(et.setLineWidth(V.wireframeLinewidth*_()),ie.setMode(1)):ie.setMode(4);else if(nt.isLine){let ln=V.linewidth;ln===void 0&&(ln=1),et.setLineWidth(ln*_()),nt.isLineSegments?ie.setMode(1):nt.isLineLoop?ie.setMode(2):ie.setMode(3)}else nt.isPoints?ie.setMode(0):nt.isSprite&&ie.setMode(4);if(nt.isInstancedMesh)ie.renderInstances(Nn,je,nt.count);else if(q.isInstancedBufferGeometry){const ln=Math.min(q.instanceCount,q._maxInstanceCount);ie.renderInstances(Nn,je,ln)}else ie.render(Nn,je)}},this.compile=function(P,W){p=F.get(P),p.init(),b.push(p),P.traverseVisible(function(q){q.isLight&&q.layers.test(W.layers)&&(p.pushLight(q),q.castShadow&&p.pushShadow(q))}),p.setupLights(g.physicallyCorrectLights),P.traverse(function(q){const V=q.material;if(V)if(Array.isArray(V))for(let nt=0;nt<V.length;nt++){const yt=V[nt];xn(yt,P,q)}else xn(V,P,q)}),b.pop(),p=null};let st=null;function Dt(P){st&&st(P)}function Pt(){ue.stop()}function It(){ue.start()}const ue=new hh;ue.setAnimationLoop(Dt),typeof self<"u"&&ue.setContext(self),this.setAnimationLoop=function(P){st=P,ut.setAnimationLoop(P),P===null?ue.stop():ue.start()},ut.addEventListener("sessionstart",Pt),ut.addEventListener("sessionend",It),this.render=function(P,W){if(W!==void 0&&W.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(v===!0)return;P.autoUpdate===!0&&P.updateMatrixWorld(),W.parent===null&&W.updateMatrixWorld(),ut.enabled===!0&&ut.isPresenting===!0&&(ut.cameraAutoUpdate===!0&&ut.updateCamera(W),W=ut.getCamera()),P.isScene===!0&&P.onBeforeRender(g,P,W,z),p=F.get(P,b.length),p.init(),b.push(p),A.multiplyMatrices(W.projectionMatrix,W.matrixWorldInverse),w.setFromProjectionMatrix(A),C=this.localClippingEnabled,S=T.init(this.clippingPlanes,C,W),u=Kt.get(P,x.length),u.init(),x.push(u),jt(P,W,0,g.sortObjects),u.finish(),g.sortObjects===!0&&u.sort(ht,R),S===!0&&T.beginShadows();const q=p.state.shadowsArray;if(K.render(q,P,W),S===!0&&T.endShadows(),this.info.autoReset===!0&&this.info.reset(),ct.render(u,P),p.setupLights(g.physicallyCorrectLights),W.isArrayCamera){const V=W.cameras;for(let nt=0,yt=V.length;nt<yt;nt++){const St=V[nt];se(u,P,St,St.viewport)}}else se(u,P,W);z!==null&&(At.updateMultisampleRenderTarget(z),At.updateRenderTargetMipmap(z)),P.isScene===!0&&P.onAfterRender(g,P,W),vt.resetDefaultState(),B=-1,O=null,b.pop(),b.length>0?p=b[b.length-1]:p=null,x.pop(),x.length>0?u=x[x.length-1]:u=null};function jt(P,W,q,V){if(P.visible===!1)return;if(P.layers.test(W.layers)){if(P.isGroup)q=P.renderOrder;else if(P.isLOD)P.autoUpdate===!0&&P.update(W);else if(P.isLight)p.pushLight(P),P.castShadow&&p.pushShadow(P);else if(P.isSprite){if(!P.frustumCulled||w.intersectsSprite(P)){V&&E.setFromMatrixPosition(P.matrixWorld).applyMatrix4(A);const St=Ot.update(P),Bt=P.material;Bt.visible&&u.push(P,St,Bt,q,E.z,null)}}else if((P.isMesh||P.isLine||P.isPoints)&&(P.isSkinnedMesh&&P.skeleton.frame!==lt.render.frame&&(P.skeleton.update(),P.skeleton.frame=lt.render.frame),!P.frustumCulled||w.intersectsObject(P))){V&&E.setFromMatrixPosition(P.matrixWorld).applyMatrix4(A);const St=Ot.update(P),Bt=P.material;if(Array.isArray(Bt)){const Et=St.groups;for(let Lt=0,zt=Et.length;Lt<zt;Lt++){const Gt=Et[Lt],ie=Bt[Gt.materialIndex];ie&&ie.visible&&u.push(P,St,ie,q,E.z,Gt)}}else Bt.visible&&u.push(P,St,Bt,q,E.z,null)}}const yt=P.children;for(let St=0,Bt=yt.length;St<Bt;St++)jt(yt[St],W,q,V)}function se(P,W,q,V){const nt=P.opaque,yt=P.transmissive,St=P.transparent;p.setupLightsView(q),yt.length>0&&ii(nt,W,q),V&&et.viewport(G.copy(V)),nt.length>0&&re(nt,W,q),yt.length>0&&re(yt,W,q),St.length>0&&re(St,W,q),et.buffers.depth.setTest(!0),et.buffers.depth.setMask(!0),et.buffers.color.setMask(!0),et.setPolygonOffset(!1)}function ii(P,W,q){const V=tt.isWebGL2;I===null&&(I=new Ui(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?Ss:nr,minFilter:zo,samples:V&&s===!0?4:0})),g.getDrawingBufferSize(d),V?I.setSize(d.x,d.y):I.setSize($a(d.x),$a(d.y));const nt=g.getRenderTarget();g.setRenderTarget(I),g.clear();const yt=g.toneMapping;g.toneMapping=xi,re(P,W,q),g.toneMapping=yt,At.updateMultisampleRenderTarget(I),At.updateRenderTargetMipmap(I),g.setRenderTarget(nt)}function re(P,W,q){const V=W.isScene===!0?W.overrideMaterial:null;for(let nt=0,yt=P.length;nt<yt;nt++){const St=P[nt],Bt=St.object,Et=St.geometry,Lt=V===null?St.material:V,zt=St.group;Bt.layers.test(q.layers)&&ae(Bt,W,q,Et,Lt,zt)}}function ae(P,W,q,V,nt,yt){P.onBeforeRender(g,W,q,V,nt,yt),P.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,P.matrixWorld),P.normalMatrix.getNormalMatrix(P.modelViewMatrix),nt.onBeforeRender(g,W,q,V,P,yt),nt.transparent===!0&&nt.side===Ur?(nt.side=Pn,nt.needsUpdate=!0,g.renderBufferDirect(q,W,V,nt,P,yt),nt.side=Ms,nt.needsUpdate=!0,g.renderBufferDirect(q,W,V,nt,P,yt),nt.side=Ur):g.renderBufferDirect(q,W,V,nt,P,yt),P.onAfterRender(g,W,q,V,nt,yt)}function xn(P,W,q){W.isScene!==!0&&(W=it);const V=rt.get(P),nt=p.state.lights,yt=p.state.shadowsArray,St=nt.state.version,Bt=Yt.getParameters(P,nt.state,yt,W,q),Et=Yt.getProgramCacheKey(Bt);let Lt=V.programs;V.environment=P.isMeshStandardMaterial?W.environment:null,V.fog=W.fog,V.envMap=(P.isMeshStandardMaterial?Ct:gt).get(P.envMap||V.environment),Lt===void 0&&(P.addEventListener("dispose",_t),Lt=new Map,V.programs=Lt);let zt=Lt.get(Et);if(zt!==void 0){if(V.currentProgram===zt&&V.lightsStateVersion===St)return oe(P,Bt),zt}else Bt.uniforms=Yt.getUniforms(P),P.onBuild(q,Bt,g),P.onBeforeCompile(Bt,g),zt=Yt.acquireProgram(Bt,Et),Lt.set(Et,zt),V.uniforms=Bt.uniforms;const Gt=V.uniforms;(!P.isShaderMaterial&&!P.isRawShaderMaterial||P.clipping===!0)&&(Gt.clippingPlanes=T.uniform),oe(P,Bt),V.needsLights=ce(P),V.lightsStateVersion=St,V.needsLights&&(Gt.ambientLightColor.value=nt.state.ambient,Gt.lightProbe.value=nt.state.probe,Gt.directionalLights.value=nt.state.directional,Gt.directionalLightShadows.value=nt.state.directionalShadow,Gt.spotLights.value=nt.state.spot,Gt.spotLightShadows.value=nt.state.spotShadow,Gt.rectAreaLights.value=nt.state.rectArea,Gt.ltc_1.value=nt.state.rectAreaLTC1,Gt.ltc_2.value=nt.state.rectAreaLTC2,Gt.pointLights.value=nt.state.point,Gt.pointLightShadows.value=nt.state.pointShadow,Gt.hemisphereLights.value=nt.state.hemi,Gt.directionalShadowMap.value=nt.state.directionalShadowMap,Gt.directionalShadowMatrix.value=nt.state.directionalShadowMatrix,Gt.spotShadowMap.value=nt.state.spotShadowMap,Gt.spotShadowMatrix.value=nt.state.spotShadowMatrix,Gt.pointShadowMap.value=nt.state.pointShadowMap,Gt.pointShadowMatrix.value=nt.state.pointShadowMatrix);const ie=zt.getUniforms(),De=xo.seqWithValue(ie.seq,Gt);return V.currentProgram=zt,V.uniformsList=De,zt}function oe(P,W){const q=rt.get(P);q.outputEncoding=W.outputEncoding,q.instancing=W.instancing,q.skinning=W.skinning,q.morphTargets=W.morphTargets,q.morphNormals=W.morphNormals,q.morphColors=W.morphColors,q.morphTargetsCount=W.morphTargetsCount,q.numClippingPlanes=W.numClippingPlanes,q.numIntersection=W.numClipIntersection,q.vertexAlphas=W.vertexAlphas,q.vertexTangents=W.vertexTangents,q.toneMapping=W.toneMapping}function le(P,W,q,V,nt){W.isScene!==!0&&(W=it),At.resetTextureUnits();const yt=W.fog,St=V.isMeshStandardMaterial?W.environment:null,Bt=z===null?g.outputEncoding:z.isXRRenderTarget===!0?z.texture.encoding:ir,Et=(V.isMeshStandardMaterial?Ct:gt).get(V.envMap||St),Lt=V.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,zt=!!V.normalMap&&!!q.attributes.tangent,Gt=!!q.morphAttributes.position,ie=!!q.morphAttributes.normal,De=!!q.morphAttributes.color,Ge=V.toneMapped?g.toneMapping:xi,Dn=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,qe=Dn!==void 0?Dn.length:0,$t=rt.get(V),Nn=p.state.lights;if(S===!0&&(C===!0||P!==O)){const Xe=P===O&&V.id===B;T.setState(V,P,Xe)}let fe=!1;V.version===$t.__version?($t.needsLights&&$t.lightsStateVersion!==Nn.state.version||$t.outputEncoding!==Bt||nt.isInstancedMesh&&$t.instancing===!1||!nt.isInstancedMesh&&$t.instancing===!0||nt.isSkinnedMesh&&$t.skinning===!1||!nt.isSkinnedMesh&&$t.skinning===!0||$t.envMap!==Et||V.fog===!0&&$t.fog!==yt||$t.numClippingPlanes!==void 0&&($t.numClippingPlanes!==T.numPlanes||$t.numIntersection!==T.numIntersection)||$t.vertexAlphas!==Lt||$t.vertexTangents!==zt||$t.morphTargets!==Gt||$t.morphNormals!==ie||$t.morphColors!==De||$t.toneMapping!==Ge||tt.isWebGL2===!0&&$t.morphTargetsCount!==qe)&&(fe=!0):(fe=!0,$t.__version=V.version);let je=$t.currentProgram;fe===!0&&(je=xn(V,W,nt));let ln=!1,si=!1,Vi=!1;const be=je.getUniforms(),oi=$t.uniforms;if(et.useProgram(je.program)&&(ln=!0,si=!0,Vi=!0),V.id!==B&&(B=V.id,si=!0),ln||O!==P){if(be.setValue(N,"projectionMatrix",P.projectionMatrix),tt.logarithmicDepthBuffer&&be.setValue(N,"logDepthBufFC",2/(Math.log(P.far+1)/Math.LN2)),O!==P&&(O=P,si=!0,Vi=!0),V.isShaderMaterial||V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshStandardMaterial||V.envMap){const Xe=be.map.cameraPosition;Xe!==void 0&&Xe.setValue(N,E.setFromMatrixPosition(P.matrixWorld))}(V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshLambertMaterial||V.isMeshBasicMaterial||V.isMeshStandardMaterial||V.isShaderMaterial)&&be.setValue(N,"isOrthographic",P.isOrthographicCamera===!0),(V.isMeshPhongMaterial||V.isMeshToonMaterial||V.isMeshLambertMaterial||V.isMeshBasicMaterial||V.isMeshStandardMaterial||V.isShaderMaterial||V.isShadowMaterial||nt.isSkinnedMesh)&&be.setValue(N,"viewMatrix",P.matrixWorldInverse)}if(nt.isSkinnedMesh){be.setOptional(N,nt,"bindMatrix"),be.setOptional(N,nt,"bindMatrixInverse");const Xe=nt.skeleton;Xe&&(tt.floatVertexTextures?(Xe.boneTexture===null&&Xe.computeBoneTexture(),be.setValue(N,"boneTexture",Xe.boneTexture,At),be.setValue(N,"boneTextureSize",Xe.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Hi=q.morphAttributes;return(Hi.position!==void 0||Hi.normal!==void 0||Hi.color!==void 0&&tt.isWebGL2===!0)&&ot.update(nt,q,V,je),(si||$t.receiveShadow!==nt.receiveShadow)&&($t.receiveShadow=nt.receiveShadow,be.setValue(N,"receiveShadow",nt.receiveShadow)),si&&(be.setValue(N,"toneMappingExposure",g.toneMappingExposure),$t.needsLights&&ri(oi,Vi),yt&&V.fog===!0&&Jt.refreshFogUniforms(oi,yt),Jt.refreshMaterialUniforms(oi,V,j,$,I),xo.upload(N,$t.uniformsList,oi,At)),V.isShaderMaterial&&V.uniformsNeedUpdate===!0&&(xo.upload(N,$t.uniformsList,oi,At),V.uniformsNeedUpdate=!1),V.isSpriteMaterial&&be.setValue(N,"center",nt.center),be.setValue(N,"modelViewMatrix",nt.modelViewMatrix),be.setValue(N,"normalMatrix",nt.normalMatrix),be.setValue(N,"modelMatrix",nt.matrixWorld),je}function ri(P,W){P.ambientLightColor.needsUpdate=W,P.lightProbe.needsUpdate=W,P.directionalLights.needsUpdate=W,P.directionalLightShadows.needsUpdate=W,P.pointLights.needsUpdate=W,P.pointLightShadows.needsUpdate=W,P.spotLights.needsUpdate=W,P.spotLightShadows.needsUpdate=W,P.rectAreaLights.needsUpdate=W,P.hemisphereLights.needsUpdate=W}function ce(P){return P.isMeshLambertMaterial||P.isMeshToonMaterial||P.isMeshPhongMaterial||P.isMeshStandardMaterial||P.isShadowMaterial||P.isShaderMaterial&&P.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return z},this.setRenderTargetTextures=function(P,W,q){rt.get(P.texture).__webglTexture=W,rt.get(P.depthTexture).__webglTexture=q;const V=rt.get(P);V.__hasExternalTextures=!0,V.__hasExternalTextures&&(V.__autoAllocateDepthBuffer=q===void 0,V.__autoAllocateDepthBuffer||Y.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),V.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(P,W){const q=rt.get(P);q.__webglFramebuffer=W,q.__useDefaultFramebuffer=W===void 0},this.setRenderTarget=function(P,W=0,q=0){z=P,M=W,D=q;let V=!0;if(P){const Et=rt.get(P);Et.__useDefaultFramebuffer!==void 0?(et.bindFramebuffer(36160,null),V=!1):Et.__webglFramebuffer===void 0?At.setupRenderTarget(P):Et.__hasExternalTextures&&At.rebindTextures(P,rt.get(P.texture).__webglTexture,rt.get(P.depthTexture).__webglTexture)}let nt=null,yt=!1,St=!1;if(P){const Et=P.texture;(Et.isData3DTexture||Et.isDataArrayTexture)&&(St=!0);const Lt=rt.get(P).__webglFramebuffer;P.isWebGLCubeRenderTarget?(nt=Lt[W],yt=!0):tt.isWebGL2&&P.samples>0&&At.useMultisampledRTT(P)===!1?nt=rt.get(P).__webglMultisampledFramebuffer:nt=Lt,G.copy(P.viewport),Z.copy(P.scissor),L=P.scissorTest}else G.copy(f).multiplyScalar(j).floor(),Z.copy(m).multiplyScalar(j).floor(),L=y;if(et.bindFramebuffer(36160,nt)&&tt.drawBuffers&&V&&et.drawBuffers(P,nt),et.viewport(G),et.scissor(Z),et.setScissorTest(L),yt){const Et=rt.get(P.texture);N.framebufferTexture2D(36160,36064,34069+W,Et.__webglTexture,q)}else if(St){const Et=rt.get(P.texture),Lt=W||0;N.framebufferTextureLayer(36160,36064,Et.__webglTexture,q||0,Lt)}B=-1},this.readRenderTargetPixels=function(P,W,q,V,nt,yt,St){if(!(P&&P.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Bt=rt.get(P).__webglFramebuffer;if(P.isWebGLCubeRenderTarget&&St!==void 0&&(Bt=Bt[St]),Bt){et.bindFramebuffer(36160,Bt);try{const Et=P.texture,Lt=Et.format,zt=Et.type;if(Lt!==Cn&&X.convert(Lt)!==N.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Gt=zt===Ss&&(Y.has("EXT_color_buffer_half_float")||tt.isWebGL2&&Y.has("EXT_color_buffer_float"));if(zt!==nr&&X.convert(zt)!==N.getParameter(35738)&&!(zt===Ki&&(tt.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float")))&&!Gt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}W>=0&&W<=P.width-V&&q>=0&&q<=P.height-nt&&N.readPixels(W,q,V,nt,X.convert(Lt),X.convert(zt),yt)}finally{const Et=z!==null?rt.get(z).__webglFramebuffer:null;et.bindFramebuffer(36160,Et)}}},this.copyFramebufferToTexture=function(P,W,q=0){const V=Math.pow(2,-q),nt=Math.floor(W.image.width*V),yt=Math.floor(W.image.height*V);At.setTexture2D(W,0),N.copyTexSubImage2D(3553,q,0,0,P.x,P.y,nt,yt),et.unbindTexture()},this.copyTextureToTexture=function(P,W,q,V=0){const nt=W.image.width,yt=W.image.height,St=X.convert(q.format),Bt=X.convert(q.type);At.setTexture2D(q,0),N.pixelStorei(37440,q.flipY),N.pixelStorei(37441,q.premultiplyAlpha),N.pixelStorei(3317,q.unpackAlignment),W.isDataTexture?N.texSubImage2D(3553,V,P.x,P.y,nt,yt,St,Bt,W.image.data):W.isCompressedTexture?N.compressedTexSubImage2D(3553,V,P.x,P.y,W.mipmaps[0].width,W.mipmaps[0].height,St,W.mipmaps[0].data):N.texSubImage2D(3553,V,P.x,P.y,St,Bt,W.image),V===0&&q.generateMipmaps&&N.generateMipmap(3553),et.unbindTexture()},this.copyTextureToTexture3D=function(P,W,q,V,nt=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const yt=P.max.x-P.min.x+1,St=P.max.y-P.min.y+1,Bt=P.max.z-P.min.z+1,Et=X.convert(V.format),Lt=X.convert(V.type);let zt;if(V.isData3DTexture)At.setTexture3D(V,0),zt=32879;else if(V.isDataArrayTexture)At.setTexture2DArray(V,0),zt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}N.pixelStorei(37440,V.flipY),N.pixelStorei(37441,V.premultiplyAlpha),N.pixelStorei(3317,V.unpackAlignment);const Gt=N.getParameter(3314),ie=N.getParameter(32878),De=N.getParameter(3316),Ge=N.getParameter(3315),Dn=N.getParameter(32877),qe=q.isCompressedTexture?q.mipmaps[0]:q.image;N.pixelStorei(3314,qe.width),N.pixelStorei(32878,qe.height),N.pixelStorei(3316,P.min.x),N.pixelStorei(3315,P.min.y),N.pixelStorei(32877,P.min.z),q.isDataTexture||q.isData3DTexture?N.texSubImage3D(zt,nt,W.x,W.y,W.z,yt,St,Bt,Et,Lt,qe.data):q.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),N.compressedTexSubImage3D(zt,nt,W.x,W.y,W.z,yt,St,Bt,Et,qe.data)):N.texSubImage3D(zt,nt,W.x,W.y,W.z,yt,St,Bt,Et,Lt,qe),N.pixelStorei(3314,Gt),N.pixelStorei(32878,ie),N.pixelStorei(3316,De),N.pixelStorei(3315,Ge),N.pixelStorei(32877,Dn),nt===0&&V.generateMipmaps&&N.generateMipmap(zt),et.unbindTexture()},this.initTexture=function(P){At.setTexture2D(P,0),et.unbindTexture()},this.resetState=function(){M=0,D=0,z=null,et.reset(),vt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Uv extends _h{}Uv.prototype.isWebGL1Renderer=!0;class zv extends In{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),e}}class Gv extends Ie{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class yh extends Ie{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class Vv extends Ie{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}new J;new J;new J;new J;new Gn;class Hv extends Ie{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Vt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Wv extends _i{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class bh extends Ie{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Vt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yr,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class qv extends bh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Je(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Vt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Vt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Vt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class jv extends Ie{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vt(16777215),this.specular=new Vt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yr,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Xv extends Ie{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Vt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yr,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Zv extends Ie{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yr,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Yv extends Ie{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Oo,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Jv extends Ie{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Vt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yr,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Kv extends yh{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const Qv={ShadowMaterial:Hv,SpriteMaterial:Gv,RawShaderMaterial:Wv,ShaderMaterial:_i,PointsMaterial:Vv,MeshPhysicalMaterial:qv,MeshStandardMaterial:bh,MeshPhongMaterial:jv,MeshToonMaterial:Xv,MeshNormalMaterial:Zv,MeshLambertMaterial:Yv,MeshDepthMaterial:vh,MeshDistanceMaterial:xh,MeshBasicMaterial:Es,MeshMatcapMaterial:Jv,LineDashedMaterial:Kv,LineBasicMaterial:yh,Material:Ie};Ie.fromType=function(i){return new Qv[i]};const Kc={enabled:!1,files:{},add:function(i,t){this.enabled!==!1&&(this.files[i]=t)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class $v{constructor(t,e,n){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(h){a++,s===!1&&r.onStart!==void 0&&r.onStart(h,o,a),s=!0},this.itemEnd=function(h){o++,r.onProgress!==void 0&&r.onProgress(h,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,u){return c.push(h,u),this},this.removeHandler=function(h){const u=c.indexOf(h);return u!==-1&&c.splice(u,2),this},this.getHandler=function(h){for(let u=0,p=c.length;u<p;u+=2){const x=c[u],b=c[u+1];if(x.global&&(x.lastIndex=0),x.test(h))return b}return null}}}const tx=new $v;class wh{constructor(t){this.manager=t!==void 0?t:tx,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(r,s){n.load(t,r,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}class ex extends wh{constructor(t){super(t)}load(t,e,n,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=Kc.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const a=As("img");function l(){h(),Kc.add(t,this),e&&e(this),s.manager.itemEnd(t)}function c(u){h(),r&&r(u),s.manager.itemError(t),s.manager.itemEnd(t)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(t),a.src=t,a}}class nx extends wh{constructor(t){super(t)}load(t,e,n,r){const s=new pn,o=new ex(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){s.image=a,s.needsUpdate=!0,e!==void 0&&e(s)},n,r),s}}const Mh="\\[\\]\\.:\\/",wl="[^"+Mh+"]",ix="[^"+Mh.replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",wl);/(WCOD+)?/.source.replace("WCOD",ix);/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wl);/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wl);class rx{constructor(t,e,n=0,r=1/0){this.ray=new sh(t,e),this.near=n,this.far=r,this.camera=null,this.layers=new _l,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return el(t,this,n,e),n.sort(Qc),n}intersectObjects(t,e=!0,n=[]){for(let r=0,s=t.length;r<s;r++)el(t[r],this,n,e);return n.sort(Qc),n}}function Qc(i,t){return i.distance-t.distance}function el(i,t,e,n){if(i.layers.test(t.layers)&&i.raycast(t,e),n===!0){const r=i.children;for(let s=0,o=r.length;s<o;s++)el(r[s],t,e,!0)}}const Fn=new Uint32Array(512),Bn=new Uint32Array(512);for(let i=0;i<256;++i){const t=i-127;t<-27?(Fn[i]=0,Fn[i|256]=32768,Bn[i]=24,Bn[i|256]=24):t<-14?(Fn[i]=1024>>-t-14,Fn[i|256]=1024>>-t-14|32768,Bn[i]=-t-1,Bn[i|256]=-t-1):t<=15?(Fn[i]=t+15<<10,Fn[i|256]=t+15<<10|32768,Bn[i]=13,Bn[i|256]=13):t<128?(Fn[i]=31744,Fn[i|256]=64512,Bn[i]=24,Bn[i|256]=24):(Fn[i]=31744,Fn[i|256]=64512,Bn[i]=13,Bn[i|256]=13)}const Sh=new Uint32Array(2048),Os=new Uint32Array(64),sx=new Uint32Array(64);for(let i=1;i<1024;++i){let t=i<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,Sh[i]=t|e}for(let i=1024;i<2048;++i)Sh[i]=939524096+(i-1024<<13);for(let i=1;i<31;++i)Os[i]=i<<23;Os[31]=1199570944;Os[32]=2147483648;for(let i=33;i<63;++i)Os[i]=2147483648+(i-32<<23);Os[63]=3347054592;for(let i=1;i<64;++i)i!==32&&(sx[i]=1024);typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:vl}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=vl);var Fr={Linear:{None:function(i){return i}},Quadratic:{In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}},Cubic:{In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}},Quartic:{In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}},Quintic:{In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}},Sinusoidal:{In:function(i){return 1-Math.cos(i*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.cos(Math.PI*i))}},Exponential:{In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}},Circular:{In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}},Elastic:{In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}},Back:{In:function(i){var t=1.70158;return i*i*((t+1)*i-t)},Out:function(i){var t=1.70158;return--i*i*((t+1)*i+t)+1},InOut:function(i){var t=2.5949095;return(i*=2)<1?.5*(i*i*((t+1)*i-t)):.5*((i-=2)*i*((t+1)*i+t)+2)}},Bounce:{In:function(i){return 1-Fr.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?Fr.Bounce.In(i*2)*.5:Fr.Bounce.Out(i*2-1)*.5+.5}}},gs;typeof self>"u"&&typeof process<"u"&&process.hrtime?gs=function(){var i=process.hrtime();return i[0]*1e3+i[1]/1e6}:typeof self<"u"&&self.performance!==void 0&&self.performance.now!==void 0?gs=self.performance.now.bind(self.performance):Date.now!==void 0?gs=Date.now:gs=function(){return new Date().getTime()};var Tr=gs,ox=function(){function i(){this._tweens={},this._tweensAddedDuringUpdate={}}return i.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(e){return t._tweens[e]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},i.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},i.prototype.update=function(t,e){t===void 0&&(t=Tr()),e===void 0&&(e=!1);var n=Object.keys(this._tweens);if(n.length===0)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var s=this._tweens[n[r]],o=!e;s&&s.update(t,o)===!1&&!e&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},i}(),vs={Linear:function(i,t){var e=i.length-1,n=e*t,r=Math.floor(n),s=vs.Utils.Linear;return t<0?s(i[0],i[1],n):t>1?s(i[e],i[e-1],e-n):s(i[r],i[r+1>e?e:r+1],n-r)},Bezier:function(i,t){for(var e=0,n=i.length-1,r=Math.pow,s=vs.Utils.Bernstein,o=0;o<=n;o++)e+=r(1-t,n-o)*r(t,o)*i[o]*s(n,o);return e},CatmullRom:function(i,t){var e=i.length-1,n=e*t,r=Math.floor(n),s=vs.Utils.CatmullRom;return i[0]===i[e]?(t<0&&(r=Math.floor(n=e*(1+t))),s(i[(r-1+e)%e],i[r],i[(r+1)%e],i[(r+2)%e],n-r)):t<0?i[0]-(s(i[0],i[0],i[1],i[1],-n)-i[0]):t>1?i[e]-(s(i[e],i[e],i[e-1],i[e-1],n-e)-i[e]):s(i[r?r-1:0],i[r],i[e<r+1?e:r+1],i[e<r+2?e:r+2],n-r)},Utils:{Linear:function(i,t,e){return(t-i)*e+i},Bernstein:function(i,t){var e=vs.Utils.Factorial;return e(i)/e(t)/e(i-t)},Factorial:function(){var i=[1];return function(t){var e=1;if(i[t])return i[t];for(var n=t;n>1;n--)e*=n;return i[t]=e,e}}(),CatmullRom:function(i,t,e,n,r){var s=(e-i)*.5,o=(n-t)*.5,a=r*r,l=r*a;return(2*t-2*e+s+o)*l+(-3*t+3*e-2*s-o)*a+s*r+t}}},Ah=function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i}(),Eh=new ox,Th=function(){function i(t,e){e===void 0&&(e=Eh),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Fr.Linear.None,this._interpolationFunction=vs.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=Ah.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),e!==void 0&&(this._duration=e),this},i.prototype.duration=function(t){return this._duration=t,this},i.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var e in this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e]}return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t!==void 0?typeof t=="string"?Tr()+parseFloat(t):t:Tr(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},i.prototype._setupProperties=function(t,e,n,r){for(var s in n){var o=t[s],a=Array.isArray(o),l=a?"array":typeof o,c=!a&&Array.isArray(n[s]);if(!(l==="undefined"||l==="function")){if(c){var h=n[s];if(h.length===0)continue;h=h.map(this._handleRelativeValue.bind(this,o)),n[s]=[o].concat(h)}if((l==="object"||a)&&o&&!c){e[s]=a?[]:{};for(var u in o)e[s][u]=o[u];r[s]=a?[]:{},this._setupProperties(o,e[s],n[s],r[s])}else typeof e[s]>"u"&&(e[s]=o),a||(e[s]*=1),c?r[s]=n[s].slice().reverse():r[s]=e[s]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},i.prototype.pause=function(t){return t===void 0&&(t=Tr()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},i.prototype.resume=function(t){return t===void 0&&(t=Tr()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},i.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},i.prototype.group=function(t){return this._group=t,this},i.prototype.delay=function(t){return this._delayTime=t,this},i.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},i.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},i.prototype.yoyo=function(t){return this._yoyo=t,this},i.prototype.easing=function(t){return this._easingFunction=t,this},i.prototype.interpolation=function(t){return this._interpolationFunction=t,this},i.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},i.prototype.onStart=function(t){return this._onStartCallback=t,this},i.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},i.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},i.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},i.prototype.onStop=function(t){return this._onStopCallback=t,this},i.prototype.update=function(t,e){if(t===void 0&&(t=Tr()),e===void 0&&(e=!0),this._isPaused)return!0;var n,r,s=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>s)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(t-this._startTime)/this._duration,r=this._duration===0||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),r===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(n in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[n]=="string"&&(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(t,e,n,r){for(var s in n)if(e[s]!==void 0){var o=e[s]||0,a=n[s],l=Array.isArray(t[s]),c=Array.isArray(a),h=!l&&c;h?t[s]=this._interpolationFunction(a,r):typeof a=="object"&&a?this._updateProperties(t[s],o,a,r):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(t[s]=o+(a-o)*r))}},i.prototype._handleRelativeValue=function(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)},i.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];typeof n=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(n):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},i}();Ah.nextId;var Kn=Eh;Kn.getAll.bind(Kn);Kn.removeAll.bind(Kn);Kn.add.bind(Kn);Kn.remove.bind(Kn);var ax=Kn.update.bind(Kn),Ch=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rh={exports:{}};(function(i){(function(t,e){function n(R,f){if(!R)throw new Error(f||"Assertion failed")}function r(R,f){R.super_=f;var m=function(){};m.prototype=f.prototype,R.prototype=new m,R.prototype.constructor=R}function s(R,f,m){if(s.isBN(R))return R;this.negative=0,this.words=null,this.length=0,this.red=null,R!==null&&((f==="le"||f==="be")&&(m=f,f=10),this._init(R||0,f||10,m||"be"))}typeof t=="object"?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=require("buffer").Buffer}catch{}s.isBN=function(f){return f instanceof s?!0:f!==null&&typeof f=="object"&&f.constructor.wordSize===s.wordSize&&Array.isArray(f.words)},s.max=function(f,m){return f.cmp(m)>0?f:m},s.min=function(f,m){return f.cmp(m)<0?f:m},s.prototype._init=function(f,m,y){if(typeof f=="number")return this._initNumber(f,m,y);if(typeof f=="object")return this._initArray(f,m,y);m==="hex"&&(m=16),n(m===(m|0)&&m>=2&&m<=36),f=f.toString().replace(/\s+/g,"");var w=0;f[0]==="-"&&(w++,this.negative=1),w<f.length&&(m===16?this._parseHex(f,w,y):(this._parseBase(f,m,w),y==="le"&&this._initArray(this.toArray(),m,y)))},s.prototype._initNumber=function(f,m,y){f<0&&(this.negative=1,f=-f),f<67108864?(this.words=[f&67108863],this.length=1):f<4503599627370496?(this.words=[f&67108863,f/67108864&67108863],this.length=2):(n(f<9007199254740992),this.words=[f&67108863,f/67108864&67108863,1],this.length=3),y==="le"&&this._initArray(this.toArray(),m,y)},s.prototype._initArray=function(f,m,y){if(n(typeof f.length=="number"),f.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(f.length/3),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var S,C,I=0;if(y==="be")for(w=f.length-1,S=0;w>=0;w-=3)C=f[w]|f[w-1]<<8|f[w-2]<<16,this.words[S]|=C<<I&67108863,this.words[S+1]=C>>>26-I&67108863,I+=24,I>=26&&(I-=26,S++);else if(y==="le")for(w=0,S=0;w<f.length;w+=3)C=f[w]|f[w+1]<<8|f[w+2]<<16,this.words[S]|=C<<I&67108863,this.words[S+1]=C>>>26-I&67108863,I+=24,I>=26&&(I-=26,S++);return this._strip()};function a(R,f){var m=R.charCodeAt(f);if(m>=48&&m<=57)return m-48;if(m>=65&&m<=70)return m-55;if(m>=97&&m<=102)return m-87;n(!1,"Invalid character in "+R)}function l(R,f,m){var y=a(R,m);return m-1>=f&&(y|=a(R,m-1)<<4),y}s.prototype._parseHex=function(f,m,y){this.length=Math.ceil((f.length-m)/6),this.words=new Array(this.length);for(var w=0;w<this.length;w++)this.words[w]=0;var S=0,C=0,I;if(y==="be")for(w=f.length-1;w>=m;w-=2)I=l(f,m,w)<<S,this.words[C]|=I&67108863,S>=18?(S-=18,C+=1,this.words[C]|=I>>>26):S+=8;else{var A=f.length-m;for(w=A%2===0?m+1:m;w<f.length;w+=2)I=l(f,m,w)<<S,this.words[C]|=I&67108863,S>=18?(S-=18,C+=1,this.words[C]|=I>>>26):S+=8}this._strip()};function c(R,f,m,y){for(var w=0,S=0,C=Math.min(R.length,m),I=f;I<C;I++){var A=R.charCodeAt(I)-48;w*=y,A>=49?S=A-49+10:A>=17?S=A-17+10:S=A,n(A>=0&&S<y,"Invalid character"),w+=S}return w}s.prototype._parseBase=function(f,m,y){this.words=[0],this.length=1;for(var w=0,S=1;S<=67108863;S*=m)w++;w--,S=S/m|0;for(var C=f.length-y,I=C%w,A=Math.min(C,C-I)+y,d=0,E=y;E<A;E+=w)d=c(f,E,E+w,m),this.imuln(S),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(I!==0){var it=1;for(d=c(f,E,f.length,m),E=0;E<I;E++)it*=m;this.imuln(it),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}this._strip()},s.prototype.copy=function(f){f.words=new Array(this.length);for(var m=0;m<this.length;m++)f.words[m]=this.words[m];f.length=this.length,f.negative=this.negative,f.red=this.red};function h(R,f){R.words=f.words,R.length=f.length,R.negative=f.negative,R.red=f.red}if(s.prototype._move=function(f){h(f,this)},s.prototype.clone=function(){var f=new s(null);return this.copy(f),f},s.prototype._expand=function(f){for(;this.length<f;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=u}catch{s.prototype.inspect=u}else s.prototype.inspect=u;function u(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var p=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],x=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],b=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(f,m){f=f||10,m=m|0||1;var y;if(f===16||f==="hex"){y="";for(var w=0,S=0,C=0;C<this.length;C++){var I=this.words[C],A=((I<<w|S)&16777215).toString(16);S=I>>>24-w&16777215,w+=2,w>=26&&(w-=26,C--),S!==0||C!==this.length-1?y=p[6-A.length]+A+y:y=A+y}for(S!==0&&(y=S.toString(16)+y);y.length%m!==0;)y="0"+y;return this.negative!==0&&(y="-"+y),y}if(f===(f|0)&&f>=2&&f<=36){var d=x[f],E=b[f];y="";var it=this.clone();for(it.negative=0;!it.isZero();){var _=it.modrn(E).toString(f);it=it.idivn(E),it.isZero()?y=_+y:y=p[d-_.length]+_+y}for(this.isZero()&&(y="0"+y);y.length%m!==0;)y="0"+y;return this.negative!==0&&(y="-"+y),y}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var f=this.words[0];return this.length===2?f+=this.words[1]*67108864:this.length===3&&this.words[2]===1?f+=4503599627370496+this.words[1]*67108864:this.length>2&&n(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-f:f},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(f,m){return this.toArrayLike(o,f,m)}),s.prototype.toArray=function(f,m){return this.toArrayLike(Array,f,m)};var g=function(f,m){return f.allocUnsafe?f.allocUnsafe(m):new f(m)};s.prototype.toArrayLike=function(f,m,y){this._strip();var w=this.byteLength(),S=y||Math.max(1,w);n(w<=S,"byte array longer than desired length"),n(S>0,"Requested array length <= 0");var C=g(f,S),I=m==="le"?"LE":"BE";return this["_toArrayLike"+I](C,w),C},s.prototype._toArrayLikeLE=function(f,m){for(var y=0,w=0,S=0,C=0;S<this.length;S++){var I=this.words[S]<<C|w;f[y++]=I&255,y<f.length&&(f[y++]=I>>8&255),y<f.length&&(f[y++]=I>>16&255),C===6?(y<f.length&&(f[y++]=I>>24&255),w=0,C=0):(w=I>>>24,C+=2)}if(y<f.length)for(f[y++]=w;y<f.length;)f[y++]=0},s.prototype._toArrayLikeBE=function(f,m){for(var y=f.length-1,w=0,S=0,C=0;S<this.length;S++){var I=this.words[S]<<C|w;f[y--]=I&255,y>=0&&(f[y--]=I>>8&255),y>=0&&(f[y--]=I>>16&255),C===6?(y>=0&&(f[y--]=I>>24&255),w=0,C=0):(w=I>>>24,C+=2)}if(y>=0)for(f[y--]=w;y>=0;)f[y--]=0},Math.clz32?s.prototype._countBits=function(f){return 32-Math.clz32(f)}:s.prototype._countBits=function(f){var m=f,y=0;return m>=4096&&(y+=13,m>>>=13),m>=64&&(y+=7,m>>>=7),m>=8&&(y+=4,m>>>=4),m>=2&&(y+=2,m>>>=2),y+m},s.prototype._zeroBits=function(f){if(f===0)return 26;var m=f,y=0;return(m&8191)===0&&(y+=13,m>>>=13),(m&127)===0&&(y+=7,m>>>=7),(m&15)===0&&(y+=4,m>>>=4),(m&3)===0&&(y+=2,m>>>=2),(m&1)===0&&y++,y},s.prototype.bitLength=function(){var f=this.words[this.length-1],m=this._countBits(f);return(this.length-1)*26+m};function v(R){for(var f=new Array(R.bitLength()),m=0;m<f.length;m++){var y=m/26|0,w=m%26;f[m]=R.words[y]>>>w&1}return f}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var f=0,m=0;m<this.length;m++){var y=this._zeroBits(this.words[m]);if(f+=y,y!==26)break}return f},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(f){return this.negative!==0?this.abs().inotn(f).iaddn(1):this.clone()},s.prototype.fromTwos=function(f){return this.testn(f-1)?this.notn(f).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(f){for(;this.length<f.length;)this.words[this.length++]=0;for(var m=0;m<f.length;m++)this.words[m]=this.words[m]|f.words[m];return this._strip()},s.prototype.ior=function(f){return n((this.negative|f.negative)===0),this.iuor(f)},s.prototype.or=function(f){return this.length>f.length?this.clone().ior(f):f.clone().ior(this)},s.prototype.uor=function(f){return this.length>f.length?this.clone().iuor(f):f.clone().iuor(this)},s.prototype.iuand=function(f){var m;this.length>f.length?m=f:m=this;for(var y=0;y<m.length;y++)this.words[y]=this.words[y]&f.words[y];return this.length=m.length,this._strip()},s.prototype.iand=function(f){return n((this.negative|f.negative)===0),this.iuand(f)},s.prototype.and=function(f){return this.length>f.length?this.clone().iand(f):f.clone().iand(this)},s.prototype.uand=function(f){return this.length>f.length?this.clone().iuand(f):f.clone().iuand(this)},s.prototype.iuxor=function(f){var m,y;this.length>f.length?(m=this,y=f):(m=f,y=this);for(var w=0;w<y.length;w++)this.words[w]=m.words[w]^y.words[w];if(this!==m)for(;w<m.length;w++)this.words[w]=m.words[w];return this.length=m.length,this._strip()},s.prototype.ixor=function(f){return n((this.negative|f.negative)===0),this.iuxor(f)},s.prototype.xor=function(f){return this.length>f.length?this.clone().ixor(f):f.clone().ixor(this)},s.prototype.uxor=function(f){return this.length>f.length?this.clone().iuxor(f):f.clone().iuxor(this)},s.prototype.inotn=function(f){n(typeof f=="number"&&f>=0);var m=Math.ceil(f/26)|0,y=f%26;this._expand(m),y>0&&m--;for(var w=0;w<m;w++)this.words[w]=~this.words[w]&67108863;return y>0&&(this.words[w]=~this.words[w]&67108863>>26-y),this._strip()},s.prototype.notn=function(f){return this.clone().inotn(f)},s.prototype.setn=function(f,m){n(typeof f=="number"&&f>=0);var y=f/26|0,w=f%26;return this._expand(y+1),m?this.words[y]=this.words[y]|1<<w:this.words[y]=this.words[y]&~(1<<w),this._strip()},s.prototype.iadd=function(f){var m;if(this.negative!==0&&f.negative===0)return this.negative=0,m=this.isub(f),this.negative^=1,this._normSign();if(this.negative===0&&f.negative!==0)return f.negative=0,m=this.isub(f),f.negative=1,m._normSign();var y,w;this.length>f.length?(y=this,w=f):(y=f,w=this);for(var S=0,C=0;C<w.length;C++)m=(y.words[C]|0)+(w.words[C]|0)+S,this.words[C]=m&67108863,S=m>>>26;for(;S!==0&&C<y.length;C++)m=(y.words[C]|0)+S,this.words[C]=m&67108863,S=m>>>26;if(this.length=y.length,S!==0)this.words[this.length]=S,this.length++;else if(y!==this)for(;C<y.length;C++)this.words[C]=y.words[C];return this},s.prototype.add=function(f){var m;return f.negative!==0&&this.negative===0?(f.negative=0,m=this.sub(f),f.negative^=1,m):f.negative===0&&this.negative!==0?(this.negative=0,m=f.sub(this),this.negative=1,m):this.length>f.length?this.clone().iadd(f):f.clone().iadd(this)},s.prototype.isub=function(f){if(f.negative!==0){f.negative=0;var m=this.iadd(f);return f.negative=1,m._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(f),this.negative=1,this._normSign();var y=this.cmp(f);if(y===0)return this.negative=0,this.length=1,this.words[0]=0,this;var w,S;y>0?(w=this,S=f):(w=f,S=this);for(var C=0,I=0;I<S.length;I++)m=(w.words[I]|0)-(S.words[I]|0)+C,C=m>>26,this.words[I]=m&67108863;for(;C!==0&&I<w.length;I++)m=(w.words[I]|0)+C,C=m>>26,this.words[I]=m&67108863;if(C===0&&I<w.length&&w!==this)for(;I<w.length;I++)this.words[I]=w.words[I];return this.length=Math.max(this.length,I),w!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(f){return this.clone().isub(f)};function M(R,f,m){m.negative=f.negative^R.negative;var y=R.length+f.length|0;m.length=y,y=y-1|0;var w=R.words[0]|0,S=f.words[0]|0,C=w*S,I=C&67108863,A=C/67108864|0;m.words[0]=I;for(var d=1;d<y;d++){for(var E=A>>>26,it=A&67108863,_=Math.min(d,f.length-1),N=Math.max(0,d-R.length+1);N<=_;N++){var Q=d-N|0;w=R.words[Q]|0,S=f.words[N]|0,C=w*S+it,E+=C/67108864|0,it=C&67108863}m.words[d]=it|0,A=E|0}return A!==0?m.words[d]=A|0:m.length--,m._strip()}var D=function(f,m,y){var w=f.words,S=m.words,C=y.words,I=0,A,d,E,it=w[0]|0,_=it&8191,N=it>>>13,Q=w[1]|0,Y=Q&8191,tt=Q>>>13,et=w[2]|0,lt=et&8191,rt=et>>>13,At=w[3]|0,gt=At&8191,Ct=At>>>13,ve=w[4]|0,qt=ve&8191,Ot=ve>>>13,Yt=w[5]|0,Jt=Yt&8191,Kt=Yt>>>13,F=w[6]|0,T=F&8191,K=F>>>13,ct=w[7]|0,ot=ct&8191,ft=ct>>>13,Ft=w[8]|0,X=Ft&8191,vt=Ft>>>13,Mt=w[9]|0,ut=Mt&8191,k=Mt>>>13,mt=S[0]|0,at=mt&8191,_t=mt>>>13,bt=S[1]|0,wt=bt&8191,st=bt>>>13,Dt=S[2]|0,Pt=Dt&8191,It=Dt>>>13,ue=S[3]|0,jt=ue&8191,se=ue>>>13,ii=S[4]|0,re=ii&8191,ae=ii>>>13,xn=S[5]|0,oe=xn&8191,le=xn>>>13,ri=S[6]|0,ce=ri&8191,P=ri>>>13,W=S[7]|0,q=W&8191,V=W>>>13,nt=S[8]|0,yt=nt&8191,St=nt>>>13,Bt=S[9]|0,Et=Bt&8191,Lt=Bt>>>13;y.negative=f.negative^m.negative,y.length=19,A=Math.imul(_,at),d=Math.imul(_,_t),d=d+Math.imul(N,at)|0,E=Math.imul(N,_t);var zt=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(zt>>>26)|0,zt&=67108863,A=Math.imul(Y,at),d=Math.imul(Y,_t),d=d+Math.imul(tt,at)|0,E=Math.imul(tt,_t),A=A+Math.imul(_,wt)|0,d=d+Math.imul(_,st)|0,d=d+Math.imul(N,wt)|0,E=E+Math.imul(N,st)|0;var Gt=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Gt>>>26)|0,Gt&=67108863,A=Math.imul(lt,at),d=Math.imul(lt,_t),d=d+Math.imul(rt,at)|0,E=Math.imul(rt,_t),A=A+Math.imul(Y,wt)|0,d=d+Math.imul(Y,st)|0,d=d+Math.imul(tt,wt)|0,E=E+Math.imul(tt,st)|0,A=A+Math.imul(_,Pt)|0,d=d+Math.imul(_,It)|0,d=d+Math.imul(N,Pt)|0,E=E+Math.imul(N,It)|0;var ie=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(ie>>>26)|0,ie&=67108863,A=Math.imul(gt,at),d=Math.imul(gt,_t),d=d+Math.imul(Ct,at)|0,E=Math.imul(Ct,_t),A=A+Math.imul(lt,wt)|0,d=d+Math.imul(lt,st)|0,d=d+Math.imul(rt,wt)|0,E=E+Math.imul(rt,st)|0,A=A+Math.imul(Y,Pt)|0,d=d+Math.imul(Y,It)|0,d=d+Math.imul(tt,Pt)|0,E=E+Math.imul(tt,It)|0,A=A+Math.imul(_,jt)|0,d=d+Math.imul(_,se)|0,d=d+Math.imul(N,jt)|0,E=E+Math.imul(N,se)|0;var De=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(De>>>26)|0,De&=67108863,A=Math.imul(qt,at),d=Math.imul(qt,_t),d=d+Math.imul(Ot,at)|0,E=Math.imul(Ot,_t),A=A+Math.imul(gt,wt)|0,d=d+Math.imul(gt,st)|0,d=d+Math.imul(Ct,wt)|0,E=E+Math.imul(Ct,st)|0,A=A+Math.imul(lt,Pt)|0,d=d+Math.imul(lt,It)|0,d=d+Math.imul(rt,Pt)|0,E=E+Math.imul(rt,It)|0,A=A+Math.imul(Y,jt)|0,d=d+Math.imul(Y,se)|0,d=d+Math.imul(tt,jt)|0,E=E+Math.imul(tt,se)|0,A=A+Math.imul(_,re)|0,d=d+Math.imul(_,ae)|0,d=d+Math.imul(N,re)|0,E=E+Math.imul(N,ae)|0;var Ge=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Ge>>>26)|0,Ge&=67108863,A=Math.imul(Jt,at),d=Math.imul(Jt,_t),d=d+Math.imul(Kt,at)|0,E=Math.imul(Kt,_t),A=A+Math.imul(qt,wt)|0,d=d+Math.imul(qt,st)|0,d=d+Math.imul(Ot,wt)|0,E=E+Math.imul(Ot,st)|0,A=A+Math.imul(gt,Pt)|0,d=d+Math.imul(gt,It)|0,d=d+Math.imul(Ct,Pt)|0,E=E+Math.imul(Ct,It)|0,A=A+Math.imul(lt,jt)|0,d=d+Math.imul(lt,se)|0,d=d+Math.imul(rt,jt)|0,E=E+Math.imul(rt,se)|0,A=A+Math.imul(Y,re)|0,d=d+Math.imul(Y,ae)|0,d=d+Math.imul(tt,re)|0,E=E+Math.imul(tt,ae)|0,A=A+Math.imul(_,oe)|0,d=d+Math.imul(_,le)|0,d=d+Math.imul(N,oe)|0,E=E+Math.imul(N,le)|0;var Dn=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Dn>>>26)|0,Dn&=67108863,A=Math.imul(T,at),d=Math.imul(T,_t),d=d+Math.imul(K,at)|0,E=Math.imul(K,_t),A=A+Math.imul(Jt,wt)|0,d=d+Math.imul(Jt,st)|0,d=d+Math.imul(Kt,wt)|0,E=E+Math.imul(Kt,st)|0,A=A+Math.imul(qt,Pt)|0,d=d+Math.imul(qt,It)|0,d=d+Math.imul(Ot,Pt)|0,E=E+Math.imul(Ot,It)|0,A=A+Math.imul(gt,jt)|0,d=d+Math.imul(gt,se)|0,d=d+Math.imul(Ct,jt)|0,E=E+Math.imul(Ct,se)|0,A=A+Math.imul(lt,re)|0,d=d+Math.imul(lt,ae)|0,d=d+Math.imul(rt,re)|0,E=E+Math.imul(rt,ae)|0,A=A+Math.imul(Y,oe)|0,d=d+Math.imul(Y,le)|0,d=d+Math.imul(tt,oe)|0,E=E+Math.imul(tt,le)|0,A=A+Math.imul(_,ce)|0,d=d+Math.imul(_,P)|0,d=d+Math.imul(N,ce)|0,E=E+Math.imul(N,P)|0;var qe=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(qe>>>26)|0,qe&=67108863,A=Math.imul(ot,at),d=Math.imul(ot,_t),d=d+Math.imul(ft,at)|0,E=Math.imul(ft,_t),A=A+Math.imul(T,wt)|0,d=d+Math.imul(T,st)|0,d=d+Math.imul(K,wt)|0,E=E+Math.imul(K,st)|0,A=A+Math.imul(Jt,Pt)|0,d=d+Math.imul(Jt,It)|0,d=d+Math.imul(Kt,Pt)|0,E=E+Math.imul(Kt,It)|0,A=A+Math.imul(qt,jt)|0,d=d+Math.imul(qt,se)|0,d=d+Math.imul(Ot,jt)|0,E=E+Math.imul(Ot,se)|0,A=A+Math.imul(gt,re)|0,d=d+Math.imul(gt,ae)|0,d=d+Math.imul(Ct,re)|0,E=E+Math.imul(Ct,ae)|0,A=A+Math.imul(lt,oe)|0,d=d+Math.imul(lt,le)|0,d=d+Math.imul(rt,oe)|0,E=E+Math.imul(rt,le)|0,A=A+Math.imul(Y,ce)|0,d=d+Math.imul(Y,P)|0,d=d+Math.imul(tt,ce)|0,E=E+Math.imul(tt,P)|0,A=A+Math.imul(_,q)|0,d=d+Math.imul(_,V)|0,d=d+Math.imul(N,q)|0,E=E+Math.imul(N,V)|0;var $t=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+($t>>>26)|0,$t&=67108863,A=Math.imul(X,at),d=Math.imul(X,_t),d=d+Math.imul(vt,at)|0,E=Math.imul(vt,_t),A=A+Math.imul(ot,wt)|0,d=d+Math.imul(ot,st)|0,d=d+Math.imul(ft,wt)|0,E=E+Math.imul(ft,st)|0,A=A+Math.imul(T,Pt)|0,d=d+Math.imul(T,It)|0,d=d+Math.imul(K,Pt)|0,E=E+Math.imul(K,It)|0,A=A+Math.imul(Jt,jt)|0,d=d+Math.imul(Jt,se)|0,d=d+Math.imul(Kt,jt)|0,E=E+Math.imul(Kt,se)|0,A=A+Math.imul(qt,re)|0,d=d+Math.imul(qt,ae)|0,d=d+Math.imul(Ot,re)|0,E=E+Math.imul(Ot,ae)|0,A=A+Math.imul(gt,oe)|0,d=d+Math.imul(gt,le)|0,d=d+Math.imul(Ct,oe)|0,E=E+Math.imul(Ct,le)|0,A=A+Math.imul(lt,ce)|0,d=d+Math.imul(lt,P)|0,d=d+Math.imul(rt,ce)|0,E=E+Math.imul(rt,P)|0,A=A+Math.imul(Y,q)|0,d=d+Math.imul(Y,V)|0,d=d+Math.imul(tt,q)|0,E=E+Math.imul(tt,V)|0,A=A+Math.imul(_,yt)|0,d=d+Math.imul(_,St)|0,d=d+Math.imul(N,yt)|0,E=E+Math.imul(N,St)|0;var Nn=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Nn>>>26)|0,Nn&=67108863,A=Math.imul(ut,at),d=Math.imul(ut,_t),d=d+Math.imul(k,at)|0,E=Math.imul(k,_t),A=A+Math.imul(X,wt)|0,d=d+Math.imul(X,st)|0,d=d+Math.imul(vt,wt)|0,E=E+Math.imul(vt,st)|0,A=A+Math.imul(ot,Pt)|0,d=d+Math.imul(ot,It)|0,d=d+Math.imul(ft,Pt)|0,E=E+Math.imul(ft,It)|0,A=A+Math.imul(T,jt)|0,d=d+Math.imul(T,se)|0,d=d+Math.imul(K,jt)|0,E=E+Math.imul(K,se)|0,A=A+Math.imul(Jt,re)|0,d=d+Math.imul(Jt,ae)|0,d=d+Math.imul(Kt,re)|0,E=E+Math.imul(Kt,ae)|0,A=A+Math.imul(qt,oe)|0,d=d+Math.imul(qt,le)|0,d=d+Math.imul(Ot,oe)|0,E=E+Math.imul(Ot,le)|0,A=A+Math.imul(gt,ce)|0,d=d+Math.imul(gt,P)|0,d=d+Math.imul(Ct,ce)|0,E=E+Math.imul(Ct,P)|0,A=A+Math.imul(lt,q)|0,d=d+Math.imul(lt,V)|0,d=d+Math.imul(rt,q)|0,E=E+Math.imul(rt,V)|0,A=A+Math.imul(Y,yt)|0,d=d+Math.imul(Y,St)|0,d=d+Math.imul(tt,yt)|0,E=E+Math.imul(tt,St)|0,A=A+Math.imul(_,Et)|0,d=d+Math.imul(_,Lt)|0,d=d+Math.imul(N,Et)|0,E=E+Math.imul(N,Lt)|0;var fe=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(fe>>>26)|0,fe&=67108863,A=Math.imul(ut,wt),d=Math.imul(ut,st),d=d+Math.imul(k,wt)|0,E=Math.imul(k,st),A=A+Math.imul(X,Pt)|0,d=d+Math.imul(X,It)|0,d=d+Math.imul(vt,Pt)|0,E=E+Math.imul(vt,It)|0,A=A+Math.imul(ot,jt)|0,d=d+Math.imul(ot,se)|0,d=d+Math.imul(ft,jt)|0,E=E+Math.imul(ft,se)|0,A=A+Math.imul(T,re)|0,d=d+Math.imul(T,ae)|0,d=d+Math.imul(K,re)|0,E=E+Math.imul(K,ae)|0,A=A+Math.imul(Jt,oe)|0,d=d+Math.imul(Jt,le)|0,d=d+Math.imul(Kt,oe)|0,E=E+Math.imul(Kt,le)|0,A=A+Math.imul(qt,ce)|0,d=d+Math.imul(qt,P)|0,d=d+Math.imul(Ot,ce)|0,E=E+Math.imul(Ot,P)|0,A=A+Math.imul(gt,q)|0,d=d+Math.imul(gt,V)|0,d=d+Math.imul(Ct,q)|0,E=E+Math.imul(Ct,V)|0,A=A+Math.imul(lt,yt)|0,d=d+Math.imul(lt,St)|0,d=d+Math.imul(rt,yt)|0,E=E+Math.imul(rt,St)|0,A=A+Math.imul(Y,Et)|0,d=d+Math.imul(Y,Lt)|0,d=d+Math.imul(tt,Et)|0,E=E+Math.imul(tt,Lt)|0;var je=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(je>>>26)|0,je&=67108863,A=Math.imul(ut,Pt),d=Math.imul(ut,It),d=d+Math.imul(k,Pt)|0,E=Math.imul(k,It),A=A+Math.imul(X,jt)|0,d=d+Math.imul(X,se)|0,d=d+Math.imul(vt,jt)|0,E=E+Math.imul(vt,se)|0,A=A+Math.imul(ot,re)|0,d=d+Math.imul(ot,ae)|0,d=d+Math.imul(ft,re)|0,E=E+Math.imul(ft,ae)|0,A=A+Math.imul(T,oe)|0,d=d+Math.imul(T,le)|0,d=d+Math.imul(K,oe)|0,E=E+Math.imul(K,le)|0,A=A+Math.imul(Jt,ce)|0,d=d+Math.imul(Jt,P)|0,d=d+Math.imul(Kt,ce)|0,E=E+Math.imul(Kt,P)|0,A=A+Math.imul(qt,q)|0,d=d+Math.imul(qt,V)|0,d=d+Math.imul(Ot,q)|0,E=E+Math.imul(Ot,V)|0,A=A+Math.imul(gt,yt)|0,d=d+Math.imul(gt,St)|0,d=d+Math.imul(Ct,yt)|0,E=E+Math.imul(Ct,St)|0,A=A+Math.imul(lt,Et)|0,d=d+Math.imul(lt,Lt)|0,d=d+Math.imul(rt,Et)|0,E=E+Math.imul(rt,Lt)|0;var ln=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(ln>>>26)|0,ln&=67108863,A=Math.imul(ut,jt),d=Math.imul(ut,se),d=d+Math.imul(k,jt)|0,E=Math.imul(k,se),A=A+Math.imul(X,re)|0,d=d+Math.imul(X,ae)|0,d=d+Math.imul(vt,re)|0,E=E+Math.imul(vt,ae)|0,A=A+Math.imul(ot,oe)|0,d=d+Math.imul(ot,le)|0,d=d+Math.imul(ft,oe)|0,E=E+Math.imul(ft,le)|0,A=A+Math.imul(T,ce)|0,d=d+Math.imul(T,P)|0,d=d+Math.imul(K,ce)|0,E=E+Math.imul(K,P)|0,A=A+Math.imul(Jt,q)|0,d=d+Math.imul(Jt,V)|0,d=d+Math.imul(Kt,q)|0,E=E+Math.imul(Kt,V)|0,A=A+Math.imul(qt,yt)|0,d=d+Math.imul(qt,St)|0,d=d+Math.imul(Ot,yt)|0,E=E+Math.imul(Ot,St)|0,A=A+Math.imul(gt,Et)|0,d=d+Math.imul(gt,Lt)|0,d=d+Math.imul(Ct,Et)|0,E=E+Math.imul(Ct,Lt)|0;var si=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(si>>>26)|0,si&=67108863,A=Math.imul(ut,re),d=Math.imul(ut,ae),d=d+Math.imul(k,re)|0,E=Math.imul(k,ae),A=A+Math.imul(X,oe)|0,d=d+Math.imul(X,le)|0,d=d+Math.imul(vt,oe)|0,E=E+Math.imul(vt,le)|0,A=A+Math.imul(ot,ce)|0,d=d+Math.imul(ot,P)|0,d=d+Math.imul(ft,ce)|0,E=E+Math.imul(ft,P)|0,A=A+Math.imul(T,q)|0,d=d+Math.imul(T,V)|0,d=d+Math.imul(K,q)|0,E=E+Math.imul(K,V)|0,A=A+Math.imul(Jt,yt)|0,d=d+Math.imul(Jt,St)|0,d=d+Math.imul(Kt,yt)|0,E=E+Math.imul(Kt,St)|0,A=A+Math.imul(qt,Et)|0,d=d+Math.imul(qt,Lt)|0,d=d+Math.imul(Ot,Et)|0,E=E+Math.imul(Ot,Lt)|0;var Vi=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Vi>>>26)|0,Vi&=67108863,A=Math.imul(ut,oe),d=Math.imul(ut,le),d=d+Math.imul(k,oe)|0,E=Math.imul(k,le),A=A+Math.imul(X,ce)|0,d=d+Math.imul(X,P)|0,d=d+Math.imul(vt,ce)|0,E=E+Math.imul(vt,P)|0,A=A+Math.imul(ot,q)|0,d=d+Math.imul(ot,V)|0,d=d+Math.imul(ft,q)|0,E=E+Math.imul(ft,V)|0,A=A+Math.imul(T,yt)|0,d=d+Math.imul(T,St)|0,d=d+Math.imul(K,yt)|0,E=E+Math.imul(K,St)|0,A=A+Math.imul(Jt,Et)|0,d=d+Math.imul(Jt,Lt)|0,d=d+Math.imul(Kt,Et)|0,E=E+Math.imul(Kt,Lt)|0;var be=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(be>>>26)|0,be&=67108863,A=Math.imul(ut,ce),d=Math.imul(ut,P),d=d+Math.imul(k,ce)|0,E=Math.imul(k,P),A=A+Math.imul(X,q)|0,d=d+Math.imul(X,V)|0,d=d+Math.imul(vt,q)|0,E=E+Math.imul(vt,V)|0,A=A+Math.imul(ot,yt)|0,d=d+Math.imul(ot,St)|0,d=d+Math.imul(ft,yt)|0,E=E+Math.imul(ft,St)|0,A=A+Math.imul(T,Et)|0,d=d+Math.imul(T,Lt)|0,d=d+Math.imul(K,Et)|0,E=E+Math.imul(K,Lt)|0;var oi=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(oi>>>26)|0,oi&=67108863,A=Math.imul(ut,q),d=Math.imul(ut,V),d=d+Math.imul(k,q)|0,E=Math.imul(k,V),A=A+Math.imul(X,yt)|0,d=d+Math.imul(X,St)|0,d=d+Math.imul(vt,yt)|0,E=E+Math.imul(vt,St)|0,A=A+Math.imul(ot,Et)|0,d=d+Math.imul(ot,Lt)|0,d=d+Math.imul(ft,Et)|0,E=E+Math.imul(ft,Lt)|0;var Hi=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Hi>>>26)|0,Hi&=67108863,A=Math.imul(ut,yt),d=Math.imul(ut,St),d=d+Math.imul(k,yt)|0,E=Math.imul(k,St),A=A+Math.imul(X,Et)|0,d=d+Math.imul(X,Lt)|0,d=d+Math.imul(vt,Et)|0,E=E+Math.imul(vt,Lt)|0;var Xe=(I+A|0)+((d&8191)<<13)|0;I=(E+(d>>>13)|0)+(Xe>>>26)|0,Xe&=67108863,A=Math.imul(ut,Et),d=Math.imul(ut,Lt),d=d+Math.imul(k,Et)|0,E=Math.imul(k,Lt);var Ko=(I+A|0)+((d&8191)<<13)|0;return I=(E+(d>>>13)|0)+(Ko>>>26)|0,Ko&=67108863,C[0]=zt,C[1]=Gt,C[2]=ie,C[3]=De,C[4]=Ge,C[5]=Dn,C[6]=qe,C[7]=$t,C[8]=Nn,C[9]=fe,C[10]=je,C[11]=ln,C[12]=si,C[13]=Vi,C[14]=be,C[15]=oi,C[16]=Hi,C[17]=Xe,C[18]=Ko,I!==0&&(C[19]=I,y.length++),y};Math.imul||(D=M);function z(R,f,m){m.negative=f.negative^R.negative,m.length=R.length+f.length;for(var y=0,w=0,S=0;S<m.length-1;S++){var C=w;w=0;for(var I=y&67108863,A=Math.min(S,f.length-1),d=Math.max(0,S-R.length+1);d<=A;d++){var E=S-d,it=R.words[E]|0,_=f.words[d]|0,N=it*_,Q=N&67108863;C=C+(N/67108864|0)|0,Q=Q+I|0,I=Q&67108863,C=C+(Q>>>26)|0,w+=C>>>26,C&=67108863}m.words[S]=I,y=C,C=w}return y!==0?m.words[S]=y:m.length--,m._strip()}function B(R,f,m){return z(R,f,m)}s.prototype.mulTo=function(f,m){var y,w=this.length+f.length;return this.length===10&&f.length===10?y=D(this,f,m):w<63?y=M(this,f,m):w<1024?y=z(this,f,m):y=B(this,f,m),y},s.prototype.mul=function(f){var m=new s(null);return m.words=new Array(this.length+f.length),this.mulTo(f,m)},s.prototype.mulf=function(f){var m=new s(null);return m.words=new Array(this.length+f.length),B(this,f,m)},s.prototype.imul=function(f){return this.clone().mulTo(f,this)},s.prototype.imuln=function(f){var m=f<0;m&&(f=-f),n(typeof f=="number"),n(f<67108864);for(var y=0,w=0;w<this.length;w++){var S=(this.words[w]|0)*f,C=(S&67108863)+(y&67108863);y>>=26,y+=S/67108864|0,y+=C>>>26,this.words[w]=C&67108863}return y!==0&&(this.words[w]=y,this.length++),m?this.ineg():this},s.prototype.muln=function(f){return this.clone().imuln(f)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(f){var m=v(f);if(m.length===0)return new s(1);for(var y=this,w=0;w<m.length&&m[w]===0;w++,y=y.sqr());if(++w<m.length)for(var S=y.sqr();w<m.length;w++,S=S.sqr())m[w]!==0&&(y=y.mul(S));return y},s.prototype.iushln=function(f){n(typeof f=="number"&&f>=0);var m=f%26,y=(f-m)/26,w=67108863>>>26-m<<26-m,S;if(m!==0){var C=0;for(S=0;S<this.length;S++){var I=this.words[S]&w,A=(this.words[S]|0)-I<<m;this.words[S]=A|C,C=I>>>26-m}C&&(this.words[S]=C,this.length++)}if(y!==0){for(S=this.length-1;S>=0;S--)this.words[S+y]=this.words[S];for(S=0;S<y;S++)this.words[S]=0;this.length+=y}return this._strip()},s.prototype.ishln=function(f){return n(this.negative===0),this.iushln(f)},s.prototype.iushrn=function(f,m,y){n(typeof f=="number"&&f>=0);var w;m?w=(m-m%26)/26:w=0;var S=f%26,C=Math.min((f-S)/26,this.length),I=67108863^67108863>>>S<<S,A=y;if(w-=C,w=Math.max(0,w),A){for(var d=0;d<C;d++)A.words[d]=this.words[d];A.length=C}if(C!==0)if(this.length>C)for(this.length-=C,d=0;d<this.length;d++)this.words[d]=this.words[d+C];else this.words[0]=0,this.length=1;var E=0;for(d=this.length-1;d>=0&&(E!==0||d>=w);d--){var it=this.words[d]|0;this.words[d]=E<<26-S|it>>>S,E=it&I}return A&&E!==0&&(A.words[A.length++]=E),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(f,m,y){return n(this.negative===0),this.iushrn(f,m,y)},s.prototype.shln=function(f){return this.clone().ishln(f)},s.prototype.ushln=function(f){return this.clone().iushln(f)},s.prototype.shrn=function(f){return this.clone().ishrn(f)},s.prototype.ushrn=function(f){return this.clone().iushrn(f)},s.prototype.testn=function(f){n(typeof f=="number"&&f>=0);var m=f%26,y=(f-m)/26,w=1<<m;if(this.length<=y)return!1;var S=this.words[y];return!!(S&w)},s.prototype.imaskn=function(f){n(typeof f=="number"&&f>=0);var m=f%26,y=(f-m)/26;if(n(this.negative===0,"imaskn works only with positive numbers"),this.length<=y)return this;if(m!==0&&y++,this.length=Math.min(y,this.length),m!==0){var w=67108863^67108863>>>m<<m;this.words[this.length-1]&=w}return this._strip()},s.prototype.maskn=function(f){return this.clone().imaskn(f)},s.prototype.iaddn=function(f){return n(typeof f=="number"),n(f<67108864),f<0?this.isubn(-f):this.negative!==0?this.length===1&&(this.words[0]|0)<=f?(this.words[0]=f-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(f),this.negative=1,this):this._iaddn(f)},s.prototype._iaddn=function(f){this.words[0]+=f;for(var m=0;m<this.length&&this.words[m]>=67108864;m++)this.words[m]-=67108864,m===this.length-1?this.words[m+1]=1:this.words[m+1]++;return this.length=Math.max(this.length,m+1),this},s.prototype.isubn=function(f){if(n(typeof f=="number"),n(f<67108864),f<0)return this.iaddn(-f);if(this.negative!==0)return this.negative=0,this.iaddn(f),this.negative=1,this;if(this.words[0]-=f,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var m=0;m<this.length&&this.words[m]<0;m++)this.words[m]+=67108864,this.words[m+1]-=1;return this._strip()},s.prototype.addn=function(f){return this.clone().iaddn(f)},s.prototype.subn=function(f){return this.clone().isubn(f)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(f,m,y){var w=f.length+y,S;this._expand(w);var C,I=0;for(S=0;S<f.length;S++){C=(this.words[S+y]|0)+I;var A=(f.words[S]|0)*m;C-=A&67108863,I=(C>>26)-(A/67108864|0),this.words[S+y]=C&67108863}for(;S<this.length-y;S++)C=(this.words[S+y]|0)+I,I=C>>26,this.words[S+y]=C&67108863;if(I===0)return this._strip();for(n(I===-1),I=0,S=0;S<this.length;S++)C=-(this.words[S]|0)+I,I=C>>26,this.words[S]=C&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(f,m){var y=this.length-f.length,w=this.clone(),S=f,C=S.words[S.length-1]|0,I=this._countBits(C);y=26-I,y!==0&&(S=S.ushln(y),w.iushln(y),C=S.words[S.length-1]|0);var A=w.length-S.length,d;if(m!=="mod"){d=new s(null),d.length=A+1,d.words=new Array(d.length);for(var E=0;E<d.length;E++)d.words[E]=0}var it=w.clone()._ishlnsubmul(S,1,A);it.negative===0&&(w=it,d&&(d.words[A]=1));for(var _=A-1;_>=0;_--){var N=(w.words[S.length+_]|0)*67108864+(w.words[S.length+_-1]|0);for(N=Math.min(N/C|0,67108863),w._ishlnsubmul(S,N,_);w.negative!==0;)N--,w.negative=0,w._ishlnsubmul(S,1,_),w.isZero()||(w.negative^=1);d&&(d.words[_]=N)}return d&&d._strip(),w._strip(),m!=="div"&&y!==0&&w.iushrn(y),{div:d||null,mod:w}},s.prototype.divmod=function(f,m,y){if(n(!f.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var w,S,C;return this.negative!==0&&f.negative===0?(C=this.neg().divmod(f,m),m!=="mod"&&(w=C.div.neg()),m!=="div"&&(S=C.mod.neg(),y&&S.negative!==0&&S.iadd(f)),{div:w,mod:S}):this.negative===0&&f.negative!==0?(C=this.divmod(f.neg(),m),m!=="mod"&&(w=C.div.neg()),{div:w,mod:C.mod}):(this.negative&f.negative)!==0?(C=this.neg().divmod(f.neg(),m),m!=="div"&&(S=C.mod.neg(),y&&S.negative!==0&&S.isub(f)),{div:C.div,mod:S}):f.length>this.length||this.cmp(f)<0?{div:new s(0),mod:this}:f.length===1?m==="div"?{div:this.divn(f.words[0]),mod:null}:m==="mod"?{div:null,mod:new s(this.modrn(f.words[0]))}:{div:this.divn(f.words[0]),mod:new s(this.modrn(f.words[0]))}:this._wordDiv(f,m)},s.prototype.div=function(f){return this.divmod(f,"div",!1).div},s.prototype.mod=function(f){return this.divmod(f,"mod",!1).mod},s.prototype.umod=function(f){return this.divmod(f,"mod",!0).mod},s.prototype.divRound=function(f){var m=this.divmod(f);if(m.mod.isZero())return m.div;var y=m.div.negative!==0?m.mod.isub(f):m.mod,w=f.ushrn(1),S=f.andln(1),C=y.cmp(w);return C<0||S===1&&C===0?m.div:m.div.negative!==0?m.div.isubn(1):m.div.iaddn(1)},s.prototype.modrn=function(f){var m=f<0;m&&(f=-f),n(f<=67108863);for(var y=(1<<26)%f,w=0,S=this.length-1;S>=0;S--)w=(y*w+(this.words[S]|0))%f;return m?-w:w},s.prototype.modn=function(f){return this.modrn(f)},s.prototype.idivn=function(f){var m=f<0;m&&(f=-f),n(f<=67108863);for(var y=0,w=this.length-1;w>=0;w--){var S=(this.words[w]|0)+y*67108864;this.words[w]=S/f|0,y=S%f}return this._strip(),m?this.ineg():this},s.prototype.divn=function(f){return this.clone().idivn(f)},s.prototype.egcd=function(f){n(f.negative===0),n(!f.isZero());var m=this,y=f.clone();m.negative!==0?m=m.umod(f):m=m.clone();for(var w=new s(1),S=new s(0),C=new s(0),I=new s(1),A=0;m.isEven()&&y.isEven();)m.iushrn(1),y.iushrn(1),++A;for(var d=y.clone(),E=m.clone();!m.isZero();){for(var it=0,_=1;(m.words[0]&_)===0&&it<26;++it,_<<=1);if(it>0)for(m.iushrn(it);it-- >0;)(w.isOdd()||S.isOdd())&&(w.iadd(d),S.isub(E)),w.iushrn(1),S.iushrn(1);for(var N=0,Q=1;(y.words[0]&Q)===0&&N<26;++N,Q<<=1);if(N>0)for(y.iushrn(N);N-- >0;)(C.isOdd()||I.isOdd())&&(C.iadd(d),I.isub(E)),C.iushrn(1),I.iushrn(1);m.cmp(y)>=0?(m.isub(y),w.isub(C),S.isub(I)):(y.isub(m),C.isub(w),I.isub(S))}return{a:C,b:I,gcd:y.iushln(A)}},s.prototype._invmp=function(f){n(f.negative===0),n(!f.isZero());var m=this,y=f.clone();m.negative!==0?m=m.umod(f):m=m.clone();for(var w=new s(1),S=new s(0),C=y.clone();m.cmpn(1)>0&&y.cmpn(1)>0;){for(var I=0,A=1;(m.words[0]&A)===0&&I<26;++I,A<<=1);if(I>0)for(m.iushrn(I);I-- >0;)w.isOdd()&&w.iadd(C),w.iushrn(1);for(var d=0,E=1;(y.words[0]&E)===0&&d<26;++d,E<<=1);if(d>0)for(y.iushrn(d);d-- >0;)S.isOdd()&&S.iadd(C),S.iushrn(1);m.cmp(y)>=0?(m.isub(y),w.isub(S)):(y.isub(m),S.isub(w))}var it;return m.cmpn(1)===0?it=w:it=S,it.cmpn(0)<0&&it.iadd(f),it},s.prototype.gcd=function(f){if(this.isZero())return f.abs();if(f.isZero())return this.abs();var m=this.clone(),y=f.clone();m.negative=0,y.negative=0;for(var w=0;m.isEven()&&y.isEven();w++)m.iushrn(1),y.iushrn(1);do{for(;m.isEven();)m.iushrn(1);for(;y.isEven();)y.iushrn(1);var S=m.cmp(y);if(S<0){var C=m;m=y,y=C}else if(S===0||y.cmpn(1)===0)break;m.isub(y)}while(!0);return y.iushln(w)},s.prototype.invm=function(f){return this.egcd(f).a.umod(f)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(f){return this.words[0]&f},s.prototype.bincn=function(f){n(typeof f=="number");var m=f%26,y=(f-m)/26,w=1<<m;if(this.length<=y)return this._expand(y+1),this.words[y]|=w,this;for(var S=w,C=y;S!==0&&C<this.length;C++){var I=this.words[C]|0;I+=S,S=I>>>26,I&=67108863,this.words[C]=I}return S!==0&&(this.words[C]=S,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(f){var m=f<0;if(this.negative!==0&&!m)return-1;if(this.negative===0&&m)return 1;this._strip();var y;if(this.length>1)y=1;else{m&&(f=-f),n(f<=67108863,"Number is too big");var w=this.words[0]|0;y=w===f?0:w<f?-1:1}return this.negative!==0?-y|0:y},s.prototype.cmp=function(f){if(this.negative!==0&&f.negative===0)return-1;if(this.negative===0&&f.negative!==0)return 1;var m=this.ucmp(f);return this.negative!==0?-m|0:m},s.prototype.ucmp=function(f){if(this.length>f.length)return 1;if(this.length<f.length)return-1;for(var m=0,y=this.length-1;y>=0;y--){var w=this.words[y]|0,S=f.words[y]|0;if(w!==S){w<S?m=-1:w>S&&(m=1);break}}return m},s.prototype.gtn=function(f){return this.cmpn(f)===1},s.prototype.gt=function(f){return this.cmp(f)===1},s.prototype.gten=function(f){return this.cmpn(f)>=0},s.prototype.gte=function(f){return this.cmp(f)>=0},s.prototype.ltn=function(f){return this.cmpn(f)===-1},s.prototype.lt=function(f){return this.cmp(f)===-1},s.prototype.lten=function(f){return this.cmpn(f)<=0},s.prototype.lte=function(f){return this.cmp(f)<=0},s.prototype.eqn=function(f){return this.cmpn(f)===0},s.prototype.eq=function(f){return this.cmp(f)===0},s.red=function(f){return new j(f)},s.prototype.toRed=function(f){return n(!this.red,"Already a number in reduction context"),n(this.negative===0,"red works only with positives"),f.convertTo(this)._forceRed(f)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(f){return this.red=f,this},s.prototype.forceRed=function(f){return n(!this.red,"Already a number in reduction context"),this._forceRed(f)},s.prototype.redAdd=function(f){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,f)},s.prototype.redIAdd=function(f){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,f)},s.prototype.redSub=function(f){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,f)},s.prototype.redISub=function(f){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,f)},s.prototype.redShl=function(f){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,f)},s.prototype.redMul=function(f){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,f),this.red.mul(this,f)},s.prototype.redIMul=function(f){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,f),this.red.imul(this,f)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(f){return n(this.red&&!f.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,f)};var O={k256:null,p224:null,p192:null,p25519:null};function G(R,f){this.name=R,this.p=new s(f,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}G.prototype._tmp=function(){var f=new s(null);return f.words=new Array(Math.ceil(this.n/13)),f},G.prototype.ireduce=function(f){var m=f,y;do this.split(m,this.tmp),m=this.imulK(m),m=m.iadd(this.tmp),y=m.bitLength();while(y>this.n);var w=y<this.n?-1:m.ucmp(this.p);return w===0?(m.words[0]=0,m.length=1):w>0?m.isub(this.p):m.strip!==void 0?m.strip():m._strip(),m},G.prototype.split=function(f,m){f.iushrn(this.n,0,m)},G.prototype.imulK=function(f){return f.imul(this.k)};function Z(){G.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}r(Z,G),Z.prototype.split=function(f,m){for(var y=4194303,w=Math.min(f.length,9),S=0;S<w;S++)m.words[S]=f.words[S];if(m.length=w,f.length<=9){f.words[0]=0,f.length=1;return}var C=f.words[9];for(m.words[m.length++]=C&y,S=10;S<f.length;S++){var I=f.words[S]|0;f.words[S-10]=(I&y)<<4|C>>>22,C=I}C>>>=22,f.words[S-10]=C,C===0&&f.length>10?f.length-=10:f.length-=9},Z.prototype.imulK=function(f){f.words[f.length]=0,f.words[f.length+1]=0,f.length+=2;for(var m=0,y=0;y<f.length;y++){var w=f.words[y]|0;m+=w*977,f.words[y]=m&67108863,m=w*64+(m/67108864|0)}return f.words[f.length-1]===0&&(f.length--,f.words[f.length-1]===0&&f.length--),f};function L(){G.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}r(L,G);function U(){G.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}r(U,G);function $(){G.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}r($,G),$.prototype.imulK=function(f){for(var m=0,y=0;y<f.length;y++){var w=(f.words[y]|0)*19+m,S=w&67108863;w>>>=26,f.words[y]=S,m=w}return m!==0&&(f.words[f.length++]=m),f},s._prime=function(f){if(O[f])return O[f];var m;if(f==="k256")m=new Z;else if(f==="p224")m=new L;else if(f==="p192")m=new U;else if(f==="p25519")m=new $;else throw new Error("Unknown prime "+f);return O[f]=m,m};function j(R){if(typeof R=="string"){var f=s._prime(R);this.m=f.p,this.prime=f}else n(R.gtn(1),"modulus must be greater than 1"),this.m=R,this.prime=null}j.prototype._verify1=function(f){n(f.negative===0,"red works only with positives"),n(f.red,"red works only with red numbers")},j.prototype._verify2=function(f,m){n((f.negative|m.negative)===0,"red works only with positives"),n(f.red&&f.red===m.red,"red works only with red numbers")},j.prototype.imod=function(f){return this.prime?this.prime.ireduce(f)._forceRed(this):(h(f,f.umod(this.m)._forceRed(this)),f)},j.prototype.neg=function(f){return f.isZero()?f.clone():this.m.sub(f)._forceRed(this)},j.prototype.add=function(f,m){this._verify2(f,m);var y=f.add(m);return y.cmp(this.m)>=0&&y.isub(this.m),y._forceRed(this)},j.prototype.iadd=function(f,m){this._verify2(f,m);var y=f.iadd(m);return y.cmp(this.m)>=0&&y.isub(this.m),y},j.prototype.sub=function(f,m){this._verify2(f,m);var y=f.sub(m);return y.cmpn(0)<0&&y.iadd(this.m),y._forceRed(this)},j.prototype.isub=function(f,m){this._verify2(f,m);var y=f.isub(m);return y.cmpn(0)<0&&y.iadd(this.m),y},j.prototype.shl=function(f,m){return this._verify1(f),this.imod(f.ushln(m))},j.prototype.imul=function(f,m){return this._verify2(f,m),this.imod(f.imul(m))},j.prototype.mul=function(f,m){return this._verify2(f,m),this.imod(f.mul(m))},j.prototype.isqr=function(f){return this.imul(f,f.clone())},j.prototype.sqr=function(f){return this.mul(f,f)},j.prototype.sqrt=function(f){if(f.isZero())return f.clone();var m=this.m.andln(3);if(n(m%2===1),m===3){var y=this.m.add(new s(1)).iushrn(2);return this.pow(f,y)}for(var w=this.m.subn(1),S=0;!w.isZero()&&w.andln(1)===0;)S++,w.iushrn(1);n(!w.isZero());var C=new s(1).toRed(this),I=C.redNeg(),A=this.m.subn(1).iushrn(1),d=this.m.bitLength();for(d=new s(2*d*d).toRed(this);this.pow(d,A).cmp(I)!==0;)d.redIAdd(I);for(var E=this.pow(d,w),it=this.pow(f,w.addn(1).iushrn(1)),_=this.pow(f,w),N=S;_.cmp(C)!==0;){for(var Q=_,Y=0;Q.cmp(C)!==0;Y++)Q=Q.redSqr();n(Y<N);var tt=this.pow(E,new s(1).iushln(N-Y-1));it=it.redMul(tt),E=tt.redSqr(),_=_.redMul(E),N=Y}return it},j.prototype.invm=function(f){var m=f._invmp(this.m);return m.negative!==0?(m.negative=0,this.imod(m).redNeg()):this.imod(m)},j.prototype.pow=function(f,m){if(m.isZero())return new s(1).toRed(this);if(m.cmpn(1)===0)return f.clone();var y=4,w=new Array(1<<y);w[0]=new s(1).toRed(this),w[1]=f;for(var S=2;S<w.length;S++)w[S]=this.mul(w[S-1],f);var C=w[0],I=0,A=0,d=m.bitLength()%26;for(d===0&&(d=26),S=m.length-1;S>=0;S--){for(var E=m.words[S],it=d-1;it>=0;it--){var _=E>>it&1;if(C!==w[0]&&(C=this.sqr(C)),_===0&&I===0){A=0;continue}I<<=1,I|=_,A++,!(A!==y&&(S!==0||it!==0))&&(C=this.mul(C,w[I]),A=0,I=0)}d=26}return C},j.prototype.convertTo=function(f){var m=f.umod(this.m);return m===f?m.clone():m},j.prototype.convertFrom=function(f){var m=f.clone();return m.red=null,m},s.mont=function(f){return new ht(f)};function ht(R){j.call(this,R),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}r(ht,j),ht.prototype.convertTo=function(f){return this.imod(f.ushln(this.shift))},ht.prototype.convertFrom=function(f){var m=this.imod(f.mul(this.rinv));return m.red=null,m},ht.prototype.imul=function(f,m){if(f.isZero()||m.isZero())return f.words[0]=0,f.length=1,f;var y=f.imul(m),w=y.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),S=y.isub(w).iushrn(this.shift),C=S;return S.cmp(this.m)>=0?C=S.isub(this.m):S.cmpn(0)<0&&(C=S.iadd(this.m)),C._forceRed(this)},ht.prototype.mul=function(f,m){if(f.isZero()||m.isZero())return new s(0)._forceRed(this);var y=f.mul(m),w=y.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),S=y.isub(w).iushrn(this.shift),C=S;return S.cmp(this.m)>=0?C=S.isub(this.m):S.cmpn(0)<0&&(C=S.iadd(this.m)),C._forceRed(this)},ht.prototype.invm=function(f){var m=this.imod(f._invmp(this.m).mul(this.r2));return m._forceRed(this)}})(i,Ch)})(Rh);var Ut=Rh.exports;const lx="logger/5.6.0";let $c=!1,tf=!1;const _o={debug:1,default:2,info:2,warning:3,error:4,off:5};let ef=_o.default,Ia=null;function cx(){try{const i=[];if(["NFD","NFC","NFKD","NFKC"].forEach(t=>{try{if("test".normalize(t)!=="test")throw new Error("bad normalize")}catch{i.push(t)}}),i.length)throw new Error("missing "+i.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(i){return i.message}return null}const nf=cx();var nl;(function(i){i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF"})(nl||(nl={}));var En;(function(i){i.UNKNOWN_ERROR="UNKNOWN_ERROR",i.NOT_IMPLEMENTED="NOT_IMPLEMENTED",i.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",i.NETWORK_ERROR="NETWORK_ERROR",i.SERVER_ERROR="SERVER_ERROR",i.TIMEOUT="TIMEOUT",i.BUFFER_OVERRUN="BUFFER_OVERRUN",i.NUMERIC_FAULT="NUMERIC_FAULT",i.MISSING_NEW="MISSING_NEW",i.INVALID_ARGUMENT="INVALID_ARGUMENT",i.MISSING_ARGUMENT="MISSING_ARGUMENT",i.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",i.CALL_EXCEPTION="CALL_EXCEPTION",i.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",i.NONCE_EXPIRED="NONCE_EXPIRED",i.REPLACEMENT_UNDERPRICED="REPLACEMENT_UNDERPRICED",i.UNPREDICTABLE_GAS_LIMIT="UNPREDICTABLE_GAS_LIMIT",i.TRANSACTION_REPLACED="TRANSACTION_REPLACED"})(En||(En={}));const rf="0123456789abcdef";class H{constructor(t){Object.defineProperty(this,"version",{enumerable:!0,value:t,writable:!1})}_log(t,e){const n=t.toLowerCase();_o[n]==null&&this.throwArgumentError("invalid log level name","logLevel",t),!(ef>_o[n])&&console.log.apply(console,e)}debug(...t){this._log(H.levels.DEBUG,t)}info(...t){this._log(H.levels.INFO,t)}warn(...t){this._log(H.levels.WARNING,t)}makeError(t,e,n){if(tf)return this.makeError("censored error",e,{});e||(e=H.errors.UNKNOWN_ERROR),n||(n={});const r=[];Object.keys(n).forEach(l=>{const c=n[l];try{if(c instanceof Uint8Array){let h="";for(let u=0;u<c.length;u++)h+=rf[c[u]>>4],h+=rf[c[u]&15];r.push(l+"=Uint8Array(0x"+h+")")}else r.push(l+"="+JSON.stringify(c))}catch{r.push(l+"="+JSON.stringify(n[l].toString()))}}),r.push(`code=${e}`),r.push(`version=${this.version}`);const s=t;let o="";switch(e){case En.NUMERIC_FAULT:{o="NUMERIC_FAULT";const l=t;switch(l){case"overflow":case"underflow":case"division-by-zero":o+="-"+l;break;case"negative-power":case"negative-width":o+="-unsupported";break;case"unbound-bitwise-result":o+="-unbound-result";break}break}case En.CALL_EXCEPTION:case En.INSUFFICIENT_FUNDS:case En.MISSING_NEW:case En.NONCE_EXPIRED:case En.REPLACEMENT_UNDERPRICED:case En.TRANSACTION_REPLACED:case En.UNPREDICTABLE_GAS_LIMIT:o=e;break}o&&(t+=" [ See: https://links.ethers.org/v5-errors-"+o+" ]"),r.length&&(t+=" ("+r.join(", ")+")");const a=new Error(t);return a.reason=s,a.code=e,Object.keys(n).forEach(function(l){a[l]=n[l]}),a}throwError(t,e,n){throw this.makeError(t,e,n)}throwArgumentError(t,e,n){return this.throwError(t,H.errors.INVALID_ARGUMENT,{argument:e,value:n})}assert(t,e,n,r){t||this.throwError(e,n,r)}assertArgument(t,e,n,r){t||this.throwArgumentError(e,n,r)}checkNormalize(t){t==null&&(t="platform missing String.prototype.normalize"),nf&&this.throwError("platform missing String.prototype.normalize",H.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:nf})}checkSafeUint53(t,e){typeof t=="number"&&(e==null&&(e="value not safe"),(t<0||t>=9007199254740991)&&this.throwError(e,H.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:t}),t%1&&this.throwError(e,H.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:t}))}checkArgumentCount(t,e,n){n?n=": "+n:n="",t<e&&this.throwError("missing argument"+n,H.errors.MISSING_ARGUMENT,{count:t,expectedCount:e}),t>e&&this.throwError("too many arguments"+n,H.errors.UNEXPECTED_ARGUMENT,{count:t,expectedCount:e})}checkNew(t,e){(t===Object||t==null)&&this.throwError("missing new",H.errors.MISSING_NEW,{name:e.name})}checkAbstract(t,e){t===e?this.throwError("cannot instantiate abstract class "+JSON.stringify(e.name)+" directly; use a sub-class",H.errors.UNSUPPORTED_OPERATION,{name:t.name,operation:"new"}):(t===Object||t==null)&&this.throwError("missing new",H.errors.MISSING_NEW,{name:e.name})}static globalLogger(){return Ia||(Ia=new H(lx)),Ia}static setCensorship(t,e){if(!t&&e&&this.globalLogger().throwError("cannot permanently disable censorship",H.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),$c){if(!t)return;this.globalLogger().throwError("error censorship permanent",H.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}tf=!!t,$c=!!e}static setLogLevel(t){const e=_o[t.toLowerCase()];if(e==null){H.globalLogger().warn("invalid log level - "+t);return}ef=e}static from(t){return new H(t)}}H.errors=En;H.levels=nl;const fx="bytes/5.6.1",ge=new H(fx);function Ph(i){return!!i.toHexString}function Br(i){return i.slice||(i.slice=function(){const t=Array.prototype.slice.call(arguments);return Br(new Uint8Array(Array.prototype.slice.apply(i,t)))}),i}function Ml(i){return ee(i)&&!(i.length%2)||$r(i)}function sf(i){return typeof i=="number"&&i==i&&i%1===0}function $r(i){if(i==null)return!1;if(i.constructor===Uint8Array)return!0;if(typeof i=="string"||!sf(i.length)||i.length<0)return!1;for(let t=0;t<i.length;t++){const e=i[t];if(!sf(e)||e<0||e>=256)return!1}return!0}function Nt(i,t){if(t||(t={}),typeof i=="number"){ge.checkSafeUint53(i,"invalid arrayify value");const e=[];for(;i;)e.unshift(i&255),i=parseInt(String(i/256));return e.length===0&&e.push(0),Br(new Uint8Array(e))}if(t.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),Ph(i)&&(i=i.toHexString()),ee(i)){let e=i.substring(2);e.length%2&&(t.hexPad==="left"?e="0"+e:t.hexPad==="right"?e+="0":ge.throwArgumentError("hex data is odd-length","value",i));const n=[];for(let r=0;r<e.length;r+=2)n.push(parseInt(e.substring(r,r+2),16));return Br(new Uint8Array(n))}return $r(i)?Br(new Uint8Array(i)):ge.throwArgumentError("invalid arrayify value","value",i)}function on(i){const t=i.map(r=>Nt(r)),e=t.reduce((r,s)=>r+s.length,0),n=new Uint8Array(e);return t.reduce((r,s)=>(n.set(s,r),r+s.length),0),Br(n)}function Wr(i){let t=Nt(i);if(t.length===0)return t;let e=0;for(;e<t.length&&t[e]===0;)e++;return e&&(t=t.slice(e)),t}function hx(i,t){i=Nt(i),i.length>t&&ge.throwArgumentError("value out of range","value",arguments[0]);const e=new Uint8Array(t);return e.set(i,t-i.length),Br(e)}function ee(i,t){return!(typeof i!="string"||!i.match(/^0x[0-9A-Fa-f]*$/)||t&&i.length!==2+2*t)}const La="0123456789abcdef";function Rt(i,t){if(t||(t={}),typeof i=="number"){ge.checkSafeUint53(i,"invalid hexlify value");let e="";for(;i;)e=La[i&15]+e,i=Math.floor(i/16);return e.length?(e.length%2&&(e="0"+e),"0x"+e):"0x00"}if(typeof i=="bigint")return i=i.toString(16),i.length%2?"0x0"+i:"0x"+i;if(t.allowMissingPrefix&&typeof i=="string"&&i.substring(0,2)!=="0x"&&(i="0x"+i),Ph(i))return i.toHexString();if(ee(i))return i.length%2&&(t.hexPad==="left"?i="0x0"+i.substring(2):t.hexPad==="right"?i+="0":ge.throwArgumentError("hex data is odd-length","value",i)),i.toLowerCase();if($r(i)){let e="0x";for(let n=0;n<i.length;n++){let r=i[n];e+=La[(r&240)>>4]+La[r&15]}return e}return ge.throwArgumentError("invalid hexlify value","value",i)}function rr(i){if(typeof i!="string")i=Rt(i);else if(!ee(i)||i.length%2)return null;return(i.length-2)/2}function Fe(i,t,e){return typeof i!="string"?i=Rt(i):(!ee(i)||i.length%2)&&ge.throwArgumentError("invalid hexData","value",i),t=2+2*t,e!=null?"0x"+i.substring(t,2+2*e):"0x"+i.substring(t)}function Ke(i){let t="0x";return i.forEach(e=>{t+=Rt(e).substring(2)}),t}function Sl(i){const t=ux(Rt(i,{hexPad:"left"}));return t==="0x"?"0x0":t}function ux(i){typeof i!="string"&&(i=Rt(i)),ee(i)||ge.throwArgumentError("invalid hex string","value",i),i=i.substring(2);let t=0;for(;t<i.length&&i[t]==="0";)t++;return"0x"+i.substring(t)}function he(i,t){for(typeof i!="string"?i=Rt(i):ee(i)||ge.throwArgumentError("invalid hex string","value",i),i.length>2*t+2&&ge.throwArgumentError("value out of range","value",arguments[1]);i.length<2*t+2;)i="0x0"+i.substring(2);return i}function Vo(i){const t={r:"0x",s:"0x",_vs:"0x",recoveryParam:0,v:0,yParityAndS:"0x",compact:"0x"};if(Ml(i)){let e=Nt(i);e.length===64?(t.v=27+(e[32]>>7),e[32]&=127,t.r=Rt(e.slice(0,32)),t.s=Rt(e.slice(32,64))):e.length===65?(t.r=Rt(e.slice(0,32)),t.s=Rt(e.slice(32,64)),t.v=e[64]):ge.throwArgumentError("invalid signature string","signature",i),t.v<27&&(t.v===0||t.v===1?t.v+=27:ge.throwArgumentError("signature invalid v byte","signature",i)),t.recoveryParam=1-t.v%2,t.recoveryParam&&(e[32]|=128),t._vs=Rt(e.slice(32,64))}else{if(t.r=i.r,t.s=i.s,t.v=i.v,t.recoveryParam=i.recoveryParam,t._vs=i._vs,t._vs!=null){const r=hx(Nt(t._vs),32);t._vs=Rt(r);const s=r[0]>=128?1:0;t.recoveryParam==null?t.recoveryParam=s:t.recoveryParam!==s&&ge.throwArgumentError("signature recoveryParam mismatch _vs","signature",i),r[0]&=127;const o=Rt(r);t.s==null?t.s=o:t.s!==o&&ge.throwArgumentError("signature v mismatch _vs","signature",i)}if(t.recoveryParam==null)t.v==null?ge.throwArgumentError("signature missing v and recoveryParam","signature",i):t.v===0||t.v===1?t.recoveryParam=t.v:t.recoveryParam=1-t.v%2;else if(t.v==null)t.v=27+t.recoveryParam;else{const r=t.v===0||t.v===1?t.v:1-t.v%2;t.recoveryParam!==r&&ge.throwArgumentError("signature recoveryParam mismatch v","signature",i)}t.r==null||!ee(t.r)?ge.throwArgumentError("signature missing or invalid r","signature",i):t.r=he(t.r,32),t.s==null||!ee(t.s)?ge.throwArgumentError("signature missing or invalid s","signature",i):t.s=he(t.s,32);const e=Nt(t.s);e[0]>=128&&ge.throwArgumentError("signature s out of range","signature",i),t.recoveryParam&&(e[0]|=128);const n=Rt(e);t._vs&&(ee(t._vs)||ge.throwArgumentError("signature invalid _vs","signature",i),t._vs=he(t._vs,32)),t._vs==null?t._vs=n:t._vs!==n&&ge.throwArgumentError("signature _vs mismatch v and s","signature",i)}return t.yParityAndS=t._vs,t.compact=t.r+t.yParityAndS.substring(2),t}const Ih="bignumber/5.6.2";var Co=Ut.BN;const pi=new H(Ih),Da={},of=9007199254740991;function dx(i){return i!=null&&(pt.isBigNumber(i)||typeof i=="number"&&i%1===0||typeof i=="string"&&!!i.match(/^-?[0-9]+$/)||ee(i)||typeof i=="bigint"||$r(i))}let af=!1;class pt{constructor(t,e){t!==Da&&pi.throwError("cannot call constructor directly; use BigNumber.from",H.errors.UNSUPPORTED_OPERATION,{operation:"new (BigNumber)"}),this._hex=e,this._isBigNumber=!0,Object.freeze(this)}fromTwos(t){return Ze(Xt(this).fromTwos(t))}toTwos(t){return Ze(Xt(this).toTwos(t))}abs(){return this._hex[0]==="-"?pt.from(this._hex.substring(1)):this}add(t){return Ze(Xt(this).add(Xt(t)))}sub(t){return Ze(Xt(this).sub(Xt(t)))}div(t){return pt.from(t).isZero()&&fn("division-by-zero","div"),Ze(Xt(this).div(Xt(t)))}mul(t){return Ze(Xt(this).mul(Xt(t)))}mod(t){const e=Xt(t);return e.isNeg()&&fn("division-by-zero","mod"),Ze(Xt(this).umod(e))}pow(t){const e=Xt(t);return e.isNeg()&&fn("negative-power","pow"),Ze(Xt(this).pow(e))}and(t){const e=Xt(t);return(this.isNegative()||e.isNeg())&&fn("unbound-bitwise-result","and"),Ze(Xt(this).and(e))}or(t){const e=Xt(t);return(this.isNegative()||e.isNeg())&&fn("unbound-bitwise-result","or"),Ze(Xt(this).or(e))}xor(t){const e=Xt(t);return(this.isNegative()||e.isNeg())&&fn("unbound-bitwise-result","xor"),Ze(Xt(this).xor(e))}mask(t){return(this.isNegative()||t<0)&&fn("negative-width","mask"),Ze(Xt(this).maskn(t))}shl(t){return(this.isNegative()||t<0)&&fn("negative-width","shl"),Ze(Xt(this).shln(t))}shr(t){return(this.isNegative()||t<0)&&fn("negative-width","shr"),Ze(Xt(this).shrn(t))}eq(t){return Xt(this).eq(Xt(t))}lt(t){return Xt(this).lt(Xt(t))}lte(t){return Xt(this).lte(Xt(t))}gt(t){return Xt(this).gt(Xt(t))}gte(t){return Xt(this).gte(Xt(t))}isNegative(){return this._hex[0]==="-"}isZero(){return Xt(this).isZero()}toNumber(){try{return Xt(this).toNumber()}catch{fn("overflow","toNumber",this.toString())}return null}toBigInt(){try{return BigInt(this.toString())}catch{}return pi.throwError("this platform does not support BigInt",H.errors.UNSUPPORTED_OPERATION,{value:this.toString()})}toString(){return arguments.length>0&&(arguments[0]===10?af||(af=!0,pi.warn("BigNumber.toString does not accept any parameters; base-10 is assumed")):arguments[0]===16?pi.throwError("BigNumber.toString does not accept any parameters; use bigNumber.toHexString()",H.errors.UNEXPECTED_ARGUMENT,{}):pi.throwError("BigNumber.toString does not accept parameters",H.errors.UNEXPECTED_ARGUMENT,{})),Xt(this).toString(10)}toHexString(){return this._hex}toJSON(t){return{type:"BigNumber",hex:this.toHexString()}}static from(t){if(t instanceof pt)return t;if(typeof t=="string")return t.match(/^-?0x[0-9a-f]+$/i)?new pt(Da,Ts(t)):t.match(/^-?[0-9]+$/)?new pt(Da,Ts(new Co(t))):pi.throwArgumentError("invalid BigNumber string","value",t);if(typeof t=="number")return t%1&&fn("underflow","BigNumber.from",t),(t>=of||t<=-of)&&fn("overflow","BigNumber.from",t),pt.from(String(t));const e=t;if(typeof e=="bigint")return pt.from(e.toString());if($r(e))return pt.from(Rt(e));if(e)if(e.toHexString){const n=e.toHexString();if(typeof n=="string")return pt.from(n)}else{let n=e._hex;if(n==null&&e.type==="BigNumber"&&(n=e.hex),typeof n=="string"&&(ee(n)||n[0]==="-"&&ee(n.substring(1))))return pt.from(n)}return pi.throwArgumentError("invalid BigNumber value","value",t)}static isBigNumber(t){return!!(t&&t._isBigNumber)}}function Ts(i){if(typeof i!="string")return Ts(i.toString(16));if(i[0]==="-")return i=i.substring(1),i[0]==="-"&&pi.throwArgumentError("invalid hex","value",i),i=Ts(i),i==="0x00"?i:"-"+i;if(i.substring(0,2)!=="0x"&&(i="0x"+i),i==="0x")return"0x00";for(i.length%2&&(i="0x0"+i.substring(2));i.length>4&&i.substring(0,4)==="0x00";)i="0x"+i.substring(4);return i}function Ze(i){return pt.from(Ts(i))}function Xt(i){const t=pt.from(i).toHexString();return t[0]==="-"?new Co("-"+t.substring(3),16):new Co(t.substring(2),16)}function fn(i,t,e){const n={fault:i,operation:t};return e!=null&&(n.value=e),pi.throwError(i,H.errors.NUMERIC_FAULT,n)}function px(i){return new Co(i,36).toString(16)}const Ve=new H(Ih),_s={},Lh=pt.from(0),Dh=pt.from(-1);function Nh(i,t,e,n){const r={fault:t,operation:e};return n!==void 0&&(r.value=n),Ve.throwError(i,H.errors.NUMERIC_FAULT,r)}let ys="0";for(;ys.length<256;)ys+=ys;function Al(i){if(typeof i!="number")try{i=pt.from(i).toNumber()}catch{}return typeof i=="number"&&i>=0&&i<=256&&!(i%1)?"1"+ys.substring(0,i):Ve.throwArgumentError("invalid decimal size","decimals",i)}function yo(i,t){t==null&&(t=0);const e=Al(t);i=pt.from(i);const n=i.lt(Lh);n&&(i=i.mul(Dh));let r=i.mod(e).toString();for(;r.length<e.length-1;)r="0"+r;r=r.match(/^([0-9]*[1-9]|0)(0*)/)[1];const s=i.div(e).toString();return e.length===1?i=s:i=s+"."+r,n&&(i="-"+i),i}function ui(i,t){t==null&&(t=0);const e=Al(t);(typeof i!="string"||!i.match(/^-?[0-9.]+$/))&&Ve.throwArgumentError("invalid decimal value","value",i);const n=i.substring(0,1)==="-";n&&(i=i.substring(1)),i==="."&&Ve.throwArgumentError("missing value","value",i);const r=i.split(".");r.length>2&&Ve.throwArgumentError("too many decimal points","value",i);let s=r[0],o=r[1];for(s||(s="0"),o||(o="0");o[o.length-1]==="0";)o=o.substring(0,o.length-1);for(o.length>e.length-1&&Nh("fractional component exceeds decimals","underflow","parseFixed"),o===""&&(o="0");o.length<e.length-1;)o+="0";const a=pt.from(s),l=pt.from(o);let c=a.mul(e).add(l);return n&&(c=c.mul(Dh)),c}class kr{constructor(t,e,n,r){t!==_s&&Ve.throwError("cannot use FixedFormat constructor; use FixedFormat.from",H.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.signed=e,this.width=n,this.decimals=r,this.name=(e?"":"u")+"fixed"+String(n)+"x"+String(r),this._multiplier=Al(r),Object.freeze(this)}static from(t){if(t instanceof kr)return t;typeof t=="number"&&(t=`fixed128x${t}`);let e=!0,n=128,r=18;if(typeof t=="string"){if(t!=="fixed")if(t==="ufixed")e=!1;else{const s=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);s||Ve.throwArgumentError("invalid fixed format","format",t),e=s[1]!=="u",n=parseInt(s[2]),r=parseInt(s[3])}}else if(t){const s=(o,a,l)=>t[o]==null?l:(typeof t[o]!==a&&Ve.throwArgumentError("invalid fixed format ("+o+" not "+a+")","format."+o,t[o]),t[o]);e=s("signed","boolean",e),n=s("width","number",n),r=s("decimals","number",r)}return n%8&&Ve.throwArgumentError("invalid fixed format width (not byte aligned)","format.width",n),r>80&&Ve.throwArgumentError("invalid fixed format (decimals too large)","format.decimals",r),new kr(_s,e,n,r)}}class Re{constructor(t,e,n,r){t!==_s&&Ve.throwError("cannot use FixedNumber constructor; use FixedNumber.from",H.errors.UNSUPPORTED_OPERATION,{operation:"new FixedFormat"}),this.format=r,this._hex=e,this._value=n,this._isFixedNumber=!0,Object.freeze(this)}_checkFormat(t){this.format.name!==t.format.name&&Ve.throwArgumentError("incompatible format; use fixedNumber.toFormat","other",t)}addUnsafe(t){this._checkFormat(t);const e=ui(this._value,this.format.decimals),n=ui(t._value,t.format.decimals);return Re.fromValue(e.add(n),this.format.decimals,this.format)}subUnsafe(t){this._checkFormat(t);const e=ui(this._value,this.format.decimals),n=ui(t._value,t.format.decimals);return Re.fromValue(e.sub(n),this.format.decimals,this.format)}mulUnsafe(t){this._checkFormat(t);const e=ui(this._value,this.format.decimals),n=ui(t._value,t.format.decimals);return Re.fromValue(e.mul(n).div(this.format._multiplier),this.format.decimals,this.format)}divUnsafe(t){this._checkFormat(t);const e=ui(this._value,this.format.decimals),n=ui(t._value,t.format.decimals);return Re.fromValue(e.mul(this.format._multiplier).div(n),this.format.decimals,this.format)}floor(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=Re.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return this.isNegative()&&n&&(e=e.subUnsafe(lf.toFormat(e.format))),e}ceiling(){const t=this.toString().split(".");t.length===1&&t.push("0");let e=Re.from(t[0],this.format);const n=!t[1].match(/^(0*)$/);return!this.isNegative()&&n&&(e=e.addUnsafe(lf.toFormat(e.format))),e}round(t){t==null&&(t=0);const e=this.toString().split(".");if(e.length===1&&e.push("0"),(t<0||t>80||t%1)&&Ve.throwArgumentError("invalid decimal count","decimals",t),e[1].length<=t)return this;const n=Re.from("1"+ys.substring(0,t),this.format),r=mx.toFormat(this.format);return this.mulUnsafe(n).addUnsafe(r).floor().divUnsafe(n)}isZero(){return this._value==="0.0"||this._value==="0"}isNegative(){return this._value[0]==="-"}toString(){return this._value}toHexString(t){if(t==null)return this._hex;t%8&&Ve.throwArgumentError("invalid byte width","width",t);const e=pt.from(this._hex).fromTwos(this.format.width).toTwos(t).toHexString();return he(e,t/8)}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return Re.fromString(this._value,t)}static fromValue(t,e,n){return n==null&&e!=null&&!dx(e)&&(n=e,e=null),e==null&&(e=0),n==null&&(n="fixed"),Re.fromString(yo(t,e),kr.from(n))}static fromString(t,e){e==null&&(e="fixed");const n=kr.from(e),r=ui(t,n.decimals);!n.signed&&r.lt(Lh)&&Nh("unsigned value cannot be negative","overflow","value",t);let s=null;n.signed?s=r.toTwos(n.width).toHexString():(s=r.toHexString(),s=he(s,n.width/8));const o=yo(r,n.decimals);return new Re(_s,s,o,n)}static fromBytes(t,e){e==null&&(e="fixed");const n=kr.from(e);if(Nt(t).length>n.width/8)throw new Error("overflow");let r=pt.from(t);n.signed&&(r=r.fromTwos(n.width));const s=r.toTwos((n.signed?0:1)+n.width).toHexString(),o=yo(r,n.decimals);return new Re(_s,s,o,n)}static from(t,e){if(typeof t=="string")return Re.fromString(t,e);if($r(t))return Re.fromBytes(t,e);try{return Re.fromValue(t,0,e)}catch(n){if(n.code!==H.errors.INVALID_ARGUMENT)throw n}return Ve.throwArgumentError("invalid FixedNumber value","value",t)}static isFixedNumber(t){return!!(t&&t._isFixedNumber)}}const lf=Re.from(1),mx=Re.from("0.5"),gx="properties/5.6.0";var vx=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const Ro=new H(gx);function dt(i,t,e){Object.defineProperty(i,t,{enumerable:!0,value:e,writable:!1})}function jn(i,t){for(let e=0;e<32;e++){if(i[t])return i[t];if(!i.prototype||typeof i.prototype!="object")break;i=Object.getPrototypeOf(i.prototype).constructor}return null}function ye(i){return vx(this,void 0,void 0,function*(){const t=Object.keys(i).map(n=>{const r=i[n];return Promise.resolve(r).then(s=>({key:n,value:s}))});return(yield Promise.all(t)).reduce((n,r)=>(n[r.key]=r.value,n),{})})}function xx(i,t){(!i||typeof i!="object")&&Ro.throwArgumentError("invalid object","object",i),Object.keys(i).forEach(e=>{t[e]||Ro.throwArgumentError("invalid object key - "+e,"transaction:"+e,i)})}function Ee(i){const t={};for(const e in i)t[e]=i[e];return t}const _x={bigint:!0,boolean:!0,function:!0,number:!0,string:!0};function Fh(i){if(i==null||_x[typeof i])return!0;if(Array.isArray(i)||typeof i=="object"){if(!Object.isFrozen(i))return!1;const t=Object.keys(i);for(let e=0;e<t.length;e++){let n=null;try{n=i[t[e]]}catch{continue}if(!Fh(n))return!1}return!0}return Ro.throwArgumentError(`Cannot deepCopy ${typeof i}`,"object",i)}function yx(i){if(Fh(i))return i;if(Array.isArray(i))return Object.freeze(i.map(t=>yi(t)));if(typeof i=="object"){const t={};for(const e in i){const n=i[e];n!==void 0&&dt(t,e,yi(n))}return t}return Ro.throwArgumentError(`Cannot deepCopy ${typeof i}`,"object",i)}function yi(i){return yx(i)}class Us{constructor(t){for(const e in t)this[e]=yi(t[e])}}const zs="abi/5.6.4",Qt=new H(zs),sr={};let cf={calldata:!0,memory:!0,storage:!0},bx={calldata:!0,memory:!0};function fo(i,t){if(i==="bytes"||i==="string"){if(cf[t])return!0}else if(i==="address"){if(t==="payable")return!0}else if((i.indexOf("[")>=0||i==="tuple")&&bx[t])return!0;return(cf[t]||t==="payable")&&Qt.throwArgumentError("invalid modifier","name",t),!1}function wx(i,t){let e=i;function n(a){Qt.throwArgumentError(`unexpected character at position ${a}`,"param",i)}i=i.replace(/\s/g," ");function r(a){let l={type:"",name:"",parent:a,state:{allowType:!0}};return t&&(l.indexed=!1),l}let s={type:"",name:"",state:{allowType:!0}},o=s;for(let a=0;a<i.length;a++){let l=i[a];switch(l){case"(":o.state.allowType&&o.type===""?o.type="tuple":o.state.allowParams||n(a),o.state.allowType=!1,o.type=Cr(o.type),o.components=[r(o)],o=o.components[0];break;case")":delete o.state,o.name==="indexed"&&(t||n(a),o.indexed=!0,o.name=""),fo(o.type,o.name)&&(o.name=""),o.type=Cr(o.type);let c=o;o=o.parent,o||n(a),delete c.parent,o.state.allowParams=!1,o.state.allowName=!0,o.state.allowArray=!0;break;case",":delete o.state,o.name==="indexed"&&(t||n(a),o.indexed=!0,o.name=""),fo(o.type,o.name)&&(o.name=""),o.type=Cr(o.type);let h=r(o.parent);o.parent.components.push(h),delete o.parent,o=h;break;case" ":o.state.allowType&&o.type!==""&&(o.type=Cr(o.type),delete o.state.allowType,o.state.allowName=!0,o.state.allowParams=!0),o.state.allowName&&o.name!==""&&(o.name==="indexed"?(t||n(a),o.indexed&&n(a),o.indexed=!0,o.name=""):fo(o.type,o.name)?o.name="":o.state.allowName=!1);break;case"[":o.state.allowArray||n(a),o.type+=l,o.state.allowArray=!1,o.state.allowName=!1,o.state.readArray=!0;break;case"]":o.state.readArray||n(a),o.type+=l,o.state.readArray=!1,o.state.allowArray=!0,o.state.allowName=!0;break;default:o.state.allowType?(o.type+=l,o.state.allowParams=!0,o.state.allowArray=!0):o.state.allowName?(o.name+=l,delete o.state.allowArray):o.state.readArray?o.type+=l:n(a)}}return o.parent&&Qt.throwArgumentError("unexpected eof","param",i),delete s.state,o.name==="indexed"?(t||n(e.length-7),o.indexed&&n(e.length-7),o.indexed=!0,o.name=""):fo(o.type,o.name)&&(o.name=""),s.type=Cr(s.type),s}function bo(i,t){for(let e in t)dt(i,e,t[e])}const te=Object.freeze({sighash:"sighash",minimal:"minimal",full:"full",json:"json"}),Mx=new RegExp(/^(.*)\[([0-9]*)\]$/);class Ae{constructor(t,e){t!==sr&&Qt.throwError("use fromString",H.errors.UNSUPPORTED_OPERATION,{operation:"new ParamType()"}),bo(this,e);let n=this.type.match(Mx);n?bo(this,{arrayLength:parseInt(n[2]||"-1"),arrayChildren:Ae.fromObject({type:n[1],components:this.components}),baseType:"array"}):bo(this,{arrayLength:null,arrayChildren:null,baseType:this.components!=null?"tuple":this.type}),this._isParamType=!0,Object.freeze(this)}format(t){if(t||(t=te.sighash),te[t]||Qt.throwArgumentError("invalid format type","format",t),t===te.json){let n={type:this.baseType==="tuple"?"tuple":this.type,name:this.name||void 0};return typeof this.indexed=="boolean"&&(n.indexed=this.indexed),this.components&&(n.components=this.components.map(r=>JSON.parse(r.format(t)))),JSON.stringify(n)}let e="";return this.baseType==="array"?(e+=this.arrayChildren.format(t),e+="["+(this.arrayLength<0?"":String(this.arrayLength))+"]"):this.baseType==="tuple"?(t!==te.sighash&&(e+=this.type),e+="("+this.components.map(n=>n.format(t)).join(t===te.full?", ":",")+")"):e+=this.type,t!==te.sighash&&(this.indexed===!0&&(e+=" indexed"),t===te.full&&this.name&&(e+=" "+this.name)),e}static from(t,e){return typeof t=="string"?Ae.fromString(t,e):Ae.fromObject(t)}static fromObject(t){return Ae.isParamType(t)?t:new Ae(sr,{name:t.name||null,type:Cr(t.type),indexed:t.indexed==null?null:!!t.indexed,components:t.components?t.components.map(Ae.fromObject):null})}static fromString(t,e){function n(r){return Ae.fromObject({name:r.name,type:r.type,indexed:r.indexed,components:r.components})}return n(wx(t,!!e))}static isParamType(t){return!!(t!=null&&t._isParamType)}}function Cs(i,t){return Ax(i).map(e=>Ae.fromString(e,t))}class vi{constructor(t,e){t!==sr&&Qt.throwError("use a static from method",H.errors.UNSUPPORTED_OPERATION,{operation:"new Fragment()"}),bo(this,e),this._isFragment=!0,Object.freeze(this)}static from(t){return vi.isFragment(t)?t:typeof t=="string"?vi.fromString(t):vi.fromObject(t)}static fromObject(t){if(vi.isFragment(t))return t;switch(t.type){case"function":return Hn.fromObject(t);case"event":return gi.fromObject(t);case"constructor":return Vn.fromObject(t);case"error":return Fi.fromObject(t);case"fallback":case"receive":return null}return Qt.throwArgumentError("invalid fragment object","value",t)}static fromString(t){return t=t.replace(/\s/g," "),t=t.replace(/\(/g," (").replace(/\)/g,") ").replace(/\s+/g," "),t=t.trim(),t.split(" ")[0]==="event"?gi.fromString(t.substring(5).trim()):t.split(" ")[0]==="function"?Hn.fromString(t.substring(8).trim()):t.split("(")[0].trim()==="constructor"?Vn.fromString(t.trim()):t.split(" ")[0]==="error"?Fi.fromString(t.substring(5).trim()):Qt.throwArgumentError("unsupported fragment","value",t)}static isFragment(t){return!!(t&&t._isFragment)}}class gi extends vi{format(t){if(t||(t=te.sighash),te[t]||Qt.throwArgumentError("invalid format type","format",t),t===te.json)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});let e="";return t!==te.sighash&&(e+="event "),e+=this.name+"("+this.inputs.map(n=>n.format(t)).join(t===te.full?", ":",")+") ",t!==te.sighash&&this.anonymous&&(e+="anonymous "),e.trim()}static from(t){return typeof t=="string"?gi.fromString(t):gi.fromObject(t)}static fromObject(t){if(gi.isEventFragment(t))return t;t.type!=="event"&&Qt.throwArgumentError("invalid event object","value",t);const e={name:Rs(t.name),anonymous:t.anonymous,inputs:t.inputs?t.inputs.map(Ae.fromObject):[],type:"event"};return new gi(sr,e)}static fromString(t){let e=t.match(Ps);e||Qt.throwArgumentError("invalid event string","value",t);let n=!1;return e[3].split(" ").forEach(r=>{switch(r.trim()){case"anonymous":n=!0;break;case"":break;default:Qt.warn("unknown modifier: "+r)}}),gi.fromObject({name:e[1].trim(),anonymous:n,inputs:Cs(e[2],!0),type:"event"})}static isEventFragment(t){return t&&t._isFragment&&t.type==="event"}}function Bh(i,t){t.gas=null;let e=i.split("@");return e.length!==1?(e.length>2&&Qt.throwArgumentError("invalid human-readable ABI signature","value",i),e[1].match(/^[0-9]+$/)||Qt.throwArgumentError("invalid human-readable ABI signature gas","value",i),t.gas=pt.from(e[1]),e[0]):i}function kh(i,t){t.constant=!1,t.payable=!1,t.stateMutability="nonpayable",i.split(" ").forEach(e=>{switch(e.trim()){case"constant":t.constant=!0;break;case"payable":t.payable=!0,t.stateMutability="payable";break;case"nonpayable":t.payable=!1,t.stateMutability="nonpayable";break;case"pure":t.constant=!0,t.stateMutability="pure";break;case"view":t.constant=!0,t.stateMutability="view";break;case"external":case"public":case"":break;default:console.log("unknown modifier: "+e)}})}function Oh(i){let t={constant:!1,payable:!0,stateMutability:"payable"};return i.stateMutability!=null?(t.stateMutability=i.stateMutability,t.constant=t.stateMutability==="view"||t.stateMutability==="pure",i.constant!=null&&!!i.constant!==t.constant&&Qt.throwArgumentError("cannot have constant function with mutability "+t.stateMutability,"value",i),t.payable=t.stateMutability==="payable",i.payable!=null&&!!i.payable!==t.payable&&Qt.throwArgumentError("cannot have payable function with mutability "+t.stateMutability,"value",i)):i.payable!=null?(t.payable=!!i.payable,i.constant==null&&!t.payable&&i.type!=="constructor"&&Qt.throwArgumentError("unable to determine stateMutability","value",i),t.constant=!!i.constant,t.constant?t.stateMutability="view":t.stateMutability=t.payable?"payable":"nonpayable",t.payable&&t.constant&&Qt.throwArgumentError("cannot have constant payable function","value",i)):i.constant!=null?(t.constant=!!i.constant,t.payable=!t.constant,t.stateMutability=t.constant?"view":"payable"):i.type!=="constructor"&&Qt.throwArgumentError("unable to determine stateMutability","value",i),t}class Vn extends vi{format(t){if(t||(t=te.sighash),te[t]||Qt.throwArgumentError("invalid format type","format",t),t===te.json)return JSON.stringify({type:"constructor",stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});t===te.sighash&&Qt.throwError("cannot format a constructor for sighash",H.errors.UNSUPPORTED_OPERATION,{operation:"format(sighash)"});let e="constructor("+this.inputs.map(n=>n.format(t)).join(t===te.full?", ":",")+") ";return this.stateMutability&&this.stateMutability!=="nonpayable"&&(e+=this.stateMutability+" "),e.trim()}static from(t){return typeof t=="string"?Vn.fromString(t):Vn.fromObject(t)}static fromObject(t){if(Vn.isConstructorFragment(t))return t;t.type!=="constructor"&&Qt.throwArgumentError("invalid constructor object","value",t);let e=Oh(t);e.constant&&Qt.throwArgumentError("constructor cannot be constant","value",t);const n={name:null,type:t.type,inputs:t.inputs?t.inputs.map(Ae.fromObject):[],payable:e.payable,stateMutability:e.stateMutability,gas:t.gas?pt.from(t.gas):null};return new Vn(sr,n)}static fromString(t){let e={type:"constructor"};t=Bh(t,e);let n=t.match(Ps);return(!n||n[1].trim()!=="constructor")&&Qt.throwArgumentError("invalid constructor string","value",t),e.inputs=Cs(n[2].trim(),!1),kh(n[3].trim(),e),Vn.fromObject(e)}static isConstructorFragment(t){return t&&t._isFragment&&t.type==="constructor"}}class Hn extends Vn{format(t){if(t||(t=te.sighash),te[t]||Qt.throwArgumentError("invalid format type","format",t),t===te.json)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas?this.gas.toNumber():void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(t))),outputs:this.outputs.map(n=>JSON.parse(n.format(t)))});let e="";return t!==te.sighash&&(e+="function "),e+=this.name+"("+this.inputs.map(n=>n.format(t)).join(t===te.full?", ":",")+") ",t!==te.sighash&&(this.stateMutability?this.stateMutability!=="nonpayable"&&(e+=this.stateMutability+" "):this.constant&&(e+="view "),this.outputs&&this.outputs.length&&(e+="returns ("+this.outputs.map(n=>n.format(t)).join(", ")+") "),this.gas!=null&&(e+="@"+this.gas.toString()+" ")),e.trim()}static from(t){return typeof t=="string"?Hn.fromString(t):Hn.fromObject(t)}static fromObject(t){if(Hn.isFunctionFragment(t))return t;t.type!=="function"&&Qt.throwArgumentError("invalid function object","value",t);let e=Oh(t);const n={type:t.type,name:Rs(t.name),constant:e.constant,inputs:t.inputs?t.inputs.map(Ae.fromObject):[],outputs:t.outputs?t.outputs.map(Ae.fromObject):[],payable:e.payable,stateMutability:e.stateMutability,gas:t.gas?pt.from(t.gas):null};return new Hn(sr,n)}static fromString(t){let e={type:"function"};t=Bh(t,e);let n=t.split(" returns ");n.length>2&&Qt.throwArgumentError("invalid function string","value",t);let r=n[0].match(Ps);if(r||Qt.throwArgumentError("invalid function signature","value",t),e.name=r[1].trim(),e.name&&Rs(e.name),e.inputs=Cs(r[2],!1),kh(r[3].trim(),e),n.length>1){let s=n[1].match(Ps);(s[1].trim()!=""||s[3].trim()!="")&&Qt.throwArgumentError("unexpected tokens","value",t),e.outputs=Cs(s[2],!1)}else e.outputs=[];return Hn.fromObject(e)}static isFunctionFragment(t){return t&&t._isFragment&&t.type==="function"}}function ff(i){const t=i.format();return(t==="Error(string)"||t==="Panic(uint256)")&&Qt.throwArgumentError(`cannot specify user defined ${t} error`,"fragment",i),i}class Fi extends vi{format(t){if(t||(t=te.sighash),te[t]||Qt.throwArgumentError("invalid format type","format",t),t===te.json)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(t)))});let e="";return t!==te.sighash&&(e+="error "),e+=this.name+"("+this.inputs.map(n=>n.format(t)).join(t===te.full?", ":",")+") ",e.trim()}static from(t){return typeof t=="string"?Fi.fromString(t):Fi.fromObject(t)}static fromObject(t){if(Fi.isErrorFragment(t))return t;t.type!=="error"&&Qt.throwArgumentError("invalid error object","value",t);const e={type:t.type,name:Rs(t.name),inputs:t.inputs?t.inputs.map(Ae.fromObject):[]};return ff(new Fi(sr,e))}static fromString(t){let e={type:"error"},n=t.match(Ps);return n||Qt.throwArgumentError("invalid error signature","value",t),e.name=n[1].trim(),e.name&&Rs(e.name),e.inputs=Cs(n[2],!1),ff(Fi.fromObject(e))}static isErrorFragment(t){return t&&t._isFragment&&t.type==="error"}}function Cr(i){return i.match(/^uint($|[^1-9])/)?i="uint256"+i.substring(4):i.match(/^int($|[^1-9])/)&&(i="int256"+i.substring(3)),i}const Sx=new RegExp("^[a-zA-Z$_][a-zA-Z0-9$_]*$");function Rs(i){return(!i||!i.match(Sx))&&Qt.throwArgumentError(`invalid identifier "${i}"`,"value",i),i}const Ps=new RegExp("^([^)(]*)\\((.*)\\)([^)(]*)$");function Ax(i){i=i.trim();let t=[],e="",n=0;for(let r=0;r<i.length;r++){let s=i[r];s===","&&n===0?(t.push(e),e=""):(e+=s,s==="("?n++:s===")"&&(n--,n===-1&&Qt.throwArgumentError("unbalanced parenthesis","value",i)))}return e&&t.push(e),t}const El=new H(zs);function Ex(i){const t=[],e=function(n,r){if(!!Array.isArray(r))for(let s in r){const o=n.slice();o.push(s);try{e(o,r[s])}catch(a){t.push({path:o,error:a})}}};return e([],i),t}class Si{constructor(t,e,n,r){this.name=t,this.type=e,this.localName=n,this.dynamic=r}_throwError(t,e){El.throwArgumentError(t,this.localName,e)}}class il{constructor(t){dt(this,"wordSize",t||32),this._data=[],this._dataLength=0,this._padding=new Uint8Array(t)}get data(){return Ke(this._data)}get length(){return this._dataLength}_writeData(t){return this._data.push(t),this._dataLength+=t.length,t.length}appendWriter(t){return this._writeData(on(t._data))}writeBytes(t){let e=Nt(t);const n=e.length%this.wordSize;return n&&(e=on([e,this._padding.slice(n)])),this._writeData(e)}_getValue(t){let e=Nt(pt.from(t));return e.length>this.wordSize&&El.throwError("value out-of-bounds",H.errors.BUFFER_OVERRUN,{length:this.wordSize,offset:e.length}),e.length%this.wordSize&&(e=on([this._padding.slice(e.length%this.wordSize),e])),e}writeValue(t){return this._writeData(this._getValue(t))}writeUpdatableValue(){const t=this._data.length;return this._data.push(this._padding),this._dataLength+=this.wordSize,e=>{this._data[t]=this._getValue(e)}}}class Po{constructor(t,e,n,r){dt(this,"_data",Nt(t)),dt(this,"wordSize",e||32),dt(this,"_coerceFunc",n),dt(this,"allowLoose",r),this._offset=0}get data(){return Rt(this._data)}get consumed(){return this._offset}static coerce(t,e){let n=t.match("^u?int([0-9]+)$");return n&&parseInt(n[1])<=48&&(e=e.toNumber()),e}coerce(t,e){return this._coerceFunc?this._coerceFunc(t,e):Po.coerce(t,e)}_peekBytes(t,e,n){let r=Math.ceil(e/this.wordSize)*this.wordSize;return this._offset+r>this._data.length&&(this.allowLoose&&n&&this._offset+e<=this._data.length?r=e:El.throwError("data out-of-bounds",H.errors.BUFFER_OVERRUN,{length:this._data.length,offset:this._offset+r})),this._data.slice(this._offset,this._offset+r)}subReader(t){return new Po(this._data.slice(this._offset+t),this.wordSize,this._coerceFunc,this.allowLoose)}readBytes(t,e){let n=this._peekBytes(0,t,!!e);return this._offset+=n.length,n.slice(0,t)}readValue(){return pt.from(this.readBytes(this.wordSize))}}var Uh={exports:{}};/**
 * [js-sha3]{@link https://github.com/emn178/js-sha3}
 *
 * @version 0.8.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */(function(i){(function(){var t="input is invalid type",e="finalize already called",n=typeof window=="object",r=n?window:{};r.JS_SHA3_NO_WINDOW&&(n=!1);var s=!n&&typeof self=="object",o=!r.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;o?r=Ch:s&&(r=self);var a=!r.JS_SHA3_NO_COMMON_JS&&!0&&i.exports,l=!r.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",c="0123456789abcdef".split(""),h=[31,7936,2031616,520093696],u=[4,1024,262144,67108864],p=[1,256,65536,16777216],x=[6,1536,393216,100663296],b=[0,8,16,24],g=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],v=[224,256,384,512],M=[128,256],D=["hex","buffer","arrayBuffer","array","digest"],z={128:168,256:136};(r.JS_SHA3_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(_){return Object.prototype.toString.call(_)==="[object Array]"}),l&&(r.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(_){return typeof _=="object"&&_.buffer&&_.buffer.constructor===ArrayBuffer});for(var B=function(_,N,Q){return function(Y){return new d(_,N,_).update(Y)[Q]()}},O=function(_,N,Q){return function(Y,tt){return new d(_,N,tt).update(Y)[Q]()}},G=function(_,N,Q){return function(Y,tt,et,lt){return f["cshake"+_].update(Y,tt,et,lt)[Q]()}},Z=function(_,N,Q){return function(Y,tt,et,lt){return f["kmac"+_].update(Y,tt,et,lt)[Q]()}},L=function(_,N,Q,Y){for(var tt=0;tt<D.length;++tt){var et=D[tt];_[et]=N(Q,Y,et)}return _},U=function(_,N){var Q=B(_,N,"hex");return Q.create=function(){return new d(_,N,_)},Q.update=function(Y){return Q.create().update(Y)},L(Q,B,_,N)},$=function(_,N){var Q=O(_,N,"hex");return Q.create=function(Y){return new d(_,N,Y)},Q.update=function(Y,tt){return Q.create(tt).update(Y)},L(Q,O,_,N)},j=function(_,N){var Q=z[_],Y=G(_,N,"hex");return Y.create=function(tt,et,lt){return!et&&!lt?f["shake"+_].create(tt):new d(_,N,tt).bytepad([et,lt],Q)},Y.update=function(tt,et,lt,rt){return Y.create(et,lt,rt).update(tt)},L(Y,G,_,N)},ht=function(_,N){var Q=z[_],Y=Z(_,N,"hex");return Y.create=function(tt,et,lt){return new E(_,N,et).bytepad(["KMAC",lt],Q).bytepad([tt],Q)},Y.update=function(tt,et,lt,rt){return Y.create(tt,lt,rt).update(et)},L(Y,Z,_,N)},R=[{name:"keccak",padding:p,bits:v,createMethod:U},{name:"sha3",padding:x,bits:v,createMethod:U},{name:"shake",padding:h,bits:M,createMethod:$},{name:"cshake",padding:u,bits:M,createMethod:j},{name:"kmac",padding:u,bits:M,createMethod:ht}],f={},m=[],y=0;y<R.length;++y)for(var w=R[y],S=w.bits,C=0;C<S.length;++C){var I=w.name+"_"+S[C];if(m.push(I),f[I]=w.createMethod(S[C],w.padding),w.name!=="sha3"){var A=w.name+S[C];m.push(A),f[A]=f[I]}}function d(_,N,Q){this.blocks=[],this.s=[],this.padding=N,this.outputBits=Q,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(_<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=Q>>5,this.extraBytes=(Q&31)>>3;for(var Y=0;Y<50;++Y)this.s[Y]=0}d.prototype.update=function(_){if(this.finalized)throw new Error(e);var N,Q=typeof _;if(Q!=="string"){if(Q==="object"){if(_===null)throw new Error(t);if(l&&_.constructor===ArrayBuffer)_=new Uint8Array(_);else if(!Array.isArray(_)&&(!l||!ArrayBuffer.isView(_)))throw new Error(t)}else throw new Error(t);N=!0}for(var Y=this.blocks,tt=this.byteCount,et=_.length,lt=this.blockCount,rt=0,At=this.s,gt,Ct;rt<et;){if(this.reset)for(this.reset=!1,Y[0]=this.block,gt=1;gt<lt+1;++gt)Y[gt]=0;if(N)for(gt=this.start;rt<et&&gt<tt;++rt)Y[gt>>2]|=_[rt]<<b[gt++&3];else for(gt=this.start;rt<et&&gt<tt;++rt)Ct=_.charCodeAt(rt),Ct<128?Y[gt>>2]|=Ct<<b[gt++&3]:Ct<2048?(Y[gt>>2]|=(192|Ct>>6)<<b[gt++&3],Y[gt>>2]|=(128|Ct&63)<<b[gt++&3]):Ct<55296||Ct>=57344?(Y[gt>>2]|=(224|Ct>>12)<<b[gt++&3],Y[gt>>2]|=(128|Ct>>6&63)<<b[gt++&3],Y[gt>>2]|=(128|Ct&63)<<b[gt++&3]):(Ct=65536+((Ct&1023)<<10|_.charCodeAt(++rt)&1023),Y[gt>>2]|=(240|Ct>>18)<<b[gt++&3],Y[gt>>2]|=(128|Ct>>12&63)<<b[gt++&3],Y[gt>>2]|=(128|Ct>>6&63)<<b[gt++&3],Y[gt>>2]|=(128|Ct&63)<<b[gt++&3]);if(this.lastByteIndex=gt,gt>=tt){for(this.start=gt-tt,this.block=Y[lt],gt=0;gt<lt;++gt)At[gt]^=Y[gt];it(At),this.reset=!0}else this.start=gt}return this},d.prototype.encode=function(_,N){var Q=_&255,Y=1,tt=[Q];for(_=_>>8,Q=_&255;Q>0;)tt.unshift(Q),_=_>>8,Q=_&255,++Y;return N?tt.push(Y):tt.unshift(Y),this.update(tt),tt.length},d.prototype.encodeString=function(_){var N,Q=typeof _;if(Q!=="string"){if(Q==="object"){if(_===null)throw new Error(t);if(l&&_.constructor===ArrayBuffer)_=new Uint8Array(_);else if(!Array.isArray(_)&&(!l||!ArrayBuffer.isView(_)))throw new Error(t)}else throw new Error(t);N=!0}var Y=0,tt=_.length;if(N)Y=tt;else for(var et=0;et<_.length;++et){var lt=_.charCodeAt(et);lt<128?Y+=1:lt<2048?Y+=2:lt<55296||lt>=57344?Y+=3:(lt=65536+((lt&1023)<<10|_.charCodeAt(++et)&1023),Y+=4)}return Y+=this.encode(Y*8),this.update(_),Y},d.prototype.bytepad=function(_,N){for(var Q=this.encode(N),Y=0;Y<_.length;++Y)Q+=this.encodeString(_[Y]);var tt=N-Q%N,et=[];return et.length=tt,this.update(et),this},d.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var _=this.blocks,N=this.lastByteIndex,Q=this.blockCount,Y=this.s;if(_[N>>2]|=this.padding[N&3],this.lastByteIndex===this.byteCount)for(_[0]=_[Q],N=1;N<Q+1;++N)_[N]=0;for(_[Q-1]|=2147483648,N=0;N<Q;++N)Y[N]^=_[N];it(Y)}},d.prototype.toString=d.prototype.hex=function(){this.finalize();for(var _=this.blockCount,N=this.s,Q=this.outputBlocks,Y=this.extraBytes,tt=0,et=0,lt="",rt;et<Q;){for(tt=0;tt<_&&et<Q;++tt,++et)rt=N[tt],lt+=c[rt>>4&15]+c[rt&15]+c[rt>>12&15]+c[rt>>8&15]+c[rt>>20&15]+c[rt>>16&15]+c[rt>>28&15]+c[rt>>24&15];et%_===0&&(it(N),tt=0)}return Y&&(rt=N[tt],lt+=c[rt>>4&15]+c[rt&15],Y>1&&(lt+=c[rt>>12&15]+c[rt>>8&15]),Y>2&&(lt+=c[rt>>20&15]+c[rt>>16&15])),lt},d.prototype.arrayBuffer=function(){this.finalize();var _=this.blockCount,N=this.s,Q=this.outputBlocks,Y=this.extraBytes,tt=0,et=0,lt=this.outputBits>>3,rt;Y?rt=new ArrayBuffer(Q+1<<2):rt=new ArrayBuffer(lt);for(var At=new Uint32Array(rt);et<Q;){for(tt=0;tt<_&&et<Q;++tt,++et)At[et]=N[tt];et%_===0&&it(N)}return Y&&(At[tt]=N[tt],rt=rt.slice(0,lt)),rt},d.prototype.buffer=d.prototype.arrayBuffer,d.prototype.digest=d.prototype.array=function(){this.finalize();for(var _=this.blockCount,N=this.s,Q=this.outputBlocks,Y=this.extraBytes,tt=0,et=0,lt=[],rt,At;et<Q;){for(tt=0;tt<_&&et<Q;++tt,++et)rt=et<<2,At=N[tt],lt[rt]=At&255,lt[rt+1]=At>>8&255,lt[rt+2]=At>>16&255,lt[rt+3]=At>>24&255;et%_===0&&it(N)}return Y&&(rt=et<<2,At=N[tt],lt[rt]=At&255,Y>1&&(lt[rt+1]=At>>8&255),Y>2&&(lt[rt+2]=At>>16&255)),lt};function E(_,N,Q){d.call(this,_,N,Q)}E.prototype=new d,E.prototype.finalize=function(){return this.encode(this.outputBits,!0),d.prototype.finalize.call(this)};var it=function(_){var N,Q,Y,tt,et,lt,rt,At,gt,Ct,ve,qt,Ot,Yt,Jt,Kt,F,T,K,ct,ot,ft,Ft,X,vt,Mt,ut,k,mt,at,_t,bt,wt,st,Dt,Pt,It,ue,jt,se,ii,re,ae,xn,oe,le,ri,ce,P,W,q,V,nt,yt,St,Bt,Et,Lt,zt,Gt,ie,De,Ge;for(Y=0;Y<48;Y+=2)tt=_[0]^_[10]^_[20]^_[30]^_[40],et=_[1]^_[11]^_[21]^_[31]^_[41],lt=_[2]^_[12]^_[22]^_[32]^_[42],rt=_[3]^_[13]^_[23]^_[33]^_[43],At=_[4]^_[14]^_[24]^_[34]^_[44],gt=_[5]^_[15]^_[25]^_[35]^_[45],Ct=_[6]^_[16]^_[26]^_[36]^_[46],ve=_[7]^_[17]^_[27]^_[37]^_[47],qt=_[8]^_[18]^_[28]^_[38]^_[48],Ot=_[9]^_[19]^_[29]^_[39]^_[49],N=qt^(lt<<1|rt>>>31),Q=Ot^(rt<<1|lt>>>31),_[0]^=N,_[1]^=Q,_[10]^=N,_[11]^=Q,_[20]^=N,_[21]^=Q,_[30]^=N,_[31]^=Q,_[40]^=N,_[41]^=Q,N=tt^(At<<1|gt>>>31),Q=et^(gt<<1|At>>>31),_[2]^=N,_[3]^=Q,_[12]^=N,_[13]^=Q,_[22]^=N,_[23]^=Q,_[32]^=N,_[33]^=Q,_[42]^=N,_[43]^=Q,N=lt^(Ct<<1|ve>>>31),Q=rt^(ve<<1|Ct>>>31),_[4]^=N,_[5]^=Q,_[14]^=N,_[15]^=Q,_[24]^=N,_[25]^=Q,_[34]^=N,_[35]^=Q,_[44]^=N,_[45]^=Q,N=At^(qt<<1|Ot>>>31),Q=gt^(Ot<<1|qt>>>31),_[6]^=N,_[7]^=Q,_[16]^=N,_[17]^=Q,_[26]^=N,_[27]^=Q,_[36]^=N,_[37]^=Q,_[46]^=N,_[47]^=Q,N=Ct^(tt<<1|et>>>31),Q=ve^(et<<1|tt>>>31),_[8]^=N,_[9]^=Q,_[18]^=N,_[19]^=Q,_[28]^=N,_[29]^=Q,_[38]^=N,_[39]^=Q,_[48]^=N,_[49]^=Q,Yt=_[0],Jt=_[1],le=_[11]<<4|_[10]>>>28,ri=_[10]<<4|_[11]>>>28,k=_[20]<<3|_[21]>>>29,mt=_[21]<<3|_[20]>>>29,Gt=_[31]<<9|_[30]>>>23,ie=_[30]<<9|_[31]>>>23,re=_[40]<<18|_[41]>>>14,ae=_[41]<<18|_[40]>>>14,st=_[2]<<1|_[3]>>>31,Dt=_[3]<<1|_[2]>>>31,Kt=_[13]<<12|_[12]>>>20,F=_[12]<<12|_[13]>>>20,ce=_[22]<<10|_[23]>>>22,P=_[23]<<10|_[22]>>>22,at=_[33]<<13|_[32]>>>19,_t=_[32]<<13|_[33]>>>19,De=_[42]<<2|_[43]>>>30,Ge=_[43]<<2|_[42]>>>30,yt=_[5]<<30|_[4]>>>2,St=_[4]<<30|_[5]>>>2,Pt=_[14]<<6|_[15]>>>26,It=_[15]<<6|_[14]>>>26,T=_[25]<<11|_[24]>>>21,K=_[24]<<11|_[25]>>>21,W=_[34]<<15|_[35]>>>17,q=_[35]<<15|_[34]>>>17,bt=_[45]<<29|_[44]>>>3,wt=_[44]<<29|_[45]>>>3,X=_[6]<<28|_[7]>>>4,vt=_[7]<<28|_[6]>>>4,Bt=_[17]<<23|_[16]>>>9,Et=_[16]<<23|_[17]>>>9,ue=_[26]<<25|_[27]>>>7,jt=_[27]<<25|_[26]>>>7,ct=_[36]<<21|_[37]>>>11,ot=_[37]<<21|_[36]>>>11,V=_[47]<<24|_[46]>>>8,nt=_[46]<<24|_[47]>>>8,xn=_[8]<<27|_[9]>>>5,oe=_[9]<<27|_[8]>>>5,Mt=_[18]<<20|_[19]>>>12,ut=_[19]<<20|_[18]>>>12,Lt=_[29]<<7|_[28]>>>25,zt=_[28]<<7|_[29]>>>25,se=_[38]<<8|_[39]>>>24,ii=_[39]<<8|_[38]>>>24,ft=_[48]<<14|_[49]>>>18,Ft=_[49]<<14|_[48]>>>18,_[0]=Yt^~Kt&T,_[1]=Jt^~F&K,_[10]=X^~Mt&k,_[11]=vt^~ut&mt,_[20]=st^~Pt&ue,_[21]=Dt^~It&jt,_[30]=xn^~le&ce,_[31]=oe^~ri&P,_[40]=yt^~Bt&Lt,_[41]=St^~Et&zt,_[2]=Kt^~T&ct,_[3]=F^~K&ot,_[12]=Mt^~k&at,_[13]=ut^~mt&_t,_[22]=Pt^~ue&se,_[23]=It^~jt&ii,_[32]=le^~ce&W,_[33]=ri^~P&q,_[42]=Bt^~Lt&Gt,_[43]=Et^~zt&ie,_[4]=T^~ct&ft,_[5]=K^~ot&Ft,_[14]=k^~at&bt,_[15]=mt^~_t&wt,_[24]=ue^~se&re,_[25]=jt^~ii&ae,_[34]=ce^~W&V,_[35]=P^~q&nt,_[44]=Lt^~Gt&De,_[45]=zt^~ie&Ge,_[6]=ct^~ft&Yt,_[7]=ot^~Ft&Jt,_[16]=at^~bt&X,_[17]=_t^~wt&vt,_[26]=se^~re&st,_[27]=ii^~ae&Dt,_[36]=W^~V&xn,_[37]=q^~nt&oe,_[46]=Gt^~De&yt,_[47]=ie^~Ge&St,_[8]=ft^~Yt&Kt,_[9]=Ft^~Jt&F,_[18]=bt^~X&Mt,_[19]=wt^~vt&ut,_[28]=re^~st&Pt,_[29]=ae^~Dt&It,_[38]=V^~xn&le,_[39]=nt^~oe&ri,_[48]=De^~yt&Bt,_[49]=Ge^~St&Et,_[0]^=g[Y],_[1]^=g[Y+1]};if(a)i.exports=f;else for(y=0;y<m.length;++y)r[m[y]]=f[m[y]]})()})(Uh);var Tx=Uh.exports;function Me(i){return"0x"+Tx.keccak_256(Nt(i))}const Cx="rlp/5.6.1",On=new H(Cx);function hf(i){const t=[];for(;i;)t.unshift(i&255),i>>=8;return t}function uf(i,t,e){let n=0;for(let r=0;r<e;r++)n=n*256+i[t+r];return n}function zh(i){if(Array.isArray(i)){let n=[];if(i.forEach(function(s){n=n.concat(zh(s))}),n.length<=55)return n.unshift(192+n.length),n;const r=hf(n.length);return r.unshift(247+r.length),r.concat(n)}Ml(i)||On.throwArgumentError("RLP object must be BytesLike","object",i);const t=Array.prototype.slice.call(Nt(i));if(t.length===1&&t[0]<=127)return t;if(t.length<=55)return t.unshift(128+t.length),t;const e=hf(t.length);return e.unshift(183+e.length),e.concat(t)}function Ho(i){return Rt(zh(i))}function df(i,t,e,n){const r=[];for(;e<t+1+n;){const s=Gh(i,e);r.push(s.result),e+=s.consumed,e>t+1+n&&On.throwError("child data too short",H.errors.BUFFER_OVERRUN,{})}return{consumed:1+n,result:r}}function Gh(i,t){if(i.length===0&&On.throwError("data too short",H.errors.BUFFER_OVERRUN,{}),i[t]>=248){const e=i[t]-247;t+1+e>i.length&&On.throwError("data short segment too short",H.errors.BUFFER_OVERRUN,{});const n=uf(i,t+1,e);return t+1+e+n>i.length&&On.throwError("data long segment too short",H.errors.BUFFER_OVERRUN,{}),df(i,t,t+1+e,e+n)}else if(i[t]>=192){const e=i[t]-192;return t+1+e>i.length&&On.throwError("data array too short",H.errors.BUFFER_OVERRUN,{}),df(i,t,t+1,e)}else if(i[t]>=184){const e=i[t]-183;t+1+e>i.length&&On.throwError("data array too short",H.errors.BUFFER_OVERRUN,{});const n=uf(i,t+1,e);t+1+e+n>i.length&&On.throwError("data array too short",H.errors.BUFFER_OVERRUN,{});const r=Rt(i.slice(t+1+e,t+1+e+n));return{consumed:1+e+n,result:r}}else if(i[t]>=128){const e=i[t]-128;t+1+e>i.length&&On.throwError("data too short",H.errors.BUFFER_OVERRUN,{});const n=Rt(i.slice(t+1,t+1+e));return{consumed:1+e,result:n}}return{consumed:1,result:Rt(i[t])}}function Tl(i){const t=Nt(i),e=Gh(t,0);return e.consumed!==t.length&&On.throwArgumentError("invalid rlp data","data",i),e.result}const Rx="address/5.6.1",Pr=new H(Rx);function pf(i){ee(i,20)||Pr.throwArgumentError("invalid address","address",i),i=i.toLowerCase();const t=i.substring(2).split(""),e=new Uint8Array(40);for(let r=0;r<40;r++)e[r]=t[r].charCodeAt(0);const n=Nt(Me(e));for(let r=0;r<40;r+=2)n[r>>1]>>4>=8&&(t[r]=t[r].toUpperCase()),(n[r>>1]&15)>=8&&(t[r+1]=t[r+1].toUpperCase());return"0x"+t.join("")}const Px=9007199254740991;function Ix(i){return Math.log10?Math.log10(i):Math.log(i)/Math.LN10}const Cl={};for(let i=0;i<10;i++)Cl[String(i)]=String(i);for(let i=0;i<26;i++)Cl[String.fromCharCode(65+i)]=String(10+i);const mf=Math.floor(Ix(Px));function Lx(i){i=i.toUpperCase(),i=i.substring(4)+i.substring(0,2)+"00";let t=i.split("").map(n=>Cl[n]).join("");for(;t.length>=mf;){let n=t.substring(0,mf);t=parseInt(n,10)%97+t.substring(n.length)}let e=String(98-parseInt(t,10)%97);for(;e.length<2;)e="0"+e;return e}function Pe(i){let t=null;if(typeof i!="string"&&Pr.throwArgumentError("invalid address","address",i),i.match(/^(0x)?[0-9a-fA-F]{40}$/))i.substring(0,2)!=="0x"&&(i="0x"+i),t=pf(i),i.match(/([A-F].*[a-f])|([a-f].*[A-F])/)&&t!==i&&Pr.throwArgumentError("bad address checksum","address",i);else if(i.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){for(i.substring(2,4)!==Lx(i)&&Pr.throwArgumentError("bad icap checksum","address",i),t=px(i.substring(4));t.length<40;)t="0"+t;t=pf("0x"+t)}else Pr.throwArgumentError("invalid address","address",i);return t}function Vh(i){let t=null;try{t=Pe(i.from)}catch{Pr.throwArgumentError("missing from address","transaction",i)}const e=Wr(Nt(pt.from(i.nonce).toHexString()));return Pe(Fe(Me(Ho([t,e])),12))}class Dx extends Si{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,e){try{e=Pe(e)}catch(n){this._throwError(n.message,e)}return t.writeValue(e)}decode(t){return Pe(he(t.readValue().toHexString(),20))}}class Nx extends Si{constructor(t){super(t.name,t.type,void 0,t.dynamic),this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,e){return this.coder.encode(t,e)}decode(t){return this.coder.decode(t)}}const Ir=new H(zs);function Hh(i,t,e){let n=null;if(Array.isArray(e))n=e;else if(e&&typeof e=="object"){let l={};n=t.map(c=>{const h=c.localName;return h||Ir.throwError("cannot encode object for signature with missing names",H.errors.INVALID_ARGUMENT,{argument:"values",coder:c,value:e}),l[h]&&Ir.throwError("cannot encode object for signature with duplicate names",H.errors.INVALID_ARGUMENT,{argument:"values",coder:c,value:e}),l[h]=!0,e[h]})}else Ir.throwArgumentError("invalid tuple value","tuple",e);t.length!==n.length&&Ir.throwArgumentError("types/value length mismatch","tuple",e);let r=new il(i.wordSize),s=new il(i.wordSize),o=[];t.forEach((l,c)=>{let h=n[c];if(l.dynamic){let u=s.length;l.encode(s,h);let p=r.writeUpdatableValue();o.push(x=>{p(x+u)})}else l.encode(r,h)}),o.forEach(l=>{l(r.length)});let a=i.appendWriter(r);return a+=i.appendWriter(s),a}function Wh(i,t){let e=[],n=i.subReader(0);t.forEach(s=>{let o=null;if(s.dynamic){let a=i.readValue(),l=n.subReader(a.toNumber());try{o=s.decode(l)}catch(c){if(c.code===H.errors.BUFFER_OVERRUN)throw c;o=c,o.baseType=s.name,o.name=s.localName,o.type=s.type}}else try{o=s.decode(i)}catch(a){if(a.code===H.errors.BUFFER_OVERRUN)throw a;o=a,o.baseType=s.name,o.name=s.localName,o.type=s.type}o!=null&&e.push(o)});const r=t.reduce((s,o)=>{const a=o.localName;return a&&(s[a]||(s[a]=0),s[a]++),s},{});t.forEach((s,o)=>{let a=s.localName;if(!a||r[a]!==1||(a==="length"&&(a="_length"),e[a]!=null))return;const l=e[o];l instanceof Error?Object.defineProperty(e,a,{enumerable:!0,get:()=>{throw l}}):e[a]=l});for(let s=0;s<e.length;s++){const o=e[s];o instanceof Error&&Object.defineProperty(e,s,{enumerable:!0,get:()=>{throw o}})}return Object.freeze(e)}class Fx extends Si{constructor(t,e,n){const r=t.type+"["+(e>=0?e:"")+"]",s=e===-1||t.dynamic;super("array",r,n,s),this.coder=t,this.length=e}defaultValue(){const t=this.coder.defaultValue(),e=[];for(let n=0;n<this.length;n++)e.push(t);return e}encode(t,e){Array.isArray(e)||this._throwError("expected array value",e);let n=this.length;n===-1&&(n=e.length,t.writeValue(e.length)),Ir.checkArgumentCount(e.length,n,"coder array"+(this.localName?" "+this.localName:""));let r=[];for(let s=0;s<e.length;s++)r.push(this.coder);return Hh(t,r,e)}decode(t){let e=this.length;e===-1&&(e=t.readValue().toNumber(),e*32>t._data.length&&Ir.throwError("insufficient data length",H.errors.BUFFER_OVERRUN,{length:t._data.length,count:e}));let n=[];for(let r=0;r<e;r++)n.push(new Nx(this.coder));return t.coerce(this.name,Wh(t,n))}}class Bx extends Si{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,e){return t.writeValue(e?1:0)}decode(t){return t.coerce(this.type,!t.readValue().isZero())}}class qh extends Si{constructor(t,e){super(t,t,e,!0)}defaultValue(){return"0x"}encode(t,e){e=Nt(e);let n=t.writeValue(e.length);return n+=t.writeBytes(e),n}decode(t){return t.readBytes(t.readValue().toNumber(),!0)}}class kx extends qh{constructor(t){super("bytes",t)}decode(t){return t.coerce(this.name,Rt(super.decode(t)))}}class Ox extends Si{constructor(t,e){let n="bytes"+String(t);super(n,n,e,!1),this.size=t}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,e){let n=Nt(e);return n.length!==this.size&&this._throwError("incorrect data length",e),t.writeBytes(n)}decode(t){return t.coerce(this.name,Rt(t.readBytes(this.size)))}}class Ux extends Si{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,e){return e!=null&&this._throwError("not null",e),t.writeBytes([])}decode(t){return t.readBytes(0),t.coerce(this.name,null)}}const zx="0x0000000000000000000000000000000000000000",Gx=pt.from(-1),jh=pt.from(0),Vx=pt.from(1),Hx=pt.from("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Wx="0x0000000000000000000000000000000000000000000000000000000000000000";class qx extends Si{constructor(t,e,n){const r=(e?"int":"uint")+t*8;super(r,r,n,!1),this.size=t,this.signed=e}defaultValue(){return 0}encode(t,e){let n=pt.from(e),r=Hx.mask(t.wordSize*8);if(this.signed){let s=r.mask(this.size*8-1);(n.gt(s)||n.lt(s.add(Vx).mul(Gx)))&&this._throwError("value out-of-bounds",e)}else(n.lt(jh)||n.gt(r.mask(this.size*8)))&&this._throwError("value out-of-bounds",e);return n=n.toTwos(this.size*8).mask(this.size*8),this.signed&&(n=n.fromTwos(this.size*8).toTwos(8*t.wordSize)),t.writeValue(n)}decode(t){let e=t.readValue().mask(this.size*8);return this.signed&&(e=e.fromTwos(this.size*8)),t.coerce(this.name,e)}}const jx="strings/5.6.1",Xh=new H(jx);var qr;(function(i){i.current="",i.NFC="NFC",i.NFD="NFD",i.NFKC="NFKC",i.NFKD="NFKD"})(qr||(qr={}));var nn;(function(i){i.UNEXPECTED_CONTINUE="unexpected continuation byte",i.BAD_PREFIX="bad codepoint prefix",i.OVERRUN="string overrun",i.MISSING_CONTINUE="missing continuation byte",i.OUT_OF_RANGE="out of UTF-8 range",i.UTF16_SURROGATE="UTF-16 surrogate",i.OVERLONG="overlong representation"})(nn||(nn={}));function Xx(i,t,e,n,r){return Xh.throwArgumentError(`invalid codepoint at offset ${t}; ${i}`,"bytes",e)}function Zh(i,t,e,n,r){if(i===nn.BAD_PREFIX||i===nn.UNEXPECTED_CONTINUE){let s=0;for(let o=t+1;o<e.length&&e[o]>>6===2;o++)s++;return s}return i===nn.OVERRUN?e.length-t-1:0}function Zx(i,t,e,n,r){return i===nn.OVERLONG?(n.push(r),0):(n.push(65533),Zh(i,t,e,n,r))}const Yx=Object.freeze({error:Xx,ignore:Zh,replace:Zx});function Yh(i,t){t==null&&(t=Yx.error),i=Nt(i);const e=[];let n=0;for(;n<i.length;){const r=i[n++];if(r>>7===0){e.push(r);continue}let s=null,o=null;if((r&224)===192)s=1,o=127;else if((r&240)===224)s=2,o=2047;else if((r&248)===240)s=3,o=65535;else{(r&192)===128?n+=t(nn.UNEXPECTED_CONTINUE,n-1,i,e):n+=t(nn.BAD_PREFIX,n-1,i,e);continue}if(n-1+s>=i.length){n+=t(nn.OVERRUN,n-1,i,e);continue}let a=r&(1<<8-s-1)-1;for(let l=0;l<s;l++){let c=i[n];if((c&192)!=128){n+=t(nn.MISSING_CONTINUE,n,i,e),a=null;break}a=a<<6|c&63,n++}if(a!==null){if(a>1114111){n+=t(nn.OUT_OF_RANGE,n-1-s,i,e,a);continue}if(a>=55296&&a<=57343){n+=t(nn.UTF16_SURROGATE,n-1-s,i,e,a);continue}if(a<=o){n+=t(nn.OVERLONG,n-1-s,i,e,a);continue}e.push(a)}}return e}function Qn(i,t=qr.current){t!=qr.current&&(Xh.checkNormalize(),i=i.normalize(t));let e=[];for(let n=0;n<i.length;n++){const r=i.charCodeAt(n);if(r<128)e.push(r);else if(r<2048)e.push(r>>6|192),e.push(r&63|128);else if((r&64512)==55296){n++;const s=i.charCodeAt(n);if(n>=i.length||(s&64512)!==56320)throw new Error("invalid utf-8 string");const o=65536+((r&1023)<<10)+(s&1023);e.push(o>>18|240),e.push(o>>12&63|128),e.push(o>>6&63|128),e.push(o&63|128)}else e.push(r>>12|224),e.push(r>>6&63|128),e.push(r&63|128)}return Nt(e)}function rl(i){return i.map(t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode((t>>10&1023)+55296,(t&1023)+56320))).join("")}function Gs(i,t){return rl(Yh(i,t))}function gf(i,t=qr.current){return Yh(Qn(i,t))}function Jx(i){if(i.length%4!==0)throw new Error("bad data");let t=[];for(let e=0;e<i.length;e+=4)t.push(parseInt(i.substring(e,e+4),16));return t}function Rl(i,t){t||(t=function(r){return[parseInt(r,16)]});let e=0,n={};return i.split(",").forEach(r=>{let s=r.split(":");e+=parseInt(s[0],16),n[e]=t(s[1])}),n}function Jh(i){let t=0;return i.split(",").map(e=>{let n=e.split("-");n.length===1?n[1]="0":n[1]===""&&(n[1]="1");let r=t+parseInt(n[0],16);return t=parseInt(n[1],16),{l:r,h:t}})}function Pl(i,t){let e=0;for(let n=0;n<t.length;n++){let r=t[n];if(e+=r.l,i>=e&&i<=e+r.h&&(i-e)%(r.d||1)===0){if(r.e&&r.e.indexOf(i-e)!==-1)continue;return r}}return null}const Kx=Jh("221,13-1b,5f-,40-10,51-f,11-3,3-3,2-2,2-4,8,2,15,2d,28-8,88,48,27-,3-5,11-20,27-,8,28,3-5,12,18,b-a,1c-4,6-16,2-d,2-2,2,1b-4,17-9,8f-,10,f,1f-2,1c-34,33-14e,4,36-,13-,6-2,1a-f,4,9-,3-,17,8,2-2,5-,2,8-,3-,4-8,2-3,3,6-,16-6,2-,7-3,3-,17,8,3,3,3-,2,6-3,3-,4-a,5,2-6,10-b,4,8,2,4,17,8,3,6-,b,4,4-,2-e,2-4,b-10,4,9-,3-,17,8,3-,5-,9-2,3-,4-7,3-3,3,4-3,c-10,3,7-2,4,5-2,3,2,3-2,3-2,4-2,9,4-3,6-2,4,5-8,2-e,d-d,4,9,4,18,b,6-3,8,4,5-6,3-8,3-3,b-11,3,9,4,18,b,6-3,8,4,5-6,3-6,2,3-3,b-11,3,9,4,18,11-3,7-,4,5-8,2-7,3-3,b-11,3,13-2,19,a,2-,8-2,2-3,7,2,9-11,4-b,3b-3,1e-24,3,2-,3,2-,2-5,5,8,4,2,2-,3,e,4-,6,2,7-,b-,3-21,49,23-5,1c-3,9,25,10-,2-2f,23,6,3,8-2,5-5,1b-45,27-9,2a-,2-3,5b-4,45-4,53-5,8,40,2,5-,8,2,5-,28,2,5-,20,2,5-,8,2,5-,8,8,18,20,2,5-,8,28,14-5,1d-22,56-b,277-8,1e-2,52-e,e,8-a,18-8,15-b,e,4,3-b,5e-2,b-15,10,b-5,59-7,2b-555,9d-3,5b-5,17-,7-,27-,7-,9,2,2,2,20-,36,10,f-,7,14-,4,a,54-3,2-6,6-5,9-,1c-10,13-1d,1c-14,3c-,10-6,32-b,240-30,28-18,c-14,a0,115-,3,66-,b-76,5,5-,1d,24,2,5-2,2,8-,35-2,19,f-10,1d-3,311-37f,1b,5a-b,d7-19,d-3,41,57-,68-4,29-3,5f,29-37,2e-2,25-c,2c-2,4e-3,30,78-3,64-,20,19b7-49,51a7-59,48e-2,38-738,2ba5-5b,222f-,3c-94,8-b,6-4,1b,6,2,3,3,6d-20,16e-f,41-,37-7,2e-2,11-f,5-b,18-,b,14,5-3,6,88-,2,bf-2,7-,7-,7-,4-2,8,8-9,8-2ff,20,5-b,1c-b4,27-,27-cbb1,f7-9,28-2,b5-221,56,48,3-,2-,3-,5,d,2,5,3,42,5-,9,8,1d,5,6,2-2,8,153-3,123-3,33-27fd,a6da-5128,21f-5df,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3-fffd,3,2-1d,61-ff7d"),Qx="ad,34f,1806,180b,180c,180d,200b,200c,200d,2060,feff".split(",").map(i=>parseInt(i,16)),$x=[{h:25,s:32,l:65},{h:30,s:32,e:[23],l:127},{h:54,s:1,e:[48],l:64,d:2},{h:14,s:1,l:57,d:2},{h:44,s:1,l:17,d:2},{h:10,s:1,e:[2,6,8],l:61,d:2},{h:16,s:1,l:68,d:2},{h:84,s:1,e:[18,24,66],l:19,d:2},{h:26,s:32,e:[17],l:435},{h:22,s:1,l:71,d:2},{h:15,s:80,l:40},{h:31,s:32,l:16},{h:32,s:1,l:80,d:2},{h:52,s:1,l:42,d:2},{h:12,s:1,l:55,d:2},{h:40,s:1,e:[38],l:15,d:2},{h:14,s:1,l:48,d:2},{h:37,s:48,l:49},{h:148,s:1,l:6351,d:2},{h:88,s:1,l:160,d:2},{h:15,s:16,l:704},{h:25,s:26,l:854},{h:25,s:32,l:55915},{h:37,s:40,l:1247},{h:25,s:-119711,l:53248},{h:25,s:-119763,l:52},{h:25,s:-119815,l:52},{h:25,s:-119867,e:[1,4,5,7,8,11,12,17],l:52},{h:25,s:-119919,l:52},{h:24,s:-119971,e:[2,7,8,17],l:52},{h:24,s:-120023,e:[2,7,13,15,16,17],l:52},{h:25,s:-120075,l:52},{h:25,s:-120127,l:52},{h:25,s:-120179,l:52},{h:25,s:-120231,l:52},{h:25,s:-120283,l:52},{h:25,s:-120335,l:52},{h:24,s:-119543,e:[17],l:56},{h:24,s:-119601,e:[17],l:58},{h:24,s:-119659,e:[17],l:58},{h:24,s:-119717,e:[17],l:58},{h:24,s:-119775,e:[17],l:58}],t_=Rl("b5:3bc,c3:ff,7:73,2:253,5:254,3:256,1:257,5:259,1:25b,3:260,1:263,2:269,1:268,5:26f,1:272,2:275,7:280,3:283,5:288,3:28a,1:28b,5:292,3f:195,1:1bf,29:19e,125:3b9,8b:3b2,1:3b8,1:3c5,3:3c6,1:3c0,1a:3ba,1:3c1,1:3c3,2:3b8,1:3b5,1bc9:3b9,1c:1f76,1:1f77,f:1f7a,1:1f7b,d:1f78,1:1f79,1:1f7c,1:1f7d,107:63,5:25b,4:68,1:68,1:68,3:69,1:69,1:6c,3:6e,4:70,1:71,1:72,1:72,1:72,7:7a,2:3c9,2:7a,2:6b,1:e5,1:62,1:63,3:65,1:66,2:6d,b:3b3,1:3c0,6:64,1b574:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3,20:3b8,1a:3c3"),e_=Rl("179:1,2:1,2:1,5:1,2:1,a:4f,a:1,8:1,2:1,2:1,3:1,5:1,3:1,4:1,2:1,3:1,4:1,8:2,1:1,2:2,1:1,2:2,27:2,195:26,2:25,1:25,1:25,2:40,2:3f,1:3f,33:1,11:-6,1:-9,1ac7:-3a,6d:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,b:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,c:-8,2:-8,2:-8,2:-8,9:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,1:-8,49:-8,1:-8,1:-4a,1:-4a,d:-56,1:-56,1:-56,1:-56,d:-8,1:-8,f:-8,1:-8,3:-7"),n_=Rl("df:00730073,51:00690307,19:02BC006E,a7:006A030C,18a:002003B9,16:03B903080301,20:03C503080301,1d7:05650582,190f:00680331,1:00740308,1:0077030A,1:0079030A,1:006102BE,b6:03C50313,2:03C503130300,2:03C503130301,2:03C503130342,2a:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F0003B9,1:1F0103B9,1:1F0203B9,1:1F0303B9,1:1F0403B9,1:1F0503B9,1:1F0603B9,1:1F0703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F2003B9,1:1F2103B9,1:1F2203B9,1:1F2303B9,1:1F2403B9,1:1F2503B9,1:1F2603B9,1:1F2703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,1:1F6003B9,1:1F6103B9,1:1F6203B9,1:1F6303B9,1:1F6403B9,1:1F6503B9,1:1F6603B9,1:1F6703B9,3:1F7003B9,1:03B103B9,1:03AC03B9,2:03B10342,1:03B1034203B9,5:03B103B9,6:1F7403B9,1:03B703B9,1:03AE03B9,2:03B70342,1:03B7034203B9,5:03B703B9,6:03B903080300,1:03B903080301,3:03B90342,1:03B903080342,b:03C503080300,1:03C503080301,1:03C10313,2:03C50342,1:03C503080342,b:1F7C03B9,1:03C903B9,1:03CE03B9,2:03C90342,1:03C9034203B9,5:03C903B9,ac:00720073,5b:00B00063,6:00B00066,d:006E006F,a:0073006D,1:00740065006C,1:0074006D,124f:006800700061,2:00610075,2:006F0076,b:00700061,1:006E0061,1:03BC0061,1:006D0061,1:006B0061,1:006B0062,1:006D0062,1:00670062,3:00700066,1:006E0066,1:03BC0066,4:0068007A,1:006B0068007A,1:006D0068007A,1:00670068007A,1:00740068007A,15:00700061,1:006B00700061,1:006D00700061,1:006700700061,8:00700076,1:006E0076,1:03BC0076,1:006D0076,1:006B0076,1:006D0076,1:00700077,1:006E0077,1:03BC0077,1:006D0077,1:006B0077,1:006D0077,1:006B03C9,1:006D03C9,2:00620071,3:00632215006B0067,1:0063006F002E,1:00640062,1:00670079,2:00680070,2:006B006B,1:006B006D,9:00700068,2:00700070006D,1:00700072,2:00730076,1:00770062,c723:00660066,1:00660069,1:0066006C,1:006600660069,1:00660066006C,1:00730074,1:00730074,d:05740576,1:05740565,1:0574056B,1:057E0576,1:0574056D",Jx),i_=Jh("80-20,2a0-,39c,32,f71,18e,7f2-f,19-7,30-4,7-5,f81-b,5,a800-20ff,4d1-1f,110,fa-6,d174-7,2e84-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,ffff-,2,1f-5f,ff7f-20001");function r_(i){return i.reduce((t,e)=>(e.forEach(n=>{t.push(n)}),t),[])}function s_(i){return!!Pl(i,Kx)}function o_(i){let t=Pl(i,$x);if(t)return[i+t.s];let e=t_[i];if(e)return e;let n=e_[i];if(n)return[i+n[0]];let r=n_[i];return r||null}function a_(i){return!!Pl(i,i_)}function Kh(i){if(i.match(/^[a-z0-9-]*$/i)&&i.length<=59)return i.toLowerCase();let t=gf(i);t=r_(t.map(n=>{if(Qx.indexOf(n)>=0)return[];if(n>=65024&&n<=65039)return[];let r=o_(n);return r||[n]})),t=gf(rl(t),qr.NFKC),t.forEach(n=>{if(a_(n))throw new Error("STRINGPREP_CONTAINS_PROHIBITED")}),t.forEach(n=>{if(s_(n))throw new Error("STRINGPREP_CONTAINS_UNASSIGNED")});let e=rl(t);if(e.substring(0,1)==="-"||e.substring(2,4)==="--"||e.substring(e.length-1)==="-")throw new Error("invalid hyphen");if(e.length>63)throw new Error("too long");return e}class l_ extends qh{constructor(t){super("string",t)}defaultValue(){return""}encode(t,e){return super.encode(t,Qn(e))}decode(t){return Gs(super.decode(t))}}class ho extends Si{constructor(t,e){let n=!1;const r=[];t.forEach(o=>{o.dynamic&&(n=!0),r.push(o.type)});const s="tuple("+r.join(",")+")";super("tuple",s,e,n),this.coders=t}defaultValue(){const t=[];this.coders.forEach(n=>{t.push(n.defaultValue())});const e=this.coders.reduce((n,r)=>{const s=r.localName;return s&&(n[s]||(n[s]=0),n[s]++),n},{});return this.coders.forEach((n,r)=>{let s=n.localName;!s||e[s]!==1||(s==="length"&&(s="_length"),t[s]==null&&(t[s]=t[r]))}),Object.freeze(t)}encode(t,e){return Hh(t,this.coders,e)}decode(t){return t.coerce(this.name,Wh(t,this.coders))}}const uo=new H(zs),c_=new RegExp(/^bytes([0-9]*)$/),f_=new RegExp(/^(u?int)([0-9]*)$/);class h_{constructor(t){dt(this,"coerceFunc",t||null)}_getCoder(t){switch(t.baseType){case"address":return new Dx(t.name);case"bool":return new Bx(t.name);case"string":return new l_(t.name);case"bytes":return new kx(t.name);case"array":return new Fx(this._getCoder(t.arrayChildren),t.arrayLength,t.name);case"tuple":return new ho((t.components||[]).map(n=>this._getCoder(n)),t.name);case"":return new Ux(t.name)}let e=t.type.match(f_);if(e){let n=parseInt(e[2]||"256");return(n===0||n>256||n%8!==0)&&uo.throwArgumentError("invalid "+e[1]+" bit length","param",t),new qx(n/8,e[1]==="int",t.name)}if(e=t.type.match(c_),e){let n=parseInt(e[1]);return(n===0||n>32)&&uo.throwArgumentError("invalid bytes length","param",t),new Ox(n,t.name)}return uo.throwArgumentError("invalid type","type",t.type)}_getWordSize(){return 32}_getReader(t,e){return new Po(t,this._getWordSize(),this.coerceFunc,e)}_getWriter(){return new il(this._getWordSize())}getDefaultValue(t){const e=t.map(r=>this._getCoder(Ae.from(r)));return new ho(e,"_").defaultValue()}encode(t,e){t.length!==e.length&&uo.throwError("types/values length mismatch",H.errors.INVALID_ARGUMENT,{count:{types:t.length,values:e.length},value:{types:t,values:e}});const n=t.map(o=>this._getCoder(Ae.from(o))),r=new ho(n,"_"),s=this._getWriter();return r.encode(s,e),s.data}decode(t,e,n){const r=t.map(o=>this._getCoder(Ae.from(o)));return new ho(r,"_").decode(this._getReader(Nt(e),n))}}const u_=new h_;function Lr(i){return Me(Qn(i))}const Qh="hash/5.6.1",vf=new H(Qh),$h=new Uint8Array(32);$h.fill(0);const d_=new RegExp("^((.*)\\.)?([^.]+)$");function wo(i){typeof i!="string"&&vf.throwArgumentError("invalid ENS name; not a string","name",i);let t=i,e=$h;for(;t.length;){const n=t.match(d_);(n==null||n[2]==="")&&vf.throwArgumentError("invalid ENS address; missing component","name",i);const r=Qn(Kh(n[3]));e=Me(on([e,Me(r)])),t=n[2]||""}return Rt(e)}function p_(i){return Rt(on(i.split(".").map(t=>{const e=Qn("_"+Kh(t));return e[0]=e.length-1,e})))+"00"}var m_=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const me=new H(Qh),tu=new Uint8Array(32);tu.fill(0);const g_=pt.from(-1),eu=pt.from(0),nu=pt.from(1),v_=pt.from("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function x_(i){const t=Nt(i),e=t.length%32;return e?Ke([t,tu.slice(e)]):Rt(t)}const __=he(nu.toHexString(),32),y_=he(eu.toHexString(),32),xf={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},Na=["name","version","chainId","verifyingContract","salt"];function _f(i){return function(t){return typeof t!="string"&&me.throwArgumentError(`invalid domain value for ${JSON.stringify(i)}`,`domain.${i}`,t),t}}const b_={name:_f("name"),version:_f("version"),chainId:function(i){try{return pt.from(i).toString()}catch{}return me.throwArgumentError('invalid domain value for "chainId"',"domain.chainId",i)},verifyingContract:function(i){try{return Pe(i).toLowerCase()}catch{}return me.throwArgumentError('invalid domain value "verifyingContract"',"domain.verifyingContract",i)},salt:function(i){try{const t=Nt(i);if(t.length!==32)throw new Error("bad length");return Rt(t)}catch{}return me.throwArgumentError('invalid domain value "salt"',"domain.salt",i)}};function Fa(i){{const t=i.match(/^(u?)int(\d*)$/);if(t){const e=t[1]==="",n=parseInt(t[2]||"256");(n%8!==0||n>256||t[2]&&t[2]!==String(n))&&me.throwArgumentError("invalid numeric width","type",i);const r=v_.mask(e?n-1:n),s=e?r.add(nu).mul(g_):eu;return function(o){const a=pt.from(o);return(a.lt(s)||a.gt(r))&&me.throwArgumentError(`value out-of-bounds for ${i}`,"value",o),he(a.toTwos(256).toHexString(),32)}}}{const t=i.match(/^bytes(\d+)$/);if(t){const e=parseInt(t[1]);return(e===0||e>32||t[1]!==String(e))&&me.throwArgumentError("invalid bytes width","type",i),function(n){return Nt(n).length!==e&&me.throwArgumentError(`invalid length for ${i}`,"value",n),x_(n)}}}switch(i){case"address":return function(t){return he(Pe(t),32)};case"bool":return function(t){return t?__:y_};case"bytes":return function(t){return Me(t)};case"string":return function(t){return Lr(t)}}return null}function yf(i,t){return`${i}(${t.map(({name:e,type:n})=>n+" "+e).join(",")})`}class en{constructor(t){dt(this,"types",Object.freeze(yi(t))),dt(this,"_encoderCache",{}),dt(this,"_types",{});const e={},n={},r={};Object.keys(t).forEach(a=>{e[a]={},n[a]=[],r[a]={}});for(const a in t){const l={};t[a].forEach(c=>{l[c.name]&&me.throwArgumentError(`duplicate variable name ${JSON.stringify(c.name)} in ${JSON.stringify(a)}`,"types",t),l[c.name]=!0;const h=c.type.match(/^([^\x5b]*)(\x5b|$)/)[1];h===a&&me.throwArgumentError(`circular type reference to ${JSON.stringify(h)}`,"types",t),!Fa(h)&&(n[h]||me.throwArgumentError(`unknown type ${JSON.stringify(h)}`,"types",t),n[h].push(a),e[a][h]=!0)})}const s=Object.keys(n).filter(a=>n[a].length===0);s.length===0?me.throwArgumentError("missing primary type","types",t):s.length>1&&me.throwArgumentError(`ambiguous primary types or unused types: ${s.map(a=>JSON.stringify(a)).join(", ")}`,"types",t),dt(this,"primaryType",s[0]);function o(a,l){l[a]&&me.throwArgumentError(`circular type reference to ${JSON.stringify(a)}`,"types",t),l[a]=!0,Object.keys(e[a]).forEach(c=>{!n[c]||(o(c,l),Object.keys(l).forEach(h=>{r[h][c]=!0}))}),delete l[a]}o(this.primaryType,{});for(const a in r){const l=Object.keys(r[a]);l.sort(),this._types[a]=yf(a,t[a])+l.map(c=>yf(c,t[c])).join("")}}getEncoder(t){let e=this._encoderCache[t];return e||(e=this._encoderCache[t]=this._getEncoder(t)),e}_getEncoder(t){{const r=Fa(t);if(r)return r}const e=t.match(/^(.*)(\x5b(\d*)\x5d)$/);if(e){const r=e[1],s=this.getEncoder(r),o=parseInt(e[3]);return a=>{o>=0&&a.length!==o&&me.throwArgumentError("array length mismatch; expected length ${ arrayLength }","value",a);let l=a.map(s);return this._types[r]&&(l=l.map(Me)),Me(Ke(l))}}const n=this.types[t];if(n){const r=Lr(this._types[t]);return s=>{const o=n.map(({name:a,type:l})=>{const c=this.getEncoder(l)(s[a]);return this._types[l]?Me(c):c});return o.unshift(r),Ke(o)}}return me.throwArgumentError(`unknown type: ${t}`,"type",t)}encodeType(t){const e=this._types[t];return e||me.throwArgumentError(`unknown type: ${JSON.stringify(t)}`,"name",t),e}encodeData(t,e){return this.getEncoder(t)(e)}hashStruct(t,e){return Me(this.encodeData(t,e))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,e,n){if(Fa(t))return n(t,e);const r=t.match(/^(.*)(\x5b(\d*)\x5d)$/);if(r){const o=r[1],a=parseInt(r[3]);return a>=0&&e.length!==a&&me.throwArgumentError("array length mismatch; expected length ${ arrayLength }","value",e),e.map(l=>this._visit(o,l,n))}const s=this.types[t];return s?s.reduce((o,{name:a,type:l})=>(o[a]=this._visit(l,e[a],n),o),{}):me.throwArgumentError(`unknown type: ${t}`,"type",t)}visit(t,e){return this._visit(this.primaryType,t,e)}static from(t){return new en(t)}static getPrimaryType(t){return en.from(t).primaryType}static hashStruct(t,e,n){return en.from(e).hashStruct(t,n)}static hashDomain(t){const e=[];for(const n in t){const r=xf[n];r||me.throwArgumentError(`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",t),e.push({name:n,type:r})}return e.sort((n,r)=>Na.indexOf(n.name)-Na.indexOf(r.name)),en.hashStruct("EIP712Domain",{EIP712Domain:e},t)}static encode(t,e,n){return Ke(["0x1901",en.hashDomain(t),en.from(e).hash(n)])}static hash(t,e,n){return Me(en.encode(t,e,n))}static resolveNames(t,e,n,r){return m_(this,void 0,void 0,function*(){t=Ee(t);const s={};t.verifyingContract&&!ee(t.verifyingContract,20)&&(s[t.verifyingContract]="0x");const o=en.from(e);o.visit(n,(a,l)=>(a==="address"&&!ee(l,20)&&(s[l]="0x"),l));for(const a in s)s[a]=yield r(a);return t.verifyingContract&&s[t.verifyingContract]&&(t.verifyingContract=s[t.verifyingContract]),n=o.visit(n,(a,l)=>a==="address"&&s[l]?s[l]:l),{domain:t,value:n}})}static getPayload(t,e,n){en.hashDomain(t);const r={},s=[];Na.forEach(l=>{const c=t[l];c!=null&&(r[l]=b_[l](c),s.push({name:l,type:xf[l]}))});const o=en.from(e),a=Ee(e);return a.EIP712Domain?me.throwArgumentError("types must not contain EIP712Domain type","types.EIP712Domain",e):a.EIP712Domain=s,o.encode(n),{types:a,domain:r,primaryType:o.primaryType,message:o.visit(n,(l,c)=>{if(l.match(/^bytes(\d*)/))return Rt(Nt(c));if(l.match(/^u?int/))return pt.from(c).toString();switch(l){case"address":return c.toLowerCase();case"bool":return!!c;case"string":return typeof c!="string"&&me.throwArgumentError("invalid string","value",c),c}return me.throwArgumentError("unsupported type","type",l)})}}}const de=new H(zs);class w_ extends Us{}class M_ extends Us{}class S_ extends Us{}class sl extends Us{static isIndexed(t){return!!(t&&t._isIndexed)}}const A_={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:!0},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"]}};function bf(i,t){const e=new Error(`deferred error during ABI decoding triggered accessing ${i}`);return e.error=t,e}class wf{constructor(t){let e=[];typeof t=="string"?e=JSON.parse(t):e=t,dt(this,"fragments",e.map(n=>vi.from(n)).filter(n=>n!=null)),dt(this,"_abiCoder",jn(new.target,"getAbiCoder")()),dt(this,"functions",{}),dt(this,"errors",{}),dt(this,"events",{}),dt(this,"structs",{}),this.fragments.forEach(n=>{let r=null;switch(n.type){case"constructor":if(this.deploy){de.warn("duplicate definition - constructor");return}dt(this,"deploy",n);return;case"function":r=this.functions;break;case"event":r=this.events;break;case"error":r=this.errors;break;default:return}let s=n.format();if(r[s]){de.warn("duplicate definition - "+s);return}r[s]=n}),this.deploy||dt(this,"deploy",Vn.from({payable:!1,type:"constructor"})),dt(this,"_isInterface",!0)}format(t){t||(t=te.full),t===te.sighash&&de.throwArgumentError("interface does not support formatting sighash","format",t);const e=this.fragments.map(n=>n.format(t));return t===te.json?JSON.stringify(e.map(n=>JSON.parse(n))):e}static getAbiCoder(){return u_}static getAddress(t){return Pe(t)}static getSighash(t){return Fe(Lr(t.format()),0,4)}static getEventTopic(t){return Lr(t.format())}getFunction(t){if(ee(t)){for(const n in this.functions)if(t===this.getSighash(n))return this.functions[n];de.throwArgumentError("no matching function","sighash",t)}if(t.indexOf("(")===-1){const n=t.trim(),r=Object.keys(this.functions).filter(s=>s.split("(")[0]===n);return r.length===0?de.throwArgumentError("no matching function","name",n):r.length>1&&de.throwArgumentError("multiple matching functions","name",n),this.functions[r[0]]}const e=this.functions[Hn.fromString(t).format()];return e||de.throwArgumentError("no matching function","signature",t),e}getEvent(t){if(ee(t)){const n=t.toLowerCase();for(const r in this.events)if(n===this.getEventTopic(r))return this.events[r];de.throwArgumentError("no matching event","topichash",n)}if(t.indexOf("(")===-1){const n=t.trim(),r=Object.keys(this.events).filter(s=>s.split("(")[0]===n);return r.length===0?de.throwArgumentError("no matching event","name",n):r.length>1&&de.throwArgumentError("multiple matching events","name",n),this.events[r[0]]}const e=this.events[gi.fromString(t).format()];return e||de.throwArgumentError("no matching event","signature",t),e}getError(t){if(ee(t)){const n=jn(this.constructor,"getSighash");for(const r in this.errors){const s=this.errors[r];if(t===n(s))return this.errors[r]}de.throwArgumentError("no matching error","sighash",t)}if(t.indexOf("(")===-1){const n=t.trim(),r=Object.keys(this.errors).filter(s=>s.split("(")[0]===n);return r.length===0?de.throwArgumentError("no matching error","name",n):r.length>1&&de.throwArgumentError("multiple matching errors","name",n),this.errors[r[0]]}const e=this.errors[Hn.fromString(t).format()];return e||de.throwArgumentError("no matching error","signature",t),e}getSighash(t){if(typeof t=="string")try{t=this.getFunction(t)}catch(e){try{t=this.getError(t)}catch{throw e}}return jn(this.constructor,"getSighash")(t)}getEventTopic(t){return typeof t=="string"&&(t=this.getEvent(t)),jn(this.constructor,"getEventTopic")(t)}_decodeParams(t,e){return this._abiCoder.decode(t,e)}_encodeParams(t,e){return this._abiCoder.encode(t,e)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,e){typeof t=="string"&&(t=this.getError(t));const n=Nt(e);return Rt(n.slice(0,4))!==this.getSighash(t)&&de.throwArgumentError(`data signature does not match error ${t.name}.`,"data",Rt(n)),this._decodeParams(t.inputs,n.slice(4))}encodeErrorResult(t,e){return typeof t=="string"&&(t=this.getError(t)),Rt(on([this.getSighash(t),this._encodeParams(t.inputs,e||[])]))}decodeFunctionData(t,e){typeof t=="string"&&(t=this.getFunction(t));const n=Nt(e);return Rt(n.slice(0,4))!==this.getSighash(t)&&de.throwArgumentError(`data signature does not match function ${t.name}.`,"data",Rt(n)),this._decodeParams(t.inputs,n.slice(4))}encodeFunctionData(t,e){return typeof t=="string"&&(t=this.getFunction(t)),Rt(on([this.getSighash(t),this._encodeParams(t.inputs,e||[])]))}decodeFunctionResult(t,e){typeof t=="string"&&(t=this.getFunction(t));let n=Nt(e),r=null,s="",o=null,a=null,l=null;switch(n.length%this._abiCoder._getWordSize()){case 0:try{return this._abiCoder.decode(t.outputs,n)}catch{}break;case 4:{const c=Rt(n.slice(0,4)),h=A_[c];if(h)o=this._abiCoder.decode(h.inputs,n.slice(4)),a=h.name,l=h.signature,h.reason&&(r=o[0]),a==="Error"?s=`; VM Exception while processing transaction: reverted with reason string ${JSON.stringify(o[0])}`:a==="Panic"&&(s=`; VM Exception while processing transaction: reverted with panic code ${o[0]}`);else try{const u=this.getError(c);o=this._abiCoder.decode(u.inputs,n.slice(4)),a=u.name,l=u.format()}catch{}break}}return de.throwError("call revert exception"+s,H.errors.CALL_EXCEPTION,{method:t.format(),data:Rt(e),errorArgs:o,errorName:a,errorSignature:l,reason:r})}encodeFunctionResult(t,e){return typeof t=="string"&&(t=this.getFunction(t)),Rt(this._abiCoder.encode(t.outputs,e||[]))}encodeFilterTopics(t,e){typeof t=="string"&&(t=this.getEvent(t)),e.length>t.inputs.length&&de.throwError("too many arguments for "+t.format(),H.errors.UNEXPECTED_ARGUMENT,{argument:"values",value:e});let n=[];t.anonymous||n.push(this.getEventTopic(t));const r=(s,o)=>s.type==="string"?Lr(o):s.type==="bytes"?Me(Rt(o)):(s.type==="bool"&&typeof o=="boolean"&&(o=o?"0x01":"0x00"),s.type.match(/^u?int/)&&(o=pt.from(o).toHexString()),s.type==="address"&&this._abiCoder.encode(["address"],[o]),he(Rt(o),32));for(e.forEach((s,o)=>{let a=t.inputs[o];if(!a.indexed){s!=null&&de.throwArgumentError("cannot filter non-indexed parameters; must be null","contract."+a.name,s);return}s==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?de.throwArgumentError("filtering with tuples or arrays not supported","contract."+a.name,s):Array.isArray(s)?n.push(s.map(l=>r(a,l))):n.push(r(a,s))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(t,e){typeof t=="string"&&(t=this.getEvent(t));const n=[],r=[],s=[];return t.anonymous||n.push(this.getEventTopic(t)),e.length!==t.inputs.length&&de.throwArgumentError("event arguments/values mismatch","values",e),t.inputs.forEach((o,a)=>{const l=e[a];if(o.indexed)if(o.type==="string")n.push(Lr(l));else if(o.type==="bytes")n.push(Me(l));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(this._abiCoder.encode([o.type],[l]))}else r.push(o),s.push(l)}),{data:this._abiCoder.encode(r,s),topics:n}}decodeEventLog(t,e,n){if(typeof t=="string"&&(t=this.getEvent(t)),n!=null&&!t.anonymous){let p=this.getEventTopic(t);(!ee(n[0],32)||n[0].toLowerCase()!==p)&&de.throwError("fragment/topic mismatch",H.errors.INVALID_ARGUMENT,{argument:"topics[0]",expected:p,value:n[0]}),n=n.slice(1)}let r=[],s=[],o=[];t.inputs.forEach((p,x)=>{p.indexed?p.type==="string"||p.type==="bytes"||p.baseType==="tuple"||p.baseType==="array"?(r.push(Ae.fromObject({type:"bytes32",name:p.name})),o.push(!0)):(r.push(p),o.push(!1)):(s.push(p),o.push(!1))});let a=n!=null?this._abiCoder.decode(r,on(n)):null,l=this._abiCoder.decode(s,e,!0),c=[],h=0,u=0;t.inputs.forEach((p,x)=>{if(p.indexed)if(a==null)c[x]=new sl({_isIndexed:!0,hash:null});else if(o[x])c[x]=new sl({_isIndexed:!0,hash:a[u++]});else try{c[x]=a[u++]}catch(b){c[x]=b}else try{c[x]=l[h++]}catch(b){c[x]=b}if(p.name&&c[p.name]==null){const b=c[x];b instanceof Error?Object.defineProperty(c,p.name,{enumerable:!0,get:()=>{throw bf(`property ${JSON.stringify(p.name)}`,b)}}):c[p.name]=b}});for(let p=0;p<c.length;p++){const x=c[p];x instanceof Error&&Object.defineProperty(c,p,{enumerable:!0,get:()=>{throw bf(`index ${p}`,x)}})}return Object.freeze(c)}parseTransaction(t){let e=this.getFunction(t.data.substring(0,10).toLowerCase());return e?new M_({args:this._abiCoder.decode(e.inputs,"0x"+t.data.substring(10)),functionFragment:e,name:e.name,signature:e.format(),sighash:this.getSighash(e),value:pt.from(t.value||"0")}):null}parseLog(t){let e=this.getEvent(t.topics[0]);return!e||e.anonymous?null:new w_({eventFragment:e,name:e.name,signature:e.format(),topic:this.getEventTopic(e),args:this.decodeEventLog(e,t.data,t.topics)})}parseError(t){const e=Rt(t);let n=this.getError(e.substring(0,10).toLowerCase());return n?new S_({args:this._abiCoder.decode(n.inputs,"0x"+e.substring(10)),errorFragment:n,name:n.name,signature:n.format(),sighash:this.getSighash(n)}):null}static isInterface(t){return!!(t&&t._isInterface)}}const E_="abstract-provider/5.6.1";var T_=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const C_=new H(E_);class R_ extends Us{static isForkEvent(t){return!!(t&&t._isForkEvent)}}class Wo{constructor(){C_.checkAbstract(new.target,Wo),dt(this,"_isProvider",!0)}getFeeData(){return T_(this,void 0,void 0,function*(){const{block:t,gasPrice:e}=yield ye({block:this.getBlock("latest"),gasPrice:this.getGasPrice().catch(s=>null)});let n=null,r=null;return t&&t.baseFeePerGas&&(r=pt.from("1500000000"),n=t.baseFeePerGas.mul(2).add(r)),{maxFeePerGas:n,maxPriorityFeePerGas:r,gasPrice:e}})}addListener(t,e){return this.on(t,e)}removeListener(t,e){return this.off(t,e)}static isProvider(t){return!!(t&&t._isProvider)}}const P_="abstract-signer/5.6.2";var Mn=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const hn=new H(P_),I_=["accessList","ccipReadEnabled","chainId","customData","data","from","gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","nonce","to","type","value"],L_=[H.errors.INSUFFICIENT_FUNDS,H.errors.NONCE_EXPIRED,H.errors.REPLACEMENT_UNDERPRICED];class Vs{constructor(){hn.checkAbstract(new.target,Vs),dt(this,"_isSigner",!0)}getBalance(t){return Mn(this,void 0,void 0,function*(){return this._checkProvider("getBalance"),yield this.provider.getBalance(this.getAddress(),t)})}getTransactionCount(t){return Mn(this,void 0,void 0,function*(){return this._checkProvider("getTransactionCount"),yield this.provider.getTransactionCount(this.getAddress(),t)})}estimateGas(t){return Mn(this,void 0,void 0,function*(){this._checkProvider("estimateGas");const e=yield ye(this.checkTransaction(t));return yield this.provider.estimateGas(e)})}call(t,e){return Mn(this,void 0,void 0,function*(){this._checkProvider("call");const n=yield ye(this.checkTransaction(t));return yield this.provider.call(n,e)})}sendTransaction(t){return Mn(this,void 0,void 0,function*(){this._checkProvider("sendTransaction");const e=yield this.populateTransaction(t),n=yield this.signTransaction(e);return yield this.provider.sendTransaction(n)})}getChainId(){return Mn(this,void 0,void 0,function*(){return this._checkProvider("getChainId"),(yield this.provider.getNetwork()).chainId})}getGasPrice(){return Mn(this,void 0,void 0,function*(){return this._checkProvider("getGasPrice"),yield this.provider.getGasPrice()})}getFeeData(){return Mn(this,void 0,void 0,function*(){return this._checkProvider("getFeeData"),yield this.provider.getFeeData()})}resolveName(t){return Mn(this,void 0,void 0,function*(){return this._checkProvider("resolveName"),yield this.provider.resolveName(t)})}checkTransaction(t){for(const n in t)I_.indexOf(n)===-1&&hn.throwArgumentError("invalid transaction key: "+n,"transaction",t);const e=Ee(t);return e.from==null?e.from=this.getAddress():e.from=Promise.all([Promise.resolve(e.from),this.getAddress()]).then(n=>(n[0].toLowerCase()!==n[1].toLowerCase()&&hn.throwArgumentError("from address mismatch","transaction",t),n[0])),e}populateTransaction(t){return Mn(this,void 0,void 0,function*(){const e=yield ye(this.checkTransaction(t));e.to!=null&&(e.to=Promise.resolve(e.to).then(r=>Mn(this,void 0,void 0,function*(){if(r==null)return null;const s=yield this.resolveName(r);return s==null&&hn.throwArgumentError("provided ENS name resolves to null","tx.to",r),s})),e.to.catch(r=>{}));const n=e.maxFeePerGas!=null||e.maxPriorityFeePerGas!=null;if(e.gasPrice!=null&&(e.type===2||n)?hn.throwArgumentError("eip-1559 transaction do not support gasPrice","transaction",t):(e.type===0||e.type===1)&&n&&hn.throwArgumentError("pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","transaction",t),(e.type===2||e.type==null)&&e.maxFeePerGas!=null&&e.maxPriorityFeePerGas!=null)e.type=2;else if(e.type===0||e.type===1)e.gasPrice==null&&(e.gasPrice=this.getGasPrice());else{const r=yield this.getFeeData();if(e.type==null)if(r.maxFeePerGas!=null&&r.maxPriorityFeePerGas!=null)if(e.type=2,e.gasPrice!=null){const s=e.gasPrice;delete e.gasPrice,e.maxFeePerGas=s,e.maxPriorityFeePerGas=s}else e.maxFeePerGas==null&&(e.maxFeePerGas=r.maxFeePerGas),e.maxPriorityFeePerGas==null&&(e.maxPriorityFeePerGas=r.maxPriorityFeePerGas);else r.gasPrice!=null?(n&&hn.throwError("network does not support EIP-1559",H.errors.UNSUPPORTED_OPERATION,{operation:"populateTransaction"}),e.gasPrice==null&&(e.gasPrice=r.gasPrice),e.type=0):hn.throwError("failed to get consistent fee data",H.errors.UNSUPPORTED_OPERATION,{operation:"signer.getFeeData"});else e.type===2&&(e.maxFeePerGas==null&&(e.maxFeePerGas=r.maxFeePerGas),e.maxPriorityFeePerGas==null&&(e.maxPriorityFeePerGas=r.maxPriorityFeePerGas))}return e.nonce==null&&(e.nonce=this.getTransactionCount("pending")),e.gasLimit==null&&(e.gasLimit=this.estimateGas(e).catch(r=>{if(L_.indexOf(r.code)>=0)throw r;return hn.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",H.errors.UNPREDICTABLE_GAS_LIMIT,{error:r,tx:e})})),e.chainId==null?e.chainId=this.getChainId():e.chainId=Promise.all([Promise.resolve(e.chainId),this.getChainId()]).then(r=>(r[1]!==0&&r[0]!==r[1]&&hn.throwArgumentError("chainId address mismatch","transaction",t),r[0])),yield ye(e)})}_checkProvider(t){this.provider||hn.throwError("missing provider",H.errors.UNSUPPORTED_OPERATION,{operation:t||"_checkProvider"})}static isSigner(t){return!!(t&&t._isSigner)}}class Il extends Vs{constructor(t,e){super(),dt(this,"address",t),dt(this,"provider",e||null)}getAddress(){return Promise.resolve(this.address)}_fail(t,e){return Promise.resolve().then(()=>{hn.throwError(t,H.errors.UNSUPPORTED_OPERATION,{operation:e})})}signMessage(t){return this._fail("VoidSigner cannot sign messages","signMessage")}signTransaction(t){return this._fail("VoidSigner cannot sign transactions","signTransaction")}_signTypedData(t,e,n){return this._fail("VoidSigner cannot sign typed data","signTypedData")}connect(t){return new Il(this.address,t)}}var iu={},Zt={},Hs=ru;function ru(i,t){if(!i)throw new Error(t||"Assertion failed")}ru.equal=function(t,e,n){if(t!=e)throw new Error(n||"Assertion failed: "+t+" != "+e)};var ol={exports:{}};typeof Object.create=="function"?ol.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:ol.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}};var D_=Hs,N_=ol.exports;Zt.inherits=N_;function F_(i,t){return(i.charCodeAt(t)&64512)!==55296||t<0||t+1>=i.length?!1:(i.charCodeAt(t+1)&64512)===56320}function B_(i,t){if(Array.isArray(i))return i.slice();if(!i)return[];var e=[];if(typeof i=="string")if(t){if(t==="hex")for(i=i.replace(/[^a-z0-9]+/ig,""),i.length%2!==0&&(i="0"+i),r=0;r<i.length;r+=2)e.push(parseInt(i[r]+i[r+1],16))}else for(var n=0,r=0;r<i.length;r++){var s=i.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):F_(i,r)?(s=65536+((s&1023)<<10)+(i.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}else for(r=0;r<i.length;r++)e[r]=i[r]|0;return e}Zt.toArray=B_;function k_(i){for(var t="",e=0;e<i.length;e++)t+=ou(i[e].toString(16));return t}Zt.toHex=k_;function su(i){var t=i>>>24|i>>>8&65280|i<<8&16711680|(i&255)<<24;return t>>>0}Zt.htonl=su;function O_(i,t){for(var e="",n=0;n<i.length;n++){var r=i[n];t==="little"&&(r=su(r)),e+=au(r.toString(16))}return e}Zt.toHex32=O_;function ou(i){return i.length===1?"0"+i:i}Zt.zero2=ou;function au(i){return i.length===7?"0"+i:i.length===6?"00"+i:i.length===5?"000"+i:i.length===4?"0000"+i:i.length===3?"00000"+i:i.length===2?"000000"+i:i.length===1?"0000000"+i:i}Zt.zero8=au;function U_(i,t,e,n){var r=e-t;D_(r%4===0);for(var s=new Array(r/4),o=0,a=t;o<s.length;o++,a+=4){var l;n==="big"?l=i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3]:l=i[a+3]<<24|i[a+2]<<16|i[a+1]<<8|i[a],s[o]=l>>>0}return s}Zt.join32=U_;function z_(i,t){for(var e=new Array(i.length*4),n=0,r=0;n<i.length;n++,r+=4){var s=i[n];t==="big"?(e[r]=s>>>24,e[r+1]=s>>>16&255,e[r+2]=s>>>8&255,e[r+3]=s&255):(e[r+3]=s>>>24,e[r+2]=s>>>16&255,e[r+1]=s>>>8&255,e[r]=s&255)}return e}Zt.split32=z_;function G_(i,t){return i>>>t|i<<32-t}Zt.rotr32=G_;function V_(i,t){return i<<t|i>>>32-t}Zt.rotl32=V_;function H_(i,t){return i+t>>>0}Zt.sum32=H_;function W_(i,t,e){return i+t+e>>>0}Zt.sum32_3=W_;function q_(i,t,e,n){return i+t+e+n>>>0}Zt.sum32_4=q_;function j_(i,t,e,n,r){return i+t+e+n+r>>>0}Zt.sum32_5=j_;function X_(i,t,e,n){var r=i[t],s=i[t+1],o=n+s>>>0,a=(o<n?1:0)+e+r;i[t]=a>>>0,i[t+1]=o}Zt.sum64=X_;function Z_(i,t,e,n){var r=t+n>>>0,s=(r<t?1:0)+i+e;return s>>>0}Zt.sum64_hi=Z_;function Y_(i,t,e,n){var r=t+n;return r>>>0}Zt.sum64_lo=Y_;function J_(i,t,e,n,r,s,o,a){var l=0,c=t;c=c+n>>>0,l+=c<t?1:0,c=c+s>>>0,l+=c<s?1:0,c=c+a>>>0,l+=c<a?1:0;var h=i+e+r+o+l;return h>>>0}Zt.sum64_4_hi=J_;function K_(i,t,e,n,r,s,o,a){var l=t+n+s+a;return l>>>0}Zt.sum64_4_lo=K_;function Q_(i,t,e,n,r,s,o,a,l,c){var h=0,u=t;u=u+n>>>0,h+=u<t?1:0,u=u+s>>>0,h+=u<s?1:0,u=u+a>>>0,h+=u<a?1:0,u=u+c>>>0,h+=u<c?1:0;var p=i+e+r+o+l+h;return p>>>0}Zt.sum64_5_hi=Q_;function $_(i,t,e,n,r,s,o,a,l,c){var h=t+n+s+a+c;return h>>>0}Zt.sum64_5_lo=$_;function ty(i,t,e){var n=t<<32-e|i>>>e;return n>>>0}Zt.rotr64_hi=ty;function ey(i,t,e){var n=i<<32-e|t>>>e;return n>>>0}Zt.rotr64_lo=ey;function ny(i,t,e){return i>>>e}Zt.shr64_hi=ny;function iy(i,t,e){var n=i<<32-e|t>>>e;return n>>>0}Zt.shr64_lo=iy;var ts={},Mf=Zt,ry=Hs;function qo(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}ts.BlockHash=qo;qo.prototype.update=function(t,e){if(t=Mf.toArray(t,e),this.pending?this.pending=this.pending.concat(t):this.pending=t,this.pendingTotal+=t.length,this.pending.length>=this._delta8){t=this.pending;var n=t.length%this._delta8;this.pending=t.slice(t.length-n,t.length),this.pending.length===0&&(this.pending=null),t=Mf.join32(t,0,t.length-n,this.endian);for(var r=0;r<t.length;r+=this._delta32)this._update(t,r,r+this._delta32)}return this};qo.prototype.digest=function(t){return this.update(this._pad()),ry(this.pending===null),this._digest(t)};qo.prototype._pad=function(){var t=this.pendingTotal,e=this._delta8,n=e-(t+this.padLength)%e,r=new Array(n+this.padLength);r[0]=128;for(var s=1;s<n;s++)r[s]=0;if(t<<=3,this.endian==="big"){for(var o=8;o<this.padLength;o++)r[s++]=0;r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=t>>>24&255,r[s++]=t>>>16&255,r[s++]=t>>>8&255,r[s++]=t&255}else for(r[s++]=t&255,r[s++]=t>>>8&255,r[s++]=t>>>16&255,r[s++]=t>>>24&255,r[s++]=0,r[s++]=0,r[s++]=0,r[s++]=0,o=8;o<this.padLength;o++)r[s++]=0;return r};var es={},ni={},sy=Zt,Zn=sy.rotr32;function oy(i,t,e,n){if(i===0)return lu(t,e,n);if(i===1||i===3)return fu(t,e,n);if(i===2)return cu(t,e,n)}ni.ft_1=oy;function lu(i,t,e){return i&t^~i&e}ni.ch32=lu;function cu(i,t,e){return i&t^i&e^t&e}ni.maj32=cu;function fu(i,t,e){return i^t^e}ni.p32=fu;function ay(i){return Zn(i,2)^Zn(i,13)^Zn(i,22)}ni.s0_256=ay;function ly(i){return Zn(i,6)^Zn(i,11)^Zn(i,25)}ni.s1_256=ly;function cy(i){return Zn(i,7)^Zn(i,18)^i>>>3}ni.g0_256=cy;function fy(i){return Zn(i,17)^Zn(i,19)^i>>>10}ni.g1_256=fy;var jr=Zt,hy=ts,uy=ni,Ba=jr.rotl32,ls=jr.sum32,dy=jr.sum32_5,py=uy.ft_1,hu=hy.BlockHash,my=[1518500249,1859775393,2400959708,3395469782];function $n(){if(!(this instanceof $n))return new $n;hu.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}jr.inherits($n,hu);var gy=$n;$n.blockSize=512;$n.outSize=160;$n.hmacStrength=80;$n.padLength=64;$n.prototype._update=function(t,e){for(var n=this.W,r=0;r<16;r++)n[r]=t[e+r];for(;r<n.length;r++)n[r]=Ba(n[r-3]^n[r-8]^n[r-14]^n[r-16],1);var s=this.h[0],o=this.h[1],a=this.h[2],l=this.h[3],c=this.h[4];for(r=0;r<n.length;r++){var h=~~(r/20),u=dy(Ba(s,5),py(h,o,a,l),c,n[r],my[h]);c=l,l=a,a=Ba(o,30),o=s,s=u}this.h[0]=ls(this.h[0],s),this.h[1]=ls(this.h[1],o),this.h[2]=ls(this.h[2],a),this.h[3]=ls(this.h[3],l),this.h[4]=ls(this.h[4],c)};$n.prototype._digest=function(t){return t==="hex"?jr.toHex32(this.h,"big"):jr.split32(this.h,"big")};var Xr=Zt,vy=ts,ns=ni,xy=Hs,Sn=Xr.sum32,_y=Xr.sum32_4,yy=Xr.sum32_5,by=ns.ch32,wy=ns.maj32,My=ns.s0_256,Sy=ns.s1_256,Ay=ns.g0_256,Ey=ns.g1_256,uu=vy.BlockHash,Ty=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ti(){if(!(this instanceof ti))return new ti;uu.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=Ty,this.W=new Array(64)}Xr.inherits(ti,uu);var du=ti;ti.blockSize=512;ti.outSize=256;ti.hmacStrength=192;ti.padLength=64;ti.prototype._update=function(t,e){for(var n=this.W,r=0;r<16;r++)n[r]=t[e+r];for(;r<n.length;r++)n[r]=_y(Ey(n[r-2]),n[r-7],Ay(n[r-15]),n[r-16]);var s=this.h[0],o=this.h[1],a=this.h[2],l=this.h[3],c=this.h[4],h=this.h[5],u=this.h[6],p=this.h[7];for(xy(this.k.length===n.length),r=0;r<n.length;r++){var x=yy(p,Sy(c),by(c,h,u),this.k[r],n[r]),b=Sn(My(s),wy(s,o,a));p=u,u=h,h=c,c=Sn(l,x),l=a,a=o,o=s,s=Sn(x,b)}this.h[0]=Sn(this.h[0],s),this.h[1]=Sn(this.h[1],o),this.h[2]=Sn(this.h[2],a),this.h[3]=Sn(this.h[3],l),this.h[4]=Sn(this.h[4],c),this.h[5]=Sn(this.h[5],h),this.h[6]=Sn(this.h[6],u),this.h[7]=Sn(this.h[7],p)};ti.prototype._digest=function(t){return t==="hex"?Xr.toHex32(this.h,"big"):Xr.split32(this.h,"big")};var al=Zt,pu=du;function bi(){if(!(this instanceof bi))return new bi;pu.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}al.inherits(bi,pu);var Cy=bi;bi.blockSize=512;bi.outSize=224;bi.hmacStrength=192;bi.padLength=64;bi.prototype._digest=function(t){return t==="hex"?al.toHex32(this.h.slice(0,7),"big"):al.split32(this.h.slice(0,7),"big")};var Qe=Zt,Ry=ts,Py=Hs,Yn=Qe.rotr64_hi,Jn=Qe.rotr64_lo,mu=Qe.shr64_hi,gu=Qe.shr64_lo,Di=Qe.sum64,ka=Qe.sum64_hi,Oa=Qe.sum64_lo,Iy=Qe.sum64_4_hi,Ly=Qe.sum64_4_lo,Dy=Qe.sum64_5_hi,Ny=Qe.sum64_5_lo,vu=Ry.BlockHash,Fy=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Ln(){if(!(this instanceof Ln))return new Ln;vu.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=Fy,this.W=new Array(160)}Qe.inherits(Ln,vu);var xu=Ln;Ln.blockSize=1024;Ln.outSize=512;Ln.hmacStrength=192;Ln.padLength=128;Ln.prototype._prepareBlock=function(t,e){for(var n=this.W,r=0;r<32;r++)n[r]=t[e+r];for(;r<n.length;r+=2){var s=jy(n[r-4],n[r-3]),o=Xy(n[r-4],n[r-3]),a=n[r-14],l=n[r-13],c=Wy(n[r-30],n[r-29]),h=qy(n[r-30],n[r-29]),u=n[r-32],p=n[r-31];n[r]=Iy(s,o,a,l,c,h,u,p),n[r+1]=Ly(s,o,a,l,c,h,u,p)}};Ln.prototype._update=function(t,e){this._prepareBlock(t,e);var n=this.W,r=this.h[0],s=this.h[1],o=this.h[2],a=this.h[3],l=this.h[4],c=this.h[5],h=this.h[6],u=this.h[7],p=this.h[8],x=this.h[9],b=this.h[10],g=this.h[11],v=this.h[12],M=this.h[13],D=this.h[14],z=this.h[15];Py(this.k.length===n.length);for(var B=0;B<n.length;B+=2){var O=D,G=z,Z=Vy(p,x),L=Hy(p,x),U=By(p,x,b,g,v),$=ky(p,x,b,g,v,M),j=this.k[B],ht=this.k[B+1],R=n[B],f=n[B+1],m=Dy(O,G,Z,L,U,$,j,ht,R,f),y=Ny(O,G,Z,L,U,$,j,ht,R,f);O=zy(r,s),G=Gy(r,s),Z=Oy(r,s,o,a,l),L=Uy(r,s,o,a,l,c);var w=ka(O,G,Z,L),S=Oa(O,G,Z,L);D=v,z=M,v=b,M=g,b=p,g=x,p=ka(h,u,m,y),x=Oa(u,u,m,y),h=l,u=c,l=o,c=a,o=r,a=s,r=ka(m,y,w,S),s=Oa(m,y,w,S)}Di(this.h,0,r,s),Di(this.h,2,o,a),Di(this.h,4,l,c),Di(this.h,6,h,u),Di(this.h,8,p,x),Di(this.h,10,b,g),Di(this.h,12,v,M),Di(this.h,14,D,z)};Ln.prototype._digest=function(t){return t==="hex"?Qe.toHex32(this.h,"big"):Qe.split32(this.h,"big")};function By(i,t,e,n,r){var s=i&e^~i&r;return s<0&&(s+=4294967296),s}function ky(i,t,e,n,r,s){var o=t&n^~t&s;return o<0&&(o+=4294967296),o}function Oy(i,t,e,n,r){var s=i&e^i&r^e&r;return s<0&&(s+=4294967296),s}function Uy(i,t,e,n,r,s){var o=t&n^t&s^n&s;return o<0&&(o+=4294967296),o}function zy(i,t){var e=Yn(i,t,28),n=Yn(t,i,2),r=Yn(t,i,7),s=e^n^r;return s<0&&(s+=4294967296),s}function Gy(i,t){var e=Jn(i,t,28),n=Jn(t,i,2),r=Jn(t,i,7),s=e^n^r;return s<0&&(s+=4294967296),s}function Vy(i,t){var e=Yn(i,t,14),n=Yn(i,t,18),r=Yn(t,i,9),s=e^n^r;return s<0&&(s+=4294967296),s}function Hy(i,t){var e=Jn(i,t,14),n=Jn(i,t,18),r=Jn(t,i,9),s=e^n^r;return s<0&&(s+=4294967296),s}function Wy(i,t){var e=Yn(i,t,1),n=Yn(i,t,8),r=mu(i,t,7),s=e^n^r;return s<0&&(s+=4294967296),s}function qy(i,t){var e=Jn(i,t,1),n=Jn(i,t,8),r=gu(i,t,7),s=e^n^r;return s<0&&(s+=4294967296),s}function jy(i,t){var e=Yn(i,t,19),n=Yn(t,i,29),r=mu(i,t,6),s=e^n^r;return s<0&&(s+=4294967296),s}function Xy(i,t){var e=Jn(i,t,19),n=Jn(t,i,29),r=gu(i,t,6),s=e^n^r;return s<0&&(s+=4294967296),s}var ll=Zt,_u=xu;function wi(){if(!(this instanceof wi))return new wi;_u.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}ll.inherits(wi,_u);var Zy=wi;wi.blockSize=1024;wi.outSize=384;wi.hmacStrength=192;wi.padLength=128;wi.prototype._digest=function(t){return t==="hex"?ll.toHex32(this.h.slice(0,12),"big"):ll.split32(this.h.slice(0,12),"big")};es.sha1=gy;es.sha224=Cy;es.sha256=du;es.sha384=Zy;es.sha512=xu;var yu={},or=Zt,Yy=ts,po=or.rotl32,Sf=or.sum32,cs=or.sum32_3,Af=or.sum32_4,bu=Yy.BlockHash;function ei(){if(!(this instanceof ei))return new ei;bu.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}or.inherits(ei,bu);yu.ripemd160=ei;ei.blockSize=512;ei.outSize=160;ei.hmacStrength=192;ei.padLength=64;ei.prototype._update=function(t,e){for(var n=this.h[0],r=this.h[1],s=this.h[2],o=this.h[3],a=this.h[4],l=n,c=r,h=s,u=o,p=a,x=0;x<80;x++){var b=Sf(po(Af(n,Ef(x,r,s,o),t[Qy[x]+e],Jy(x)),t1[x]),a);n=a,a=o,o=po(s,10),s=r,r=b,b=Sf(po(Af(l,Ef(79-x,c,h,u),t[$y[x]+e],Ky(x)),e1[x]),p),l=p,p=u,u=po(h,10),h=c,c=b}b=cs(this.h[1],s,u),this.h[1]=cs(this.h[2],o,p),this.h[2]=cs(this.h[3],a,l),this.h[3]=cs(this.h[4],n,c),this.h[4]=cs(this.h[0],r,h),this.h[0]=b};ei.prototype._digest=function(t){return t==="hex"?or.toHex32(this.h,"little"):or.split32(this.h,"little")};function Ef(i,t,e,n){return i<=15?t^e^n:i<=31?t&e|~t&n:i<=47?(t|~e)^n:i<=63?t&n|e&~n:t^(e|~n)}function Jy(i){return i<=15?0:i<=31?1518500249:i<=47?1859775393:i<=63?2400959708:2840853838}function Ky(i){return i<=15?1352829926:i<=31?1548603684:i<=47?1836072691:i<=63?2053994217:0}var Qy=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],$y=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],t1=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],e1=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],n1=Zt,i1=Hs;function Zr(i,t,e){if(!(this instanceof Zr))return new Zr(i,t,e);this.Hash=i,this.blockSize=i.blockSize/8,this.outSize=i.outSize/8,this.inner=null,this.outer=null,this._init(n1.toArray(t,e))}var r1=Zr;Zr.prototype._init=function(t){t.length>this.blockSize&&(t=new this.Hash().update(t).digest()),i1(t.length<=this.blockSize);for(var e=t.length;e<this.blockSize;e++)t.push(0);for(e=0;e<t.length;e++)t[e]^=54;for(this.inner=new this.Hash().update(t),e=0;e<t.length;e++)t[e]^=106;this.outer=new this.Hash().update(t)};Zr.prototype.update=function(t,e){return this.inner.update(t,e),this};Zr.prototype.digest=function(t){return this.outer.update(this.inner.digest()),this.outer.digest(t)};(function(i){var t=i;t.utils=Zt,t.common=ts,t.sha=es,t.ripemd=yu,t.hmac=r1,t.sha1=t.sha.sha1,t.sha256=t.sha.sha256,t.sha224=t.sha.sha224,t.sha384=t.sha.sha384,t.sha512=t.sha.sha512,t.ripemd160=t.ripemd.ripemd160})(iu);var kn=iu;function is(i,t,e){return e={path:t,exports:{},require:function(n,r){return s1(n,r??e.path)}},i(e,e.exports),e.exports}function s1(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var Ll=wu;function wu(i,t){if(!i)throw new Error(t||"Assertion failed")}wu.equal=function(t,e,n){if(t!=e)throw new Error(n||"Assertion failed: "+t+" != "+e)};var Rn=is(function(i,t){var e=t;function n(o,a){if(Array.isArray(o))return o.slice();if(!o)return[];var l=[];if(typeof o!="string"){for(var c=0;c<o.length;c++)l[c]=o[c]|0;return l}if(a==="hex"){o=o.replace(/[^a-z0-9]+/ig,""),o.length%2!==0&&(o="0"+o);for(var c=0;c<o.length;c+=2)l.push(parseInt(o[c]+o[c+1],16))}else for(var c=0;c<o.length;c++){var h=o.charCodeAt(c),u=h>>8,p=h&255;u?l.push(u,p):l.push(p)}return l}e.toArray=n;function r(o){return o.length===1?"0"+o:o}e.zero2=r;function s(o){for(var a="",l=0;l<o.length;l++)a+=r(o[l].toString(16));return a}e.toHex=s,e.encode=function(a,l){return l==="hex"?s(a):a}}),an=is(function(i,t){var e=t;e.assert=Ll,e.toArray=Rn.toArray,e.zero2=Rn.zero2,e.toHex=Rn.toHex,e.encode=Rn.encode;function n(l,c,h){var u=new Array(Math.max(l.bitLength(),h)+1);u.fill(0);for(var p=1<<c+1,x=l.clone(),b=0;b<u.length;b++){var g,v=x.andln(p-1);x.isOdd()?(v>(p>>1)-1?g=(p>>1)-v:g=v,x.isubn(g)):g=0,u[b]=g,x.iushrn(1)}return u}e.getNAF=n;function r(l,c){var h=[[],[]];l=l.clone(),c=c.clone();for(var u=0,p=0,x;l.cmpn(-u)>0||c.cmpn(-p)>0;){var b=l.andln(3)+u&3,g=c.andln(3)+p&3;b===3&&(b=-1),g===3&&(g=-1);var v;(b&1)===0?v=0:(x=l.andln(7)+u&7,(x===3||x===5)&&g===2?v=-b:v=b),h[0].push(v);var M;(g&1)===0?M=0:(x=c.andln(7)+p&7,(x===3||x===5)&&b===2?M=-g:M=g),h[1].push(M),2*u===v+1&&(u=1-u),2*p===M+1&&(p=1-p),l.iushrn(1),c.iushrn(1)}return h}e.getJSF=r;function s(l,c,h){var u="_"+c;l.prototype[c]=function(){return this[u]!==void 0?this[u]:this[u]=h.call(this)}}e.cachedProperty=s;function o(l){return typeof l=="string"?e.toArray(l,"hex"):l}e.parseBytes=o;function a(l){return new Ut(l,"hex","le")}e.intFromLE=a}),Io=an.getNAF,o1=an.getJSF,Lo=an.assert;function Gi(i,t){this.type=i,this.p=new Ut(t.p,16),this.red=t.prime?Ut.red(t.prime):Ut.mont(this.p),this.zero=new Ut(0).toRed(this.red),this.one=new Ut(1).toRed(this.red),this.two=new Ut(2).toRed(this.red),this.n=t.n&&new Ut(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var e=this.n&&this.p.div(this.n);!e||e.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}var fr=Gi;Gi.prototype.point=function(){throw new Error("Not implemented")};Gi.prototype.validate=function(){throw new Error("Not implemented")};Gi.prototype._fixedNafMul=function(t,e){Lo(t.precomputed);var n=t._getDoubles(),r=Io(e,1,this._bitLength),s=(1<<n.step+1)-(n.step%2===0?2:1);s/=3;var o=[],a,l;for(a=0;a<r.length;a+=n.step){l=0;for(var c=a+n.step-1;c>=a;c--)l=(l<<1)+r[c];o.push(l)}for(var h=this.jpoint(null,null,null),u=this.jpoint(null,null,null),p=s;p>0;p--){for(a=0;a<o.length;a++)l=o[a],l===p?u=u.mixedAdd(n.points[a]):l===-p&&(u=u.mixedAdd(n.points[a].neg()));h=h.add(u)}return h.toP()};Gi.prototype._wnafMul=function(t,e){var n=4,r=t._getNAFPoints(n);n=r.wnd;for(var s=r.points,o=Io(e,n,this._bitLength),a=this.jpoint(null,null,null),l=o.length-1;l>=0;l--){for(var c=0;l>=0&&o[l]===0;l--)c++;if(l>=0&&c++,a=a.dblp(c),l<0)break;var h=o[l];Lo(h!==0),t.type==="affine"?h>0?a=a.mixedAdd(s[h-1>>1]):a=a.mixedAdd(s[-h-1>>1].neg()):h>0?a=a.add(s[h-1>>1]):a=a.add(s[-h-1>>1].neg())}return t.type==="affine"?a.toP():a};Gi.prototype._wnafMulAdd=function(t,e,n,r,s){var o=this._wnafT1,a=this._wnafT2,l=this._wnafT3,c=0,h,u,p;for(h=0;h<r;h++){p=e[h];var x=p._getNAFPoints(t);o[h]=x.wnd,a[h]=x.points}for(h=r-1;h>=1;h-=2){var b=h-1,g=h;if(o[b]!==1||o[g]!==1){l[b]=Io(n[b],o[b],this._bitLength),l[g]=Io(n[g],o[g],this._bitLength),c=Math.max(l[b].length,c),c=Math.max(l[g].length,c);continue}var v=[e[b],null,null,e[g]];e[b].y.cmp(e[g].y)===0?(v[1]=e[b].add(e[g]),v[2]=e[b].toJ().mixedAdd(e[g].neg())):e[b].y.cmp(e[g].y.redNeg())===0?(v[1]=e[b].toJ().mixedAdd(e[g]),v[2]=e[b].add(e[g].neg())):(v[1]=e[b].toJ().mixedAdd(e[g]),v[2]=e[b].toJ().mixedAdd(e[g].neg()));var M=[-3,-1,-5,-7,0,7,5,1,3],D=o1(n[b],n[g]);for(c=Math.max(D[0].length,c),l[b]=new Array(c),l[g]=new Array(c),u=0;u<c;u++){var z=D[0][u]|0,B=D[1][u]|0;l[b][u]=M[(z+1)*3+(B+1)],l[g][u]=0,a[b]=v}}var O=this.jpoint(null,null,null),G=this._wnafT4;for(h=c;h>=0;h--){for(var Z=0;h>=0;){var L=!0;for(u=0;u<r;u++)G[u]=l[u][h]|0,G[u]!==0&&(L=!1);if(!L)break;Z++,h--}if(h>=0&&Z++,O=O.dblp(Z),h<0)break;for(u=0;u<r;u++){var U=G[u];U!==0&&(U>0?p=a[u][U-1>>1]:U<0&&(p=a[u][-U-1>>1].neg()),p.type==="affine"?O=O.mixedAdd(p):O=O.add(p))}}for(h=0;h<r;h++)a[h]=null;return s?O:O.toP()};function gn(i,t){this.curve=i,this.type=t,this.precomputed=null}Gi.BasePoint=gn;gn.prototype.eq=function(){throw new Error("Not implemented")};gn.prototype.validate=function(){return this.curve.validate(this)};Gi.prototype.decodePoint=function(t,e){t=an.toArray(t,e);var n=this.p.byteLength();if((t[0]===4||t[0]===6||t[0]===7)&&t.length-1===2*n){t[0]===6?Lo(t[t.length-1]%2===0):t[0]===7&&Lo(t[t.length-1]%2===1);var r=this.point(t.slice(1,1+n),t.slice(1+n,1+2*n));return r}else if((t[0]===2||t[0]===3)&&t.length-1===n)return this.pointFromX(t.slice(1,1+n),t[0]===3);throw new Error("Unknown point format")};gn.prototype.encodeCompressed=function(t){return this.encode(t,!0)};gn.prototype._encode=function(t){var e=this.curve.p.byteLength(),n=this.getX().toArray("be",e);return t?[this.getY().isEven()?2:3].concat(n):[4].concat(n,this.getY().toArray("be",e))};gn.prototype.encode=function(t,e){return an.encode(this._encode(e),t)};gn.prototype.precompute=function(t){if(this.precomputed)return this;var e={doubles:null,naf:null,beta:null};return e.naf=this._getNAFPoints(8),e.doubles=this._getDoubles(4,t),e.beta=this._getBeta(),this.precomputed=e,this};gn.prototype._hasDoubles=function(t){if(!this.precomputed)return!1;var e=this.precomputed.doubles;return e?e.points.length>=Math.ceil((t.bitLength()+1)/e.step):!1};gn.prototype._getDoubles=function(t,e){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var n=[this],r=this,s=0;s<e;s+=t){for(var o=0;o<t;o++)r=r.dbl();n.push(r)}return{step:t,points:n}};gn.prototype._getNAFPoints=function(t){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var e=[this],n=(1<<t)-1,r=n===1?null:this.dbl(),s=1;s<n;s++)e[s]=e[s-1].add(r);return{wnd:t,points:e}};gn.prototype._getBeta=function(){return null};gn.prototype.dblp=function(t){for(var e=this,n=0;n<t;n++)e=e.dbl();return e};var Dl=is(function(i){typeof Object.create=="function"?i.exports=function(e,n){n&&(e.super_=n,e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:i.exports=function(e,n){if(n){e.super_=n;var r=function(){};r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e}}}),a1=an.assert;function vn(i){fr.call(this,"short",i),this.a=new Ut(i.a,16).toRed(this.red),this.b=new Ut(i.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=this.a.fromRed().cmpn(0)===0,this.threeA=this.a.fromRed().sub(this.p).cmpn(-3)===0,this.endo=this._getEndomorphism(i),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}Dl(vn,fr);var l1=vn;vn.prototype._getEndomorphism=function(t){if(!(!this.zeroA||!this.g||!this.n||this.p.modn(3)!==1)){var e,n;if(t.beta)e=new Ut(t.beta,16).toRed(this.red);else{var r=this._getEndoRoots(this.p);e=r[0].cmp(r[1])<0?r[0]:r[1],e=e.toRed(this.red)}if(t.lambda)n=new Ut(t.lambda,16);else{var s=this._getEndoRoots(this.n);this.g.mul(s[0]).x.cmp(this.g.x.redMul(e))===0?n=s[0]:(n=s[1],a1(this.g.mul(n).x.cmp(this.g.x.redMul(e))===0))}var o;return t.basis?o=t.basis.map(function(a){return{a:new Ut(a.a,16),b:new Ut(a.b,16)}}):o=this._getEndoBasis(n),{beta:e,lambda:n,basis:o}}};vn.prototype._getEndoRoots=function(t){var e=t===this.p?this.red:Ut.mont(t),n=new Ut(2).toRed(e).redInvm(),r=n.redNeg(),s=new Ut(3).toRed(e).redNeg().redSqrt().redMul(n),o=r.redAdd(s).fromRed(),a=r.redSub(s).fromRed();return[o,a]};vn.prototype._getEndoBasis=function(t){for(var e=this.n.ushrn(Math.floor(this.n.bitLength()/2)),n=t,r=this.n.clone(),s=new Ut(1),o=new Ut(0),a=new Ut(0),l=new Ut(1),c,h,u,p,x,b,g,v=0,M,D;n.cmpn(0)!==0;){var z=r.div(n);M=r.sub(z.mul(n)),D=a.sub(z.mul(s));var B=l.sub(z.mul(o));if(!u&&M.cmp(e)<0)c=g.neg(),h=s,u=M.neg(),p=D;else if(u&&++v===2)break;g=M,r=n,n=M,a=s,s=D,l=o,o=B}x=M.neg(),b=D;var O=u.sqr().add(p.sqr()),G=x.sqr().add(b.sqr());return G.cmp(O)>=0&&(x=c,b=h),u.negative&&(u=u.neg(),p=p.neg()),x.negative&&(x=x.neg(),b=b.neg()),[{a:u,b:p},{a:x,b}]};vn.prototype._endoSplit=function(t){var e=this.endo.basis,n=e[0],r=e[1],s=r.b.mul(t).divRound(this.n),o=n.b.neg().mul(t).divRound(this.n),a=s.mul(n.a),l=o.mul(r.a),c=s.mul(n.b),h=o.mul(r.b),u=t.sub(a).sub(l),p=c.add(h).neg();return{k1:u,k2:p}};vn.prototype.pointFromX=function(t,e){t=new Ut(t,16),t.red||(t=t.toRed(this.red));var n=t.redSqr().redMul(t).redIAdd(t.redMul(this.a)).redIAdd(this.b),r=n.redSqrt();if(r.redSqr().redSub(n).cmp(this.zero)!==0)throw new Error("invalid point");var s=r.fromRed().isOdd();return(e&&!s||!e&&s)&&(r=r.redNeg()),this.point(t,r)};vn.prototype.validate=function(t){if(t.inf)return!0;var e=t.x,n=t.y,r=this.a.redMul(e),s=e.redSqr().redMul(e).redIAdd(r).redIAdd(this.b);return n.redSqr().redISub(s).cmpn(0)===0};vn.prototype._endoWnafMulAdd=function(t,e,n){for(var r=this._endoWnafT1,s=this._endoWnafT2,o=0;o<t.length;o++){var a=this._endoSplit(e[o]),l=t[o],c=l._getBeta();a.k1.negative&&(a.k1.ineg(),l=l.neg(!0)),a.k2.negative&&(a.k2.ineg(),c=c.neg(!0)),r[o*2]=l,r[o*2+1]=c,s[o*2]=a.k1,s[o*2+1]=a.k2}for(var h=this._wnafMulAdd(1,r,s,o*2,n),u=0;u<o*2;u++)r[u]=null,s[u]=null;return h};function Te(i,t,e,n){fr.BasePoint.call(this,i,"affine"),t===null&&e===null?(this.x=null,this.y=null,this.inf=!0):(this.x=new Ut(t,16),this.y=new Ut(e,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}Dl(Te,fr.BasePoint);vn.prototype.point=function(t,e,n){return new Te(this,t,e,n)};vn.prototype.pointFromJSON=function(t,e){return Te.fromJSON(this,t,e)};Te.prototype._getBeta=function(){if(!!this.curve.endo){var t=this.precomputed;if(t&&t.beta)return t.beta;var e=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(t){var n=this.curve,r=function(s){return n.point(s.x.redMul(n.endo.beta),s.y)};t.beta=e,e.precomputed={beta:null,naf:t.naf&&{wnd:t.naf.wnd,points:t.naf.points.map(r)},doubles:t.doubles&&{step:t.doubles.step,points:t.doubles.points.map(r)}}}return e}};Te.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]};Te.fromJSON=function(t,e,n){typeof e=="string"&&(e=JSON.parse(e));var r=t.point(e[0],e[1],n);if(!e[2])return r;function s(a){return t.point(a[0],a[1],n)}var o=e[2];return r.precomputed={beta:null,doubles:o.doubles&&{step:o.doubles.step,points:[r].concat(o.doubles.points.map(s))},naf:o.naf&&{wnd:o.naf.wnd,points:[r].concat(o.naf.points.map(s))}},r};Te.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"};Te.prototype.isInfinity=function(){return this.inf};Te.prototype.add=function(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t))return this.curve.point(null,null);if(this.x.cmp(t.x)===0)return this.curve.point(null,null);var e=this.y.redSub(t.y);e.cmpn(0)!==0&&(e=e.redMul(this.x.redSub(t.x).redInvm()));var n=e.redSqr().redISub(this.x).redISub(t.x),r=e.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,r)};Te.prototype.dbl=function(){if(this.inf)return this;var t=this.y.redAdd(this.y);if(t.cmpn(0)===0)return this.curve.point(null,null);var e=this.curve.a,n=this.x.redSqr(),r=t.redInvm(),s=n.redAdd(n).redIAdd(n).redIAdd(e).redMul(r),o=s.redSqr().redISub(this.x.redAdd(this.x)),a=s.redMul(this.x.redSub(o)).redISub(this.y);return this.curve.point(o,a)};Te.prototype.getX=function(){return this.x.fromRed()};Te.prototype.getY=function(){return this.y.fromRed()};Te.prototype.mul=function(t){return t=new Ut(t,16),this.isInfinity()?this:this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve.endo?this.curve._endoWnafMulAdd([this],[t]):this.curve._wnafMul(this,t)};Te.prototype.mulAdd=function(t,e,n){var r=[this,e],s=[t,n];return this.curve.endo?this.curve._endoWnafMulAdd(r,s):this.curve._wnafMulAdd(1,r,s,2)};Te.prototype.jmulAdd=function(t,e,n){var r=[this,e],s=[t,n];return this.curve.endo?this.curve._endoWnafMulAdd(r,s,!0):this.curve._wnafMulAdd(1,r,s,2,!0)};Te.prototype.eq=function(t){return this===t||this.inf===t.inf&&(this.inf||this.x.cmp(t.x)===0&&this.y.cmp(t.y)===0)};Te.prototype.neg=function(t){if(this.inf)return this;var e=this.curve.point(this.x,this.y.redNeg());if(t&&this.precomputed){var n=this.precomputed,r=function(s){return s.neg()};e.precomputed={naf:n.naf&&{wnd:n.naf.wnd,points:n.naf.points.map(r)},doubles:n.doubles&&{step:n.doubles.step,points:n.doubles.points.map(r)}}}return e};Te.prototype.toJ=function(){if(this.inf)return this.curve.jpoint(null,null,null);var t=this.curve.jpoint(this.x,this.y,this.curve.one);return t};function Le(i,t,e,n){fr.BasePoint.call(this,i,"jacobian"),t===null&&e===null&&n===null?(this.x=this.curve.one,this.y=this.curve.one,this.z=new Ut(0)):(this.x=new Ut(t,16),this.y=new Ut(e,16),this.z=new Ut(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}Dl(Le,fr.BasePoint);vn.prototype.jpoint=function(t,e,n){return new Le(this,t,e,n)};Le.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var t=this.z.redInvm(),e=t.redSqr(),n=this.x.redMul(e),r=this.y.redMul(e).redMul(t);return this.curve.point(n,r)};Le.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)};Le.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var e=t.z.redSqr(),n=this.z.redSqr(),r=this.x.redMul(e),s=t.x.redMul(n),o=this.y.redMul(e.redMul(t.z)),a=t.y.redMul(n.redMul(this.z)),l=r.redSub(s),c=o.redSub(a);if(l.cmpn(0)===0)return c.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var h=l.redSqr(),u=h.redMul(l),p=r.redMul(h),x=c.redSqr().redIAdd(u).redISub(p).redISub(p),b=c.redMul(p.redISub(x)).redISub(o.redMul(u)),g=this.z.redMul(t.z).redMul(l);return this.curve.jpoint(x,b,g)};Le.prototype.mixedAdd=function(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;var e=this.z.redSqr(),n=this.x,r=t.x.redMul(e),s=this.y,o=t.y.redMul(e).redMul(this.z),a=n.redSub(r),l=s.redSub(o);if(a.cmpn(0)===0)return l.cmpn(0)!==0?this.curve.jpoint(null,null,null):this.dbl();var c=a.redSqr(),h=c.redMul(a),u=n.redMul(c),p=l.redSqr().redIAdd(h).redISub(u).redISub(u),x=l.redMul(u.redISub(p)).redISub(s.redMul(h)),b=this.z.redMul(a);return this.curve.jpoint(p,x,b)};Le.prototype.dblp=function(t){if(t===0)return this;if(this.isInfinity())return this;if(!t)return this.dbl();var e;if(this.curve.zeroA||this.curve.threeA){var n=this;for(e=0;e<t;e++)n=n.dbl();return n}var r=this.curve.a,s=this.curve.tinv,o=this.x,a=this.y,l=this.z,c=l.redSqr().redSqr(),h=a.redAdd(a);for(e=0;e<t;e++){var u=o.redSqr(),p=h.redSqr(),x=p.redSqr(),b=u.redAdd(u).redIAdd(u).redIAdd(r.redMul(c)),g=o.redMul(p),v=b.redSqr().redISub(g.redAdd(g)),M=g.redISub(v),D=b.redMul(M);D=D.redIAdd(D).redISub(x);var z=h.redMul(l);e+1<t&&(c=c.redMul(x)),o=v,l=z,h=D}return this.curve.jpoint(o,h.redMul(s),l)};Le.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()};Le.prototype._zeroDbl=function(){var t,e,n;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(o);a=a.redIAdd(a);var l=r.redAdd(r).redIAdd(r),c=l.redSqr().redISub(a).redISub(a),h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),t=c,e=l.redMul(a.redISub(c)).redISub(h),n=this.y.redAdd(this.y)}else{var u=this.x.redSqr(),p=this.y.redSqr(),x=p.redSqr(),b=this.x.redAdd(p).redSqr().redISub(u).redISub(x);b=b.redIAdd(b);var g=u.redAdd(u).redIAdd(u),v=g.redSqr(),M=x.redIAdd(x);M=M.redIAdd(M),M=M.redIAdd(M),t=v.redISub(b).redISub(b),e=g.redMul(b.redISub(t)).redISub(M),n=this.y.redMul(this.z),n=n.redIAdd(n)}return this.curve.jpoint(t,e,n)};Le.prototype._threeDbl=function(){var t,e,n;if(this.zOne){var r=this.x.redSqr(),s=this.y.redSqr(),o=s.redSqr(),a=this.x.redAdd(s).redSqr().redISub(r).redISub(o);a=a.redIAdd(a);var l=r.redAdd(r).redIAdd(r).redIAdd(this.curve.a),c=l.redSqr().redISub(a).redISub(a);t=c;var h=o.redIAdd(o);h=h.redIAdd(h),h=h.redIAdd(h),e=l.redMul(a.redISub(c)).redISub(h),n=this.y.redAdd(this.y)}else{var u=this.z.redSqr(),p=this.y.redSqr(),x=this.x.redMul(p),b=this.x.redSub(u).redMul(this.x.redAdd(u));b=b.redAdd(b).redIAdd(b);var g=x.redIAdd(x);g=g.redIAdd(g);var v=g.redAdd(g);t=b.redSqr().redISub(v),n=this.y.redAdd(this.z).redSqr().redISub(p).redISub(u);var M=p.redSqr();M=M.redIAdd(M),M=M.redIAdd(M),M=M.redIAdd(M),e=b.redMul(g.redISub(t)).redISub(M)}return this.curve.jpoint(t,e,n)};Le.prototype._dbl=function(){var t=this.curve.a,e=this.x,n=this.y,r=this.z,s=r.redSqr().redSqr(),o=e.redSqr(),a=n.redSqr(),l=o.redAdd(o).redIAdd(o).redIAdd(t.redMul(s)),c=e.redAdd(e);c=c.redIAdd(c);var h=c.redMul(a),u=l.redSqr().redISub(h.redAdd(h)),p=h.redISub(u),x=a.redSqr();x=x.redIAdd(x),x=x.redIAdd(x),x=x.redIAdd(x);var b=l.redMul(p).redISub(x),g=n.redAdd(n).redMul(r);return this.curve.jpoint(u,b,g)};Le.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var t=this.x.redSqr(),e=this.y.redSqr(),n=this.z.redSqr(),r=e.redSqr(),s=t.redAdd(t).redIAdd(t),o=s.redSqr(),a=this.x.redAdd(e).redSqr().redISub(t).redISub(r);a=a.redIAdd(a),a=a.redAdd(a).redIAdd(a),a=a.redISub(o);var l=a.redSqr(),c=r.redIAdd(r);c=c.redIAdd(c),c=c.redIAdd(c),c=c.redIAdd(c);var h=s.redIAdd(a).redSqr().redISub(o).redISub(l).redISub(c),u=e.redMul(h);u=u.redIAdd(u),u=u.redIAdd(u);var p=this.x.redMul(l).redISub(u);p=p.redIAdd(p),p=p.redIAdd(p);var x=this.y.redMul(h.redMul(c.redISub(h)).redISub(a.redMul(l)));x=x.redIAdd(x),x=x.redIAdd(x),x=x.redIAdd(x);var b=this.z.redAdd(a).redSqr().redISub(n).redISub(l);return this.curve.jpoint(p,x,b)};Le.prototype.mul=function(t,e){return t=new Ut(t,e),this.curve._wnafMul(this,t)};Le.prototype.eq=function(t){if(t.type==="affine")return this.eq(t.toJ());if(this===t)return!0;var e=this.z.redSqr(),n=t.z.redSqr();if(this.x.redMul(n).redISub(t.x.redMul(e)).cmpn(0)!==0)return!1;var r=e.redMul(this.z),s=n.redMul(t.z);return this.y.redMul(s).redISub(t.y.redMul(r)).cmpn(0)===0};Le.prototype.eqXToP=function(t){var e=this.z.redSqr(),n=t.toRed(this.curve.red).redMul(e);if(this.x.cmp(n)===0)return!0;for(var r=t.clone(),s=this.curve.redN.redMul(e);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(n.redIAdd(s),this.x.cmp(n)===0)return!0}};Le.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"};Le.prototype.isInfinity=function(){return this.z.cmpn(0)===0};var Mo=is(function(i,t){var e=t;e.base=fr,e.short=l1,e.mont=null,e.edwards=null}),So=is(function(i,t){var e=t,n=an.assert;function r(a){a.type==="short"?this.curve=new Mo.short(a):a.type==="edwards"?this.curve=new Mo.edwards(a):this.curve=new Mo.mont(a),this.g=this.curve.g,this.n=this.curve.n,this.hash=a.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}e.PresetCurve=r;function s(a,l){Object.defineProperty(e,a,{configurable:!0,enumerable:!0,get:function(){var c=new r(l);return Object.defineProperty(e,a,{configurable:!0,enumerable:!0,value:c}),c}})}s("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:kn.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),s("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:kn.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),s("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:kn.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),s("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:kn.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),s("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:kn.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),s("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:kn.sha256,gRed:!1,g:["9"]}),s("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:kn.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});var o;try{o=null.crash()}catch{o=void 0}s("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:kn.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",o]})});function zi(i){if(!(this instanceof zi))return new zi(i);this.hash=i.hash,this.predResist=!!i.predResist,this.outLen=this.hash.outSize,this.minEntropy=i.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=Rn.toArray(i.entropy,i.entropyEnc||"hex"),e=Rn.toArray(i.nonce,i.nonceEnc||"hex"),n=Rn.toArray(i.pers,i.persEnc||"hex");Ll(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,e,n)}var Mu=zi;zi.prototype._init=function(t,e,n){var r=t.concat(e).concat(n);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var s=0;s<this.V.length;s++)this.K[s]=0,this.V[s]=1;this._update(r),this._reseed=1,this.reseedInterval=281474976710656};zi.prototype._hmac=function(){return new kn.hmac(this.hash,this.K)};zi.prototype._update=function(t){var e=this._hmac().update(this.V).update([0]);t&&(e=e.update(t)),this.K=e.digest(),this.V=this._hmac().update(this.V).digest(),t&&(this.K=this._hmac().update(this.V).update([1]).update(t).digest(),this.V=this._hmac().update(this.V).digest())};zi.prototype.reseed=function(t,e,n,r){typeof e!="string"&&(r=n,n=e,e=null),t=Rn.toArray(t,e),n=Rn.toArray(n,r),Ll(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(t.concat(n||[])),this._reseed=1};zi.prototype.generate=function(t,e,n,r){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");typeof e!="string"&&(r=n,n=e,e=null),n&&(n=Rn.toArray(n,r||"hex"),this._update(n));for(var s=[];s.length<t;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,t);return this._update(n),this._reseed++,Rn.encode(o,e)};var cl=an.assert;function ze(i,t){this.ec=i,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}var Nl=ze;ze.fromPublic=function(t,e,n){return e instanceof ze?e:new ze(t,{pub:e,pubEnc:n})};ze.fromPrivate=function(t,e,n){return e instanceof ze?e:new ze(t,{priv:e,privEnc:n})};ze.prototype.validate=function(){var t=this.getPublic();return t.isInfinity()?{result:!1,reason:"Invalid public key"}:t.validate()?t.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}};ze.prototype.getPublic=function(t,e){return typeof t=="string"&&(e=t,t=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),e?this.pub.encode(e,t):this.pub};ze.prototype.getPrivate=function(t){return t==="hex"?this.priv.toString(16,2):this.priv};ze.prototype._importPrivate=function(t,e){this.priv=new Ut(t,e||16),this.priv=this.priv.umod(this.ec.curve.n)};ze.prototype._importPublic=function(t,e){if(t.x||t.y){this.ec.curve.type==="mont"?cl(t.x,"Need x coordinate"):(this.ec.curve.type==="short"||this.ec.curve.type==="edwards")&&cl(t.x&&t.y,"Need both x and y coordinate"),this.pub=this.ec.curve.point(t.x,t.y);return}this.pub=this.ec.curve.decodePoint(t,e)};ze.prototype.derive=function(t){return t.validate()||cl(t.validate(),"public point not validated"),t.mul(this.priv).getX()};ze.prototype.sign=function(t,e,n){return this.ec.sign(t,this,e,n)};ze.prototype.verify=function(t,e){return this.ec.verify(t,e,this)};ze.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"};var c1=an.assert;function jo(i,t){if(i instanceof jo)return i;this._importDER(i,t)||(c1(i.r&&i.s,"Signature without r or s"),this.r=new Ut(i.r,16),this.s=new Ut(i.s,16),i.recoveryParam===void 0?this.recoveryParam=null:this.recoveryParam=i.recoveryParam)}var Xo=jo;function f1(){this.place=0}function Ua(i,t){var e=i[t.place++];if(!(e&128))return e;var n=e&15;if(n===0||n>4)return!1;for(var r=0,s=0,o=t.place;s<n;s++,o++)r<<=8,r|=i[o],r>>>=0;return r<=127?!1:(t.place=o,r)}function Tf(i){for(var t=0,e=i.length-1;!i[t]&&!(i[t+1]&128)&&t<e;)t++;return t===0?i:i.slice(t)}jo.prototype._importDER=function(t,e){t=an.toArray(t,e);var n=new f1;if(t[n.place++]!==48)return!1;var r=Ua(t,n);if(r===!1||r+n.place!==t.length||t[n.place++]!==2)return!1;var s=Ua(t,n);if(s===!1)return!1;var o=t.slice(n.place,s+n.place);if(n.place+=s,t[n.place++]!==2)return!1;var a=Ua(t,n);if(a===!1||t.length!==a+n.place)return!1;var l=t.slice(n.place,a+n.place);if(o[0]===0)if(o[1]&128)o=o.slice(1);else return!1;if(l[0]===0)if(l[1]&128)l=l.slice(1);else return!1;return this.r=new Ut(o),this.s=new Ut(l),this.recoveryParam=null,!0};function za(i,t){if(t<128){i.push(t);return}var e=1+(Math.log(t)/Math.LN2>>>3);for(i.push(e|128);--e;)i.push(t>>>(e<<3)&255);i.push(t)}jo.prototype.toDER=function(t){var e=this.r.toArray(),n=this.s.toArray();for(e[0]&128&&(e=[0].concat(e)),n[0]&128&&(n=[0].concat(n)),e=Tf(e),n=Tf(n);!n[0]&&!(n[1]&128);)n=n.slice(1);var r=[2];za(r,e.length),r=r.concat(e),r.push(2),za(r,n.length);var s=r.concat(n),o=[48];return za(o,s.length),o=o.concat(s),an.encode(o,t)};var h1=function(){throw new Error("unsupported")},Su=an.assert;function mn(i){if(!(this instanceof mn))return new mn(i);typeof i=="string"&&(Su(Object.prototype.hasOwnProperty.call(So,i),"Unknown curve "+i),i=So[i]),i instanceof So.PresetCurve&&(i={curve:i}),this.curve=i.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=i.curve.g,this.g.precompute(i.curve.n.bitLength()+1),this.hash=i.hash||i.curve.hash}var u1=mn;mn.prototype.keyPair=function(t){return new Nl(this,t)};mn.prototype.keyFromPrivate=function(t,e){return Nl.fromPrivate(this,t,e)};mn.prototype.keyFromPublic=function(t,e){return Nl.fromPublic(this,t,e)};mn.prototype.genKeyPair=function(t){t||(t={});for(var e=new Mu({hash:this.hash,pers:t.pers,persEnc:t.persEnc||"utf8",entropy:t.entropy||h1(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||"utf8",nonce:this.n.toArray()}),n=this.n.byteLength(),r=this.n.sub(new Ut(2));;){var s=new Ut(e.generate(n));if(!(s.cmp(r)>0))return s.iaddn(1),this.keyFromPrivate(s)}};mn.prototype._truncateToN=function(t,e){var n=t.byteLength()*8-this.n.bitLength();return n>0&&(t=t.ushrn(n)),!e&&t.cmp(this.n)>=0?t.sub(this.n):t};mn.prototype.sign=function(t,e,n,r){typeof n=="object"&&(r=n,n=null),r||(r={}),e=this.keyFromPrivate(e,n),t=this._truncateToN(new Ut(t,16));for(var s=this.n.byteLength(),o=e.getPrivate().toArray("be",s),a=t.toArray("be",s),l=new Mu({hash:this.hash,entropy:o,nonce:a,pers:r.pers,persEnc:r.persEnc||"utf8"}),c=this.n.sub(new Ut(1)),h=0;;h++){var u=r.k?r.k(h):new Ut(l.generate(this.n.byteLength()));if(u=this._truncateToN(u,!0),!(u.cmpn(1)<=0||u.cmp(c)>=0)){var p=this.g.mul(u);if(!p.isInfinity()){var x=p.getX(),b=x.umod(this.n);if(b.cmpn(0)!==0){var g=u.invm(this.n).mul(b.mul(e.getPrivate()).iadd(t));if(g=g.umod(this.n),g.cmpn(0)!==0){var v=(p.getY().isOdd()?1:0)|(x.cmp(b)!==0?2:0);return r.canonical&&g.cmp(this.nh)>0&&(g=this.n.sub(g),v^=1),new Xo({r:b,s:g,recoveryParam:v})}}}}}};mn.prototype.verify=function(t,e,n,r){t=this._truncateToN(new Ut(t,16)),n=this.keyFromPublic(n,r),e=new Xo(e,"hex");var s=e.r,o=e.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0||o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a=o.invm(this.n),l=a.mul(t).umod(this.n),c=a.mul(s).umod(this.n),h;return this.curve._maxwellTrick?(h=this.g.jmulAdd(l,n.getPublic(),c),h.isInfinity()?!1:h.eqXToP(s)):(h=this.g.mulAdd(l,n.getPublic(),c),h.isInfinity()?!1:h.getX().umod(this.n).cmp(s)===0)};mn.prototype.recoverPubKey=function(i,t,e,n){Su((3&e)===e,"The recovery param is more than two bits"),t=new Xo(t,n);var r=this.n,s=new Ut(i),o=t.r,a=t.s,l=e&1,c=e>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&c)throw new Error("Unable to find sencond key candinate");c?o=this.curve.pointFromX(o.add(this.curve.n),l):o=this.curve.pointFromX(o,l);var h=t.r.invm(r),u=r.sub(s).mul(h).umod(r),p=a.mul(h).umod(r);return this.g.mulAdd(u,o,p)};mn.prototype.getKeyRecoveryParam=function(i,t,e,n){if(t=new Xo(t,n),t.recoveryParam!==null)return t.recoveryParam;for(var r=0;r<4;r++){var s;try{s=this.recoverPubKey(i,t,r)}catch{continue}if(s.eq(e))return r}throw new Error("Unable to find valid recovery factor")};var d1=is(function(i,t){var e=t;e.version="6.5.4",e.utils=an,e.rand=function(){throw new Error("unsupported")},e.curve=Mo,e.curves=So,e.ec=u1,e.eddsa=null}),p1=d1.ec;const m1="signing-key/5.6.2",fl=new H(m1);let Ga=null;function zn(){return Ga||(Ga=new p1("secp256k1")),Ga}class g1{constructor(t){dt(this,"curve","secp256k1"),dt(this,"privateKey",Rt(t)),rr(this.privateKey)!==32&&fl.throwArgumentError("invalid private key","privateKey","[[ REDACTED ]]");const e=zn().keyFromPrivate(Nt(this.privateKey));dt(this,"publicKey","0x"+e.getPublic(!1,"hex")),dt(this,"compressedPublicKey","0x"+e.getPublic(!0,"hex")),dt(this,"_isSigningKey",!0)}_addPoint(t){const e=zn().keyFromPublic(Nt(this.publicKey)),n=zn().keyFromPublic(Nt(t));return"0x"+e.pub.add(n.pub).encodeCompressed("hex")}signDigest(t){const e=zn().keyFromPrivate(Nt(this.privateKey)),n=Nt(t);n.length!==32&&fl.throwArgumentError("bad digest length","digest",t);const r=e.sign(n,{canonical:!0});return Vo({recoveryParam:r.recoveryParam,r:he("0x"+r.r.toString(16),32),s:he("0x"+r.s.toString(16),32)})}computeSharedSecret(t){const e=zn().keyFromPrivate(Nt(this.privateKey)),n=zn().keyFromPublic(Nt(Au(t)));return he("0x"+e.derive(n.getPublic()).toString(16),32)}static isSigningKey(t){return!!(t&&t._isSigningKey)}}function v1(i,t){const e=Vo(t),n={r:Nt(e.r),s:Nt(e.s)};return"0x"+zn().recoverPubKey(Nt(i),n,e.recoveryParam).encode("hex",!1)}function Au(i,t){const e=Nt(i);if(e.length===32){const n=new g1(e);return t?"0x"+zn().keyFromPrivate(e).getPublic(!0,"hex"):n.publicKey}else{if(e.length===33)return t?Rt(e):"0x"+zn().keyFromPublic(e).getPublic(!1,"hex");if(e.length===65)return t?"0x"+zn().keyFromPublic(e).getPublic(!0,"hex"):Rt(e)}return fl.throwArgumentError("invalid public or private key","key","[REDACTED]")}const x1="transactions/5.6.2",Ai=new H(x1);var Cf;(function(i){i[i.legacy=0]="legacy",i[i.eip2930=1]="eip2930",i[i.eip1559=2]="eip1559"})(Cf||(Cf={}));function Fl(i){return i==="0x"?null:Pe(i)}function ke(i){return i==="0x"?jh:pt.from(i)}function _1(i){const t=Au(i);return Pe(Fe(Me(Fe(t,1)),12))}function Eu(i,t){return _1(v1(Nt(i),t))}function rn(i,t){const e=Wr(pt.from(i).toHexString());return e.length>32&&Ai.throwArgumentError("invalid length for "+t,"transaction:"+t,i),e}function Va(i,t){return{address:Pe(i),storageKeys:(t||[]).map((e,n)=>(rr(e)!==32&&Ai.throwArgumentError("invalid access list storageKey",`accessList[${i}:${n}]`,e),e.toLowerCase()))}}function rs(i){if(Array.isArray(i))return i.map((e,n)=>Array.isArray(e)?(e.length>2&&Ai.throwArgumentError("access list expected to be [ address, storageKeys[] ]",`value[${n}]`,e),Va(e[0],e[1])):Va(e.address,e.storageKeys));const t=Object.keys(i).map(e=>{const n=i[e].reduce((r,s)=>(r[s]=!0,r),{});return Va(e,Object.keys(n).sort())});return t.sort((e,n)=>e.address.localeCompare(n.address)),t}function Tu(i){return rs(i).map(t=>[t.address,t.storageKeys])}function y1(i,t){if(i.gasPrice!=null){const n=pt.from(i.gasPrice),r=pt.from(i.maxFeePerGas||0);n.eq(r)||Ai.throwArgumentError("mismatch EIP-1559 gasPrice != maxFeePerGas","tx",{gasPrice:n,maxFeePerGas:r})}const e=[rn(i.chainId||0,"chainId"),rn(i.nonce||0,"nonce"),rn(i.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),rn(i.maxFeePerGas||0,"maxFeePerGas"),rn(i.gasLimit||0,"gasLimit"),i.to!=null?Pe(i.to):"0x",rn(i.value||0,"value"),i.data||"0x",Tu(i.accessList||[])];if(t){const n=Vo(t);e.push(rn(n.recoveryParam,"recoveryParam")),e.push(Wr(n.r)),e.push(Wr(n.s))}return Ke(["0x02",Ho(e)])}function b1(i,t){const e=[rn(i.chainId||0,"chainId"),rn(i.nonce||0,"nonce"),rn(i.gasPrice||0,"gasPrice"),rn(i.gasLimit||0,"gasLimit"),i.to!=null?Pe(i.to):"0x",rn(i.value||0,"value"),i.data||"0x",Tu(i.accessList||[])];if(t){const n=Vo(t);e.push(rn(n.recoveryParam,"recoveryParam")),e.push(Wr(n.r)),e.push(Wr(n.s))}return Ke(["0x01",Ho(e)])}function Cu(i,t,e){try{const n=ke(t[0]).toNumber();if(n!==0&&n!==1)throw new Error("bad recid");i.v=n}catch{Ai.throwArgumentError("invalid v for transaction type: 1","v",t[0])}i.r=he(t[1],32),i.s=he(t[2],32);try{const n=Me(e(i));i.from=Eu(n,{r:i.r,s:i.s,recoveryParam:i.v})}catch{}}function w1(i){const t=Tl(i.slice(1));t.length!==9&&t.length!==12&&Ai.throwArgumentError("invalid component count for transaction type: 2","payload",Rt(i));const e=ke(t[2]),n=ke(t[3]),r={type:2,chainId:ke(t[0]).toNumber(),nonce:ke(t[1]).toNumber(),maxPriorityFeePerGas:e,maxFeePerGas:n,gasPrice:null,gasLimit:ke(t[4]),to:Fl(t[5]),value:ke(t[6]),data:t[7],accessList:rs(t[8])};return t.length===9||(r.hash=Me(i),Cu(r,t.slice(9),y1)),r}function M1(i){const t=Tl(i.slice(1));t.length!==8&&t.length!==11&&Ai.throwArgumentError("invalid component count for transaction type: 1","payload",Rt(i));const e={type:1,chainId:ke(t[0]).toNumber(),nonce:ke(t[1]).toNumber(),gasPrice:ke(t[2]),gasLimit:ke(t[3]),to:Fl(t[4]),value:ke(t[5]),data:t[6],accessList:rs(t[7])};return t.length===8||(e.hash=Me(i),Cu(e,t.slice(8),b1)),e}function S1(i){const t=Tl(i);t.length!==9&&t.length!==6&&Ai.throwArgumentError("invalid raw transaction","rawTransaction",i);const e={nonce:ke(t[0]).toNumber(),gasPrice:ke(t[1]),gasLimit:ke(t[2]),to:Fl(t[3]),value:ke(t[4]),data:t[5],chainId:0};if(t.length===6)return e;try{e.v=pt.from(t[6]).toNumber()}catch{return e}if(e.r=he(t[7],32),e.s=he(t[8],32),pt.from(e.r).isZero()&&pt.from(e.s).isZero())e.chainId=e.v,e.v=0;else{e.chainId=Math.floor((e.v-35)/2),e.chainId<0&&(e.chainId=0);let n=e.v-27;const r=t.slice(0,6);e.chainId!==0&&(r.push(Rt(e.chainId)),r.push("0x"),r.push("0x"),n-=e.chainId*2+8);const s=Me(Ho(r));try{e.from=Eu(s,{r:Rt(e.r),s:Rt(e.s),recoveryParam:n})}catch{}e.hash=Me(i)}return e.type=null,e}function A1(i){const t=Nt(i);if(t[0]>127)return S1(t);switch(t[0]){case 1:return M1(t);case 2:return w1(t)}return Ai.throwError(`unsupported transaction type: ${t[0]}`,H.errors.UNSUPPORTED_OPERATION,{operation:"parseTransaction",transactionType:t[0]})}const E1="contracts/5.6.2";var ar=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const xe=new H(E1);function Do(i,t){return ar(this,void 0,void 0,function*(){const e=yield t;typeof e!="string"&&xe.throwArgumentError("invalid address or ENS name","name",e);try{return Pe(e)}catch{}i||xe.throwError("a provider or signer is needed to resolve ENS names",H.errors.UNSUPPORTED_OPERATION,{operation:"resolveName"});const n=yield i.resolveName(e);return n==null&&xe.throwArgumentError("resolver or addr is not configured for ENS name","name",e),n})}function Ao(i,t,e){return ar(this,void 0,void 0,function*(){return Array.isArray(e)?yield Promise.all(e.map((n,r)=>Ao(i,Array.isArray(t)?t[r]:t[n.name],n))):e.type==="address"?yield Do(i,t):e.type==="tuple"?yield Ao(i,t,e.components):e.baseType==="array"?Array.isArray(t)?yield Promise.all(t.map(n=>Ao(i,n,e.arrayChildren))):Promise.reject(xe.makeError("invalid value for array",H.errors.INVALID_ARGUMENT,{argument:"value",value:t})):t})}function Zo(i,t,e){return ar(this,void 0,void 0,function*(){let n={};e.length===t.inputs.length+1&&typeof e[e.length-1]=="object"&&(n=Ee(e.pop())),xe.checkArgumentCount(e.length,t.inputs.length,"passed to contract"),i.signer?n.from?n.from=ye({override:Do(i.signer,n.from),signer:i.signer.getAddress()}).then(c=>ar(this,void 0,void 0,function*(){return Pe(c.signer)!==c.override&&xe.throwError("Contract with a Signer cannot override from",H.errors.UNSUPPORTED_OPERATION,{operation:"overrides.from"}),c.override})):n.from=i.signer.getAddress():n.from&&(n.from=Do(i.provider,n.from));const r=yield ye({args:Ao(i.signer||i.provider,e,t.inputs),address:i.resolvedAddress,overrides:ye(n)||{}}),s=i.interface.encodeFunctionData(t,r.args),o={data:s,to:r.address},a=r.overrides;if(a.nonce!=null&&(o.nonce=pt.from(a.nonce).toNumber()),a.gasLimit!=null&&(o.gasLimit=pt.from(a.gasLimit)),a.gasPrice!=null&&(o.gasPrice=pt.from(a.gasPrice)),a.maxFeePerGas!=null&&(o.maxFeePerGas=pt.from(a.maxFeePerGas)),a.maxPriorityFeePerGas!=null&&(o.maxPriorityFeePerGas=pt.from(a.maxPriorityFeePerGas)),a.from!=null&&(o.from=a.from),a.type!=null&&(o.type=a.type),a.accessList!=null&&(o.accessList=rs(a.accessList)),o.gasLimit==null&&t.gas!=null){let c=21e3;const h=Nt(s);for(let u=0;u<h.length;u++)c+=4,h[u]&&(c+=64);o.gasLimit=pt.from(t.gas).add(c)}if(a.value){const c=pt.from(a.value);!c.isZero()&&!t.payable&&xe.throwError("non-payable method cannot override value",H.errors.UNSUPPORTED_OPERATION,{operation:"overrides.value",value:n.value}),o.value=c}a.customData&&(o.customData=Ee(a.customData)),a.ccipReadEnabled&&(o.ccipReadEnabled=!!a.ccipReadEnabled),delete n.nonce,delete n.gasLimit,delete n.gasPrice,delete n.from,delete n.value,delete n.type,delete n.accessList,delete n.maxFeePerGas,delete n.maxPriorityFeePerGas,delete n.customData,delete n.ccipReadEnabled;const l=Object.keys(n).filter(c=>n[c]!=null);return l.length&&xe.throwError(`cannot override ${l.map(c=>JSON.stringify(c)).join(",")}`,H.errors.UNSUPPORTED_OPERATION,{operation:"overrides",overrides:l}),o})}function T1(i,t){return function(...e){return Zo(i,t,e)}}function C1(i,t){const e=i.signer||i.provider;return function(...n){return ar(this,void 0,void 0,function*(){e||xe.throwError("estimate require a provider or signer",H.errors.UNSUPPORTED_OPERATION,{operation:"estimateGas"});const r=yield Zo(i,t,n);return yield e.estimateGas(r)})}}function R1(i,t){const e=t.wait.bind(t);t.wait=n=>e(n).then(r=>(r.events=r.logs.map(s=>{let o=yi(s),a=null;try{a=i.interface.parseLog(s)}catch{}return a&&(o.args=a.args,o.decode=(l,c)=>i.interface.decodeEventLog(a.eventFragment,l,c),o.event=a.name,o.eventSignature=a.signature),o.removeListener=()=>i.provider,o.getBlock=()=>i.provider.getBlock(r.blockHash),o.getTransaction=()=>i.provider.getTransaction(r.transactionHash),o.getTransactionReceipt=()=>Promise.resolve(r),o}),r))}function Ru(i,t,e){const n=i.signer||i.provider;return function(...r){return ar(this,void 0,void 0,function*(){let s;if(r.length===t.inputs.length+1&&typeof r[r.length-1]=="object"){const l=Ee(r.pop());l.blockTag!=null&&(s=yield l.blockTag),delete l.blockTag,r.push(l)}i.deployTransaction!=null&&(yield i._deployed(s));const o=yield Zo(i,t,r),a=yield n.call(o,s);try{let l=i.interface.decodeFunctionResult(t,a);return e&&t.outputs.length===1&&(l=l[0]),l}catch(l){throw l.code===H.errors.CALL_EXCEPTION&&(l.address=i.address,l.args=r,l.transaction=o),l}})}}function P1(i,t){return function(...e){return ar(this,void 0,void 0,function*(){i.signer||xe.throwError("sending a transaction requires a signer",H.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction"}),i.deployTransaction!=null&&(yield i._deployed());const n=yield Zo(i,t,e),r=yield i.signer.sendTransaction(n);return R1(i,r),r})}}function Rf(i,t,e){return t.constant?Ru(i,t,e):P1(i,t)}function Pu(i){return i.address&&(i.topics==null||i.topics.length===0)?"*":(i.address||"*")+"@"+(i.topics?i.topics.map(t=>Array.isArray(t)?t.join("|"):t).join(":"):"")}class Is{constructor(t,e){dt(this,"tag",t),dt(this,"filter",e),this._listeners=[]}addListener(t,e){this._listeners.push({listener:t,once:e})}removeListener(t){let e=!1;this._listeners=this._listeners.filter(n=>e||n.listener!==t?!0:(e=!0,!1))}removeAllListeners(){this._listeners=[]}listeners(){return this._listeners.map(t=>t.listener)}listenerCount(){return this._listeners.length}run(t){const e=this.listenerCount();return this._listeners=this._listeners.filter(n=>{const r=t.slice();return setTimeout(()=>{n.listener.apply(this,r)},0),!n.once}),e}prepareEvent(t){}getEmit(t){return[t]}}class I1 extends Is{constructor(){super("error",null)}}class Pf extends Is{constructor(t,e,n,r){const s={address:t};let o=e.getEventTopic(n);r?(o!==r[0]&&xe.throwArgumentError("topic mismatch","topics",r),s.topics=r.slice()):s.topics=[o],super(Pu(s),s),dt(this,"address",t),dt(this,"interface",e),dt(this,"fragment",n)}prepareEvent(t){super.prepareEvent(t),t.event=this.fragment.name,t.eventSignature=this.fragment.format(),t.decode=(e,n)=>this.interface.decodeEventLog(this.fragment,e,n);try{t.args=this.interface.decodeEventLog(this.fragment,t.data,t.topics)}catch(e){t.args=null,t.decodeError=e}}getEmit(t){const e=Ex(t.args);if(e.length)throw e[0].error;const n=(t.args||[]).slice();return n.push(t),n}}class If extends Is{constructor(t,e){super("*",{address:t}),dt(this,"address",t),dt(this,"interface",e)}prepareEvent(t){super.prepareEvent(t);try{const e=this.interface.parseLog(t);t.event=e.name,t.eventSignature=e.signature,t.decode=(n,r)=>this.interface.decodeEventLog(e.eventFragment,n,r),t.args=e.args}catch{}}}class L1{constructor(t,e,n){dt(this,"interface",jn(new.target,"getInterface")(e)),n==null?(dt(this,"provider",null),dt(this,"signer",null)):Vs.isSigner(n)?(dt(this,"provider",n.provider||null),dt(this,"signer",n)):Wo.isProvider(n)?(dt(this,"provider",n),dt(this,"signer",null)):xe.throwArgumentError("invalid signer or provider","signerOrProvider",n),dt(this,"callStatic",{}),dt(this,"estimateGas",{}),dt(this,"functions",{}),dt(this,"populateTransaction",{}),dt(this,"filters",{});{const o={};Object.keys(this.interface.events).forEach(a=>{const l=this.interface.events[a];dt(this.filters,a,(...c)=>({address:this.address,topics:this.interface.encodeFilterTopics(l,c)})),o[l.name]||(o[l.name]=[]),o[l.name].push(a)}),Object.keys(o).forEach(a=>{const l=o[a];l.length===1?dt(this.filters,a,this.filters[l[0]]):xe.warn(`Duplicate definition of ${a} (${l.join(", ")})`)})}if(dt(this,"_runningEvents",{}),dt(this,"_wrappedEmits",{}),t==null&&xe.throwArgumentError("invalid contract address or ENS name","addressOrName",t),dt(this,"address",t),this.provider)dt(this,"resolvedAddress",Do(this.provider,t));else try{dt(this,"resolvedAddress",Promise.resolve(Pe(t)))}catch{xe.throwError("provider is required to use ENS name as contract address",H.errors.UNSUPPORTED_OPERATION,{operation:"new Contract"})}this.resolvedAddress.catch(o=>{});const r={},s={};Object.keys(this.interface.functions).forEach(o=>{const a=this.interface.functions[o];if(s[o]){xe.warn(`Duplicate ABI entry for ${JSON.stringify(o)}`);return}s[o]=!0;{const l=a.name;r[`%${l}`]||(r[`%${l}`]=[]),r[`%${l}`].push(o)}this[o]==null&&dt(this,o,Rf(this,a,!0)),this.functions[o]==null&&dt(this.functions,o,Rf(this,a,!1)),this.callStatic[o]==null&&dt(this.callStatic,o,Ru(this,a,!0)),this.populateTransaction[o]==null&&dt(this.populateTransaction,o,T1(this,a)),this.estimateGas[o]==null&&dt(this.estimateGas,o,C1(this,a))}),Object.keys(r).forEach(o=>{const a=r[o];if(a.length>1)return;o=o.substring(1);const l=a[0];try{this[o]==null&&dt(this,o,this[l])}catch{}this.functions[o]==null&&dt(this.functions,o,this.functions[l]),this.callStatic[o]==null&&dt(this.callStatic,o,this.callStatic[l]),this.populateTransaction[o]==null&&dt(this.populateTransaction,o,this.populateTransaction[l]),this.estimateGas[o]==null&&dt(this.estimateGas,o,this.estimateGas[l])})}static getContractAddress(t){return Vh(t)}static getInterface(t){return wf.isInterface(t)?t:new wf(t)}deployed(){return this._deployed()}_deployed(t){return this._deployedPromise||(this.deployTransaction?this._deployedPromise=this.deployTransaction.wait().then(()=>this):this._deployedPromise=this.provider.getCode(this.address,t).then(e=>(e==="0x"&&xe.throwError("contract not deployed",H.errors.UNSUPPORTED_OPERATION,{contractAddress:this.address,operation:"getDeployed"}),this))),this._deployedPromise}fallback(t){this.signer||xe.throwError("sending a transactions require a signer",H.errors.UNSUPPORTED_OPERATION,{operation:"sendTransaction(fallback)"});const e=Ee(t||{});return["from","to"].forEach(function(n){e[n]!=null&&xe.throwError("cannot override "+n,H.errors.UNSUPPORTED_OPERATION,{operation:n})}),e.to=this.resolvedAddress,this.deployed().then(()=>this.signer.sendTransaction(e))}connect(t){typeof t=="string"&&(t=new Il(t,this.provider));const e=new this.constructor(this.address,this.interface,t);return this.deployTransaction&&dt(e,"deployTransaction",this.deployTransaction),e}attach(t){return new this.constructor(t,this.interface,this.signer||this.provider)}static isIndexed(t){return sl.isIndexed(t)}_normalizeRunningEvent(t){return this._runningEvents[t.tag]?this._runningEvents[t.tag]:t}_getRunningEvent(t){if(typeof t=="string"){if(t==="error")return this._normalizeRunningEvent(new I1);if(t==="event")return this._normalizeRunningEvent(new Is("event",null));if(t==="*")return this._normalizeRunningEvent(new If(this.address,this.interface));const e=this.interface.getEvent(t);return this._normalizeRunningEvent(new Pf(this.address,this.interface,e))}if(t.topics&&t.topics.length>0){try{const n=t.topics[0];if(typeof n!="string")throw new Error("invalid topic");const r=this.interface.getEvent(n);return this._normalizeRunningEvent(new Pf(this.address,this.interface,r,t.topics))}catch{}const e={address:this.address,topics:t.topics};return this._normalizeRunningEvent(new Is(Pu(e),e))}return this._normalizeRunningEvent(new If(this.address,this.interface))}_checkRunningEvents(t){if(t.listenerCount()===0){delete this._runningEvents[t.tag];const e=this._wrappedEmits[t.tag];e&&t.filter&&(this.provider.off(t.filter,e),delete this._wrappedEmits[t.tag])}}_wrapEvent(t,e,n){const r=yi(e);return r.removeListener=()=>{!n||(t.removeListener(n),this._checkRunningEvents(t))},r.getBlock=()=>this.provider.getBlock(e.blockHash),r.getTransaction=()=>this.provider.getTransaction(e.transactionHash),r.getTransactionReceipt=()=>this.provider.getTransactionReceipt(e.transactionHash),t.prepareEvent(r),r}_addEventListener(t,e,n){if(this.provider||xe.throwError("events require a provider or a signer with a provider",H.errors.UNSUPPORTED_OPERATION,{operation:"once"}),t.addListener(e,n),this._runningEvents[t.tag]=t,!this._wrappedEmits[t.tag]){const r=s=>{let o=this._wrapEvent(t,s,e);if(o.decodeError==null)try{const a=t.getEmit(o);this.emit(t.filter,...a)}catch(a){o.decodeError=a.error}t.filter!=null&&this.emit("event",o),o.decodeError!=null&&this.emit("error",o.decodeError,o)};this._wrappedEmits[t.tag]=r,t.filter!=null&&this.provider.on(t.filter,r)}}queryFilter(t,e,n){const r=this._getRunningEvent(t),s=Ee(r.filter);return typeof e=="string"&&ee(e,32)?(n!=null&&xe.throwArgumentError("cannot specify toBlock with blockhash","toBlock",n),s.blockHash=e):(s.fromBlock=e??0,s.toBlock=n??"latest"),this.provider.getLogs(s).then(o=>o.map(a=>this._wrapEvent(r,a,null)))}on(t,e){return this._addEventListener(this._getRunningEvent(t),e,!1),this}once(t,e){return this._addEventListener(this._getRunningEvent(t),e,!0),this}emit(t,...e){if(!this.provider)return!1;const n=this._getRunningEvent(t),r=n.run(e)>0;return this._checkRunningEvents(n),r}listenerCount(t){return this.provider?t==null?Object.keys(this._runningEvents).reduce((e,n)=>e+this._runningEvents[n].listenerCount(),0):this._getRunningEvent(t).listenerCount():0}listeners(t){if(!this.provider)return[];if(t==null){const e=[];for(let n in this._runningEvents)this._runningEvents[n].listeners().forEach(r=>{e.push(r)});return e}return this._getRunningEvent(t).listeners()}removeAllListeners(t){if(!this.provider)return this;if(t==null){for(const n in this._runningEvents){const r=this._runningEvents[n];r.removeAllListeners(),this._checkRunningEvents(r)}return this}const e=this._getRunningEvent(t);return e.removeAllListeners(),this._checkRunningEvents(e),this}off(t,e){if(!this.provider)return this;const n=this._getRunningEvent(t);return n.removeListener(e),this._checkRunningEvents(n),this}removeListener(t,e){return this.off(t,e)}}class D1 extends L1{}class Iu{constructor(t){dt(this,"alphabet",t),dt(this,"base",t.length),dt(this,"_alphabetMap",{}),dt(this,"_leader",t.charAt(0));for(let e=0;e<t.length;e++)this._alphabetMap[t.charAt(e)]=e}encode(t){let e=Nt(t);if(e.length===0)return"";let n=[0];for(let s=0;s<e.length;++s){let o=e[s];for(let a=0;a<n.length;++a)o+=n[a]<<8,n[a]=o%this.base,o=o/this.base|0;for(;o>0;)n.push(o%this.base),o=o/this.base|0}let r="";for(let s=0;e[s]===0&&s<e.length-1;++s)r+=this._leader;for(let s=n.length-1;s>=0;--s)r+=this.alphabet[n[s]];return r}decode(t){if(typeof t!="string")throw new TypeError("Expected String");let e=[];if(t.length===0)return new Uint8Array(e);e.push(0);for(let n=0;n<t.length;n++){let r=this._alphabetMap[t[n]];if(r===void 0)throw new Error("Non-base"+this.base+" character");let s=r;for(let o=0;o<e.length;++o)s+=e[o]*this.base,e[o]=s&255,s>>=8;for(;s>0;)e.push(s&255),s>>=8}for(let n=0;t[n]===this._leader&&n<t.length-1;++n)e.push(0);return Nt(new Uint8Array(e.reverse()))}}new Iu("abcdefghijklmnopqrstuvwxyz234567");const hl=new Iu("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),N1="sha2/5.6.1";new H(N1);function Lf(i){return"0x"+kn.sha256().update(Nt(i)).digest("hex")}const F1="networks/5.6.4",Df=new H(F1);function B1(i){return i&&typeof i.renetwork=="function"}function Bi(i){const t=function(e,n){n==null&&(n={});const r=[];if(e.InfuraProvider&&n.infura!=="-")try{r.push(new e.InfuraProvider(i,n.infura))}catch{}if(e.EtherscanProvider&&n.etherscan!=="-")try{r.push(new e.EtherscanProvider(i,n.etherscan))}catch{}if(e.AlchemyProvider&&n.alchemy!=="-")try{r.push(new e.AlchemyProvider(i,n.alchemy))}catch{}if(e.PocketProvider&&n.pocket!=="-"){const s=["goerli","ropsten","rinkeby"];try{const o=new e.PocketProvider(i,n.pocket);o.network&&s.indexOf(o.network.name)===-1&&r.push(o)}catch{}}if(e.CloudflareProvider&&n.cloudflare!=="-")try{r.push(new e.CloudflareProvider(i))}catch{}if(e.AnkrProvider&&n.ankr!=="-")try{const s=["ropsten"],o=new e.AnkrProvider(i,n.ankr);o.network&&s.indexOf(o.network.name)===-1&&r.push(o)}catch{}if(r.length===0)return null;if(e.FallbackProvider){let s=1;return n.quorum!=null?s=n.quorum:i==="homestead"&&(s=2),new e.FallbackProvider(r,s)}return r[0]};return t.renetwork=function(e){return Bi(e)},t}function No(i,t){const e=function(n,r){return n.JsonRpcProvider?new n.JsonRpcProvider(i,t):null};return e.renetwork=function(n){return No(i,n)},e}const Nf={chainId:1,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"homestead",_defaultProvider:Bi("homestead")},Ff={chainId:3,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"ropsten",_defaultProvider:Bi("ropsten")},Bf={chainId:63,name:"classicMordor",_defaultProvider:No("https://www.ethercluster.com/mordor","classicMordor")},mo={unspecified:{chainId:0,name:"unspecified"},homestead:Nf,mainnet:Nf,morden:{chainId:2,name:"morden"},ropsten:Ff,testnet:Ff,rinkeby:{chainId:4,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"rinkeby",_defaultProvider:Bi("rinkeby")},kovan:{chainId:42,name:"kovan",_defaultProvider:Bi("kovan")},goerli:{chainId:5,ensAddress:"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",name:"goerli",_defaultProvider:Bi("goerli")},kintsugi:{chainId:1337702,name:"kintsugi"},classic:{chainId:61,name:"classic",_defaultProvider:No("https://www.ethercluster.com/etc","classic")},classicMorden:{chainId:62,name:"classicMorden"},classicMordor:Bf,classicTestnet:Bf,classicKotti:{chainId:6,name:"classicKotti",_defaultProvider:No("https://www.ethercluster.com/kotti","classicKotti")},xdai:{chainId:100,name:"xdai"},matic:{chainId:137,name:"matic",_defaultProvider:Bi("matic")},maticmum:{chainId:80001,name:"maticmum"},optimism:{chainId:10,name:"optimism",_defaultProvider:Bi("optimism")},"optimism-kovan":{chainId:69,name:"optimism-kovan"},"optimism-goerli":{chainId:420,name:"optimism-goerli"},arbitrum:{chainId:42161,name:"arbitrum"},"arbitrum-rinkeby":{chainId:421611,name:"arbitrum-rinkeby"},bnb:{chainId:56,name:"bnb"},bnbt:{chainId:97,name:"bnbt"}};function k1(i){if(i==null)return null;if(typeof i=="number"){for(const n in mo){const r=mo[n];if(r.chainId===i)return{name:r.name,chainId:r.chainId,ensAddress:r.ensAddress||null,_defaultProvider:r._defaultProvider||null}}return{chainId:i,name:"unknown"}}if(typeof i=="string"){const n=mo[i];return n==null?null:{name:n.name,chainId:n.chainId,ensAddress:n.ensAddress,_defaultProvider:n._defaultProvider||null}}const t=mo[i.name];if(!t)return typeof i.chainId!="number"&&Df.throwArgumentError("invalid network chainId","network",i),i;i.chainId!==0&&i.chainId!==t.chainId&&Df.throwArgumentError("network chainId mismatch","network",i);let e=i._defaultProvider||null;return e==null&&t._defaultProvider&&(B1(t._defaultProvider)?e=t._defaultProvider.renetwork(i):e=t._defaultProvider),{name:i.name,chainId:t.chainId,ensAddress:i.ensAddress||t.ensAddress||null,_defaultProvider:e}}function O1(i){i=atob(i);const t=[];for(let e=0;e<i.length;e++)t.push(i.charCodeAt(e));return Nt(t)}function Lu(i){i=Nt(i);let t="";for(let e=0;e<i.length;e++)t+=String.fromCharCode(i[e]);return btoa(t)}const U1="web/5.6.1";var z1=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};function G1(i,t){return z1(this,void 0,void 0,function*(){t==null&&(t={});const e={method:t.method||"GET",headers:t.headers||{},body:t.body||void 0};t.skipFetchSetup!==!0&&(e.mode="cors",e.cache="no-cache",e.credentials="same-origin",e.redirect="follow",e.referrer="client");const n=yield fetch(i,e),r=yield n.arrayBuffer(),s={};return n.headers.forEach?n.headers.forEach((o,a)=>{s[a.toLowerCase()]=o}):n.headers.keys().forEach(o=>{s[o.toLowerCase()]=n.headers.get(o)}),{headers:s,statusCode:n.status,statusMessage:n.statusText,body:Nt(new Uint8Array(r))}})}var V1=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const An=new H(U1);function kf(i){return new Promise(t=>{setTimeout(t,i)})}function Ni(i,t){if(i==null)return null;if(typeof i=="string")return i;if(Ml(i)){if(t&&(t.split("/")[0]==="text"||t.split(";")[0].trim()==="application/json"))try{return Gs(i)}catch{}return Rt(i)}return i}function H1(i,t,e){const n=typeof i=="object"&&i.throttleLimit!=null?i.throttleLimit:12;An.assertArgument(n>0&&n%1===0,"invalid connection throttle limit","connection.throttleLimit",n);const r=typeof i=="object"?i.throttleCallback:null,s=typeof i=="object"&&typeof i.throttleSlotInterval=="number"?i.throttleSlotInterval:100;An.assertArgument(s>0&&s%1===0,"invalid connection throttle slot interval","connection.throttleSlotInterval",s);const o=typeof i=="object"?!!i.errorPassThrough:!1,a={};let l=null;const c={method:"GET"};let h=!1,u=2*60*1e3;if(typeof i=="string")l=i;else if(typeof i=="object"){if((i==null||i.url==null)&&An.throwArgumentError("missing URL","connection.url",i),l=i.url,typeof i.timeout=="number"&&i.timeout>0&&(u=i.timeout),i.headers)for(const M in i.headers)a[M.toLowerCase()]={key:M,value:String(i.headers[M])},["if-none-match","if-modified-since"].indexOf(M.toLowerCase())>=0&&(h=!0);if(c.allowGzip=!!i.allowGzip,i.user!=null&&i.password!=null){l.substring(0,6)!=="https:"&&i.allowInsecureAuthentication!==!0&&An.throwError("basic authentication requires a secure https url",H.errors.INVALID_ARGUMENT,{argument:"url",url:l,user:i.user,password:"[REDACTED]"});const M=i.user+":"+i.password;a.authorization={key:"Authorization",value:"Basic "+Lu(Qn(M))}}i.skipFetchSetup!=null&&(c.skipFetchSetup=!!i.skipFetchSetup)}const p=new RegExp("^data:([a-z0-9-]+/[a-z0-9-]+);base64,(.*)$","i"),x=l?l.match(p):null;if(x)try{const M={statusCode:200,statusMessage:"OK",headers:{"content-type":x[1]},body:O1(x[2])};let D=M.body;return e&&(D=e(M.body,M)),Promise.resolve(D)}catch(M){An.throwError("processing response error",H.errors.SERVER_ERROR,{body:Ni(x[1],x[2]),error:M,requestBody:null,requestMethod:"GET",url:l})}t&&(c.method="POST",c.body=t,a["content-type"]==null&&(a["content-type"]={key:"Content-Type",value:"application/octet-stream"}),a["content-length"]==null&&(a["content-length"]={key:"Content-Length",value:String(t.length)}));const b={};Object.keys(a).forEach(M=>{const D=a[M];b[D.key]=D.value}),c.headers=b;const g=function(){let M=null;return{promise:new Promise(function(B,O){u&&(M=setTimeout(()=>{M!=null&&(M=null,O(An.makeError("timeout",H.errors.TIMEOUT,{requestBody:Ni(c.body,b["content-type"]),requestMethod:c.method,timeout:u,url:l})))},u))}),cancel:function(){M!=null&&(clearTimeout(M),M=null)}}}(),v=function(){return V1(this,void 0,void 0,function*(){for(let M=0;M<n;M++){let D=null;try{if(D=yield G1(l,c),M<n){if(D.statusCode===301||D.statusCode===302){const B=D.headers.location||"";if(c.method==="GET"&&B.match(/^https:/)){l=D.headers.location;continue}}else if(D.statusCode===429){let B=!0;if(r&&(B=yield r(M,l)),B){let O=0;const G=D.headers["retry-after"];typeof G=="string"&&G.match(/^[1-9][0-9]*$/)?O=parseInt(G)*1e3:O=s*parseInt(String(Math.random()*Math.pow(2,M))),yield kf(O);continue}}}}catch(B){D=B.response,D==null&&(g.cancel(),An.throwError("missing response",H.errors.SERVER_ERROR,{requestBody:Ni(c.body,b["content-type"]),requestMethod:c.method,serverError:B,url:l}))}let z=D.body;if(h&&D.statusCode===304?z=null:!o&&(D.statusCode<200||D.statusCode>=300)&&(g.cancel(),An.throwError("bad response",H.errors.SERVER_ERROR,{status:D.statusCode,headers:D.headers,body:Ni(z,D.headers?D.headers["content-type"]:null),requestBody:Ni(c.body,b["content-type"]),requestMethod:c.method,url:l})),e)try{const B=yield e(z,D);return g.cancel(),B}catch(B){if(B.throttleRetry&&M<n){let O=!0;if(r&&(O=yield r(M,l)),O){const G=s*parseInt(String(Math.random()*Math.pow(2,M)));yield kf(G);continue}}g.cancel(),An.throwError("processing response error",H.errors.SERVER_ERROR,{body:Ni(z,D.headers?D.headers["content-type"]:null),error:B,requestBody:Ni(c.body,b["content-type"]),requestMethod:c.method,url:l})}return g.cancel(),z}return An.throwError("failed response",H.errors.SERVER_ERROR,{requestBody:Ni(c.body,b["content-type"]),requestMethod:c.method,url:l})})}();return Promise.race([g.promise,v])}function Bl(i,t,e){let n=(s,o)=>{let a=null;if(s!=null)try{a=JSON.parse(Gs(s))}catch(l){An.throwError("invalid JSON",H.errors.SERVER_ERROR,{body:s,error:l})}return e&&(a=e(a,o)),a},r=null;if(t!=null){r=Qn(t);const s=typeof i=="string"?{url:i}:Ee(i);s.headers?Object.keys(s.headers).filter(a=>a.toLowerCase()==="content-type").length!==0||(s.headers=Ee(s.headers),s.headers["content-type"]="application/json"):s.headers={"content-type":"application/json"},i=s}return H1(i,r,n)}function xs(i,t){return t||(t={}),t=Ee(t),t.floor==null&&(t.floor=0),t.ceiling==null&&(t.ceiling=1e4),t.interval==null&&(t.interval=250),new Promise(function(e,n){let r=null,s=!1;const o=()=>s?!1:(s=!0,r&&clearTimeout(r),!0);t.timeout&&(r=setTimeout(()=>{o()&&n(new Error("timeout"))},t.timeout));const a=t.retryLimit;let l=0;function c(){return i().then(function(h){if(h!==void 0)o()&&e(h);else if(t.oncePoll)t.oncePoll.once("poll",c);else if(t.onceBlock)t.onceBlock.once("block",c);else if(!s){if(l++,l>a){o()&&n(new Error("retry limit reached"));return}let u=t.interval*parseInt(String(Math.random()*Math.pow(2,l)));u<t.floor&&(u=t.floor),u>t.ceiling&&(u=t.ceiling),setTimeout(c,u)}return null},function(h){o()&&n(h)})}c()})}var Fo="qpzry9x8gf2tvdw0s3jn54khce6mua7l",ul={};for(var go=0;go<Fo.length;go++){var Ha=Fo.charAt(go);if(ul[Ha]!==void 0)throw new TypeError(Ha+" is ambiguous");ul[Ha]=go}function Or(i){var t=i>>25;return(i&33554431)<<5^-(t>>0&1)&996825010^-(t>>1&1)&642813549^-(t>>2&1)&513874426^-(t>>3&1)&1027748829^-(t>>4&1)&705979059}function Du(i){for(var t=1,e=0;e<i.length;++e){var n=i.charCodeAt(e);if(n<33||n>126)return"Invalid prefix ("+i+")";t=Or(t)^n>>5}for(t=Or(t),e=0;e<i.length;++e){var r=i.charCodeAt(e);t=Or(t)^r&31}return t}function W1(i,t,e){if(e=e||90,i.length+7+t.length>e)throw new TypeError("Exceeds length limit");i=i.toLowerCase();var n=Du(i);if(typeof n=="string")throw new Error(n);for(var r=i+"1",s=0;s<t.length;++s){var o=t[s];if(o>>5!==0)throw new Error("Non 5-bit word");n=Or(n)^o,r+=Fo.charAt(o)}for(s=0;s<6;++s)n=Or(n);for(n^=1,s=0;s<6;++s){var a=n>>(5-s)*5&31;r+=Fo.charAt(a)}return r}function Nu(i,t){if(t=t||90,i.length<8)return i+" too short";if(i.length>t)return"Exceeds length limit";var e=i.toLowerCase(),n=i.toUpperCase();if(i!==e&&i!==n)return"Mixed-case string "+i;i=e;var r=i.lastIndexOf("1");if(r===-1)return"No separator character for "+i;if(r===0)return"Missing prefix for "+i;var s=i.slice(0,r),o=i.slice(r+1);if(o.length<6)return"Data too short";var a=Du(s);if(typeof a=="string")return a;for(var l=[],c=0;c<o.length;++c){var h=o.charAt(c),u=ul[h];if(u===void 0)return"Unknown character "+h;a=Or(a)^u,!(c+6>=o.length)&&l.push(u)}return a!==1?"Invalid checksum for "+i:{prefix:s,words:l}}function q1(){var i=Nu.apply(null,arguments);if(typeof i=="object")return i}function j1(i){var t=Nu.apply(null,arguments);if(typeof t=="object")return t;throw new Error(t)}function Yo(i,t,e,n){for(var r=0,s=0,o=(1<<e)-1,a=[],l=0;l<i.length;++l)for(r=r<<t|i[l],s+=t;s>=e;)s-=e,a.push(r>>s&o);if(n)s>0&&a.push(r<<e-s&o);else{if(s>=t)return"Excess padding";if(r<<e-s&o)return"Non-zero padding"}return a}function X1(i){var t=Yo(i,8,5,!0);if(Array.isArray(t))return t}function Z1(i){var t=Yo(i,8,5,!0);if(Array.isArray(t))return t;throw new Error(t)}function Y1(i){var t=Yo(i,5,8,!1);if(Array.isArray(t))return t}function J1(i){var t=Yo(i,5,8,!1);if(Array.isArray(t))return t;throw new Error(t)}var Of={decodeUnsafe:q1,decode:j1,encode:W1,toWordsUnsafe:X1,toWords:Z1,fromWordsUnsafe:Y1,fromWords:J1};const Jo="providers/5.6.8",fs=new H(Jo);class Tt{constructor(){this.formats=this.getDefaultFormats()}getDefaultFormats(){const t={},e=this.address.bind(this),n=this.bigNumber.bind(this),r=this.blockTag.bind(this),s=this.data.bind(this),o=this.hash.bind(this),a=this.hex.bind(this),l=this.number.bind(this),c=this.type.bind(this),h=u=>this.data(u,!0);return t.transaction={hash:o,type:c,accessList:Tt.allowNull(this.accessList.bind(this),null),blockHash:Tt.allowNull(o,null),blockNumber:Tt.allowNull(l,null),transactionIndex:Tt.allowNull(l,null),confirmations:Tt.allowNull(l,null),from:e,gasPrice:Tt.allowNull(n),maxPriorityFeePerGas:Tt.allowNull(n),maxFeePerGas:Tt.allowNull(n),gasLimit:n,to:Tt.allowNull(e,null),value:n,nonce:l,data:s,r:Tt.allowNull(this.uint256),s:Tt.allowNull(this.uint256),v:Tt.allowNull(l),creates:Tt.allowNull(e,null),raw:Tt.allowNull(s)},t.transactionRequest={from:Tt.allowNull(e),nonce:Tt.allowNull(l),gasLimit:Tt.allowNull(n),gasPrice:Tt.allowNull(n),maxPriorityFeePerGas:Tt.allowNull(n),maxFeePerGas:Tt.allowNull(n),to:Tt.allowNull(e),value:Tt.allowNull(n),data:Tt.allowNull(h),type:Tt.allowNull(l),accessList:Tt.allowNull(this.accessList.bind(this),null)},t.receiptLog={transactionIndex:l,blockNumber:l,transactionHash:o,address:e,topics:Tt.arrayOf(o),data:s,logIndex:l,blockHash:o},t.receipt={to:Tt.allowNull(this.address,null),from:Tt.allowNull(this.address,null),contractAddress:Tt.allowNull(e,null),transactionIndex:l,root:Tt.allowNull(a),gasUsed:n,logsBloom:Tt.allowNull(s),blockHash:o,transactionHash:o,logs:Tt.arrayOf(this.receiptLog.bind(this)),blockNumber:l,confirmations:Tt.allowNull(l,null),cumulativeGasUsed:n,effectiveGasPrice:Tt.allowNull(n),status:Tt.allowNull(l),type:c},t.block={hash:Tt.allowNull(o),parentHash:o,number:l,timestamp:l,nonce:Tt.allowNull(a),difficulty:this.difficulty.bind(this),gasLimit:n,gasUsed:n,miner:Tt.allowNull(e),extraData:s,transactions:Tt.allowNull(Tt.arrayOf(o)),baseFeePerGas:Tt.allowNull(n)},t.blockWithTransactions=Ee(t.block),t.blockWithTransactions.transactions=Tt.allowNull(Tt.arrayOf(this.transactionResponse.bind(this))),t.filter={fromBlock:Tt.allowNull(r,void 0),toBlock:Tt.allowNull(r,void 0),blockHash:Tt.allowNull(o,void 0),address:Tt.allowNull(e,void 0),topics:Tt.allowNull(this.topics.bind(this),void 0)},t.filterLog={blockNumber:Tt.allowNull(l),blockHash:Tt.allowNull(o),transactionIndex:l,removed:Tt.allowNull(this.boolean.bind(this)),address:e,data:Tt.allowFalsish(s,"0x"),topics:Tt.arrayOf(o),transactionHash:o,logIndex:l},t}accessList(t){return rs(t||[])}number(t){return t==="0x"?0:pt.from(t).toNumber()}type(t){return t==="0x"||t==null?0:pt.from(t).toNumber()}bigNumber(t){return pt.from(t)}boolean(t){if(typeof t=="boolean")return t;if(typeof t=="string"){if(t=t.toLowerCase(),t==="true")return!0;if(t==="false")return!1}throw new Error("invalid boolean - "+t)}hex(t,e){return typeof t=="string"&&(!e&&t.substring(0,2)!=="0x"&&(t="0x"+t),ee(t))?t.toLowerCase():fs.throwArgumentError("invalid hash","value",t)}data(t,e){const n=this.hex(t,e);if(n.length%2!==0)throw new Error("invalid data; odd-length - "+t);return n}address(t){return Pe(t)}callAddress(t){if(!ee(t,32))return null;const e=Pe(Fe(t,12));return e===zx?null:e}contractAddress(t){return Vh(t)}blockTag(t){if(t==null)return"latest";if(t==="earliest")return"0x0";if(t==="latest"||t==="pending")return t;if(typeof t=="number"||ee(t))return Sl(t);throw new Error("invalid blockTag")}hash(t,e){const n=this.hex(t,e);return rr(n)!==32?fs.throwArgumentError("invalid hash","value",t):n}difficulty(t){if(t==null)return null;const e=pt.from(t);try{return e.toNumber()}catch{}return null}uint256(t){if(!ee(t))throw new Error("invalid uint256");return he(t,32)}_block(t,e){t.author!=null&&t.miner==null&&(t.miner=t.author);const n=t._difficulty!=null?t._difficulty:t.difficulty,r=Tt.check(e,t);return r._difficulty=n==null?null:pt.from(n),r}block(t){return this._block(t,this.formats.block)}blockWithTransactions(t){return this._block(t,this.formats.blockWithTransactions)}transactionRequest(t){return Tt.check(this.formats.transactionRequest,t)}transactionResponse(t){t.gas!=null&&t.gasLimit==null&&(t.gasLimit=t.gas),t.to&&pt.from(t.to).isZero()&&(t.to="0x0000000000000000000000000000000000000000"),t.input!=null&&t.data==null&&(t.data=t.input),t.to==null&&t.creates==null&&(t.creates=this.contractAddress(t)),(t.type===1||t.type===2)&&t.accessList==null&&(t.accessList=[]);const e=Tt.check(this.formats.transaction,t);if(t.chainId!=null){let n=t.chainId;ee(n)&&(n=pt.from(n).toNumber()),e.chainId=n}else{let n=t.networkId;n==null&&e.v==null&&(n=t.chainId),ee(n)&&(n=pt.from(n).toNumber()),typeof n!="number"&&e.v!=null&&(n=(e.v-35)/2,n<0&&(n=0),n=parseInt(n)),typeof n!="number"&&(n=0),e.chainId=n}return e.blockHash&&e.blockHash.replace(/0/g,"")==="x"&&(e.blockHash=null),e}transaction(t){return A1(t)}receiptLog(t){return Tt.check(this.formats.receiptLog,t)}receipt(t){const e=Tt.check(this.formats.receipt,t);if(e.root!=null)if(e.root.length<=4){const n=pt.from(e.root).toNumber();n===0||n===1?(e.status!=null&&e.status!==n&&fs.throwArgumentError("alt-root-status/status mismatch","value",{root:e.root,status:e.status}),e.status=n,delete e.root):fs.throwArgumentError("invalid alt-root-status","value.root",e.root)}else e.root.length!==66&&fs.throwArgumentError("invalid root hash","value.root",e.root);return e.status!=null&&(e.byzantium=!0),e}topics(t){return Array.isArray(t)?t.map(e=>this.topics(e)):t!=null?this.hash(t,!0):null}filter(t){return Tt.check(this.formats.filter,t)}filterLog(t){return Tt.check(this.formats.filterLog,t)}static check(t,e){const n={};for(const r in t)try{const s=t[r](e[r]);s!==void 0&&(n[r]=s)}catch(s){throw s.checkKey=r,s.checkValue=e[r],s}return n}static allowNull(t,e){return function(n){return n==null?e:t(n)}}static allowFalsish(t,e){return function(n){return n?t(n):e}}static arrayOf(t){return function(e){if(!Array.isArray(e))throw new Error("not an array");const n=[];return e.forEach(function(r){n.push(t(r))}),n}}}var kt=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const Ht=new H(Jo),K1=10;function Uf(i){return i==null?"null":(rr(i)!==32&&Ht.throwArgumentError("invalid topic","topic",i),i.toLowerCase())}function zf(i){for(i=i.slice();i.length>0&&i[i.length-1]==null;)i.pop();return i.map(t=>{if(Array.isArray(t)){const e={};t.forEach(r=>{e[Uf(r)]=!0});const n=Object.keys(e);return n.sort(),n.join("|")}else return Uf(t)}).join("&")}function Q1(i){return i===""?[]:i.split(/&/g).map(t=>{if(t==="")return[];const e=t.split("|").map(n=>n==="null"?null:n);return e.length===1?e[0]:e})}function Ar(i){if(typeof i=="string"){if(i=i.toLowerCase(),rr(i)===32)return"tx:"+i;if(i.indexOf(":")===-1)return i}else{if(Array.isArray(i))return"filter:*:"+zf(i);if(R_.isForkEvent(i))throw Ht.warn("not implemented"),new Error("not implemented");if(i&&typeof i=="object")return"filter:"+(i.address||"*")+":"+zf(i.topics||[])}throw new Error("invalid event - "+i)}function hs(){return new Date().getTime()}function Gf(i){return new Promise(t=>{setTimeout(t,i)})}const $1=["block","network","pending","poll"];class tb{constructor(t,e,n){dt(this,"tag",t),dt(this,"listener",e),dt(this,"once",n),this._lastBlockNumber=-2,this._inflight=!1}get event(){switch(this.type){case"tx":return this.hash;case"filter":return this.filter}return this.tag}get type(){return this.tag.split(":")[0]}get hash(){const t=this.tag.split(":");return t[0]!=="tx"?null:t[1]}get filter(){const t=this.tag.split(":");if(t[0]!=="filter")return null;const e=t[1],n=Q1(t[2]),r={};return n.length>0&&(r.topics=n),e&&e!=="*"&&(r.address=e),r}pollable(){return this.tag.indexOf(":")>=0||$1.indexOf(this.tag)>=0}}const eb={0:{symbol:"btc",p2pkh:0,p2sh:5,prefix:"bc"},2:{symbol:"ltc",p2pkh:48,p2sh:50,prefix:"ltc"},3:{symbol:"doge",p2pkh:30,p2sh:22},60:{symbol:"eth",ilk:"eth"},61:{symbol:"etc",ilk:"eth"},700:{symbol:"xdai",ilk:"eth"}};function Wa(i){return he(pt.from(i).toHexString(),32)}function Vf(i){return hl.encode(on([i,Fe(Lf(Lf(i)),0,4)]))}const Fu=new RegExp("^(ipfs)://(.*)$","i"),Hf=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),Fu,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];function Eo(i,t){try{return Gs(Ls(i,t))}catch{}return null}function Ls(i,t){if(i==="0x")return null;const e=pt.from(Fe(i,t,t+32)).toNumber(),n=pt.from(Fe(i,e,e+32)).toNumber();return Fe(i,e+32,e+32+n)}function qa(i){return i.match(/^ipfs:\/\/ipfs\//i)?i=i.substring(12):i.match(/^ipfs:\/\//i)?i=i.substring(7):Ht.throwArgumentError("unsupported IPFS format","link",i),`https://gateway.ipfs.io/ipfs/${i}`}function Wf(i){const t=Nt(i);if(t.length>32)throw new Error("internal; should not happen");const e=new Uint8Array(32);return e.set(t,32-t.length),e}function nb(i){if(i.length%32===0)return i;const t=new Uint8Array(Math.ceil(i.length/32)*32);return t.set(i),t}function Bu(i){const t=[];let e=0;for(let n=0;n<i.length;n++)t.push(null),e+=32;for(let n=0;n<i.length;n++){const r=Nt(i[n]);t[n]=Wf(e),t.push(Wf(r.length)),t.push(nb(r)),e+=32+Math.ceil(r.length/32)*32}return Ke(t)}class qf{constructor(t,e,n,r){dt(this,"provider",t),dt(this,"name",n),dt(this,"address",t.formatter.address(e)),dt(this,"_resolvedAddress",r)}supportsWildcard(){return this._supportsEip2544||(this._supportsEip2544=this.provider.call({to:this.address,data:"0x01ffc9a79061b92300000000000000000000000000000000000000000000000000000000"}).then(t=>pt.from(t).eq(1)).catch(t=>{if(t.code===H.errors.CALL_EXCEPTION)return!1;throw this._supportsEip2544=null,t})),this._supportsEip2544}_fetch(t,e){return kt(this,void 0,void 0,function*(){const n={to:this.address,ccipReadEnabled:!0,data:Ke([t,wo(this.name),e||"0x"])};let r=!1;(yield this.supportsWildcard())&&(r=!0,n.data=Ke(["0x9061b923",Bu([p_(this.name),n.data])]));try{let s=yield this.provider.call(n);return Nt(s).length%32===4&&Ht.throwError("resolver threw error",H.errors.CALL_EXCEPTION,{transaction:n,data:s}),r&&(s=Ls(s,0)),s}catch(s){if(s.code===H.errors.CALL_EXCEPTION)return null;throw s}})}_fetchBytes(t,e){return kt(this,void 0,void 0,function*(){const n=yield this._fetch(t,e);return n!=null?Ls(n,0):null})}_getAddress(t,e){const n=eb[String(t)];if(n==null&&Ht.throwError(`unsupported coin type: ${t}`,H.errors.UNSUPPORTED_OPERATION,{operation:`getAddress(${t})`}),n.ilk==="eth")return this.provider.formatter.address(e);const r=Nt(e);if(n.p2pkh!=null){const s=e.match(/^0x76a9([0-9a-f][0-9a-f])([0-9a-f]*)88ac$/);if(s){const o=parseInt(s[1],16);if(s[2].length===o*2&&o>=1&&o<=75)return Vf(on([[n.p2pkh],"0x"+s[2]]))}}if(n.p2sh!=null){const s=e.match(/^0xa9([0-9a-f][0-9a-f])([0-9a-f]*)87$/);if(s){const o=parseInt(s[1],16);if(s[2].length===o*2&&o>=1&&o<=75)return Vf(on([[n.p2sh],"0x"+s[2]]))}}if(n.prefix!=null){const s=r[1];let o=r[0];if(o===0?s!==20&&s!==32&&(o=-1):o=-1,o>=0&&r.length===2+s&&s>=1&&s<=75){const a=Of.toWords(r.slice(2));return a.unshift(o),Of.encode(n.prefix,a)}}return null}getAddress(t){return kt(this,void 0,void 0,function*(){if(t==null&&(t=60),t===60)try{const r=yield this._fetch("0x3b3b57de");return r==="0x"||r===Wx?null:this.provider.formatter.callAddress(r)}catch(r){if(r.code===H.errors.CALL_EXCEPTION)return null;throw r}const e=yield this._fetchBytes("0xf1cb7e06",Wa(t));if(e==null||e==="0x")return null;const n=this._getAddress(t,e);return n==null&&Ht.throwError("invalid or unsupported coin data",H.errors.UNSUPPORTED_OPERATION,{operation:`getAddress(${t})`,coinType:t,data:e}),n})}getAvatar(){return kt(this,void 0,void 0,function*(){const t=[{type:"name",content:this.name}];try{const e=yield this.getText("avatar");if(e==null)return null;for(let n=0;n<Hf.length;n++){const r=e.match(Hf[n]);if(r==null)continue;const s=r[1].toLowerCase();switch(s){case"https":return t.push({type:"url",content:e}),{linkage:t,url:e};case"data":return t.push({type:"data",content:e}),{linkage:t,url:e};case"ipfs":return t.push({type:"ipfs",content:e}),{linkage:t,url:qa(e)};case"erc721":case"erc1155":{const o=s==="erc721"?"0xc87b56dd":"0x0e89341c";t.push({type:s,content:e});const a=this._resolvedAddress||(yield this.getAddress()),l=(r[2]||"").split("/");if(l.length!==2)return null;const c=yield this.provider.formatter.address(l[0]),h=he(pt.from(l[1]).toHexString(),32);if(s==="erc721"){const g=this.provider.formatter.callAddress(yield this.provider.call({to:c,data:Ke(["0x6352211e",h])}));if(a!==g)return null;t.push({type:"owner",content:g})}else if(s==="erc1155"){const g=pt.from(yield this.provider.call({to:c,data:Ke(["0x00fdd58e",he(a,32),h])}));if(g.isZero())return null;t.push({type:"balance",content:g.toString()})}const u={to:this.provider.formatter.address(l[0]),data:Ke([o,h])};let p=Eo(yield this.provider.call(u),0);if(p==null)return null;t.push({type:"metadata-url-base",content:p}),s==="erc1155"&&(p=p.replace("{id}",h.substring(2)),t.push({type:"metadata-url-expanded",content:p})),p.match(/^ipfs:/i)&&(p=qa(p)),t.push({type:"metadata-url",content:p});const x=yield Bl(p);if(!x)return null;t.push({type:"metadata",content:JSON.stringify(x)});let b=x.image;if(typeof b!="string")return null;if(!b.match(/^(https:\/\/|data:)/i)){if(b.match(Fu)==null)return null;t.push({type:"url-ipfs",content:b}),b=qa(b)}return t.push({type:"url",content:b}),{linkage:t,url:b}}}}}catch{}return null})}getContentHash(){return kt(this,void 0,void 0,function*(){const t=yield this._fetchBytes("0xbc1c58d1");if(t==null||t==="0x")return null;const e=t.match(/^0xe3010170(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const o=parseInt(e[3],16);if(e[4].length===o*2)return"ipfs://"+hl.encode("0x"+e[1])}const n=t.match(/^0xe5010172(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(n){const o=parseInt(n[3],16);if(n[4].length===o*2)return"ipns://"+hl.encode("0x"+n[1])}const r=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(r&&r[1].length===32*2)return"bzz://"+r[1];const s=t.match(/^0x90b2c605([0-9a-f]*)$/);if(s&&s[1].length===34*2){const o={"=":"","+":"-","/":"_"},a=Lu("0x"+s[1]).replace(/[=+\/]/g,l=>o[l]);return"sia://"+a}return Ht.throwError("invalid or unsupported content hash data",H.errors.UNSUPPORTED_OPERATION,{operation:"getContentHash()",data:t})})}getText(t){return kt(this,void 0,void 0,function*(){let e=Qn(t);e=on([Wa(64),Wa(e.length),e]),e.length%32!==0&&(e=on([e,he("0x",32-t.length%32)]));const n=yield this._fetchBytes("0x59d1d43c",Rt(e));return n==null||n==="0x"?null:Gs(n)})}}let ja=null,ib=1;class rb extends Wo{constructor(t){if(super(),this._events=[],this._emitted={block:-2},this.disableCcipRead=!1,this.formatter=new.target.getFormatter(),dt(this,"anyNetwork",t==="any"),this.anyNetwork&&(t=this.detectNetwork()),t instanceof Promise)this._networkPromise=t,t.catch(e=>{}),this._ready().catch(e=>{});else{const e=jn(new.target,"getNetwork")(t);e?(dt(this,"_network",e),this.emit("network",e,null)):Ht.throwArgumentError("invalid network","network",t)}this._maxInternalBlockNumber=-1024,this._lastBlockNumber=-2,this._maxFilterBlockRange=10,this._pollingInterval=4e3,this._fastQueryDate=0}_ready(){return kt(this,void 0,void 0,function*(){if(this._network==null){let t=null;if(this._networkPromise)try{t=yield this._networkPromise}catch{}t==null&&(t=yield this.detectNetwork()),t||Ht.throwError("no network detected",H.errors.UNKNOWN_ERROR,{}),this._network==null&&(this.anyNetwork?this._network=t:dt(this,"_network",t),this.emit("network",t,null))}return this._network})}get ready(){return xs(()=>this._ready().then(t=>t,t=>{if(!(t.code===H.errors.NETWORK_ERROR&&t.event==="noNetwork"))throw t}))}static getFormatter(){return ja==null&&(ja=new Tt),ja}static getNetwork(t){return k1(t??"homestead")}ccipReadFetch(t,e,n){return kt(this,void 0,void 0,function*(){if(this.disableCcipRead||n.length===0)return null;const r=t.to.toLowerCase(),s=e.toLowerCase(),o=[];for(let a=0;a<n.length;a++){const l=n[a],c=l.replace("{sender}",r).replace("{data}",s),h=l.indexOf("{data}")>=0?null:JSON.stringify({data:s,sender:r}),u=yield Bl({url:c,errorPassThrough:!0},h,(x,b)=>(x.status=b.statusCode,x));if(u.data)return u.data;const p=u.message||"unknown error";if(u.status>=400&&u.status<500)return Ht.throwError(`response not found during CCIP fetch: ${p}`,H.errors.SERVER_ERROR,{url:l,errorMessage:p});o.push(p)}return Ht.throwError(`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,H.errors.SERVER_ERROR,{urls:n,errorMessages:o})})}_getInternalBlockNumber(t){return kt(this,void 0,void 0,function*(){if(yield this._ready(),t>0)for(;this._internalBlockNumber;){const r=this._internalBlockNumber;try{const s=yield r;if(hs()-s.respTime<=t)return s.blockNumber;break}catch{if(this._internalBlockNumber===r)break}}const e=hs(),n=ye({blockNumber:this.perform("getBlockNumber",{}),networkError:this.getNetwork().then(r=>null,r=>r)}).then(({blockNumber:r,networkError:s})=>{if(s)throw this._internalBlockNumber===n&&(this._internalBlockNumber=null),s;const o=hs();return r=pt.from(r).toNumber(),r<this._maxInternalBlockNumber&&(r=this._maxInternalBlockNumber),this._maxInternalBlockNumber=r,this._setFastBlockNumber(r),{blockNumber:r,reqTime:e,respTime:o}});return this._internalBlockNumber=n,n.catch(r=>{this._internalBlockNumber===n&&(this._internalBlockNumber=null)}),(yield n).blockNumber})}poll(){return kt(this,void 0,void 0,function*(){const t=ib++,e=[];let n=null;try{n=yield this._getInternalBlockNumber(100+this.pollingInterval/2)}catch(r){this.emit("error",r);return}if(this._setFastBlockNumber(n),this.emit("poll",t,n),n===this._lastBlockNumber){this.emit("didPoll",t);return}if(this._emitted.block===-2&&(this._emitted.block=n-1),Math.abs(this._emitted.block-n)>1e3)Ht.warn(`network block skew detected; skipping block events (emitted=${this._emitted.block} blockNumber${n})`),this.emit("error",Ht.makeError("network block skew detected",H.errors.NETWORK_ERROR,{blockNumber:n,event:"blockSkew",previousBlockNumber:this._emitted.block})),this.emit("block",n);else for(let r=this._emitted.block+1;r<=n;r++)this.emit("block",r);this._emitted.block!==n&&(this._emitted.block=n,Object.keys(this._emitted).forEach(r=>{if(r==="block")return;const s=this._emitted[r];s!=="pending"&&n-s>12&&delete this._emitted[r]})),this._lastBlockNumber===-2&&(this._lastBlockNumber=n-1),this._events.forEach(r=>{switch(r.type){case"tx":{const s=r.hash;let o=this.getTransactionReceipt(s).then(a=>(!a||a.blockNumber==null||(this._emitted["t:"+s]=a.blockNumber,this.emit(s,a)),null)).catch(a=>{this.emit("error",a)});e.push(o);break}case"filter":{if(!r._inflight){r._inflight=!0;const s=r.filter;s.fromBlock=r._lastBlockNumber+1,s.toBlock=n,s.toBlock-this._maxFilterBlockRange>s.fromBlock&&(s.fromBlock=s.toBlock-this._maxFilterBlockRange);const o=this.getLogs(s).then(a=>{r._inflight=!1,a.length!==0&&a.forEach(l=>{l.blockNumber>r._lastBlockNumber&&(r._lastBlockNumber=l.blockNumber),this._emitted["b:"+l.blockHash]=l.blockNumber,this._emitted["t:"+l.transactionHash]=l.blockNumber,this.emit(s,l)})}).catch(a=>{this.emit("error",a),r._inflight=!1});e.push(o)}break}}}),this._lastBlockNumber=n,Promise.all(e).then(()=>{this.emit("didPoll",t)}).catch(r=>{this.emit("error",r)})})}resetEventsBlock(t){this._lastBlockNumber=t-1,this.polling&&this.poll()}get network(){return this._network}detectNetwork(){return kt(this,void 0,void 0,function*(){return Ht.throwError("provider does not support network detection",H.errors.UNSUPPORTED_OPERATION,{operation:"provider.detectNetwork"})})}getNetwork(){return kt(this,void 0,void 0,function*(){const t=yield this._ready(),e=yield this.detectNetwork();if(t.chainId!==e.chainId){if(this.anyNetwork)return this._network=e,this._lastBlockNumber=-2,this._fastBlockNumber=null,this._fastBlockNumberPromise=null,this._fastQueryDate=0,this._emitted.block=-2,this._maxInternalBlockNumber=-1024,this._internalBlockNumber=null,this.emit("network",e,t),yield Gf(0),this._network;const n=Ht.makeError("underlying network changed",H.errors.NETWORK_ERROR,{event:"changed",network:t,detectedNetwork:e});throw this.emit("error",n),n}return t})}get blockNumber(){return this._getInternalBlockNumber(100+this.pollingInterval/2).then(t=>{this._setFastBlockNumber(t)},t=>{}),this._fastBlockNumber!=null?this._fastBlockNumber:-1}get polling(){return this._poller!=null}set polling(t){t&&!this._poller?(this._poller=setInterval(()=>{this.poll()},this.pollingInterval),this._bootstrapPoll||(this._bootstrapPoll=setTimeout(()=>{this.poll(),this._bootstrapPoll=setTimeout(()=>{this._poller||this.poll(),this._bootstrapPoll=null},this.pollingInterval)},0))):!t&&this._poller&&(clearInterval(this._poller),this._poller=null)}get pollingInterval(){return this._pollingInterval}set pollingInterval(t){if(typeof t!="number"||t<=0||parseInt(String(t))!=t)throw new Error("invalid polling interval");this._pollingInterval=t,this._poller&&(clearInterval(this._poller),this._poller=setInterval(()=>{this.poll()},this._pollingInterval))}_getFastBlockNumber(){const t=hs();return t-this._fastQueryDate>2*this._pollingInterval&&(this._fastQueryDate=t,this._fastBlockNumberPromise=this.getBlockNumber().then(e=>((this._fastBlockNumber==null||e>this._fastBlockNumber)&&(this._fastBlockNumber=e),this._fastBlockNumber))),this._fastBlockNumberPromise}_setFastBlockNumber(t){this._fastBlockNumber!=null&&t<this._fastBlockNumber||(this._fastQueryDate=hs(),(this._fastBlockNumber==null||t>this._fastBlockNumber)&&(this._fastBlockNumber=t,this._fastBlockNumberPromise=Promise.resolve(t)))}waitForTransaction(t,e,n){return kt(this,void 0,void 0,function*(){return this._waitForTransaction(t,e??1,n||0,null)})}_waitForTransaction(t,e,n,r){return kt(this,void 0,void 0,function*(){const s=yield this.getTransactionReceipt(t);return(s?s.confirmations:0)>=e?s:new Promise((o,a)=>{const l=[];let c=!1;const h=function(){return c?!0:(c=!0,l.forEach(p=>{p()}),!1)},u=p=>{p.confirmations<e||h()||o(p)};if(this.on(t,u),l.push(()=>{this.removeListener(t,u)}),r){let p=r.startBlock,x=null;const b=g=>kt(this,void 0,void 0,function*(){c||(yield Gf(1e3),this.getTransactionCount(r.from).then(v=>kt(this,void 0,void 0,function*(){if(!c){if(v<=r.nonce)p=g;else{{const M=yield this.getTransaction(t);if(M&&M.blockNumber!=null)return}for(x==null&&(x=p-3,x<r.startBlock&&(x=r.startBlock));x<=g;){if(c)return;const M=yield this.getBlockWithTransactions(x);for(let D=0;D<M.transactions.length;D++){const z=M.transactions[D];if(z.hash===t)return;if(z.from===r.from&&z.nonce===r.nonce){if(c)return;const B=yield this.waitForTransaction(z.hash,e);if(h())return;let O="replaced";z.data===r.data&&z.to===r.to&&z.value.eq(r.value)?O="repriced":z.data==="0x"&&z.from===z.to&&z.value.isZero()&&(O="cancelled"),a(Ht.makeError("transaction was replaced",H.errors.TRANSACTION_REPLACED,{cancelled:O==="replaced"||O==="cancelled",reason:O,replacement:this._wrapTransaction(z),hash:t,receipt:B}));return}}x++}}c||this.once("block",b)}}),v=>{c||this.once("block",b)}))});if(c)return;this.once("block",b),l.push(()=>{this.removeListener("block",b)})}if(typeof n=="number"&&n>0){const p=setTimeout(()=>{h()||a(Ht.makeError("timeout exceeded",H.errors.TIMEOUT,{timeout:n}))},n);p.unref&&p.unref(),l.push(()=>{clearTimeout(p)})}})})}getBlockNumber(){return kt(this,void 0,void 0,function*(){return this._getInternalBlockNumber(0)})}getGasPrice(){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const t=yield this.perform("getGasPrice",{});try{return pt.from(t)}catch(e){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"getGasPrice",result:t,error:e})}})}getBalance(t,e){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ye({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),r=yield this.perform("getBalance",n);try{return pt.from(r)}catch(s){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"getBalance",params:n,result:r,error:s})}})}getTransactionCount(t,e){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ye({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),r=yield this.perform("getTransactionCount",n);try{return pt.from(r).toNumber()}catch(s){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"getTransactionCount",params:n,result:r,error:s})}})}getCode(t,e){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ye({address:this._getAddress(t),blockTag:this._getBlockTag(e)}),r=yield this.perform("getCode",n);try{return Rt(r)}catch(s){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"getCode",params:n,result:r,error:s})}})}getStorageAt(t,e,n){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const r=yield ye({address:this._getAddress(t),blockTag:this._getBlockTag(n),position:Promise.resolve(e).then(o=>Sl(o))}),s=yield this.perform("getStorageAt",r);try{return Rt(s)}catch(o){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"getStorageAt",params:r,result:s,error:o})}})}_wrapTransaction(t,e,n){if(e!=null&&rr(e)!==32)throw new Error("invalid response - sendTransaction");const r=t;return e!=null&&t.hash!==e&&Ht.throwError("Transaction hash mismatch from Provider.sendTransaction.",H.errors.UNKNOWN_ERROR,{expectedHash:t.hash,returnedHash:e}),r.wait=(s,o)=>kt(this,void 0,void 0,function*(){s==null&&(s=1),o==null&&(o=0);let a;s!==0&&n!=null&&(a={data:t.data,from:t.from,nonce:t.nonce,to:t.to,value:t.value,startBlock:n});const l=yield this._waitForTransaction(t.hash,s,o,a);return l==null&&s===0?null:(this._emitted["t:"+t.hash]=l.blockNumber,l.status===0&&Ht.throwError("transaction failed",H.errors.CALL_EXCEPTION,{transactionHash:t.hash,transaction:t,receipt:l}),l)}),r}sendTransaction(t){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const e=yield Promise.resolve(t).then(s=>Rt(s)),n=this.formatter.transaction(t);n.confirmations==null&&(n.confirmations=0);const r=yield this._getInternalBlockNumber(100+2*this.pollingInterval);try{const s=yield this.perform("sendTransaction",{signedTransaction:e});return this._wrapTransaction(n,s,r)}catch(s){throw s.transaction=n,s.transactionHash=n.hash,s}})}_getTransactionRequest(t){return kt(this,void 0,void 0,function*(){const e=yield t,n={};return["from","to"].forEach(r=>{e[r]!=null&&(n[r]=Promise.resolve(e[r]).then(s=>s?this._getAddress(s):null))}),["gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","value"].forEach(r=>{e[r]!=null&&(n[r]=Promise.resolve(e[r]).then(s=>s?pt.from(s):null))}),["type"].forEach(r=>{e[r]!=null&&(n[r]=Promise.resolve(e[r]).then(s=>s??null))}),e.accessList&&(n.accessList=this.formatter.accessList(e.accessList)),["data"].forEach(r=>{e[r]!=null&&(n[r]=Promise.resolve(e[r]).then(s=>s?Rt(s):null))}),this.formatter.transactionRequest(yield ye(n))})}_getFilter(t){return kt(this,void 0,void 0,function*(){t=yield t;const e={};return t.address!=null&&(e.address=this._getAddress(t.address)),["blockHash","topics"].forEach(n=>{t[n]!=null&&(e[n]=t[n])}),["fromBlock","toBlock"].forEach(n=>{t[n]!=null&&(e[n]=this._getBlockTag(t[n]))}),this.formatter.filter(yield ye(e))})}_call(t,e,n){return kt(this,void 0,void 0,function*(){n>=K1&&Ht.throwError("CCIP read exceeded maximum redirections",H.errors.SERVER_ERROR,{redirects:n,transaction:t});const r=t.to,s=yield this.perform("call",{transaction:t,blockTag:e});if(n>=0&&e==="latest"&&r!=null&&s.substring(0,10)==="0x556f1830"&&rr(s)%32===4)try{const o=Fe(s,4),a=Fe(o,0,32);pt.from(a).eq(r)||Ht.throwError("CCIP Read sender did not match",H.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction:t,data:s});const l=[],c=pt.from(Fe(o,32,64)).toNumber(),h=pt.from(Fe(o,c,c+32)).toNumber(),u=Fe(o,c+32);for(let M=0;M<h;M++){const D=Eo(u,M*32);D==null&&Ht.throwError("CCIP Read contained corrupt URL string",H.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction:t,data:s}),l.push(D)}const p=Ls(o,64);pt.from(Fe(o,100,128)).isZero()||Ht.throwError("CCIP Read callback selector included junk",H.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction:t,data:s});const x=Fe(o,96,100),b=Ls(o,128),g=yield this.ccipReadFetch(t,p,l);g==null&&Ht.throwError("CCIP Read disabled or provided no URLs",H.errors.CALL_EXCEPTION,{name:"OffchainLookup",signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",transaction:t,data:s});const v={to:r,data:Ke([x,Bu([g,b])])};return this._call(v,e,n+1)}catch(o){if(o.code===H.errors.SERVER_ERROR)throw o}try{return Rt(s)}catch(o){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"call",params:{transaction:t,blockTag:e},result:s,error:o})}})}call(t,e){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const n=yield ye({transaction:this._getTransactionRequest(t),blockTag:this._getBlockTag(e),ccipReadEnabled:Promise.resolve(t.ccipReadEnabled)});return this._call(n.transaction,n.blockTag,n.ccipReadEnabled?0:-1)})}estimateGas(t){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const e=yield ye({transaction:this._getTransactionRequest(t)}),n=yield this.perform("estimateGas",e);try{return pt.from(n)}catch(r){return Ht.throwError("bad result from backend",H.errors.SERVER_ERROR,{method:"estimateGas",params:e,result:n,error:r})}})}_getAddress(t){return kt(this,void 0,void 0,function*(){t=yield t,typeof t!="string"&&Ht.throwArgumentError("invalid address or ENS name","name",t);const e=yield this.resolveName(t);return e==null&&Ht.throwError("ENS name not configured",H.errors.UNSUPPORTED_OPERATION,{operation:`resolveName(${JSON.stringify(t)})`}),e})}_getBlock(t,e){return kt(this,void 0,void 0,function*(){yield this.getNetwork(),t=yield t;let n=-128;const r={includeTransactions:!!e};if(ee(t,32))r.blockHash=t;else try{r.blockTag=yield this._getBlockTag(t),ee(r.blockTag)&&(n=parseInt(r.blockTag.substring(2),16))}catch{Ht.throwArgumentError("invalid block hash or block tag","blockHashOrBlockTag",t)}return xs(()=>kt(this,void 0,void 0,function*(){const s=yield this.perform("getBlock",r);if(s==null)return r.blockHash!=null&&this._emitted["b:"+r.blockHash]==null||r.blockTag!=null&&n>this._emitted.block?null:void 0;if(e){let o=null;for(let l=0;l<s.transactions.length;l++){const c=s.transactions[l];if(c.blockNumber==null)c.confirmations=0;else if(c.confirmations==null){o==null&&(o=yield this._getInternalBlockNumber(100+2*this.pollingInterval));let h=o-c.blockNumber+1;h<=0&&(h=1),c.confirmations=h}}const a=this.formatter.blockWithTransactions(s);return a.transactions=a.transactions.map(l=>this._wrapTransaction(l)),a}return this.formatter.block(s)}),{oncePoll:this})})}getBlock(t){return this._getBlock(t,!1)}getBlockWithTransactions(t){return this._getBlock(t,!0)}getTransaction(t){return kt(this,void 0,void 0,function*(){yield this.getNetwork(),t=yield t;const e={transactionHash:this.formatter.hash(t,!0)};return xs(()=>kt(this,void 0,void 0,function*(){const n=yield this.perform("getTransaction",e);if(n==null)return this._emitted["t:"+t]==null?null:void 0;const r=this.formatter.transactionResponse(n);if(r.blockNumber==null)r.confirmations=0;else if(r.confirmations==null){let o=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-r.blockNumber+1;o<=0&&(o=1),r.confirmations=o}return this._wrapTransaction(r)}),{oncePoll:this})})}getTransactionReceipt(t){return kt(this,void 0,void 0,function*(){yield this.getNetwork(),t=yield t;const e={transactionHash:this.formatter.hash(t,!0)};return xs(()=>kt(this,void 0,void 0,function*(){const n=yield this.perform("getTransactionReceipt",e);if(n==null)return this._emitted["t:"+t]==null?null:void 0;if(n.blockHash==null)return;const r=this.formatter.receipt(n);if(r.blockNumber==null)r.confirmations=0;else if(r.confirmations==null){let o=(yield this._getInternalBlockNumber(100+2*this.pollingInterval))-r.blockNumber+1;o<=0&&(o=1),r.confirmations=o}return r}),{oncePoll:this})})}getLogs(t){return kt(this,void 0,void 0,function*(){yield this.getNetwork();const e=yield ye({filter:this._getFilter(t)}),n=yield this.perform("getLogs",e);return n.forEach(r=>{r.removed==null&&(r.removed=!1)}),Tt.arrayOf(this.formatter.filterLog.bind(this.formatter))(n)})}getEtherPrice(){return kt(this,void 0,void 0,function*(){return yield this.getNetwork(),this.perform("getEtherPrice",{})})}_getBlockTag(t){return kt(this,void 0,void 0,function*(){if(t=yield t,typeof t=="number"&&t<0){t%1&&Ht.throwArgumentError("invalid BlockTag","blockTag",t);let e=yield this._getInternalBlockNumber(100+2*this.pollingInterval);return e+=t,e<0&&(e=0),this.formatter.blockTag(e)}return this.formatter.blockTag(t)})}getResolver(t){return kt(this,void 0,void 0,function*(){let e=t;for(;;){if(e===""||e==="."||t!=="eth"&&e==="eth")return null;const n=yield this._getResolver(e,"getResolver");if(n!=null){const r=new qf(this,n,t);return e!==t&&!(yield r.supportsWildcard())?null:r}e=e.split(".").slice(1).join(".")}})}_getResolver(t,e){return kt(this,void 0,void 0,function*(){e==null&&(e="ENS");const n=yield this.getNetwork();n.ensAddress||Ht.throwError("network does not support ENS",H.errors.UNSUPPORTED_OPERATION,{operation:e,network:n.name});try{const r=yield this.call({to:n.ensAddress,data:"0x0178b8bf"+wo(t).substring(2)});return this.formatter.callAddress(r)}catch{}return null})}resolveName(t){return kt(this,void 0,void 0,function*(){t=yield t;try{return Promise.resolve(this.formatter.address(t))}catch(n){if(ee(t))throw n}typeof t!="string"&&Ht.throwArgumentError("invalid ENS name","name",t);const e=yield this.getResolver(t);return e?yield e.getAddress():null})}lookupAddress(t){return kt(this,void 0,void 0,function*(){t=yield t,t=this.formatter.address(t);const e=t.substring(2).toLowerCase()+".addr.reverse",n=yield this._getResolver(e,"lookupAddress");if(n==null)return null;const r=Eo(yield this.call({to:n,data:"0x691f3431"+wo(e).substring(2)}),0);return(yield this.resolveName(r))!=t?null:r})}getAvatar(t){return kt(this,void 0,void 0,function*(){let e=null;if(ee(t)){const s=this.formatter.address(t).substring(2).toLowerCase()+".addr.reverse",o=yield this._getResolver(s,"getAvatar");if(!o)return null;e=new qf(this,o,s);try{const a=yield e.getAvatar();if(a)return a.url}catch(a){if(a.code!==H.errors.CALL_EXCEPTION)throw a}try{const a=Eo(yield this.call({to:o,data:"0x691f3431"+wo(s).substring(2)}),0);e=yield this.getResolver(a)}catch(a){if(a.code!==H.errors.CALL_EXCEPTION)throw a;return null}}else if(e=yield this.getResolver(t),!e)return null;const n=yield e.getAvatar();return n==null?null:n.url})}perform(t,e){return Ht.throwError(t+" not implemented",H.errors.NOT_IMPLEMENTED,{operation:t})}_startEvent(t){this.polling=this._events.filter(e=>e.pollable()).length>0}_stopEvent(t){this.polling=this._events.filter(e=>e.pollable()).length>0}_addEventListener(t,e,n){const r=new tb(Ar(t),e,n);return this._events.push(r),this._startEvent(r),this}on(t,e){return this._addEventListener(t,e,!1)}once(t,e){return this._addEventListener(t,e,!0)}emit(t,...e){let n=!1,r=[],s=Ar(t);return this._events=this._events.filter(o=>o.tag!==s?!0:(setTimeout(()=>{o.listener.apply(this,e)},0),n=!0,o.once?(r.push(o),!1):!0)),r.forEach(o=>{this._stopEvent(o)}),n}listenerCount(t){if(!t)return this._events.length;let e=Ar(t);return this._events.filter(n=>n.tag===e).length}listeners(t){if(t==null)return this._events.map(n=>n.listener);let e=Ar(t);return this._events.filter(n=>n.tag===e).map(n=>n.listener)}off(t,e){if(e==null)return this.removeAllListeners(t);const n=[];let r=!1,s=Ar(t);return this._events=this._events.filter(o=>o.tag!==s||o.listener!=e||r?!0:(r=!0,n.push(o),!1)),n.forEach(o=>{this._stopEvent(o)}),this}removeAllListeners(t){let e=[];if(t==null)e=this._events,this._events=[];else{const n=Ar(t);this._events=this._events.filter(r=>r.tag!==n?!0:(e.push(r),!1))}return e.forEach(n=>{this._stopEvent(n)}),this}}var mi=globalThis&&globalThis.__awaiter||function(i,t,e,n){function r(s){return s instanceof e?s:new e(function(o){o(s)})}return new(e||(e=Promise))(function(s,o){function a(h){try{c(n.next(h))}catch(u){o(u)}}function l(h){try{c(n.throw(h))}catch(u){o(u)}}function c(h){h.done?s(h.value):r(h.value).then(a,l)}c((n=n.apply(i,t||[])).next())})};const Be=new H(Jo),sb=["call","estimateGas"];function bs(i,t){if(i==null)return null;if(typeof i.message=="string"&&i.message.match("reverted")){const e=ee(i.data)?i.data:null;if(!t||e)return{message:i.message,data:e}}if(typeof i=="object"){for(const e in i){const n=bs(i[e],t);if(n)return n}return null}if(typeof i=="string")try{return bs(JSON.parse(i),t)}catch{}return null}function ku(i,t,e){const n=e.transaction||e.signedTransaction;if(i==="call"){const s=bs(t,!0);if(s)return s.data;Be.throwError("missing revert data in call exception; Transaction reverted without a reason string",H.errors.CALL_EXCEPTION,{data:"0x",transaction:n,error:t})}if(i==="estimateGas"){let s=bs(t.body,!1);s==null&&(s=bs(t,!1)),s&&Be.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",H.errors.UNPREDICTABLE_GAS_LIMIT,{reason:s.message,method:i,transaction:n,error:t})}let r=t.message;throw t.code===H.errors.SERVER_ERROR&&t.error&&typeof t.error.message=="string"?r=t.error.message:typeof t.body=="string"?r=t.body:typeof t.responseText=="string"&&(r=t.responseText),r=(r||"").toLowerCase(),r.match(/insufficient funds|base fee exceeds gas limit/i)&&Be.throwError("insufficient funds for intrinsic transaction cost",H.errors.INSUFFICIENT_FUNDS,{error:t,method:i,transaction:n}),r.match(/nonce (is )?too low/i)&&Be.throwError("nonce has already been used",H.errors.NONCE_EXPIRED,{error:t,method:i,transaction:n}),r.match(/replacement transaction underpriced|transaction gas price.*too low/i)&&Be.throwError("replacement fee too low",H.errors.REPLACEMENT_UNDERPRICED,{error:t,method:i,transaction:n}),r.match(/only replay-protected/i)&&Be.throwError("legacy pre-eip-155 transactions not supported",H.errors.UNSUPPORTED_OPERATION,{error:t,method:i,transaction:n}),sb.indexOf(i)>=0&&r.match(/gas required exceeds allowance|always failing transaction|execution reverted/)&&Be.throwError("cannot estimate gas; transaction may fail or may require manual gas limit",H.errors.UNPREDICTABLE_GAS_LIMIT,{error:t,method:i,transaction:n}),t}function jf(i){return new Promise(function(t){setTimeout(t,i)})}function ob(i){if(i.error){const t=new Error(i.error.message);throw t.code=i.error.code,t.data=i.error.data,t}return i.result}function us(i){return i&&i.toLowerCase()}const dl={};class Ou extends Vs{constructor(t,e,n){if(super(),t!==dl)throw new Error("do not call the JsonRpcSigner constructor directly; use provider.getSigner");dt(this,"provider",e),n==null&&(n=0),typeof n=="string"?(dt(this,"_address",this.provider.formatter.address(n)),dt(this,"_index",null)):typeof n=="number"?(dt(this,"_index",n),dt(this,"_address",null)):Be.throwArgumentError("invalid address or index","addressOrIndex",n)}connect(t){return Be.throwError("cannot alter JSON-RPC Signer connection",H.errors.UNSUPPORTED_OPERATION,{operation:"connect"})}connectUnchecked(){return new ab(dl,this.provider,this._address||this._index)}getAddress(){return this._address?Promise.resolve(this._address):this.provider.send("eth_accounts",[]).then(t=>(t.length<=this._index&&Be.throwError("unknown account #"+this._index,H.errors.UNSUPPORTED_OPERATION,{operation:"getAddress"}),this.provider.formatter.address(t[this._index])))}sendUncheckedTransaction(t){t=Ee(t);const e=this.getAddress().then(n=>(n&&(n=n.toLowerCase()),n));if(t.gasLimit==null){const n=Ee(t);n.from=e,t.gasLimit=this.provider.estimateGas(n)}return t.to!=null&&(t.to=Promise.resolve(t.to).then(n=>mi(this,void 0,void 0,function*(){if(n==null)return null;const r=yield this.provider.resolveName(n);return r==null&&Be.throwArgumentError("provided ENS name resolves to null","tx.to",n),r}))),ye({tx:ye(t),sender:e}).then(({tx:n,sender:r})=>{n.from!=null?n.from.toLowerCase()!==r&&Be.throwArgumentError("from address mismatch","transaction",t):n.from=r;const s=this.provider.constructor.hexlifyTransaction(n,{from:!0});return this.provider.send("eth_sendTransaction",[s]).then(o=>o,o=>ku("sendTransaction",o,s))})}signTransaction(t){return Be.throwError("signing transactions is unsupported",H.errors.UNSUPPORTED_OPERATION,{operation:"signTransaction"})}sendTransaction(t){return mi(this,void 0,void 0,function*(){const e=yield this.provider._getInternalBlockNumber(100+2*this.provider.pollingInterval),n=yield this.sendUncheckedTransaction(t);try{return yield xs(()=>mi(this,void 0,void 0,function*(){const r=yield this.provider.getTransaction(n);if(r!==null)return this.provider._wrapTransaction(r,n,e)}),{oncePoll:this.provider})}catch(r){throw r.transactionHash=n,r}})}signMessage(t){return mi(this,void 0,void 0,function*(){const e=typeof t=="string"?Qn(t):t,n=yield this.getAddress();return yield this.provider.send("personal_sign",[Rt(e),n.toLowerCase()])})}_legacySignMessage(t){return mi(this,void 0,void 0,function*(){const e=typeof t=="string"?Qn(t):t,n=yield this.getAddress();return yield this.provider.send("eth_sign",[n.toLowerCase(),Rt(e)])})}_signTypedData(t,e,n){return mi(this,void 0,void 0,function*(){const r=yield en.resolveNames(t,e,n,o=>this.provider.resolveName(o)),s=yield this.getAddress();return yield this.provider.send("eth_signTypedData_v4",[s.toLowerCase(),JSON.stringify(en.getPayload(r.domain,e,r.value))])})}unlock(t){return mi(this,void 0,void 0,function*(){const e=this.provider,n=yield this.getAddress();return e.send("personal_unlockAccount",[n.toLowerCase(),t,null])})}}class ab extends Ou{sendTransaction(t){return this.sendUncheckedTransaction(t).then(e=>({hash:e,nonce:null,gasLimit:null,gasPrice:null,data:null,value:null,chainId:null,confirmations:0,from:null,wait:n=>this.provider.waitForTransaction(e,n)}))}}const lb={chainId:!0,data:!0,gasLimit:!0,gasPrice:!0,nonce:!0,to:!0,value:!0,type:!0,accessList:!0,maxFeePerGas:!0,maxPriorityFeePerGas:!0};class cb extends rb{constructor(t,e){let n=e;n==null&&(n=new Promise((r,s)=>{setTimeout(()=>{this.detectNetwork().then(o=>{r(o)},o=>{s(o)})},0)})),super(n),t||(t=jn(this.constructor,"defaultUrl")()),typeof t=="string"?dt(this,"connection",Object.freeze({url:t})):dt(this,"connection",Object.freeze(Ee(t))),this._nextId=42}get _cache(){return this._eventLoopCache==null&&(this._eventLoopCache={}),this._eventLoopCache}static defaultUrl(){return"http://localhost:8545"}detectNetwork(){return this._cache.detectNetwork||(this._cache.detectNetwork=this._uncachedDetectNetwork(),setTimeout(()=>{this._cache.detectNetwork=null},0)),this._cache.detectNetwork}_uncachedDetectNetwork(){return mi(this,void 0,void 0,function*(){yield jf(0);let t=null;try{t=yield this.send("eth_chainId",[])}catch{try{t=yield this.send("net_version",[])}catch{}}if(t!=null){const e=jn(this.constructor,"getNetwork");try{return e(pt.from(t).toNumber())}catch(n){return Be.throwError("could not detect network",H.errors.NETWORK_ERROR,{chainId:t,event:"invalidNetwork",serverError:n})}}return Be.throwError("could not detect network",H.errors.NETWORK_ERROR,{event:"noNetwork"})})}getSigner(t){return new Ou(dl,this,t)}getUncheckedSigner(t){return this.getSigner(t).connectUnchecked()}listAccounts(){return this.send("eth_accounts",[]).then(t=>t.map(e=>this.formatter.address(e)))}send(t,e){const n={method:t,params:e,id:this._nextId++,jsonrpc:"2.0"};this.emit("debug",{action:"request",request:yi(n),provider:this});const r=["eth_chainId","eth_blockNumber"].indexOf(t)>=0;if(r&&this._cache[t])return this._cache[t];const s=Bl(this.connection,JSON.stringify(n),ob).then(o=>(this.emit("debug",{action:"response",request:n,response:o,provider:this}),o),o=>{throw this.emit("debug",{action:"response",error:o,request:n,provider:this}),o});return r&&(this._cache[t]=s,setTimeout(()=>{this._cache[t]=null},0)),s}prepareRequest(t,e){switch(t){case"getBlockNumber":return["eth_blockNumber",[]];case"getGasPrice":return["eth_gasPrice",[]];case"getBalance":return["eth_getBalance",[us(e.address),e.blockTag]];case"getTransactionCount":return["eth_getTransactionCount",[us(e.address),e.blockTag]];case"getCode":return["eth_getCode",[us(e.address),e.blockTag]];case"getStorageAt":return["eth_getStorageAt",[us(e.address),he(e.position,32),e.blockTag]];case"sendTransaction":return["eth_sendRawTransaction",[e.signedTransaction]];case"getBlock":return e.blockTag?["eth_getBlockByNumber",[e.blockTag,!!e.includeTransactions]]:e.blockHash?["eth_getBlockByHash",[e.blockHash,!!e.includeTransactions]]:null;case"getTransaction":return["eth_getTransactionByHash",[e.transactionHash]];case"getTransactionReceipt":return["eth_getTransactionReceipt",[e.transactionHash]];case"call":{const n=jn(this.constructor,"hexlifyTransaction");return["eth_call",[n(e.transaction,{from:!0}),e.blockTag]]}case"estimateGas":{const n=jn(this.constructor,"hexlifyTransaction");return["eth_estimateGas",[n(e.transaction,{from:!0})]]}case"getLogs":return e.filter&&e.filter.address!=null&&(e.filter.address=us(e.filter.address)),["eth_getLogs",[e.filter]]}return null}perform(t,e){return mi(this,void 0,void 0,function*(){if(t==="call"||t==="estimateGas"){const r=e.transaction;if(r&&r.type!=null&&pt.from(r.type).isZero()&&r.maxFeePerGas==null&&r.maxPriorityFeePerGas==null){const s=yield this.getFeeData();s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null&&(e=Ee(e),e.transaction=Ee(r),delete e.transaction.type)}}const n=this.prepareRequest(t,e);n==null&&Be.throwError(t+" not implemented",H.errors.NOT_IMPLEMENTED,{operation:t});try{return yield this.send(n[0],n[1])}catch(r){return ku(t,r,e)}})}_startEvent(t){t.tag==="pending"&&this._startPending(),super._startEvent(t)}_startPending(){if(this._pendingFilter!=null)return;const t=this,e=this.send("eth_newPendingTransactionFilter",[]);this._pendingFilter=e,e.then(function(n){function r(){t.send("eth_getFilterChanges",[n]).then(function(s){if(t._pendingFilter!=e)return null;let o=Promise.resolve();return s.forEach(function(a){t._emitted["t:"+a.toLowerCase()]="pending",o=o.then(function(){return t.getTransaction(a).then(function(l){return t.emit("pending",l),null})})}),o.then(function(){return jf(1e3)})}).then(function(){if(t._pendingFilter!=e){t.send("eth_uninstallFilter",[n]);return}return setTimeout(function(){r()},0),null}).catch(s=>{})}return r(),n}).catch(n=>{})}_stopEvent(t){t.tag==="pending"&&this.listenerCount("pending")===0&&(this._pendingFilter=null),super._stopEvent(t)}static hexlifyTransaction(t,e){const n=Ee(lb);if(e)for(const s in e)e[s]&&(n[s]=!0);xx(t,n);const r={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(function(s){if(t[s]==null)return;const o=Sl(pt.from(t[s]));s==="gasLimit"&&(s="gas"),r[s]=o}),["from","to","data"].forEach(function(s){t[s]!=null&&(r[s]=Rt(t[s]))}),t.accessList&&(r.accessList=rs(t.accessList)),r}}const Xf=new H(Jo);let fb=1;function Zf(i,t){const e="Web3LegacyFetcher";return function(n,r){const s={method:n,params:r,id:fb++,jsonrpc:"2.0"};return new Promise((o,a)=>{this.emit("debug",{action:"request",fetcher:e,request:yi(s),provider:this}),t(s,(l,c)=>{if(l)return this.emit("debug",{action:"response",fetcher:e,error:l,request:s,provider:this}),a(l);if(this.emit("debug",{action:"response",fetcher:e,request:s,response:c,provider:this}),c.error){const h=new Error(c.error.message);return h.code=c.error.code,h.data=c.error.data,a(h)}o(c.result)})})}}function hb(i){return function(t,e){e==null&&(e=[]);const n={method:t,params:e};return this.emit("debug",{action:"request",fetcher:"Eip1193Fetcher",request:yi(n),provider:this}),i.request(n).then(r=>(this.emit("debug",{action:"response",fetcher:"Eip1193Fetcher",request:n,response:r,provider:this}),r),r=>{throw this.emit("debug",{action:"response",fetcher:"Eip1193Fetcher",request:n,error:r,provider:this}),r})}}class Uu extends cb{constructor(t,e){t==null&&Xf.throwArgumentError("missing provider","provider",t);let n=null,r=null,s=null;typeof t=="function"?(n="unknown:",r=t):(n=t.host||t.path||"",!n&&t.isMetaMask&&(n="metamask"),s=t,t.request?(n===""&&(n="eip-1193:"),r=hb(t)):t.sendAsync?r=Zf(t,t.sendAsync.bind(t)):t.send?r=Zf(t,t.send.bind(t)):Xf.throwArgumentError("unsupported provider","provider",t),n||(n="unknown:")),super(n,e),dt(this,"jsonRpcFetchFunc",r),dt(this,"provider",s)}send(t,e){return this.jsonRpcFetchFunc(t,e)}}const ub="units/5.6.1";new H(ub);const db=["wei","kwei","mwei","gwei","szabo","finney","ether"];function pb(i,t){if(typeof t=="string"){const e=db.indexOf(t);e!==-1&&(t=3*e)}return yo(i,t??18)}window.ethereum||alert(`Please install MetaMask or another Wallet Software to use this dApp!
Could not access window.ethereum`);let ki,Ds,kl=!1,pl=document.getElementById("connect"),ml=document.getElementById("connect_test");pl&&pl.addEventListener("click",async()=>{await mb()});ml&&ml.addEventListener("click",async()=>{await zu()});!pl&&!ml&&await zu();async function mb(){kl=!1,ki=new Uu(window.ethereum),await ki.send("eth_requestAccounts",[]),Ds=await ki.getSigner(),await Ds.getAddress(),await gb(ki)}async function zu(){kl=!0,ki=new Uu(window.ethereum),await ki.send("eth_requestAccounts",[]),Ds=await ki.getSigner(),await Ds.getAddress(),await vb(ki)}async function gb(i){(await i.getNetwork()).chainId!==137&&window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x89",rpcUrls:["https://polygon-rpc.com/"],chainName:"Polygon Mainnet",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://polygonscan.com/"]}]})}async function vb(i){(await i.getNetwork()).chainId!==80001&&window.ethereum.request({method:"wallet_addEthereumChain",params:[{chainId:"0x13881",rpcUrls:["https://matic-mumbai.chainstacklabs.com"],chainName:"Polygon Mumbai",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorerUrls:["https://mumbai.polygonscan.com"]}]})}function Gu(i){const n=kl?{erc1155:"0x37FD34a131b07ce495f7D16275B6dc4Ed1Bbd8C5",troops:"0x430a7de60d42014d6e22064417a3d09634725367",items:"0x430a7de60d42014d6e22064417a3d09634725367",erc721batch:"0xf86a72c5d9245c43e9d13cbc4cb0b49a869571b5"}[i]:{troops:"0xb195991d16c1473bdF4b122A2eD0245113fCb2F9",items:"0x70242aAa2a2e97Fa71936C8ED0185110cA23B866",staking:"0x1F827D438EeA6F06C034bf354243AB9b7B8cbB7f",erc1155:"0xc6aC1a63fbD7a843cf4F364177CD16eB0112dC09"}[i],r=["function tokenOfOwnerByIndex(address owner, uint256 index) external view returns (uint256 tokenId)"],s=["function name() external view returns (string memory)","function symbol() external view returns (string memory)","function tokenURI(uint256 tokenId) external view returns (string memory)","function balanceOf(address account) external view returns (uint256)","function safeTransferFrom(address from, address to, uint256 tokenId, bytes memory _data) public"],o=["function buyStarter(uint256 id, uint8 amount) public payable","function buyBooster(uint256 id, uint8 amount) public payable","function STARTER_PRICE() public view returns (uint256)","function BOOSTER_PRICE() public view returns (uint256)","function safeTransferFrom(address from, address to, uint256 id, uint256 amount, bytes memory data) public","function safeBatchTransferFrom(address from, address to, uint256[] memory ids, uint256[] memory amounts, bytes memory data)"],a=["function getTokensStaked(address query) public view returns(uint256[] memory)","function unstakeMul(uint256[] memory tokenIds) external"],c={troops:s+r,items:s,staking:a,erc1155:o}[i];return new D1(n,c,Ds)}const xb=i=>new Promise(t=>setTimeout(t,i)),ws=new zv,lr=new dn(75,innerWidth/innerHeight,.1,1e3);lr.position.z=5;const Mi=new _h({antialias:!0,alpha:!0});Mi.setSize(innerWidth,innerHeight);document.body.appendChild(Mi.domElement);window.addEventListener("resize",()=>{lr.aspect=innerWidth/innerHeight,lr.updateProjectionMatrix(),Mi.setSize(innerWidth,innerHeight)});const Vu=new nx;let _b=new Promise((i,t)=>{Vu.load("https://i.imgur.com/CkmEmKk.jpeg",e=>{i(e)})}),yb=new Promise((i,t)=>{Vu.load("https://i.imgur.com/CkmEmKk.jpeg",e=>{i(e)})}),sn=[],Ol=[],gl,To;Wu();class Bo{static revealCount=0;constructor(t,e){this.group=t,this.anchor=e,this.hasMoved=!1,this.sleepTime=Math.random()*1e3,this.count=0,this.lastTime=Date.now(),this.clicked=!1}shake(){const t=Date.now()-this.lastTime;this.lastTime=Date.now(),this.sleepTime<0?this.count+=.001*t:this.sleepTime-=5,this.hasMoved&&(this.x=this.anchor.x+Math.cos(this.count)/30,this.y=this.anchor.y+Math.cos(this.count)/30)}set hasMoved(t){this._hasMoved=t}get hasMoved(){return this._hasMoved}get x(){return this.group.position.x}set x(t){this.group.position.x=t}get y(){return this.group.position.y}set y(t){this.group.position.y=t}}async function bb(){const i=[],t=[];let e=0,n=0,r=1.5,s=3,o=5*r;for(let a=0;a<10;a++){const l=new ms,c=new Kr(1,2,.01),h=new Es({map:await _b}),u=new qn(c,h);l.add(u);const p=new Es({map:await yb}),x=new qn(c,p);l.add(x),e>=o&&(e=0,n+=s),x.position.z-=.001,l.position.x=o/2,l.position.y=s/2,e+=r;const b=new Bo(l,{x:e,y:n});i.push(b),t.push(l),ws.add(l)}return{instances:i,objects:t}}function Hu(){let i=.5,t=.5;for(let e=0;e<sn.length;e++)i+=sn[e].x,t+=sn[e].y;i/=sn.length,t/=sn.length,lr.position.x=i,lr.position.y=t}function wb(i){To.x=i.clientX/window.innerWidth*2-1,To.y=-(i.clientY/window.innerHeight)*2+1,gl.setFromCamera(To,lr);const t=gl.intersectObjects(Ol);t.length>0&&Mb(t[0].object.parent)}function Mb(i){const t=sn.find(e=>e.group===i);t.clicked||new Th(i.rotation).to({x:0,y:-Math.PI,z:0},1500).easing(Fr.Elastic.InOut).onComplete(()=>{Bo.revealCount++,t.clicked=!0,Bo.revealCount===sn.length&&Sb()}).start()}function Sb(){document.getElementById("exit-container").style.pointerEvents="all",document.getElementById("exit-container").style.opacity="1",document.getElementById("exit-button").addEventListener("click",()=>{Db()})}async function Ab(){for(let i=0;i<sn.length;i++){const t=sn[i];await xb(100),new Th(t.group.position).to(t.anchor,1e3).easing(Fr.Elastic.InOut).start().onUpdate(()=>Hu()).onComplete(()=>t.hasMoved=!0)}}function Wu(){ax();for(let i=0;i<sn.length;i++)sn[i].shake();Mi.render(ws,lr),requestAnimationFrame(Wu)}function Eb(){for(Bo.revealCount=0,sn=[],Ol=[];ws.children.length>0;)ws.remove(ws.children[0])}function Tb(){Eb(),bb().then(i=>{Hu(),sn=i.instances,Ol=i.objects,Ab().then(()=>{gl=new rx,To=new ne,Mi.domElement.addEventListener("click",wb)})})}class qu{constructor(t){this.packType=t,this.loadPrice()}init(){this.buyButton=document.getElementById(`buy-${this.packType}`),this.openButton=document.getElementById(`open-${this.packType}`),this._amount=0,this.buyButton.addEventListener("click",()=>{Pb(`${this.packType} pack`,0,this)}),this.openButton.addEventListener("click",()=>{Lb(),Tb()})}updatePrice(){const t=parseInt(document.getElementById("input-number-field").innerText),e=this.tokenPrice.mul(t);console.log(this.tokenPrice._hex),console.log(this.tokenPrice.toString()),document.getElementById("article-price").innerText=`Price : ${pb(e,18)} MATIC`}}class Cb extends qu{constructor(t){super(t),this.tokenID=500}loadPrice(){this.contract=Gu("erc1155"),this.contract.BOOSTER_PRICE().then(t=>{this.tokenPrice=t,console.log(this.packType,this.tokenPrice),this.init()})}async buy(){const t=parseInt(document.getElementById("input-number-field").innerText),e=this.tokenPrice.mul(t),n=await this.contract.estimateGas.buyBooster(this.tokenID,t,{value:e.toString()}),r={value:e,gasLimit:n.mul(120).div(100)};await this.contract.buyBooster(this.tokenID,t,r)}}class Rb extends qu{constructor(t){super(t),this.tokenID=1}loadPrice(){this.contract=Gu("erc1155"),this.contract.STARTER_PRICE().then(t=>{this.tokenPrice=t,console.log(this.packType,this.tokenPrice),this.init()})}async buy(){const t=parseInt(document.getElementById("input-number-field").innerText),e=this.tokenPrice.mul(t),n=await this.contract.estimateGas.buyStarter(this.tokenID,t,{value:e.toString()}),r={value:e,gasLimit:n.mul(120).div(100)};await this.contract.buyStarter(this.tokenID,t,r)}}function Pb(i,t,e){document.getElementById("modal-title").innerText=i,document.getElementById("article-price").innerText=`Price : ${0} MATIC`;const n=document.getElementById("container");n.style.filter="blur(10px)",n.style.pointerEvents="none";const r=document.getElementById("modal-container");r.style.pointerEvents="all",r.style.opacity="1";const s=document.getElementById("modal");s.style.transform="scale(1.1)";const o=document.getElementById("close-modal");document.getElementById("input-number-field").innerText="0";const a=document.getElementById("buy-article"),l=async()=>{await e.buy()};a.addEventListener("click",l);const c=h=>{h.target!==r&&h.target!==o||(Ib(),a.removeEventListener("click",l),r.removeEventListener("click",h))};r.addEventListener("click",c)}function Ib(){const i=document.getElementById("container");i.style.filter="blur(0px)",i.style.pointerEvents="all";const t=document.getElementById("modal-container");t.style.pointerEvents="none",t.style.opacity="0";const e=document.getElementById("modal");e.style.transform="scale(1)"}function Lb(){document.getElementById("container").style.filter="blur(10px)",document.getElementById("container").style.pointerEvents="none",Mi.domElement.style.pointerEvents="all",Mi.domElement.style.opacity="1"}function Db(){document.getElementById("container").style.filter="blur(0px)",document.getElementById("container").style.pointerEvents="all",document.getElementById("exit-container").style.pointerEvents="none",document.getElementById("exit-container").style.opacity="0",Mi.domElement.style.pointerEvents="none",Mi.domElement.style.opacity="0"}document.getElementById("exit-container").style.display="flex";document.getElementById("modal-container").style.display="flex";const ko=document.getElementById("input-number-field");document.getElementById("buy-decrease").addEventListener("click",()=>{ko.innerText=Math.max(parseInt(ko.innerText)-1,0),ju.updatePrice(),Xu.updatePrice()});document.getElementById("buy-increase").addEventListener("click",()=>{ko.innerText=parseInt(ko.innerText)+1,ju.updatePrice(),Xu.updatePrice()});const ju=new Rb("starter"),Xu=new Cb("booster");
